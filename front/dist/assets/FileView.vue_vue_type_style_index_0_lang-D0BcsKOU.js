import{d as B,a as U,r as S,t as x,x as E,g as j,G as g,q as D,u as q,b as A,e as G,f as K,o as i,h as u,i as a,k as o,F as y,j as _,y as O,s as p,w as v,v as z,l as h,C as k,B as P,n as I,c as Q,p as W}from"./index-D6pvmuxL.js";import{F as Y}from"./FileItem-DytLDN29.js";const J={class:"content_meta"},X={key:0,class:"crumb"},Z=["onClick","title"],ee={class:"search"},te=a("span",null,"Title : ",-1),oe=a("span",null,"Type : ",-1),le=a("span",null,"Rate : ",-1),ne=["value","innerHTML"],se=["value","innerHTML"],ae={key:0},ie=a("span",null,"Cascade : ",-1),re=a("label",{class:"buttonStyle",for:"FV_S_CB"},null,-1),ue={class:"display"},de=a("a",{class:"sysIcon sysIcon_fengefu"},null,-1),ce=a("a",{class:"buttonStyle sysIcon sysIcon_fengefu"},null,-1),ye={key:2},pe=a("span",null,"Sort : ",-1),fe=["value"],_e=a("a",{class:"sysIcon sysIcon_fengefu"},null,-1),ve=["onClick"],ge=B({__name:"FileView",setup(me){const V=U(),$=S(null),M=x(),f=E();let s={mode:"directory",pid:"0",keyword:"",tag_id:"",node_type:"",cascade_dir:"",with:"",group:"",rate:""};const T=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1;j(async n=>{console.info("onBeforeRouteUpdate",n),s=Object.assign({mode:"directory",pid:"0",keyword:"",tag_id:"",node_type:"",cascade_dir:"",with:"",group:"",rate:""},g.copyObject(n.query)),await m()});let d=S([]),c=S([]),l;async function m(n){if(console.info("getList",f.name),c.value=[],n)c.value=n;else{switch(d.value=[],f.name){default:break;case"Recycle":s.group="deleted";break;case"Favourite":s.group="favourite";break}const t=await D("file/get",s);if(!t)return;d.value=t.path,c.value=l.sortList(t.list,l.sortVal.value)}return l&&l.setList(c.value),{crumb:d.value,node:c.value}}function F(){let n=0,t="root";if(d.value.length){let e=d.value[d.value.length-1];e&&(n=e.id??0,t=e.title??"root")}V.set({title:`mkdir | ${t}`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{label:"title",type:"text"}],callback:{submit:async e=>{const b=e.content.form[0].value;if(!b)return!0;const N=await D("file/mkdir",{title:b,pid:`${n}`});m()}}})}function w(){let n=0,t="root";if(d.value.length){let e=d.value[d.value.length-1];e&&(n=e.id??0,t=e.title??"root")}V.set({title:`upload | ${t}`,alpha:!1,key:`FileView_addFile_${n}`,single:!0,w:400,h:200,minW:400,minH:200,allow_resize:!0,allow_move:!0,allow_fullscreen:!0,auto_focus:!0,component:[{componentName:"uploader",data:{pid:n,emitGo:C}}]})}q();function R(){var t;const n=g.copyObject(s);if(d.value.length&&(n.pid=((t=d.value[d.value.length-1].id)==null?void 0:t.toString())??""),n.mode="search",console.info(!s.node_type||s.node_type=="any"||!s.rate),!s.keyword&&(!s.node_type||s.node_type=="any")&&!s.rate)return l.go({pid:s.pid,mode:"directory"});console.info(n),M.push({path:f.path,query:n})}function C(n,t){switch(console.info("emitGo",n,t),n){case"reload":m();break;case"tag":l.go({tag_id:`${t}`,mode:"tag"});break;case"node":let e;for(let r=0;r<c.value.length;r++)if(c.value[r].id===t){e=c.value[r];break}if(!e)break;switch(e.type){case"directory":l.go({pid:`${e.id}`,mode:"directory"});break;default:W(g.copyObject(s),e.id??0);break}break}}A(async()=>{console.info("onMounted"),Object.assign(s,g.copyObject(f.query)),l=new G({route:f,router:M,getList:m,contentDOM:$.value,emitGo:C}),await m()&&(l.reloadScroll(),document.addEventListener("keydown",L))}),K(()=>{l.destructor(),document.removeEventListener("keydown",L)});function L(n){if(!(d.value.length||s.pid))return;const t=[];switch(n.ctrlKey&&t.push("ctrl"),n.shiftKey&&t.push("shift"),t.push(n.code),t.join("_")){default:return;case"ctrl_KeyU":l&&l.showSelectionOp&&(n.preventDefault(),w());break;case"ctrl_KeyM":l&&l.showSelectionOp&&(n.preventDefault(),F());break}}function H(n){(d.value.length||s.pid)&&(n.stopPropagation(),n.preventDefault(),w())}return(n,t)=>(i(),u("div",{class:"fr_content view_file",onDragover:H},[a("div",J,[o(d).length?(i(),u("div",X,[(i(!0),u(y,null,_(o(d),(e,r)=>(i(),u("a",{dir:"ltr",class:"item",key:r,onClick:b=>o(l).go({pid:`${e==null?void 0:e.id}`,mode:"directory"}),title:e.title},O(e.title),9,Z))),128))])):p("",!0),a("div",ee,[a("label",null,[te,v(a("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=e=>o(s).keyword=e)},null,512),[[z,o(s).keyword]])]),a("label",null,[oe,v(a("select",{"onUpdate:modelValue":t[1]||(t[1]=e=>o(s).node_type=e)},[(i(!0),u(y,null,_(o(k).fileType,(e,r)=>(i(),u("option",{key:`FV_SCH_NODE_TYPE_${r}`},O(e),1))),128))],512),[[h,o(s).node_type]])]),a("label",null,[le,T?v((i(),u("select",{key:0,class:"sysIcon","onUpdate:modelValue":t[2]||(t[2]=e=>o(s).rate=e)},[(i(!0),u(y,null,_(o(k).rateMobile,(e,r)=>(i(),u("option",{value:r,innerHTML:e,key:`FV_SCH_CON_RATE_${r}`},null,8,ne))),128))],512)),[[h,o(s).rate]]):v((i(),u("select",{key:1,class:"sysIcon","onUpdate:modelValue":t[3]||(t[3]=e=>o(s).rate=e)},[(i(!0),u(y,null,_(o(k).rate,(e,r)=>(i(),u("option",{value:r,innerHTML:e,key:`FV_SCH_CON_RATE_${r}`},null,8,se))),128))],512)),[[h,o(s).rate]])]),o(d).length?(i(),u("label",ae,[ie,v(a("input",{type:"checkbox","onUpdate:modelValue":t[4]||(t[4]=e=>o(s).cascade_dir=e),id:"FV_S_CB","true-value":1,"false-value":""},null,512),[[P,o(s).cascade_dir]]),re])):p("",!0),a("label",null,[a("button",{class:"buttonStyle sysIcon sysIcon_search",onClick:R})])]),a("div",ue,[o(l)&&o(l).showSelectionOp?(i(),u(y,{key:0},[a("a",{class:"buttonStyle",onClick:t[5]||(t[5]=e=>o(l).bathOp("browser"))},"OP"),a("a",{class:"buttonStyle",onClick:t[6]||(t[6]=e=>o(l).bathOp("favourite"))},"FAV"),a("a",{class:"buttonStyle",onClick:t[7]||(t[7]=e=>o(l).bathOp("rename"))},"RN"),a("a",{class:"buttonStyle",onClick:t[8]||(t[8]=e=>o(l).bathOp("move"))},"MV"),o(f).name!=="Recycle"?(i(),u("a",{key:0,class:"buttonStyle",onClick:t[9]||(t[9]=e=>o(l).bathOp("delete"))},"DEL")):p("",!0),o(f).name==="Recycle"?(i(),u("a",{key:1,class:"buttonStyle",onClick:t[10]||(t[10]=e=>o(l).bathOp("delete_forever"))},"rDEL")):p("",!0),de],64)):p("",!0),o(d).length||o(s).pid=="0"?(i(),u(y,{key:1},[a("a",{class:"buttonStyle sysIcon sysIcon_addfolder",onClick:F}),a("a",{class:"buttonStyle sysIcon sysIcon_addfile",onClick:w}),ce],64)):p("",!0),o(l)&&o(l).sortVal?(i(),u("label",ye,[pe,v(a("select",{"onUpdate:modelValue":t[11]||(t[11]=e=>o(l).sortVal.value=e),onChange:t[12]||(t[12]=e=>o(l).setSort(n.sortVal))},[(i(!0),u(y,null,_(o(k).sort,(e,r)=>(i(),u("option",{value:r,key:`FV_SCH_CON_SORT_${r}`},O(e),9,fe))),128))],544),[[h,o(l).sortVal.value]])])):p("",!0),_e,o(l)?(i(!0),u(y,{key:3},_(o(k).listType,(e,r)=>(i(),u("a",{class:I(["buttonStyle","sysIcon",`sysIcon_listType_${e}`,{active:o(l).mode.value===e}]),onClick:b=>o(l).setMode(e),key:`FAV_SCH_BTN_${r}`},null,10,ve))),128)):p("",!0)])]),a("div",{class:I(["content_detail",`mode_${o(l)?o(l).mode.value:""}`]),ref_key:"contentDOM",ref:$},[(i(!0),u(y,null,_(o(c),(e,r)=>(i(),Q(Y,{key:r,node:e,index:r,selected:!1,onGo:C},null,8,["node","index"]))),128))],2)],32))}});export{ge as _};

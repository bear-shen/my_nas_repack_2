const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./FileView_N-AtQEcKGP.js","./FileView.vue_vue_type_style_index_0_lang-DBGnKwao.js","./basic-cwdvCeQw.js","./basic-D5EgENoc.css","./FileItem-DqKtN6tr.js","./ContentEditable.vue_vue_type_script_setup_true_lang-DcqCX2WK.js","./Hinter-D3ESJFiP.js","./Hinter-BKQQORJ5.css","./FileItem-BvNbHAEj.css","./FileView-BSPtTJMB.css","./Favourite-BBoBoNiy.js","./Favourite-BN5yJjEX.css","./FileView_R-DrFqSEh3.js","./TagView-nqcag1ie.js","./TagView-BIbJvYcw.css","./ShareView-Dx1E9CP6.js","./ShareView-BRPRpGNM.css","./UserView-CZnujoNs.js","./UserView-CmWqTIhk.css","./LogView-B16UlOUP.js","./LogView-V_AVrbUx.css","./SettingView-20kfKt4u.js","./SettingView-EQ9DroAn.css"])))=>i.map(i=>d[i]);
var sn=Object.defineProperty;var rn=(o,e,t)=>e in o?sn(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var ae=(o,e,t)=>rn(o,typeof e!="symbol"?e+"":e,t);import{d as fe,r as F,u as Ve,o as Se,C as oe,a as rt,b as D,c as L,e as P,F as G,f as re,n as ue,g as Y,t as se,h as ft,i as We,s as ln,j as cn,k as xe,l as un,m as De,p as dn,q as fn,v as hn,w as me,x as It,y as Ye,z as Tt,A as Re,B as pn,G as de,D as _n,E as X,H as Ie,I as Te,J as mn,K as vn,L as yn,M as Xe,N as Ht,O as Qe,P as ht,Q as te,R as ce,S as He,T as Nt,_ as gn,U as wn,V as bn,W as kn,X as En,Y as pt,Z as nt,$ as Fe,a0 as zt,a1 as Oe,a2 as Bt,a3 as xn,a4 as Sn,a5 as Dn,a6 as Ln,a7 as Cn,a8 as Rn}from"./basic-cwdvCeQw.js";const $n={class:"fr_header"},On={class:"navi"},Pn=["innerHTML","href"],An={class:"user"},Mn={class:"pointer"},In=fe({__name:"Header",setup(o){const e=F([]),t=Ve();let n=t.get();function a(){t.set(null),location.reload()}Se(()=>{document.addEventListener("fe_config_loaded",()=>{e.value=oe.navList})});const l=rt(),c=oe.theme;let _=l.get("theme")??"warm";function d(){const r={};c.forEach(y=>{r[y[0]]=y[0]}),We().set({title:"theme configure",alpha:!0,key:"theme_configure",single:!0,w:360,h:160,minW:360,minH:160,allow_resize:!0,allow_move:!0,allow_escape:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"radio",label:"theme name",key:"theme",options:r,value:_}],callback:{check:async y=>{console.info(y),_=y.content.form[0].value,i(_)}}})}function i(r){c.forEach(f=>{const y=f[0],s=f[1];if(y!==r)return;l.set("theme",y);const g=document.body.className.trim().split(" "),h=[];g.forEach(w=>{w&&w.length&&w.indexOf("theme_")!==0&&h.push(w)}),h.push("theme_"+r);const u=document.createElement("link");u.setAttribute("rel","stylesheet"),u.setAttribute("href",s),document.body.appendChild(u),document.body.className=h.join(" ")})}return i(_),(r,f)=>(D(),L("div",$n,[f[1]||(f[1]=P("div",{class:"logo"},"Hentai.",-1)),P("div",On,[(D(!0),L(G,null,re(e.value,y=>{var s;return D(),L("a",{key:y.name,class:ue({active:(s=y.meta)==null?void 0:s.cur,pointer:1}),innerHTML:y.name,href:y.path,target:"_blank"},null,10,Pn)}),128))]),P("div",An,[Y(n)&&Y(n).id?(D(),L(G,{key:0},[P("div",Mn,se(Y(n).name),1),P("ul",{class:"action pointer"},[P("li",{onClick:d},"theme"),P("li",{onClick:a},"logout")])],64)):(D(),L("div",{key:1,class:"pointer",onClick:f[0]||(f[0]=(...y)=>Y(ft)&&Y(ft)(...y))},"login"))])]))}}),Tn=(o,e)=>{const t=o.__vccOpts||o;for(const[n,a]of e)t[n]=a;return t},Hn=Tn(In,[["__scopeId","data-v-b543bc40"]]),Nn="modulepreload",zn=function(o,e){return new URL(o,e).href},_t={},we=function(e,t,n){let a=Promise.resolve();if(t&&t.length>0){const c=document.getElementsByTagName("link"),_=document.querySelector("meta[property=csp-nonce]"),d=(_==null?void 0:_.nonce)||(_==null?void 0:_.getAttribute("nonce"));a=Promise.allSettled(t.map(i=>{if(i=zn(i,n),i in _t)return;_t[i]=!0;const r=i.endsWith(".css"),f=r?'[rel="stylesheet"]':"";if(!!n)for(let g=c.length-1;g>=0;g--){const h=c[g];if(h.href===i&&(!r||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${f}`))return;const s=document.createElement("link");if(s.rel=r?"stylesheet":Nn,r||(s.as="script"),s.crossOrigin="",s.href=i,d&&s.setAttribute("nonce",d),document.head.appendChild(s),r)return new Promise((g,h)=>{s.addEventListener("load",g),s.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${i}`)))})}))}function l(c){const _=new Event("vite:preloadError",{cancelable:!0});if(_.payload=c,window.dispatchEvent(_),!_.defaultPrevented)throw c}return a.then(c=>{for(const _ of c||[])_.status==="rejected"&&l(_.reason);return e().catch(l)})};/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const $e=typeof document<"u";function Ut(o){return typeof o=="object"||"displayName"in o||"props"in o||"__vccOpts"in o}function Bn(o){return o.__esModule||o[Symbol.toStringTag]==="Module"||o.default&&Ut(o.default)}const K=Object.assign;function Je(o,e){const t={};for(const n in e){const a=e[n];t[n]=_e(a)?a.map(o):o(a)}return t}const Ne=()=>{},_e=Array.isArray,Vt=/#/g,Un=/&/g,Vn=/\//g,Wn=/=/g,jn=/\?/g,Wt=/\+/g,Fn=/%5B/g,qn=/%5D/g,jt=/%5E/g,Gn=/%60/g,Ft=/%7B/g,Kn=/%7C/g,qt=/%7D/g,Yn=/%20/g;function lt(o){return encodeURI(""+o).replace(Kn,"|").replace(Fn,"[").replace(qn,"]")}function Xn(o){return lt(o).replace(Ft,"{").replace(qt,"}").replace(jt,"^")}function ot(o){return lt(o).replace(Wt,"%2B").replace(Yn,"+").replace(Vt,"%23").replace(Un,"%26").replace(Gn,"`").replace(Ft,"{").replace(qt,"}").replace(jt,"^")}function Qn(o){return ot(o).replace(Wn,"%3D")}function Jn(o){return lt(o).replace(Vt,"%23").replace(jn,"%3F")}function Zn(o){return o==null?"":Jn(o).replace(Vn,"%2F")}function Be(o){try{return decodeURIComponent(""+o)}catch{}return""+o}const eo=/\/$/,to=o=>o.replace(eo,"");function Ze(o,e,t="/"){let n,a={},l="",c="";const _=e.indexOf("#");let d=e.indexOf("?");return _<d&&_>=0&&(d=-1),d>-1&&(n=e.slice(0,d),l=e.slice(d+1,_>-1?_:e.length),a=o(l)),_>-1&&(n=n||e.slice(0,_),c=e.slice(_,e.length)),n=so(n??e,t),{fullPath:n+(l&&"?")+l+c,path:n,query:a,hash:Be(c)}}function no(o,e){const t=e.query?o(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function mt(o,e){return!e||!o.toLowerCase().startsWith(e.toLowerCase())?o:o.slice(e.length)||"/"}function oo(o,e,t){const n=e.matched.length-1,a=t.matched.length-1;return n>-1&&n===a&&Pe(e.matched[n],t.matched[a])&&Gt(e.params,t.params)&&o(e.query)===o(t.query)&&e.hash===t.hash}function Pe(o,e){return(o.aliasOf||o)===(e.aliasOf||e)}function Gt(o,e){if(Object.keys(o).length!==Object.keys(e).length)return!1;for(const t in o)if(!ao(o[t],e[t]))return!1;return!0}function ao(o,e){return _e(o)?vt(o,e):_e(e)?vt(e,o):o===e}function vt(o,e){return _e(e)?o.length===e.length&&o.every((t,n)=>t===e[n]):o.length===1&&o[0]===e}function so(o,e){if(o.startsWith("/"))return o;if(!o)return e;const t=e.split("/"),n=o.split("/"),a=n[n.length-1];(a===".."||a===".")&&n.push("");let l=t.length-1,c,_;for(c=0;c<n.length;c++)if(_=n[c],_!==".")if(_==="..")l>1&&l--;else break;return t.slice(0,l).join("/")+"/"+n.slice(c).join("/")}const be={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Ue;(function(o){o.pop="pop",o.push="push"})(Ue||(Ue={}));var ze;(function(o){o.back="back",o.forward="forward",o.unknown=""})(ze||(ze={}));function io(o){if(!o)if($e){const e=document.querySelector("base");o=e&&e.getAttribute("href")||"/",o=o.replace(/^\w+:\/\/[^\/]+/,"")}else o="/";return o[0]!=="/"&&o[0]!=="#"&&(o="/"+o),to(o)}const ro=/^[^#]+#/;function lo(o,e){return o.replace(ro,"#")+e}function co(o,e){const t=document.documentElement.getBoundingClientRect(),n=o.getBoundingClientRect();return{behavior:e.behavior,left:n.left-t.left-(e.left||0),top:n.top-t.top-(e.top||0)}}const qe=()=>({left:window.scrollX,top:window.scrollY});function uo(o){let e;if("el"in o){const t=o.el,n=typeof t=="string"&&t.startsWith("#"),a=typeof t=="string"?n?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!a)return;e=co(a,o)}else e=o;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function yt(o,e){return(history.state?history.state.position-e:-1)+o}const at=new Map;function fo(o,e){at.set(o,e)}function ho(o){const e=at.get(o);return at.delete(o),e}let po=()=>location.protocol+"//"+location.host;function Kt(o,e){const{pathname:t,search:n,hash:a}=e,l=o.indexOf("#");if(l>-1){let _=a.includes(o.slice(l))?o.slice(l).length:1,d=a.slice(_);return d[0]!=="/"&&(d="/"+d),mt(d,"")}return mt(t,o)+n+a}function _o(o,e,t,n){let a=[],l=[],c=null;const _=({state:y})=>{const s=Kt(o,location),g=t.value,h=e.value;let u=0;if(y){if(t.value=s,e.value=y,c&&c===g){c=null;return}u=h?y.position-h.position:0}else n(s);a.forEach(w=>{w(t.value,g,{delta:u,type:Ue.pop,direction:u?u>0?ze.forward:ze.back:ze.unknown})})};function d(){c=t.value}function i(y){a.push(y);const s=()=>{const g=a.indexOf(y);g>-1&&a.splice(g,1)};return l.push(s),s}function r(){const{history:y}=window;y.state&&y.replaceState(K({},y.state,{scroll:qe()}),"")}function f(){for(const y of l)y();l=[],window.removeEventListener("popstate",_),window.removeEventListener("beforeunload",r)}return window.addEventListener("popstate",_),window.addEventListener("beforeunload",r,{passive:!0}),{pauseListeners:d,listen:i,destroy:f}}function gt(o,e,t,n=!1,a=!1){return{back:o,current:e,forward:t,replaced:n,position:window.history.length,scroll:a?qe():null}}function mo(o){const{history:e,location:t}=window,n={value:Kt(o,t)},a={value:e.state};a.value||l(n.value,{back:null,current:n.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function l(d,i,r){const f=o.indexOf("#"),y=f>-1?(t.host&&document.querySelector("base")?o:o.slice(f))+d:po()+o+d;try{e[r?"replaceState":"pushState"](i,"",y),a.value=i}catch(s){console.error(s),t[r?"replace":"assign"](y)}}function c(d,i){const r=K({},e.state,gt(a.value.back,d,a.value.forward,!0),i,{position:a.value.position});l(d,r,!0),n.value=d}function _(d,i){const r=K({},a.value,e.state,{forward:d,scroll:qe()});l(r.current,r,!0);const f=K({},gt(n.value,d,null),{position:r.position+1},i);l(d,f,!1),n.value=d}return{location:n,state:a,push:_,replace:c}}function vo(o){o=io(o);const e=mo(o),t=_o(o,e.state,e.location,e.replace);function n(l,c=!0){c||t.pauseListeners(),history.go(l)}const a=K({location:"",base:o,go:n,createHref:lo.bind(null,o)},e,t);return Object.defineProperty(a,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(a,"state",{enumerable:!0,get:()=>e.state.value}),a}function yo(o){return typeof o=="string"||o&&typeof o=="object"}function Yt(o){return typeof o=="string"||typeof o=="symbol"}const Xt=Symbol("");var wt;(function(o){o[o.aborted=4]="aborted",o[o.cancelled=8]="cancelled",o[o.duplicated=16]="duplicated"})(wt||(wt={}));function Ae(o,e){return K(new Error,{type:o,[Xt]:!0},e)}function ye(o,e){return o instanceof Error&&Xt in o&&(e==null||!!(o.type&e))}const bt="[^/]+?",go={sensitive:!1,strict:!1,start:!0,end:!0},wo=/[.+*?^${}()[\]/\\]/g;function bo(o,e){const t=K({},go,e),n=[];let a=t.start?"^":"";const l=[];for(const i of o){const r=i.length?[]:[90];t.strict&&!i.length&&(a+="/");for(let f=0;f<i.length;f++){const y=i[f];let s=40+(t.sensitive?.25:0);if(y.type===0)f||(a+="/"),a+=y.value.replace(wo,"\\$&"),s+=40;else if(y.type===1){const{value:g,repeatable:h,optional:u,regexp:w}=y;l.push({name:g,repeatable:h,optional:u});const p=w||bt;if(p!==bt){s+=10;try{new RegExp(`(${p})`)}catch(v){throw new Error(`Invalid custom RegExp for param "${g}" (${p}): `+v.message)}}let m=h?`((?:${p})(?:/(?:${p}))*)`:`(${p})`;f||(m=u&&i.length<2?`(?:/${m})`:"/"+m),u&&(m+="?"),a+=m,s+=20,u&&(s+=-8),h&&(s+=-20),p===".*"&&(s+=-50)}r.push(s)}n.push(r)}if(t.strict&&t.end){const i=n.length-1;n[i][n[i].length-1]+=.7000000000000001}t.strict||(a+="/?"),t.end?a+="$":t.strict&&!a.endsWith("/")&&(a+="(?:/|$)");const c=new RegExp(a,t.sensitive?"":"i");function _(i){const r=i.match(c),f={};if(!r)return null;for(let y=1;y<r.length;y++){const s=r[y]||"",g=l[y-1];f[g.name]=s&&g.repeatable?s.split("/"):s}return f}function d(i){let r="",f=!1;for(const y of o){(!f||!r.endsWith("/"))&&(r+="/"),f=!1;for(const s of y)if(s.type===0)r+=s.value;else if(s.type===1){const{value:g,repeatable:h,optional:u}=s,w=g in i?i[g]:"";if(_e(w)&&!h)throw new Error(`Provided param "${g}" is an array but it is not repeatable (* or + modifiers)`);const p=_e(w)?w.join("/"):w;if(!p)if(u)y.length<2&&(r.endsWith("/")?r=r.slice(0,-1):f=!0);else throw new Error(`Missing required param "${g}"`);r+=p}}return r||"/"}return{re:c,score:n,keys:l,parse:_,stringify:d}}function ko(o,e){let t=0;for(;t<o.length&&t<e.length;){const n=e[t]-o[t];if(n)return n;t++}return o.length<e.length?o.length===1&&o[0]===80?-1:1:o.length>e.length?e.length===1&&e[0]===80?1:-1:0}function Qt(o,e){let t=0;const n=o.score,a=e.score;for(;t<n.length&&t<a.length;){const l=ko(n[t],a[t]);if(l)return l;t++}if(Math.abs(a.length-n.length)===1){if(kt(n))return 1;if(kt(a))return-1}return a.length-n.length}function kt(o){const e=o[o.length-1];return o.length>0&&e[e.length-1]<0}const Eo={type:0,value:""},xo=/[a-zA-Z0-9_]/;function So(o){if(!o)return[[]];if(o==="/")return[[Eo]];if(!o.startsWith("/"))throw new Error(`Invalid path "${o}"`);function e(s){throw new Error(`ERR (${t})/"${i}": ${s}`)}let t=0,n=t;const a=[];let l;function c(){l&&a.push(l),l=[]}let _=0,d,i="",r="";function f(){i&&(t===0?l.push({type:0,value:i}):t===1||t===2||t===3?(l.length>1&&(d==="*"||d==="+")&&e(`A repeatable param (${i}) must be alone in its segment. eg: '/:ids+.`),l.push({type:1,value:i,regexp:r,repeatable:d==="*"||d==="+",optional:d==="*"||d==="?"})):e("Invalid state to consume buffer"),i="")}function y(){i+=d}for(;_<o.length;){if(d=o[_++],d==="\\"&&t!==2){n=t,t=4;continue}switch(t){case 0:d==="/"?(i&&f(),c()):d===":"?(f(),t=1):y();break;case 4:y(),t=n;break;case 1:d==="("?t=2:xo.test(d)?y():(f(),t=0,d!=="*"&&d!=="?"&&d!=="+"&&_--);break;case 2:d===")"?r[r.length-1]=="\\"?r=r.slice(0,-1)+d:t=3:r+=d;break;case 3:f(),t=0,d!=="*"&&d!=="?"&&d!=="+"&&_--,r="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${i}"`),f(),c(),a}function Do(o,e,t){const n=bo(So(o.path),t),a=K(n,{record:o,parent:e,children:[],alias:[]});return e&&!a.record.aliasOf==!e.record.aliasOf&&e.children.push(a),a}function Lo(o,e){const t=[],n=new Map;e=Dt({strict:!1,end:!0,sensitive:!1},e);function a(f){return n.get(f)}function l(f,y,s){const g=!s,h=xt(f);h.aliasOf=s&&s.record;const u=Dt(e,f),w=[h];if("alias"in f){const v=typeof f.alias=="string"?[f.alias]:f.alias;for(const b of v)w.push(xt(K({},h,{components:s?s.record.components:h.components,path:b,aliasOf:s?s.record:h})))}let p,m;for(const v of w){const{path:b}=v;if(y&&b[0]!=="/"){const M=y.record.path,E=M[M.length-1]==="/"?"":"/";v.path=y.record.path+(b&&E+b)}if(p=Do(v,y,u),s?s.alias.push(p):(m=m||p,m!==p&&m.alias.push(p),g&&f.name&&!St(p)&&c(f.name)),Jt(p)&&d(p),h.children){const M=h.children;for(let E=0;E<M.length;E++)l(M[E],p,s&&s.children[E])}s=s||p}return m?()=>{c(m)}:Ne}function c(f){if(Yt(f)){const y=n.get(f);y&&(n.delete(f),t.splice(t.indexOf(y),1),y.children.forEach(c),y.alias.forEach(c))}else{const y=t.indexOf(f);y>-1&&(t.splice(y,1),f.record.name&&n.delete(f.record.name),f.children.forEach(c),f.alias.forEach(c))}}function _(){return t}function d(f){const y=$o(f,t);t.splice(y,0,f),f.record.name&&!St(f)&&n.set(f.record.name,f)}function i(f,y){let s,g={},h,u;if("name"in f&&f.name){if(s=n.get(f.name),!s)throw Ae(1,{location:f});u=s.record.name,g=K(Et(y.params,s.keys.filter(m=>!m.optional).concat(s.parent?s.parent.keys.filter(m=>m.optional):[]).map(m=>m.name)),f.params&&Et(f.params,s.keys.map(m=>m.name))),h=s.stringify(g)}else if(f.path!=null)h=f.path,s=t.find(m=>m.re.test(h)),s&&(g=s.parse(h),u=s.record.name);else{if(s=y.name?n.get(y.name):t.find(m=>m.re.test(y.path)),!s)throw Ae(1,{location:f,currentLocation:y});u=s.record.name,g=K({},y.params,f.params),h=s.stringify(g)}const w=[];let p=s;for(;p;)w.unshift(p.record),p=p.parent;return{name:u,path:h,params:g,matched:w,meta:Ro(w)}}o.forEach(f=>l(f));function r(){t.length=0,n.clear()}return{addRoute:l,resolve:i,removeRoute:c,clearRoutes:r,getRoutes:_,getRecordMatcher:a}}function Et(o,e){const t={};for(const n of e)n in o&&(t[n]=o[n]);return t}function xt(o){const e={path:o.path,redirect:o.redirect,name:o.name,meta:o.meta||{},aliasOf:o.aliasOf,beforeEnter:o.beforeEnter,props:Co(o),children:o.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in o?o.components||null:o.component&&{default:o.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function Co(o){const e={},t=o.props||!1;if("component"in o)e.default=t;else for(const n in o.components)e[n]=typeof t=="object"?t[n]:t;return e}function St(o){for(;o;){if(o.record.aliasOf)return!0;o=o.parent}return!1}function Ro(o){return o.reduce((e,t)=>K(e,t.meta),{})}function Dt(o,e){const t={};for(const n in o)t[n]=n in e?e[n]:o[n];return t}function $o(o,e){let t=0,n=e.length;for(;t!==n;){const l=t+n>>1;Qt(o,e[l])<0?n=l:t=l+1}const a=Oo(o);return a&&(n=e.lastIndexOf(a,n-1)),n}function Oo(o){let e=o;for(;e=e.parent;)if(Jt(e)&&Qt(o,e)===0)return e}function Jt({record:o}){return!!(o.name||o.components&&Object.keys(o.components).length||o.redirect)}function Po(o){const e={};if(o===""||o==="?")return e;const n=(o[0]==="?"?o.slice(1):o).split("&");for(let a=0;a<n.length;++a){const l=n[a].replace(Wt," "),c=l.indexOf("="),_=Be(c<0?l:l.slice(0,c)),d=c<0?null:Be(l.slice(c+1));if(_ in e){let i=e[_];_e(i)||(i=e[_]=[i]),i.push(d)}else e[_]=d}return e}function Lt(o){let e="";for(let t in o){const n=o[t];if(t=Qn(t),n==null){n!==void 0&&(e+=(e.length?"&":"")+t);continue}(_e(n)?n.map(l=>l&&ot(l)):[n&&ot(n)]).forEach(l=>{l!==void 0&&(e+=(e.length?"&":"")+t,l!=null&&(e+="="+l))})}return e}function Ao(o){const e={};for(const t in o){const n=o[t];n!==void 0&&(e[t]=_e(n)?n.map(a=>a==null?null:""+a):n==null?n:""+n)}return e}const Zt=Symbol(""),Ct=Symbol(""),Ge=Symbol(""),ct=Symbol(""),st=Symbol("");function Me(){let o=[];function e(n){return o.push(n),()=>{const a=o.indexOf(n);a>-1&&o.splice(a,1)}}function t(){o=[]}return{add:e,list:()=>o.slice(),reset:t}}function Mo(o,e,t){const n=()=>{o[e].delete(t)};De(n),dn(n),fn(()=>{o[e].add(t)}),o[e].add(t)}function Rs(o){const e=xe(Zt,{}).value;e&&Mo(e,"updateGuards",o)}function Ee(o,e,t,n,a,l=c=>c()){const c=n&&(n.enterCallbacks[a]=n.enterCallbacks[a]||[]);return()=>new Promise((_,d)=>{const i=y=>{y===!1?d(Ae(4,{from:t,to:e})):y instanceof Error?d(y):yo(y)?d(Ae(2,{from:e,to:y})):(c&&n.enterCallbacks[a]===c&&typeof y=="function"&&c.push(y),_())},r=l(()=>o.call(n&&n.instances[a],e,t,i));let f=Promise.resolve(r);o.length<3&&(f=f.then(i)),f.catch(y=>d(y))})}function et(o,e,t,n,a=l=>l()){const l=[];for(const c of o)for(const _ in c.components){let d=c.components[_];if(!(e!=="beforeRouteEnter"&&!c.instances[_]))if(Ut(d)){const r=(d.__vccOpts||d)[e];r&&l.push(Ee(r,t,n,c,_,a))}else{let i=d();l.push(()=>i.then(r=>{if(!r)throw new Error(`Couldn't resolve component "${_}" at "${c.path}"`);const f=Bn(r)?r.default:r;c.mods[_]=r,c.components[_]=f;const s=(f.__vccOpts||f)[e];return s&&Ee(s,t,n,c,_,a)()}))}}return l}function Rt(o){const e=xe(Ge),t=xe(ct),n=me(()=>{const d=Y(o.to);return e.resolve(d)}),a=me(()=>{const{matched:d}=n.value,{length:i}=d,r=d[i-1],f=t.matched;if(!r||!f.length)return-1;const y=f.findIndex(Pe.bind(null,r));if(y>-1)return y;const s=$t(d[i-2]);return i>1&&$t(r)===s&&f[f.length-1].path!==s?f.findIndex(Pe.bind(null,d[i-2])):y}),l=me(()=>a.value>-1&&zo(t.params,n.value.params)),c=me(()=>a.value>-1&&a.value===t.matched.length-1&&Gt(t.params,n.value.params));function _(d={}){if(No(d)){const i=e[Y(o.replace)?"replace":"push"](Y(o.to)).catch(Ne);return o.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>i),i}return Promise.resolve()}return{route:n,href:me(()=>n.value.href),isActive:l,isExactActive:c,navigate:_}}function Io(o){return o.length===1?o[0]:o}const To=fe({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Rt,setup(o,{slots:e}){const t=hn(Rt(o)),{options:n}=xe(Ge),a=me(()=>({[Ot(o.activeClass,n.linkActiveClass,"router-link-active")]:t.isActive,[Ot(o.exactActiveClass,n.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const l=e.default&&Io(e.default(t));return o.custom?l:It("a",{"aria-current":t.isExactActive?o.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:a.value},l)}}}),Ho=To;function No(o){if(!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)&&!o.defaultPrevented&&!(o.button!==void 0&&o.button!==0)){if(o.currentTarget&&o.currentTarget.getAttribute){const e=o.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return o.preventDefault&&o.preventDefault(),!0}}function zo(o,e){for(const t in e){const n=e[t],a=o[t];if(typeof n=="string"){if(n!==a)return!1}else if(!_e(a)||a.length!==n.length||n.some((l,c)=>l!==a[c]))return!1}return!0}function $t(o){return o?o.aliasOf?o.aliasOf.path:o.path:""}const Ot=(o,e,t)=>o??e??t,Bo=fe({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(o,{attrs:e,slots:t}){const n=xe(st),a=me(()=>o.route||n.value),l=xe(Ct,0),c=me(()=>{let i=Y(l);const{matched:r}=a.value;let f;for(;(f=r[i])&&!f.components;)i++;return i}),_=me(()=>a.value.matched[c.value]);Ye(Ct,me(()=>c.value+1)),Ye(Zt,_),Ye(st,a);const d=F();return Tt(()=>[d.value,_.value,o.name],([i,r,f],[y,s,g])=>{r&&(r.instances[f]=i,s&&s!==r&&i&&i===y&&(r.leaveGuards.size||(r.leaveGuards=s.leaveGuards),r.updateGuards.size||(r.updateGuards=s.updateGuards))),i&&r&&(!s||!Pe(r,s)||!y)&&(r.enterCallbacks[f]||[]).forEach(h=>h(i))},{flush:"post"}),()=>{const i=a.value,r=o.name,f=_.value,y=f&&f.components[r];if(!y)return Pt(t.default,{Component:y,route:i});const s=f.props[r],g=s?s===!0?i.params:typeof s=="function"?s(i):s:null,u=It(y,K({},g,e,{onVnodeUnmounted:w=>{w.component.isUnmounted&&(f.instances[r]=null)},ref:d}));return Pt(t.default,{Component:u,route:i})||u}}});function Pt(o,e){if(!o)return null;const t=o(e);return t.length===1?t[0]:t}const Uo=Bo;function Vo(o){const e=Lo(o.routes,o),t=o.parseQuery||Po,n=o.stringifyQuery||Lt,a=o.history,l=Me(),c=Me(),_=Me(),d=ln(be);let i=be;$e&&o.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const r=Je.bind(null,k=>""+k),f=Je.bind(null,Zn),y=Je.bind(null,Be);function s(k,C){let R,O;return Yt(k)?(R=e.getRecordMatcher(k),O=C):O=k,e.addRoute(O,R)}function g(k){const C=e.getRecordMatcher(k);C&&e.removeRoute(C)}function h(){return e.getRoutes().map(k=>k.record)}function u(k){return!!e.getRecordMatcher(k)}function w(k,C){if(C=K({},C||d.value),typeof k=="string"){const U=Ze(t,k,C.path),T=e.resolve({path:U.path},C),ne=a.createHref(U.fullPath);return K(U,T,{params:y(T.params),hash:Be(U.hash),redirectedFrom:void 0,href:ne})}let R;if(k.path!=null)R=K({},k,{path:Ze(t,k.path,C.path).path});else{const U=K({},k.params);for(const T in U)U[T]==null&&delete U[T];R=K({},k,{params:f(U)}),C.params=f(C.params)}const O=e.resolve(R,C),j=k.hash||"";O.params=r(y(O.params));const Q=no(n,K({},k,{hash:Xn(j),path:O.path})),N=a.createHref(Q);return K({fullPath:Q,hash:j,query:n===Lt?Ao(k.query):k.query||{}},O,{redirectedFrom:void 0,href:N})}function p(k){return typeof k=="string"?Ze(t,k,d.value.path):K({},k)}function m(k,C){if(i!==k)return Ae(8,{from:C,to:k})}function v(k){return E(k)}function b(k){return v(K(p(k),{replace:!0}))}function M(k){const C=k.matched[k.matched.length-1];if(C&&C.redirect){const{redirect:R}=C;let O=typeof R=="function"?R(k):R;return typeof O=="string"&&(O=O.includes("?")||O.includes("#")?O=p(O):{path:O},O.params={}),K({query:k.query,hash:k.hash,params:O.path!=null?{}:k.params},O)}}function E(k,C){const R=i=w(k),O=d.value,j=k.state,Q=k.force,N=k.replace===!0,U=M(R);if(U)return E(K(p(U),{state:typeof U=="object"?K({},j,U.state):j,force:Q,replace:N}),C||R);const T=R;T.redirectedFrom=C;let ne;return!Q&&oo(n,O,R)&&(ne=Ae(16,{to:T,from:O}),S(O,O,!0,!1)),(ne?Promise.resolve(ne):I(T,O)).catch(ee=>ye(ee)?ye(ee,2)?ee:$(ee):pe(ee,T,O)).then(ee=>{if(ee){if(ye(ee,2))return E(K({replace:N},p(ee.to),{state:typeof ee.to=="object"?K({},j,ee.to.state):j,force:Q}),C||T)}else ee=le(T,O,!0,N,j);return V(T,O,ee),ee})}function H(k,C){const R=m(k,C);return R?Promise.reject(R):Promise.resolve()}function x(k){const C=A.values().next().value;return C&&typeof C.runWithContext=="function"?C.runWithContext(k):k()}function I(k,C){let R;const[O,j,Q]=Wo(k,C);R=et(O.reverse(),"beforeRouteLeave",k,C);for(const U of O)U.leaveGuards.forEach(T=>{R.push(Ee(T,k,C))});const N=H.bind(null,k,C);return R.push(N),ie(R).then(()=>{R=[];for(const U of l.list())R.push(Ee(U,k,C));return R.push(N),ie(R)}).then(()=>{R=et(j,"beforeRouteUpdate",k,C);for(const U of j)U.updateGuards.forEach(T=>{R.push(Ee(T,k,C))});return R.push(N),ie(R)}).then(()=>{R=[];for(const U of Q)if(U.beforeEnter)if(_e(U.beforeEnter))for(const T of U.beforeEnter)R.push(Ee(T,k,C));else R.push(Ee(U.beforeEnter,k,C));return R.push(N),ie(R)}).then(()=>(k.matched.forEach(U=>U.enterCallbacks={}),R=et(Q,"beforeRouteEnter",k,C,x),R.push(N),ie(R))).then(()=>{R=[];for(const U of c.list())R.push(Ee(U,k,C));return R.push(N),ie(R)}).catch(U=>ye(U,8)?U:Promise.reject(U))}function V(k,C,R){_.list().forEach(O=>x(()=>O(k,C,R)))}function le(k,C,R,O,j){const Q=m(k,C);if(Q)return Q;const N=C===be,U=$e?history.state:{};R&&(O||N?a.replace(k.fullPath,K({scroll:N&&U&&U.scroll},j)):a.push(k.fullPath,j)),d.value=k,S(k,C,R,N),$()}let Z;function Le(){Z||(Z=a.listen((k,C,R)=>{if(!J.listening)return;const O=w(k),j=M(O);if(j){E(K(j,{replace:!0,force:!0}),O).catch(Ne);return}i=O;const Q=d.value;$e&&fo(yt(Q.fullPath,R.delta),qe()),I(O,Q).catch(N=>ye(N,12)?N:ye(N,2)?(E(K(p(N.to),{force:!0}),O).then(U=>{ye(U,20)&&!R.delta&&R.type===Ue.pop&&a.go(-1,!1)}).catch(Ne),Promise.reject()):(R.delta&&a.go(-R.delta,!1),pe(N,O,Q))).then(N=>{N=N||le(O,Q,!1),N&&(R.delta&&!ye(N,8)?a.go(-R.delta,!1):R.type===Ue.pop&&ye(N,20)&&a.go(-1,!1)),V(O,Q,N)}).catch(Ne)}))}let he=Me(),ge=Me(),Ce;function pe(k,C,R){$(k);const O=ge.list();return O.length?O.forEach(j=>j(k,C,R)):console.error(k),Promise.reject(k)}function je(){return Ce&&d.value!==be?Promise.resolve():new Promise((k,C)=>{he.add([k,C])})}function $(k){return Ce||(Ce=!k,Le(),he.list().forEach(([C,R])=>k?R(k):C()),he.reset()),k}function S(k,C,R,O){const{scrollBehavior:j}=o;if(!$e||!j)return Promise.resolve();const Q=!R&&ho(yt(k.fullPath,0))||(O||!R)&&history.state&&history.state.scroll||null;return un().then(()=>j(k,C,Q)).then(N=>N&&uo(N)).catch(N=>pe(N,k,C))}const B=k=>a.go(k);let W;const A=new Set,J={currentRoute:d,listening:!0,addRoute:s,removeRoute:g,clearRoutes:e.clearRoutes,hasRoute:u,getRoutes:h,resolve:w,options:o,push:v,replace:b,go:B,back:()=>B(-1),forward:()=>B(1),beforeEach:l.add,beforeResolve:c.add,afterEach:_.add,onError:ge.add,isReady:je,install(k){const C=this;k.component("RouterLink",Ho),k.component("RouterView",Uo),k.config.globalProperties.$router=C,Object.defineProperty(k.config.globalProperties,"$route",{enumerable:!0,get:()=>Y(d)}),$e&&!W&&d.value===be&&(W=!0,v(a.location).catch(j=>{}));const R={};for(const j in be)Object.defineProperty(R,j,{get:()=>d.value[j],enumerable:!0});k.provide(Ge,C),k.provide(ct,cn(R)),k.provide(st,d);const O=k.unmount;A.add(k),k.unmount=function(){A.delete(k),A.size<1&&(i=be,Z&&Z(),Z=null,d.value=be,W=!1,Ce=!1),O()}}};function ie(k){return k.reduce((C,R)=>C.then(()=>x(R)),Promise.resolve())}return J}function Wo(o,e){const t=[],n=[],a=[],l=Math.max(e.matched.length,o.matched.length);for(let c=0;c<l;c++){const _=e.matched[c];_&&(o.matched.find(i=>Pe(i,_))?n.push(_):t.push(_));const d=o.matched[c];d&&(e.matched.find(i=>Pe(i,d))||a.push(d))}return[t,n,a]}function jo(){return xe(Ge)}function Fo(o){return xe(ct)}const en=[{path:"/",name:"Directory",component:()=>we(()=>import("./FileView_N-AtQEcKGP.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),meta:{icon:"sysIcon_folderopen",deny_user:!1,deny_guest:!1}},{path:"/favourite",name:"Favourite",component:()=>we(()=>import("./Favourite-BBoBoNiy.js"),__vite__mapDeps([10,2,3,5,4,6,7,8,11]),import.meta.url),meta:{icon:"sysIcon_star-o",deny_user:!1,deny_guest:!0}},{path:"/recycle",name:"Recycle",component:()=>we(()=>import("./FileView_R-DrFqSEh3.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9]),import.meta.url),meta:{icon:"sysIcon_delete",deny_user:!1,deny_guest:!0}},{path:"/tag",name:"Tag",component:()=>we(()=>import("./TagView-nqcag1ie.js"),__vite__mapDeps([13,2,3,5,6,7,14]),import.meta.url),meta:{icon:"sysIcon_tagso",deny_user:!1,deny_guest:!0}},{path:"/shares",name:"Share",component:()=>we(()=>import("./ShareView-Dx1E9CP6.js"),__vite__mapDeps([15,2,3,16]),import.meta.url),meta:{icon:"sysIcon_export",deny_user:!1,deny_guest:!0}},{path:"/group",name:"User",component:()=>we(()=>import("./UserView-CZnujoNs.js"),__vite__mapDeps([17,2,3,5,6,7,18]),import.meta.url),meta:{icon:"sysIcon_team",deny_user:!0,deny_guest:!0}},{path:"/log",name:"ProcessLog",component:()=>we(()=>import("./LogView-B16UlOUP.js"),__vite__mapDeps([19,2,3,20]),import.meta.url),meta:{icon:"sysIcon_filetext",deny_user:!0,deny_guest:!0}},{path:"/setting",name:"Setting",component:()=>we(()=>import("./SettingView-20kfKt4u.js"),__vite__mapDeps([21,2,3,5,22]),import.meta.url),meta:{icon:"sysIcon_setting",deny_user:!0,deny_guest:!0}}],qo=Vo({history:vo("./"),routes:en}),Go=["onClick"],Ko={class:"content"},Yo=fe({__name:"NaviContent",props:{depth:{},records:{}},setup(o){const e=o;e.depth&&e.depth;const t=e.records,n=jo(),a=Fo();async function l(d){console.info("go",d);const i=await n.push(d.path);console.info(i)}const _=Ve().get();return(d,i)=>(D(!0),L(G,null,re(Y(t),(r,f)=>{var y,s,g,h,u,w;return D(),L(G,{key:f},[(y=r.meta)!=null&&y.hide?(D(),L(G,{key:0},[],64)):(s=r.meta)!=null&&s.deny_guest&&((g=Y(_))==null?void 0:g.group.title)=="guest"?(D(),L(G,{key:1},[],64)):(h=r.meta)!=null&&h.deny_user&&!((u=Y(_))!=null&&u.group.admin)?(D(),L(G,{key:2},[],64)):(D(),L("p",{key:3,onClick:p=>l(r),class:ue({title:!0,active:r.path===Y(a).path})},[P("span",{class:ue(["icon","sysIcon",(w=r.meta)==null?void 0:w.icon])},null,2),P("span",Ko,se(r.name),1)],10,Go))],64)}),128))}}),Xo=fe({__name:"Navi",setup(o){return(e,t)=>(D(),L("div",{class:ue(["fr_navi",{folded:!1}])},[Re(Yo,{records:Y(en),depth:1},null,8,["records"])]))}});let it=null;const tn=pn("useContext",()=>({register:Qo,trigger:Jo}));function Qo(o){it=o}function Jo(o,e){it&&it(o,e)}var nn={};Object.defineProperty(nn,"__esModule",{value:!0});function Zo(o){o===void 0&&(o={});var e=/^0/,t=/\s+/g,n=/^\s+|\s+$/g,a=/[^\x00-\x80]/,l=/^0x[0-9a-f]+$/i,c=/(0x[\da-fA-F]+|(^[\+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|\d+)/g,_=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,d=String.prototype.toLocaleLowerCase||String.prototype.toLowerCase,i=o.desc?-1:1,r=-i,f=o.insensitive?function(g){return d.call(""+g).replace(n,"")}:function(g){return(""+g).replace(n,"")};function y(g){return g.replace(c,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0")}function s(g,h){return(!g.match(e)||h===1)&&parseFloat(g)||g.replace(t," ").replace(n,"")||0}return function(g,h){var u=f(g),w=f(h);if(!u&&!w)return 0;if(!u&&w)return r;if(u&&!w)return i;var p=y(u),m=y(w),v=u.match(l),b=w.match(l),M=v&&b?parseInt(v[0],16):p.length!==1&&Date.parse(u),E=v&&b?parseInt(b[0],16):M&&w.match(_)&&Date.parse(w)||null;if(E){if(M===E)return 0;if(M<E)return r;if(M>E)return i}for(var H=p.length,x=m.length,I=0,V=Math.max(H,x);I<V;I+=1){var le=s(p[I]||"",H),Z=s(m[I]||"",x);if(isNaN(le)!==isNaN(Z))return isNaN(le)?i:r;if(a.test(le+Z)&&le.localeCompare){var Le=le.localeCompare(Z);if(Le>0)return i;if(Le<0)return r;if(I===V-1)return 0}if(le<Z)return r;if(le>Z)return i;if(""+le<""+Z)return r;if(""+le>""+Z)return i}return 0}}var ea=nn.default=Zo;let z;class $s{constructor(e){ae(this,"nodeList",F([]));ae(this,"getList");ae(this,"route");ae(this,"router");ae(this,"contentDOM");ae(this,"emitGo");ae(this,"modalStore");ae(this,"localConfigure");ae(this,"contextStore");ae(this,"mode",F(""));ae(this,"modeKey","");ae(this,"sortVal",F(""));ae(this,"selecting",!1);ae(this,"selectingMovEvtCount",0);ae(this,"selectingOffset",[[0,0],[0,0]]);ae(this,"preSelectedNodeIndexSet",new Set);ae(this,"selectingKeyDef","");ae(this,"showSelectionOp",F(!1));ae(this,"lastSelectIndex",-1);ae(this,"reloadOffset_timer",0);ae(this,"reloadOffset_count",0);ae(this,"startScroll",!1);this.contentDOM=e.contentDOM,this.getList=e.getList,this.route=e.route,this.router=e.router,this.emitGo=e.emitGo,this.modalStore=We(),this.localConfigure=rt(),this.contextStore=tn(),this.mode.value=this.localConfigure.get("file_view_mode")??"detail",this.modeKey=this.localConfigure.listen("file_view_mode",t=>this.mode.value=t),this.sortVal=F(this.localConfigure.get("file_view_sort")??"name_asc"),this.contextMenuEvt=this.contextMenuEvt.bind(this),this.mouseDownEvt=this.mouseDownEvt.bind(this),this.mouseMoveEvt=this.mouseMoveEvt.bind(this),this.mouseUpEvt=this.mouseUpEvt.bind(this),this.keymap=this.keymap.bind(this),this.reloadOffset=this.reloadOffset.bind(this),this.scrollEvt=this.scrollEvt.bind(this),addEventListener("contextmenu",this.contextMenuEvt),addEventListener("pointerdown",this.mouseDownEvt),addEventListener("pointermove",this.mouseMoveEvt),addEventListener("pointerup",this.mouseUpEvt),addEventListener("keydown",this.keymap),addEventListener("resize",this.reloadOffset),this.contentDOM.addEventListener("scroll",this.scrollEvt),z=this}destructor(){console.info("destructor loaded"),this.localConfigure.release("file_view_mode",this.modeKey),removeEventListener("contextmenu",this.contextMenuEvt),removeEventListener("pointerdown",this.mouseDownEvt),removeEventListener("pointermove",this.mouseMoveEvt),removeEventListener("pointerup",this.mouseUpEvt),removeEventListener("keydown",this.keymap),removeEventListener("resize",this.reloadOffset),this.contentDOM&&this.contentDOM.removeEventListener("scroll",this.scrollEvt),z=null}setList(e){this.nodeList.value=e,setTimeout(()=>{this.reloadOffset(void 0)},oe.timeouts.offsetDebounce)}deleteFromList(e){const t=[],n=new Set;e.forEach(a=>n.add(a)),this.nodeList.value.forEach(a=>{n.has(a.id??0)||t.push(a)}),this.getList(t)}inDetailView(e){let t=!1,n=e.target;for(;n;){if(n.contentEditable==="true"){t=!1;break}if(n.classList.contains("rater")){t=!1;break}if(n.classList.contains("list_fav")){t=!0;break}if(n.classList.contains("view_fav")){t=!1;break}if(n.classList.contains("content_meta")){t=!1;break}if(n.classList.contains("fr_content")){t=!0;break}if(!n.parentElement)break;n=n.parentElement}return t}inTaggingDOM(e){let t=!1,n=e.target;for(;n;){if(n.classList.contains("content_detail"))return!1;if(n.classList.contains("tag_list")){t=!0;break}if(!n.parentElement)break;n=n.parentElement}return t}mouseDownEvt(e){var c,_,d,i;if(!this.inDetailView(e)||e.button===1)return;if(this.selectingOffset[0]=[e.x+(((c=this.contentDOM)==null?void 0:c.scrollLeft)??0),e.y+(((_=this.contentDOM)==null?void 0:_.scrollTop)??0)],this.selectingOffset[1]=[e.x+(((d=this.contentDOM)==null?void 0:d.scrollLeft)??0),e.y+(((i=this.contentDOM)==null?void 0:i.scrollTop)??0)],this.preSelectedNodeIndexSet.clear(),e.preventDefault(),e.button!==0)return this.rightMouseDownEvt(e);this.nodeList.value.forEach((r,f)=>{r._selected&&this.preSelectedNodeIndexSet.add(f)}),this.selecting=!0,this.selectingMovEvtCount=0;const t=this.getSelection(this.selectingOffset),n=[];e.ctrlKey&&n.push("ctrl"),e.shiftKey&&n.push("shift"),this.selectingKeyDef=n.join("_");let a=-1;const l=Array.from(t);switch(l.length&&(a=l.pop()??-1),this.selectingKeyDef){case"shift":this.preSelectedNodeIndexSet.clear();case"ctrl_shift":if(a==-1||this.lastSelectIndex==-1)break;const r=Math.min(a,this.lastSelectIndex),f=Math.max(a,this.lastSelectIndex);for(let y=r;y<=f;y++)t.has(y)||this.preSelectedNodeIndexSet.add(y);break;default:this.preSelectedNodeIndexSet.clear();break;case"ctrl":break}this.nodeList.value.forEach((r,f)=>{let y=0;this.preSelectedNodeIndexSet.has(f)&&(y+=1),t.has(f)&&(y+=1),r._selected=y===1}),this.lastSelectIndex=a,this.showSelectionOp.value=this.preSelectedNodeIndexSet.size+t.size>0}rightMouseDownEvt(e){const t=this.getSelection(this.selectingOffset);let n=!1;const a=new Set;this.nodeList.value.forEach((l,c)=>{l._selected&&(a.add(c),t.has(c)&&(n=!0))}),n?this.preSelectedNodeIndexSet=a:this.preSelectedNodeIndexSet=t,this.nodeList.value.forEach((l,c)=>{l._selected=this.preSelectedNodeIndexSet.has(c)})}mouseMoveEvt(e){var a,l;if(!this.selecting||(this.selectingMovEvtCount+=1,this.selectingMovEvtCount<10))return;e.preventDefault(),this.selectingOffset[1]=[e.x+(((a=this.contentDOM)==null?void 0:a.scrollLeft)??0),e.y+(((l=this.contentDOM)==null?void 0:l.scrollTop)??0)];const t=this.getSelection(this.selectingOffset);this.nodeList.value.forEach((c,_)=>{let d=0;this.preSelectedNodeIndexSet.has(_)&&(d+=1),t.has(_)&&(d+=1),c._selected=d===1});const n=this.getSelection([this.selectingOffset[1],this.selectingOffset[1]]);n.size&&(this.lastSelectIndex=Array.from(n).pop()??-1),this.showSelectionOp.value=this.preSelectedNodeIndexSet.size+t.size>0}mouseUpEvt(e){this.selecting&&(e.preventDefault(),setTimeout(()=>{this.selecting=!1,this.selectingMovEvtCount=0,this.selectingOffset=[[0,0],[0,0]],this.preSelectedNodeIndexSet.clear(),this.selectingKeyDef=""},oe.timeouts.selectEvt))}async contextMenuEvt(e){if(!this.inDetailView(e))return;let t=this.route.name==="Recycle",n=this.getSelected();if(!n.nodeLs||!n.nodeLs.length)return;let a=n.nodeLs.length!==1;const l=n.nodeLs,c=n.idSet;let _=this.localConfigure.get("file_view_mode")??"detail";this.route.name!=="Directory"&&(_="detail");let d=_==="detail";this.route.name==="Recycle"&&(d=!1),e.preventDefault(),e.stopPropagation(),this.contextStore.trigger([{title:"Open",auth:"guest",method:async i=>{console.info("Open",i),a?await q.op_bath_browser(c,l):this.emitGo("node",l[0].id)}},{title:"Open New Tab",auth:"guest",method:async i=>{var y;console.info("Open",i,this.route,this.router);let r=null;a||l.length&&l[0].type==="directory"&&(r=l[0]),de.copyObject(this.route.query);const f=new URL(location.href);r&&f.searchParams.set("id_dir",`${r.id??0}`),(y=window.open(f,"_blank"))==null||y.focus()}},{title:"Download",auth:a||l[0].type=="directory"?"none":"guest",method:i=>{var g,h;console.info("Download",i);const r=l[0];let f=(h=(g=r.file_index)==null?void 0:g.raw)==null?void 0:h.path,y=(r==null?void 0:r.title)??"";if(!f)return;let s=document.createElement("a");s.style.display="none",s.href=f+"?filename="+y,s.target="_blank",s.setAttribute("download",y),s.click()}},{title:"Download Selected",auth:a||l[0].type=="directory"?"guest":"none",method:async i=>{if(console.info("DownloadSelected",i),console.info(this,l),!z||!z.modalStore)return;const r=At("",l),f=new _n(r,async g=>{const h=await X("file/get",Object.assign({mode:"directory",cascade_dir:"0",id_dir:g.id.toString(),with:"file"}));return h?At(g.path,h.list):[]}),y=F("downloading 0/0 (0%)"),s=z.modalStore.set({title:f.title,alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:y});await f.prepare(),await f.download((g,h,u,w,p)=>{const m=g+h,v=Math.round(1e4*m/u)/100+"%";s.content.text.value=`downloading ${m}/${u} (${v})`}),await f.build(),await f.complete(),z.modalStore.close(s.nid)}},{title:"Rename",auth:d?"user":"none",method:async i=>{console.info("Rename",i),a?await q.op_bath_rename(c,l):await q.op_rename(l[0])}},{title:"Move",auth:d?"user":"none",method:async i=>{console.info("Move",i),a?await q.op_bath_move(c,l):await q.op_move(l[0])}},{title:"Delete",auth:t?"none":"user",method:async i=>{console.info("Delete",i),a?await q.op_bath_delete(c,l):await q.op_delete(l[0])}},{title:"Recover",auth:t?"user":"none",method:async i=>{console.info("Recover",i),a?await q.op_bath_delete(c,l,!0):await q.op_delete(l[0],!0)}},{title:"Delete Forever",auth:t?"user":"none",method:async i=>{console.info("Delete Forever",i),a?await q.op_bath_delete_forever(c,l):await q.op_delete_forever(l[0])}},{title:"Favourite",auth:d?"user":"none",method:async i=>{console.info("Favourite",i),a?await q.op_bath_favourite(c,l):await q.op_toggle_favourite(l[0])}},{title:"Share",auth:"user",method:async i=>{console.info("Share",i),await q.op_share(c)}},{title:"Extra",auth:"guest",method:i=>{console.info("Extra",i)},child:[{title:"Tagging",auth:d?"user":"none",method:async i=>{console.info("Tagging",i),l.forEach(r=>{q.op_tag(r)})}},{title:"Set Cover",auth:a?"none":"user",method:async i=>{console.info("Set Cover",i),await q.op_set_cover(l[0])}},{title:"Import EHT",auth:"admin",method:async i=>{console.info("Import EHT",i),await q.op_imp_tag_eh(Array.from(c))}},{title:"Cascade Tag",auth:"user",method:async i=>{console.info("Cascade Tag",i),await q.op_cascade_tag(Array.from(c))}}]},{title:"Admin",auth:"admin",method:i=>{console.info("Extra",i)},child:[{title:"ReBuild",auth:"admin",method:async i=>{console.info("ReBuild",i),await q.op_rebuild(Array.from(c))}},{title:"ReHash",auth:a?"none":"admin",method:async i=>{console.info("ReHash",i),await q.op_rehash(Array.from(c))}},{title:"RM RAW",auth:"admin",method:async i=>{console.info("RMRAW",i),await q.op_rm_raw(Array.from(c))}}]}],e)}getSelection(e){let t=e[0][0]>e[1][0]?e[1][0]:e[0][0],n=e[0][1]>e[1][1]?e[1][1]:e[0][1],a=e[0][0]<e[1][0]?e[1][0]:e[0][0],l=e[0][1]<e[1][1]?e[1][1]:e[0][1];const c=new Set;return this.nodeList.value.forEach((_,d)=>{if(!_._offsets)return;let i=_==null?void 0:_._offsets[0],r=_==null?void 0:_._offsets[1],f=_==null?void 0:_._offsets[2],y=_==null?void 0:_._offsets[3],s=i>=t&&i<=a||f>=t&&f<=a||i<=a&&f>=t,g=r>=n&&r<=l||y>=n&&y<=l||r<=l&&y>=n;!s||!g||c.add(d)}),c}clearSelect(e){e.target.classList.contains("content_detail")&&(this.nodeList.value.forEach(t=>{t._selected=!1}),this.showSelectionOp.value=!1)}async bathOp(e){let{idSet:t,nodeLs:n}=this.getSelected();if(t.size)switch(e){case"rename":await q.op_bath_rename(t,n);break;case"move":await q.op_bath_move(t,n);break;case"delete":await q.op_bath_delete(t,n);break;case"delete_forever":await q.op_bath_delete_forever(t,n);break;case"browser":await q.op_bath_browser(t,n);break;case"favourite":await q.op_bath_favourite(t,n);break}}getSelected(){const e=[],t=new Set;return this.nodeList.value.forEach(n=>{n._selected&&(e.push(n),t.add((n==null?void 0:n.id)??0))}),{nodeLs:e,idSet:t}}arrowSelection(e){if(!this.nodeList.value.length)return;let t=this.lastSelectIndex;if(t===-1){const i=this.getSelected();i.idSet.size?t=Array.from(i.idSet).pop()??0:t=0}this.localConfigure.get("file_view_mode"),this.route.name;const n=this.nodeList.value[t];if(!n)return;n._offsets||(n._offsets=[]);const a=n._offsets[2]-n._offsets[0],l=this.contentDOM.offsetWidth,c=Math.floor(l/a);let _=t;switch(e.key){case"ArrowRight":_+=1;break;case"ArrowLeft":_-=1;break;case"ArrowUp":_-=1*c;break;case"ArrowDown":_+=1*c;break}let d=!1;(e.ctrlKey||e.shiftKey)&&(d=!0),_<0&&(_=0),_>this.nodeList.value.length-1&&(_=this.nodeList.value.length-1),this.lastSelectIndex=_,this.nodeList.value.forEach((i,r)=>{if(_===r)return i._selected=!0;i._selected&&!d&&(i._selected=!1)})}setMode(e){this.localConfigure.set("file_view_mode",e),this.setList(this.nodeList.value)}setSort(e){console.info("setSort",e),this.localConfigure.set("file_view_sort",e);const t=this.nodeList.value;this.nodeList.value=[],setTimeout(()=>{this.nodeList.value=this.sortList(t,this.sortVal.value),this.setList(this.nodeList.value)},oe.timeouts.sort)}sortList(e,t){return e=on(e,t),e}async keymap(e){let t;const n=e.target;switch(e.key){case"F2":if(Ie(n)||Te(n)||this.mode.value!="detail")return;t=this.getSelected(),t.nodeLs.length!==1?await q.op_bath_rename(t.idSet,t.nodeLs):await q.op_rename(t.nodeLs[0]);break;case"Delete":if(Ie(n)||Te(n))return;t=this.getSelected(),this.route.name==="Recycle"?await q.op_bath_delete_forever(t.idSet,t.nodeLs):await q.op_bath_delete(t.idSet,t.nodeLs);break;case"NumpadEnter":case"Enter":if(Ie(n)||Te(n)||(t=this.getSelected(),!t.idSet.size))return;if(console.info(t.idSet.size),e.altKey&&t.idSet.size==1)return this.emitGo("node",Array.from(t.idSet)[0]);await q.op_bath_browser(t.idSet,t.nodeLs);break;case"ArrowRight":case"ArrowLeft":case"ArrowUp":case"ArrowDown":return Ie(n)||Te(n)?void 0:this.arrowSelection(e)}}reloadOffset(e){if(this.reloadOffset_count>100)return;let t=!0;if(this.nodeList.value.forEach(n=>{n._dom||(t=!1)}),clearTimeout(this.reloadOffset_timer),!t){this.reloadOffset_timer=setTimeout(()=>{this.reloadOffset_count+=1,this.reloadOffset(e)},oe.timeouts.offsetDebounce);return}this.nodeList.value.forEach(n=>{if(!n._dom)return;const a=n._dom;let l=0,c=0,_=0,d=0;l=de.nodeOffsetX(a),c=de.nodeOffsetY(a),_=l+a.offsetWidth,d=c+a.offsetHeight,n._offsets=[l,c,_,d]}),this.scrollEvt(e)}go(e){const t=Object.assign({id_dir:"",id_tag:""},e);this.router.push({path:"/",query:t})}scrollEvt(e){de.debounce(()=>{this.saveScroll(),this.reloadLazyLoad()},oe.timeouts.scrollEvt,"debounce_scroll_view")}saveScroll(){const e=this.route.query??{},t=[this.route.path,e.mode?e.mode:"",e.pid?e.pid:"",e.id?e.id:"",e.id?e.id:"",e.tag_id?e.tag_id:""].join(":"),n=[this.contentDOM.scrollTop,this.contentDOM.scrollLeft];!n[0]&&!n[1]||de.debounce(()=>{mn("scroll_log",t,n)},oe.timeouts.scrollSave,"debounce_scroll_save")}async reloadScroll(){const e=this.route.query??{},t=[this.route.path,e.mode?e.mode:"",e.pid?e.pid:"",e.id?e.id:"",e.id?e.id:"",e.tag_id?e.tag_id:""].join(":"),n=await vn("scroll_log",t);n&&(this.contentDOM.scrollTop=n[0]??0,this.contentDOM.scrollLeft=n[1]??0)}reloadLazyLoad(){if(!this.contentDOM)return;const e=this.contentDOM,t=de.nodeOffsetY(e),n=e.scrollTop+t,a=n+e.clientHeight+t;this.nodeList.value.forEach(l=>{let c=!0;if(!l._offsets||!l._offsets.length)return;let _=l._offsets;_[1]>a&&(c=!1),_[3]<n&&(c=!1),l._in_screen=c})}}class q{static async op_download(e){var n,a;let t=(a=(n=e.file_index)==null?void 0:n.raw)==null?void 0:a.path;t&&window.open(`${t}?filename=${e.title}`)}static async op_rename(e){if(e._renaming){const t=new FormData;t.set("id",`${e.id}`),t.set("title",e.title??""),t.set("description",e.description??""),await X("file/mod",t),z&&z.emitGo("reload")}e._renaming=!e._renaming,setTimeout(()=>{let t=document.body.querySelector('[contenteditable="true"]');t&&t.focus()},50)}static async op_bath_rename(e,t){z&&z.modalStore.set({title:"bath rename",alpha:!1,key:"",single:!1,w:400,h:275,minW:400,minH:275,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"renameUtil",data:{node_list:t,callback:()=>{z&&z.getList()}}}]})}static async op_move(e){z&&z.modalStore.set({title:`locator | move ${e.title} to:`,alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async t=>{const n=new FormData;n.set("id_node",`${e.id}`),n.set("id_target",`${t.id}`),await X("file/mov",n),z&&z.emitGo("reload")}}}]})}static async op_bath_move(e,t){z&&z.modalStore.set({title:`locator | move ${e.size} files to:`,alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async n=>{const a={id_list:Array.from(e).join(","),id_parent:`${n.id}`},l=await X("file/bath_move",a);z&&z.getList()}}}]})}static async op_delete(e,t=!1){const n=new FormData;n.set("id",`${e.id}`);const a=await X("file/delete",n);return console.info(z),z&&e.id&&z.deleteFromList([e.id]),a}static async op_bath_delete(e,t,n=!1,a){z&&z.modalStore.set({title:`confirm to ${n?"recover":"delete"} ${e.size} files`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:"conform to "+(n?"recover":"delete"),callback:{confirm:async l=>{const c=Array.from(e),_={id_list:c.join(",")},d=await X("file/bath_delete",_);z&&z.deleteFromList(c),a&&a()}}})}static async op_delete_forever(e){const t=new FormData;t.set("id",`${e.id}`);const n=await X("file/delete_forever",t);return z&&e.id&&z.deleteFromList([e.id]),n}static async op_bath_delete_forever(e,t){z&&z.modalStore.set({title:`confirm to delete ${e.size} files forever`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:"conform to delete forever",callback:{confirm:async n=>{const a=Array.from(e),l={id_list:a.join(",")},c=await X("file/bath_delete_forever",l);z&&z.deleteFromList(a)}}})}static async op_toggle_favourite(e){const t=await X("favourite_group/get",{}),n={};t&&t.forEach(a=>{a.auto||(n[a.id??0]=a.title??"")}),z&&z.modalStore.set({title:"select fav group:",alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"checkbox",label:"attach to",key:"target_group",value:e.list_fav,options:n}],callback:{submit:async function(a){const c=a.content.form[0].value.join(",");await X("favourite/attach",{id_node:e.id,list_group:c}),location.reload()}}})}static async op_bath_favourite(e,t){const n=await X("favourite_group/get",{}),a={};n&&n.forEach(l=>{l.auto||(a[l.id??0]=l.title??"")}),z&&z.modalStore.set({title:"select fav group:",alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"checkbox",label:"attach to:",key:"target_group",value:[],options:a}],callback:{submit:async function(l){const c=l.content.form[0].value.join(",");await X("favourite/bath_attach",{node_id_list:Array.from(e),list_group:c})}}})}static async op_bath_browser(e,t){let n=Array.from(e),a={};a.with="crumb,file",n.length==1?(a.mode="directory",a.id_dir=`${t[0].type==="directory"?t[0].id:t[0].id_parent}`):(a.mode="id_iterate",a.keyword=n.join(",")),a.cascade_dir="0",ta(a,n[0])}static async op_tag(e){if(e._tagging){const t=new Set;if(e.tag)for(let a=0;a<e.tag.length;a++)for(let l=0;l<e.tag[a].sub.length;l++){const c=e.tag[a].sub[l].id;c&&t.add(c)}const n=new FormData;n.set("id_node",`${e.id}`),n.set("tag_list",Array.from(t).join(",")),await X("tag/attach",n)}e._tagging=!e._tagging}static async op_set_cover(e){const t=new FormData;return t.set("id",`${e.id}`),await X("file/cover",t)}static async op_rebuild(e){const t=new FormData;return t.set("id_list",e.join(",")),await X("file/rebuild",t)}static async op_rehash(e){const t=new FormData;return t.set("id_list",e.join(",")),await X("file/rehash",t)}static async op_cascade_tag(e){const t=new FormData;return t.set("id_list",e.join(",")),await X("file/cascade_tag",t)}static async op_rm_raw(e){const t=new FormData;return t.set("id_list",e.join(",")),await X("file/rm_raw",t)}static async op_imp_tag_eh(e){const t=new FormData;return t.set("id_list",e.join(",")),await X("setting/import_eht_tag",t)}static async op_rate(e,t){if(!z)return;let n=z.getSelected();t&&!n.idSet.size&&(n.idSet.add((t==null?void 0:t.id)??0),n.nodeLs.push(t)),n.nodeLs.forEach(l=>{l.rate=e});const a=new FormData;a.set("node_id_list",Array.from(n.idSet).join(",")),a.set("rate",`${e}`),await X("rate/attach",a)}static async op_share(e){const t={title:"share file",alpha:!1,key:"",single:!1,w:400,h:120,minW:400,minH:120,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:'<a href="./share.html?id=#id#" target="_blank" style="text-decoration: underline">url generated<br> id: #id#</a>',callback:{submit:async n=>{}}};z==null||z.modalStore.set({title:"share file",alpha:!1,key:"",single:!1,w:400,h:160,minW:400,minH:160,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"radio",label:"duration",key:"status",value:"1",options:{1:"long",2:"1 day",3:"7 day",4:"30 day",5:"manual"},on_change:(n,a,l)=>{const c=new Date;switch(l.value){case"1":a.content.form[1].disabled=!0;break;case"2":a.content.form[1].disabled=!0,c.setDate(c.getDate()+1),a.content.form[1].value=c.toISOString().substring(0,16);break;case"3":a.content.form[1].disabled=!0,c.setDate(c.getDate()+7),a.content.form[1].value=c.toISOString().substring(0,16);break;case"4":a.content.form[1].disabled=!0,c.setDate(c.getDate()+30),a.content.form[1].value=c.toISOString().substring(0,16);break;case"5":a.content.form[1].disabled=!1,c.setDate(c.getDate()+30),a.content.form[1].value=c.toISOString().substring(0,16);break}}},{type:"datetime",label:"expire",key:"time_to",value:new Date().toISOString().substring(0,16),disabled:!0}],callback:{submit:async n=>{const a=new FormData;a.set("node_id_list",Array.from(e).join(",")),n.content.form[0].value=="1"?a.set("status","2"):(a.set("status","1"),a.set("time_to",n.content.form[1].value));const l=await X("share/set",a);l&&(t.text&&(t.text=t.text.replace(/#id#/ig,`${l.id}`)),z==null||z.modalStore.set(t))}}})}}function At(o,e){const t=[];return e.forEach(n=>{var l;const a={id:n.id,id_parent:n.id_parent,path:"",url:"",size:0,type:n.type??""};if(a.path=[o??"",n.title??""].join("/"),n.type!=="directory"){const c=(l=n.file_index)==null?void 0:l.raw;if(!c)return;c.path&&(a.url=c.path+"?filename="+n.title),a.size=c.size??0}t.push(a)}),t}function ta(o,e){if(!z)return;let t=z.localConfigure.get("browser_layout_w"),n=z.localConfigure.get("browser_layout_h");const a=window.innerWidth,l=window.innerHeight;a<t&&(t=0),l<n&&(n=0),z.modalStore.set({title:"file browser",alpha:!1,key:"",single:!1,w:t||400,h:n||400,minW:400>window.innerWidth?window.innerWidth*.9:400,minH:400>window.innerHeight?window.innerHeight*.9:400,allow_resize:!0,allow_move:!0,allow_fullscreen:!0,auto_focus:!1,component:[{componentName:"fileBrowser",data:{query:de.copyObject(o),curId:e}}]})}function on(o,e){let t=["id","asc"];switch(e){default:case"id_asc":t=["id","asc"];break;case"id_desc":t=["id","desc"];break;case"name_asc":t=["title","asc"];break;case"name_desc":t=["title","desc"];break;case"crt_asc":t=["time_create","asc"];break;case"crt_desc":t=["time_create","desc"];break;case"upd_asc":t=["time_update","asc"];break;case"upd_desc":t=["time_update","desc"];break;case"rate_asc":t=["rate","asc"];break;case"rate_desc":t=["rate","desc"];break}for(let l=0;l<o.length;l++){const c=o[l];c._sort_index||(c._sort_index=c.node_path+"/"+c.title)}const n=t[1]==="desc",a=n?-1:1;return o.sort((l,c)=>{let _="",d="";switch(t[0]){default:_=l[t[0]],d=c[t[0]];break;case"title":return _=a*(l.type==="directory"?0:1)+(l._sort_index??""),d=a*(c.type==="directory"?0:1)+(c._sort_index??""),ea({desc:n,insensitive:!0})(_,d)}return(_>d?1:-1)*a}),o}var Ke={},ve=ve||function(o,e){var t={},n=t.lib={},a=function(){},l=n.Base={extend:function(s){a.prototype=this;var g=new a;return s&&g.mixIn(s),g.hasOwnProperty("init")||(g.init=function(){g.$super.init.apply(this,arguments)}),g.init.prototype=g,g.$super=this,g},create:function(){var s=this.extend();return s.init.apply(s,arguments),s},init:function(){},mixIn:function(s){for(var g in s)s.hasOwnProperty(g)&&(this[g]=s[g]);s.hasOwnProperty("toString")&&(this.toString=s.toString)},clone:function(){return this.init.prototype.extend(this)}},c=n.WordArray=l.extend({init:function(s,g){s=this.words=s||[],this.sigBytes=g!=e?g:4*s.length},toString:function(s){return(s||d).stringify(this)},concat:function(s){var g=this.words,h=s.words,u=this.sigBytes;if(s=s.sigBytes,this.clamp(),u%4)for(var w=0;w<s;w++)g[u+w>>>2]|=(h[w>>>2]>>>24-8*(w%4)&255)<<24-8*((u+w)%4);else if(65535<h.length)for(w=0;w<s;w+=4)g[u+w>>>2]=h[w>>>2];else g.push.apply(g,h);return this.sigBytes+=s,this},clamp:function(){var s=this.words,g=this.sigBytes;s[g>>>2]&=4294967295<<32-8*(g%4),s.length=o.ceil(g/4)},clone:function(){var s=l.clone.call(this);return s.words=this.words.slice(0),s},random:function(s){for(var g=[],h=0;h<s;h+=4)g.push(4294967296*o.random()|0);return new c.init(g,s)}}),_=t.enc={},d=_.Hex={stringify:function(s){var g=s.words;s=s.sigBytes;for(var h=[],u=0;u<s;u++){var w=g[u>>>2]>>>24-8*(u%4)&255;h.push((w>>>4).toString(16)),h.push((w&15).toString(16))}return h.join("")},parse:function(s){for(var g=s.length,h=[],u=0;u<g;u+=2)h[u>>>3]|=parseInt(s.substr(u,2),16)<<24-4*(u%8);return new c.init(h,g/2)}},i=_.Latin1={stringify:function(s){var g=s.words;s=s.sigBytes;for(var h=[],u=0;u<s;u++)h.push(String.fromCharCode(g[u>>>2]>>>24-8*(u%4)&255));return h.join("")},parse:function(s){for(var g=s.length,h=[],u=0;u<g;u++)h[u>>>2]|=(s.charCodeAt(u)&255)<<24-8*(u%4);return new c.init(h,g)}},r=_.Utf8={stringify:function(s){try{return decodeURIComponent(escape(i.stringify(s)))}catch{throw Error("Malformed UTF-8 data")}},parse:function(s){return i.parse(unescape(encodeURIComponent(s)))}},f=n.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(s){typeof s=="string"&&(s=r.parse(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes},_process:function(s){var g=this._data,h=g.words,u=g.sigBytes,w=this.blockSize,p=u/(4*w),p=s?o.ceil(p):o.max((p|0)-this._minBufferSize,0);if(s=p*w,u=o.min(4*s,u),s){for(var m=0;m<s;m+=w)this._doProcessBlock(h,m);m=h.splice(0,s),g.sigBytes-=u}return new c.init(m,u)},clone:function(){var s=l.clone.call(this);return s._data=this._data.clone(),s},_minBufferSize:0});n.Hasher=f.extend({cfg:l.extend(),init:function(s){this.cfg=this.cfg.extend(s),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(s){return this._append(s),this._process(),this},finalize:function(s){return s&&this._append(s),this._doFinalize()},blockSize:16,_createHelper:function(s){return function(g,h){return new s.init(h).finalize(g)}},_createHmacHelper:function(s){return function(g,h){return new y.HMAC.init(s,h).finalize(g)}}});var y=t.algo={};return t}(Math);(function(o){for(var e=ve,s=e.lib,t=s.WordArray,n=s.Hasher,s=e.algo,a=[],l=[],c=function(h){return 4294967296*(h-(h|0))|0},_=2,d=0;64>d;){var i;e:{i=_;for(var r=o.sqrt(i),f=2;f<=r;f++)if(!(i%f)){i=!1;break e}i=!0}i&&(8>d&&(a[d]=c(o.pow(_,.5))),l[d]=c(o.pow(_,1/3)),d++),_++}var y=[],s=s.SHA256=n.extend({_doReset:function(){this._hash=new t.init(a.slice(0))},_doProcessBlock:function(g,h){for(var u=this._hash.words,w=u[0],p=u[1],m=u[2],v=u[3],b=u[4],M=u[5],E=u[6],H=u[7],x=0;64>x;x++){if(16>x)y[x]=g[h+x]|0;else{var I=y[x-15],V=y[x-2];y[x]=((I<<25|I>>>7)^(I<<14|I>>>18)^I>>>3)+y[x-7]+((V<<15|V>>>17)^(V<<13|V>>>19)^V>>>10)+y[x-16]}I=H+((b<<26|b>>>6)^(b<<21|b>>>11)^(b<<7|b>>>25))+(b&M^~b&E)+l[x]+y[x],V=((w<<30|w>>>2)^(w<<19|w>>>13)^(w<<10|w>>>22))+(w&p^w&m^p&m),H=E,E=M,M=b,b=v+I|0,v=m,m=p,p=w,w=I+V|0}u[0]=u[0]+w|0,u[1]=u[1]+p|0,u[2]=u[2]+m|0,u[3]=u[3]+v|0,u[4]=u[4]+b|0,u[5]=u[5]+M|0,u[6]=u[6]+E|0,u[7]=u[7]+H|0},_doFinalize:function(){var g=this._data,h=g.words,u=8*this._nDataBytes,w=8*g.sigBytes;return h[w>>>5]|=128<<24-w%32,h[(w+64>>>9<<4)+14]=o.floor(u/4294967296),h[(w+64>>>9<<4)+15]=u,g.sigBytes=4*h.length,this._process(),this._hash},clone:function(){var g=n.clone.call(this);return g._hash=this._hash.clone(),g}});e.SHA256=n._createHelper(s),e.HmacSHA256=n._createHmacHelper(s)})(Math);(function(){var o=ve,e=o.enc.Utf8;o.algo.HMAC=o.lib.Base.extend({init:function(t,n){t=this._hasher=new t.init,typeof n=="string"&&(n=e.parse(n));var a=t.blockSize,l=4*a;n.sigBytes>l&&(n=t.finalize(n)),n.clamp();for(var c=this._oKey=n.clone(),_=this._iKey=n.clone(),d=c.words,i=_.words,r=0;r<a;r++)d[r]^=1549556828,i[r]^=909522486;c.sigBytes=_.sigBytes=l,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var n=this._hasher;return t=n.finalize(t),n.reset(),n.finalize(this._oKey.clone().concat(t))}})})();(function(){var o=ve,e=o.lib.WordArray;o.enc.Base64={stringify:function(t){var n=t.words,a=t.sigBytes,l=this._map;t.clamp(),t=[];for(var c=0;c<a;c+=3)for(var _=(n[c>>>2]>>>24-8*(c%4)&255)<<16|(n[c+1>>>2]>>>24-8*((c+1)%4)&255)<<8|n[c+2>>>2]>>>24-8*((c+2)%4)&255,d=0;4>d&&c+.75*d<a;d++)t.push(l.charAt(_>>>6*(3-d)&63));if(n=l.charAt(64))for(;t.length%4;)t.push(n);return t.join("")},parse:function(t){var n=t.length,a=this._map,l=a.charAt(64);l&&(l=t.indexOf(l),l!=-1&&(n=l));for(var l=[],c=0,_=0;_<n;_++)if(_%4){var d=a.indexOf(t.charAt(_-1))<<2*(_%4),i=a.indexOf(t.charAt(_))>>>6-2*(_%4);l[c>>>2]|=(d|i)<<24-8*(c%4),c++}return e.create(l,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(o){for(var e=ve,s=e.lib,t=s.WordArray,n=s.Hasher,s=e.algo,a=[],l=[],c=function(h){return 4294967296*(h-(h|0))|0},_=2,d=0;64>d;){var i;e:{i=_;for(var r=o.sqrt(i),f=2;f<=r;f++)if(!(i%f)){i=!1;break e}i=!0}i&&(8>d&&(a[d]=c(o.pow(_,.5))),l[d]=c(o.pow(_,1/3)),d++),_++}var y=[],s=s.SHA256=n.extend({_doReset:function(){this._hash=new t.init(a.slice(0))},_doProcessBlock:function(g,h){for(var u=this._hash.words,w=u[0],p=u[1],m=u[2],v=u[3],b=u[4],M=u[5],E=u[6],H=u[7],x=0;64>x;x++){if(16>x)y[x]=g[h+x]|0;else{var I=y[x-15],V=y[x-2];y[x]=((I<<25|I>>>7)^(I<<14|I>>>18)^I>>>3)+y[x-7]+((V<<15|V>>>17)^(V<<13|V>>>19)^V>>>10)+y[x-16]}I=H+((b<<26|b>>>6)^(b<<21|b>>>11)^(b<<7|b>>>25))+(b&M^~b&E)+l[x]+y[x],V=((w<<30|w>>>2)^(w<<19|w>>>13)^(w<<10|w>>>22))+(w&p^w&m^p&m),H=E,E=M,M=b,b=v+I|0,v=m,m=p,p=w,w=I+V|0}u[0]=u[0]+w|0,u[1]=u[1]+p|0,u[2]=u[2]+m|0,u[3]=u[3]+v|0,u[4]=u[4]+b|0,u[5]=u[5]+M|0,u[6]=u[6]+E|0,u[7]=u[7]+H|0},_doFinalize:function(){var g=this._data,h=g.words,u=8*this._nDataBytes,w=8*g.sigBytes;return h[w>>>5]|=128<<24-w%32,h[(w+64>>>9<<4)+14]=o.floor(u/4294967296),h[(w+64>>>9<<4)+15]=u,g.sigBytes=4*h.length,this._process(),this._hash},clone:function(){var g=n.clone.call(this);return g._hash=this._hash.clone(),g}});e.SHA256=n._createHelper(s),e.HmacSHA256=n._createHmacHelper(s)})(Math);Ke.enc={Base64:ve.enc.Base64,Utf8:ve.enc.Utf8,Latin1:ve.enc.Latin1};Ke.SHA256=ve.SHA256;Ke.HmacSHA256=ve.HmacSHA256;const ut=Ke,na={alg:"HS256",typ:"JWT"};function an(o){return ut.enc.Base64.stringify(o).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function oa(o,e,t={}){const n=Object.assign(na,t);if(n.alg!=="HS256"&&n.typ!=="JWT")throw new Error("jwt-encode only support the HS256 algorithm and the JWT type of hash");const a=Mt(n),l=Mt(o);let c=`${a}.${l}`;return c=ut.HmacSHA256(c,e),c=an(c),`${a}.${l}.${c}`}function Mt(o){const e=ut.enc.Utf8.parse(JSON.stringify(o));return an(e)}var aa=oa;const sa=yn(aa),ia={class:"modal_browser office"},ra={class:"base"},la={class:"l"},ca={class:"r"},ua={class:"content"},da=["id"],tt=100,fa=fe({__name:"browserOffice",props:{extId:{},curIndex:{},isActive:{type:Boolean},file:{},dom:{}},setup(o){const e=o;""+e.extId,F(null);let t=null;const a=Ve().get();Se(()=>{console.warn("mounted");const i=new URL(location.href);_(`${i.origin}/onlyoffice_server/web-apps/apps/api/documents/api.js`),setTimeout(()=>l(),tt)});function l(){if(!c)return setTimeout(()=>l(),tt);const i="modal_office_"+e.extId;if(!document.getElementById(i))return setTimeout(()=>l(),tt);const f=oe.onlyOffice.jwtSecret,y=e.file,s=y.title.lastIndexOf("."),g=y.title.substring(s+1),h=d(g);if(!h)return;const u=new URL(location.href),w={document:{fileType:g,key:y.id.toString(16)+"_"+Math.floor(new Date().valueOf()).toString(),title:y.title,url:`${u.origin}${y.raw}?tosho_token=${a==null?void 0:a.token}`},documentType:h,editorConfig:{callbackUrl:`${u.origin}/api/onlyoffice/callback?id=${y.id}&tosho_token=${a==null?void 0:a.token}`},token:""};w.token=sa(w,f),console.info(w),t=new DocsAPI().DocEditor(i,w),console.info(t)}Tt(()=>e.file,async i=>{console.info("onMod props.curNode")}),De(()=>{});let c=!1;function _(i){var r=document.createElement("script");r.type="text/javascript",r.src=i,r.onload=f=>{console.info(f),c=!0},document.body.appendChild(r)}function d(i){let r=!1;switch(i){default:break;case"doc":case"docm":case"docx":case"dot":case"dotm":case"dotx":case"epub":case"fb2":case"fodt":case"htm":case"html":case"mht":case"mhtml":case"odt":case"ott":case"rtf":case"stw":case"sxw":case"txt":case"wps":case"wpt":r="word";break;case"csv":case"et":case"ett":case"fods":case"ods":case"ots":case"sxc":case"xls":case"xlsb":case"xlsm":case"xlsx":case"xlt":case"xltm":case"xltx":r="cell";break;case"dps":case"dpt":case"fodp":case"odp":case"otp":case"pot":case"potm":case"potx":case"pps":case"ppsm":case"ppsx":case"ppt":case"pptm":case"pptx":case"sxi":r="slide";break}return r}return(i,r)=>(D(),L("div",ia,[P("div",ra,[P("div",la,[Xe(i.$slots,"info")]),P("div",ca,[Xe(i.$slots,"btnContainer")])]),Xe(i.$slots,"navigator"),P("div",ua,[P("div",{id:"modal_office_"+i.extId},null,8,da)])]))}}),ha={key:0},pa={class:"preLine"},_a={class:"btnContainer"},ma=["value"],va=["value","innerHTML"],ya=["value"],ga=["value"],wa=fe({__name:"browser",props:{data:{},modalData:{}},setup(o){const e=o,t=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1,n={audio:gn,video:wn,image:bn,pdf:kn,text:En,office:pt,base:pt};oe.onlyOffice.enabled&&(n.office=fa);const a=rt();let l=!1;function c(){if(l&&!e.modalData.layout.fullscreen){let $=a.get("browser_layout_w"),S=a.get("browser_layout_h");e.modalData.layout.w=$,e.modalData.layout.h=S,e.modalData.layout.x=(window.innerWidth-$)/2,e.modalData.layout.y=(window.innerHeight-S)/2}else e.modalData.layout.fullscreen||(a.set("browser_layout_w",e.modalData.layout.w),a.set("browser_layout_h",e.modalData.layout.h));l=e.modalData.layout.fullscreen,p.value={w:e.modalData.layout.w,h:e.modalData.layout.h}}const _=F(a.get("browser_play_mode")??"loop");function d(){let $=oe.playMode.indexOf(_.value);$+=1,$>oe.playMode.length-1&&($=0),_.value=oe.playMode[$],a.set("browser_play_mode",_.value)}const i=F(a.get("browser_show_detail")??!1);function r(){i.value=!i.value,a.set("browser_show_detail",i.value)}Se(()=>{document.addEventListener("keydown",V),document.addEventListener(`modal_resizing_${e.modalData.nid}`,c),p.value={w:e.modalData.layout.w,h:e.modalData.layout.h},setTimeout(()=>{document.activeElement&&document.activeElement.blur()},100)}),De(()=>{document.removeEventListener("keydown",V),document.removeEventListener(`modal_resizing_${e.modalData.nid}`,c)});const f=F([]),y=F([]),s=F([]);let g=0;const h=F(0),u=F(null),w=F({id:0,title:"",cover:"",preview:"",normal:"",raw:"",sameName:[]}),p=F({w:0,h:0});async function m($){const S=await X("file/get",{node_type:"directory",id_dir:`${$}`,with:"none"});return S||{path:[],list:[]}}b();function v(){let $=[];return g=0,y.value.forEach(S=>{if(!H(S))return;const B=S.rate?S.rate+2:2;$.push(Object.assign(S,{_weight_stack:g})),g+=B}),$=he($,Z.value),$}async function b($={}){var ie;$&&(e.data.query=Object.assign(e.data.query,$));let S=await X("file/get",e.data.query);if(!S||!S.list.length)return!1;let B=[];if(S.list.forEach(k=>{k.is_file&&B.push(k)}),S.list=B,!S.list.length){if(parseInt(((ie=e.data.query)==null?void 0:ie.cascade_dir)??""))return!1;const k=de.copyObject(e.data.query);if(k.cascade_dir="1",S=await X("file/get",k),!S||!S.list.length)return!1;B=[],S.list.forEach(C=>{C.is_file&&B.push(C)}),S.list=B}if(!S.list.length)return!1;let W=0,A=null;for(let k=0;k<S.list.length;k++)if(S.list[k].id===e.data.curId){W=k,A=S.list[k];break}console.info(W,A),f.value=S.path,y.value=S.list;let J=v();return J.length?(s.value=he(J,Z.value),A||(A=s.value[0]),h.value=le(s.value,A),console.info(h.value),x(),!0):!1}function M($,S,B=0){let W=s.value.length;if(W<1)return;let A=0;if(_.value==="shuffle"){let J=Math.random()*g;S=0;for(let ie=0;ie<W&&(S=ie,!(s.value[ie]._weight_stack>J));ie++);A=S}else A=$+S;for(;A<0;)A+=W;for(;A>W-1;)A-=W;B||(B=0),B+=1,!(B>W)&&(h.value=A,x())}function E($){let S=$-h.value;M(h.value,S)}function H($){const S=parseInt(pe.value)??0;if(($.rate??0)<S)return!1;switch(ge.value){case"any":case"file":return oe.ignoreFileType.indexOf($.type??"directory")===-1;default:return ge.value==$.type}}function x(){var W,A,J,ie;if(!s.value.length)return;const $=s.value[h.value];if(u.value=$,!$.file_index.preview&&["audio","video"].indexOf($.type)!==-1){let k=!1;y.value.forEach(C=>{if(C.id_parent!==$.id_parent||k)return;let R=!1;if(oe.coverKeyword.forEach(O=>{oe.imgKeyword.forEach(j=>{$.title.toLowerCase().indexOf(O)!==-1&&$.title.toLowerCase().indexOf(j)!==-1&&(R=!0)})}),R){k=!0;let O;O||(O=$.file_index.preview),O||(O=$.file_index.normal),O||(O=$.file_index.raw),$.file_index.preview=O}})}const S={id:$.id,title:$.title,cover:((W=$.file_index.cover)==null?void 0:W.path)??"",preview:((A=$.file_index.preview)==null?void 0:A.path)??"",normal:((J=$.file_index.normal)==null?void 0:J.path)??"",raw:((ie=$.file_index.raw)==null?void 0:ie.path)??"",sameName:[]};let B=S.title.lastIndexOf(".");if(B!==-1){let k=S.title.substring(0,B)??"";k&&y.value.forEach(C=>{var O,j,Q,N,U,T,ne,ee;if(C.id==S.id||((O=C.title)==null?void 0:O.indexOf(k))!==0)return;let R=(j=C.title)==null?void 0:j.substring(k.length);S.sameName.push({title:R,type:C.type??"",raw:((N=(Q=C.file_index)==null?void 0:Q.raw)==null?void 0:N.path)??"",normal:((T=(U=C.file_index)==null?void 0:U.normal)==null?void 0:T.path)??"",preview:((ee=(ne=C.file_index)==null?void 0:ne.preview)==null?void 0:ee.path)??""})})}w.value=S,I()}function I(){u.value&&(e.modalData.base.title=h.value+1+"/"+s.value.length+" "+(u.value.title??""))}async function V($){if(!u.value||Ie($.target)||!e.modalData.layout.active)return;let S,B,W,A,J,ie;switch($.key){case"ArrowLeft":if($.preventDefault(),$.stopPropagation(),["audio","video"].indexOf(u.value.type??"")!==-1)return;M(h.value,-1);break;case"ArrowRight":if($.preventDefault(),$.stopPropagation(),["audio","video"].indexOf(u.value.type??"")!==-1)return;M(h.value,1);break;case"a":case"PageUp":$.preventDefault(),$.stopPropagation(),M(h.value,-1);break;case"d":case"PageDown":$.preventDefault(),$.stopPropagation(),M(h.value,1);break;case"w":case"[":switch(e.data.query.mode){default:const C=f.value.length?f.value[f.value.length-1]:{id:0,id_parent:0,type:"directory",title:"root",description:"",status:1,building:0};if(S=await m(C.id_parent),B=he(S.list,Z.value),W=B.length,W<2)return;A=0,B.forEach((T,ne)=>{T.id==e.data.query.id_dir&&(A=ne)}),ie=B.length;do{for(A-=1;A<0;)A+=W;for(;A>W-1;)A-=W;if(J=B[A],e.data.query.id_dir=`${J.id}`,await b())break}while(--ie>0);break;case"id_iterate":if(!e.data.query.keyword)break;const R=e.data.query.keyword.split(","),O=[];R.forEach(T=>O.push(parseInt(T)));let j=null;if(u.value.crumb_node)for(let T=0;T<u.value.crumb_node.length;T++){const ne=u.value.crumb_node[T];if(O.indexOf(ne.id)!==-1){j=ne.id;break}}if(!j)break;const Q=O.indexOf(j);W=O.length;let N=Q-1;for(;N<0;)N+=W;for(;N>W-1;)N-=W;const U=O[N];for(let T=0;T<s.value.length;T++){const ne=s.value[T];for(let ee=0;ee<ne.crumb_node.length;ee++)if(ne.crumb_node[ee].id===U)return M(T,0)}}break;case"s":case"]":switch(e.data.query.mode){default:const C=f.value.length?f.value[f.value.length-1]:{id:0,id_parent:0,type:"directory",title:"root",description:"",status:1,building:0};if(S=await m(C.id_parent),B=he(S.list,Z.value),W=B.length,W<2)return;A=0,B.forEach((T,ne)=>{T.id==e.data.query.id_dir&&(A=ne)}),ie=B.length;do{for(A+=1;A<0;)A+=W;for(;A>W-1;)A-=W;if(J=B[A],e.data.query.id_dir=`${J.id}`,await b())break}while(--ie>0);break;case"id_iterate":if(!e.data.query.keyword)break;const R=e.data.query.keyword.split(","),O=[];R.forEach(T=>O.push(parseInt(T)));let j=null;for(let T=0;T<u.value.crumb_node.length;T++){const ne=u.value.crumb_node[T];if(O.indexOf(ne.id)!==-1){j=ne.id;break}}if(!j)break;const Q=O.indexOf(j);W=O.length;let N=Q+1;for(;N<0;)N+=W;for(;N>W-1;)N-=W;const U=O[N];for(let T=0;T<s.value.length;T++){const ne=s.value[T];for(let ee=0;ee<ne.crumb_node.length;ee++)if(ne.crumb_node[ee].id===U)return M(T,0)}break}break;case"NumpadEnter":case"Enter":break;case"Delete":$.preventDefault(),$.stopPropagation();const k=new Set;u.value&&u.value.id&&k.add(u.value.id),await q.op_bath_delete(k,[],!1,()=>{M(h.value,1)});break}}function le($,S){let B=0;return $.forEach((W,A)=>{W.id===S.id&&(B=A)}),B}const Z=F(a.get("browser_list_sort")??"name_asc");function Le($){var B;if(!u.value)return;console.info("setSort",Z.value,$),(B=$.target)==null||B.blur();const S=s.value;s.value=[],he(S,Z.value),s.value=S,h.value=le(S,u.value),I()}function he($,S){return $=on($,S),h.value=le($,u.value??{}),a.set("browser_list_sort",Z.value),$}const ge=F(a.get("browser_list_filter")??"any");function Ce($){a.set("browser_list_filter",$);let S=s.value[h.value],B=v();s.value=he(B,Z.value),h.value=le(s.value,S),console.info(h.value),x()}const pe=F("0");function je($){let S=s.value[h.value],B=v();s.value=he(B,Z.value),h.value=le(s.value,S),console.info(h.value),x()}return($,S)=>u.value?(D(),Ht(Nt(n[u.value.type]?n[u.value.type]:n.base),{key:0,extId:e.modalData.nid,isActive:e.modalData.layout.active,curIndex:h.value,file:w.value,dom:p.value,onNav:E},{info:Qe(()=>{var B,W;return[P("div",{class:ue({info:!0,detail:i.value})},[i.value?(D(),L(G,{key:0},[P("p",null,se(u.value.title)+" ("+se(Y(de).kmgt(((W=(B=u.value.file_index)==null?void 0:B.raw)==null?void 0:W.size)??0,2))+") ",1),u.value.crumb_node?(D(),L("p",ha,[S[11]||(S[11]=ht("Dir : ")),(D(!0),L(G,null,re(u.value.crumb_node,A=>(D(),L(G,null,[ht("/"+se(A.title),1)],64))),256))])):te("",!0),P("p",pa,se(u.value.description),1)],64)):te("",!0)],2)]}),btnContainer:Qe(()=>{var B,W;return[P("div",_a,[i.value?(D(),L(G,{key:0},[t?ce((D(),L("select",{key:0,"onUpdate:modelValue":S[0]||(S[0]=A=>pe.value=A),onChange:S[1]||(S[1]=A=>je(pe.value))},[(D(!0),L(G,null,re(Y(oe).rateMobile,(A,J)=>(D(),L("option",{value:J,key:"BROWSER_RATE_"+$.modalData.nid+"_"+J},se(A),9,ma))),128))],544)),[[He,pe.value]]):ce((D(),L("select",{key:1,class:"sysIcon","onUpdate:modelValue":S[2]||(S[2]=A=>pe.value=A),onChange:S[3]||(S[3]=A=>je(pe.value))},[(D(!0),L(G,null,re(Y(oe).rate,(A,J)=>(D(),L("option",{class:"sysIcon_A sysIcon",value:J,innerHTML:A,key:"BROWSER_RATE_"+$.modalData.nid+"_"+J},null,8,va))),128))],544)),[[He,pe.value]]),ce(P("select",{"onUpdate:modelValue":S[4]||(S[4]=A=>ge.value=A),onChange:S[5]||(S[5]=A=>Ce(ge.value))},[(D(!0),L(G,null,re(Y(oe).fileType,(A,J)=>(D(),L("option",{value:A,key:"BROWSER_TYPE_"+$.modalData.nid+"_"+J},se(A),9,ya))),128))],544),[[He,ge.value]]),S[12]||(S[12]=P("br",null,null,-1))],64)):te("",!0),ce(P("select",{"onUpdate:modelValue":S[6]||(S[6]=A=>Z.value=A),onChange:S[7]||(S[7]=A=>Le(A))},[(D(!0),L(G,null,re(Y(oe).sort,(A,J)=>(D(),L("option",{value:J,key:"BROWSER_SORT_"+$.modalData.nid+"_"+J},se(A),9,ga))),128))],544),[[He,Z.value]]),P("button",{class:ue(["sysIcon",`sysIcon_player_${_.value}`]),onClick:d},null,2),P("button",{class:ue(["sysIcon","sysIcon_info-cirlce-o"]),onClick:r}),(W=(B=u.value.file_index)==null?void 0:B.raw)!=null&&W.path?(D(),L("button",{key:1,class:ue(["sysIcon","sysIcon_download"]),onClick:S[8]||(S[8]=A=>Y(q).op_download(u.value))})):te("",!0)])]}),navigator:Qe(()=>[P("div",{class:ue({pagination:1,isMobile:t})},[P("div",{class:"left",onClick:S[9]||(S[9]=B=>M(h.value,-1))},S[13]||(S[13]=[P("span",{class:"sysIcon sysIcon_arrowleft"},null,-1)])),P("div",{class:"right",onClick:S[10]||(S[10]=B=>M(h.value,1))},S[14]||(S[14]=[P("span",{class:"sysIcon sysIcon_arrowright"},null,-1)]))],2)]),_:1},40,["extId","isActive","curIndex","file","dom"])):te("",!0)}}),ba={class:"modal_locator"},ka={class:"locator_list"},Ea=["onClick"],xa={class:"type"},Sa={class:"tree"},Da={class:"title"},La=fe({__name:"locator",props:{data:{},modalData:{}},setup(o){const e=F(null);let t={mode:"directory",id_dir:"",keyword:"",id_tag:"",cascade_dir:"1",node_type:"directory",with:"crumb",limit:"20"};const n=o,a=F([]);Se(()=>{var i;(i=e.value)==null||i.focus()}),De(()=>{});async function l(){const i=await X("file/get",t);!i||!i.list||(t.keyword&&"root".indexOf(t.keyword)!==-1&&i.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),a.value=i.list,a.value.length&&(a.value[0]._sel=!0,n.modalData.layout.h<220&&(n.modalData.layout.h=220)))}async function c(i){console.info(i),!await d(i)&&de.debounce(()=>{var y;let f=(y=e.value)==null?void 0:y.value;if(!f||!f.length){a.value=[];return}console.info(f),console.info(n.modalData),t.keyword=f,l()},200,"locator")}async function _(i){console.info(i);const r=We();if(!await n.data.call(i))return r.close(n.modalData.nid)}async function d(i){let r,f,y=!1;switch(i.code){case"ArrowDown":if(y=!0,i.stopPropagation(),i.preventDefault(),!a.value.length)break;for(r=-1,a.value.forEach((g,h)=>{g._sel&&(r=h)}),f=r+1;f<0;)f+=a.value.length;for(;f>=a.value.length;)f-=a.value.length;a.value.forEach((g,h)=>{g._sel=h==f});break;case"ArrowUp":if(y=!0,i.stopPropagation(),i.preventDefault(),!a.value.length)break;for(r=0,a.value.forEach((g,h)=>{g._sel&&(r=h)}),f=r-1;f<0;)f+=a.value.length;for(;f>=a.value.length;)f-=a.value.length;a.value.forEach((g,h)=>{g._sel=h==f});break;case"NumpadEnter":case"Enter":if(y=!0,i.stopPropagation(),i.preventDefault(),!a.value.length||(r=-1,a.value.forEach((g,h)=>{g._sel&&(r=h)}),r==-1))break;const s=a.value[r];_(s);break}return y}return(i,r)=>(D(),L("div",ba,[P("input",{type:"text",class:"locator_input",placeholder:"type title/desc here ...",ref_key:"locatorInput",ref:e,onKeydown:c},null,544),P("div",ka,[(D(!0),L(G,null,re(a.value,f=>(D(),L("div",{onClick:y=>_(f),class:ue({active:f._sel})},[P("p",xa,se(f.type),1),P("p",Sa,[P("span",Da,se(f.title),1),f.crumb_node?(D(!0),L(G,{key:0},re(f.crumb_node,y=>(D(),L("span",null,se(y.title),1))),256)):te("",!0)])],10,Ea))),256))])]))}}),Ca={class:"upload_list"},Ra={class:"title"},$a={class:"meta"},Oa={key:0},Pa={key:1},Aa=["onClick"],Ma={class:"upload_menu"},Ia={key:1},Ta=fe({__name:"uploader",props:{data:{},modalData:{}},setup(o){const e=o,t=F([]),n=new Map;Se(()=>{}),De(()=>{});function a(h){console.info("onSelectFile",h);const u=document.createElement("input");u.type="file",u.setAttribute("multiple",!0),u.onchange=w=>{var p;if((p=u.files)!=null&&p.length)for(let m=0;m<u.files.length;m++){const v=u.files[m];t.value.push({name:"/"+v.name,size:v.size,file:v,isDir:!1,status:"waiting",start:0,loaded:0})}},u.click()}function l(h){var u,w,p;if(console.debug("onDrop",h.type,(u=h.dataTransfer)==null?void 0:u.files,h),h.preventDefault(),h.stopPropagation(),!(!h.dataTransfer||!h.dataTransfer.files.length)){for(let m=0;m<((w=h.dataTransfer)==null?void 0:w.files.length);m++){const v=(p=h.dataTransfer)==null?void 0:p.items[m],b=v.webkitGetAsEntry();if(b.isFile){const M=v.getAsFile();t.value.push({name:b.fullPath,size:M.size,file:M,isDir:!1,status:"waiting",start:0,loaded:0})}else c(b).then(M=>{M.forEach(E=>t.value.push(E))})}console.info(t.value)}}async function c(h){const u=[];u.push({name:h.fullPath,size:0,file:null,isDir:!0,status:"waiting",start:0,loaded:0});const w=h.createReader(),p=await d(w);for(let m=0;m<p.length;m++){const v=p[m];if(v.isFile){const b=await _(v);u.push({name:v.fullPath,size:b.size,file:b,isDir:!1,status:"waiting",start:0,loaded:0})}v.isDirectory&&(await c(v)).forEach(M=>u.push(M))}return u}function _(h){return new Promise(u=>{h.file(w=>u(w))})}function d(h){return new Promise(u=>{h.readEntries(w=>{u(w)})})}function i(h){h.stopPropagation(),h.preventDefault()}let r=F(!1);async function f(){if(t.value.length){r.value=!0;for(let h=0;h<t.value.length;h++)t.value[h].status==="waiting"&&await y(t.value[h]);r.value=!1,e.data.emitGo("reload")}}async function y(h){let u=null,[w,p,m]=s(h.name);if(h.isDir){const v=new FormData;v.set("pid",w),v.set("title",m),h.status="uploading",u=await X("file/mkdir",v),n.set(p+m+"/",u.id)}else{const v=new FormData;v.set("pid",w),v.set("file",h.file),h.status="uploading",u=await X("file/upd",v,{upload:b=>{h.loaded=b.loaded}})}return h.status="complete",u}function s(h){const u=h.replace(/[\\/]+$/i).split(/[\\/]/i),w=u.pop();if(!u.length)return[e.data.pid,"/",w];let p="";for(let v=0;v<u.length;v++)p+=u[v]+"/";return p=="/"?[e.data.pid,p,w]:[n.get(p),p,w]}function g(h){t.value.splice(h,1)}return(h,u)=>(D(),L("div",{class:"modal_uploader",onDrop:l,onDragover:i},[P("div",Ca,[(D(!0),L(G,null,re(t.value,(w,p)=>(D(),L("div",{key:`file_upload_${p}`},[P("div",Ra,se(w.name),1),P("div",$a,[w.status==="uploading"?(D(),L("span",Oa,se(Math.round(100*w.loaded/w.size))+" % ",1)):(D(),L("span",Pa,se(w.status),1)),P("span",null,se(Y(de).kmgt(w.size)),1),w.status==="waiting"?(D(),L("span",{key:2,onClick:m=>g(p),class:"pointer"},"X",8,Aa)):te("",!0)])]))),128)),P("div",{onClick:a},"drag / drop files here...")]),P("div",Ma,[Y(r)?(D(),L("button",Ia,"uploading")):(D(),L("button",{key:0,onClick:f},"upload"))])],32))}}),Ha={class:"modal_rename_util"},Na={class:"mode_selector"},za=["id","name"],Ba=["for"],Ua=["id","name"],Va=["for"],Wa=fe({__name:"renameUtil",props:{data:{},modalData:{}},setup(o){F(null);const e=o;let t=F("pattern"),n=F("{index}_{filename}"),a=F("");Se(()=>{const _=[];e.data.node_list.forEach(d=>{_.push((d==null?void 0:d.title)??"")}),a.value=_.join(`\r
`),console.info(a)}),De(()=>{});function l(_){let d=_.length.toString().length+1,i=0,r="",f=n.value.match(/\{index:(\d+)}/);f&&(i=parseInt(f[1]),r=f[0]);const y=new Map;_.forEach((g,h)=>{const u=g.crumb_node?g.crumb_node[g.crumb_node.length-1]:null,w=u?u.title:"";let p=new Map;p.set("{filename}",g.title??""),p.set("{index}",de.prefix(h+1,d,"0")),p.set("{directory}",w??""),p.set(`{index:${r}}`,de.prefix(h+1,i,"0"));let m=n.value;p.forEach((v,b)=>{m=m.replace(b,v)}),y.set(g.id??0,m)});const s=[];return y.forEach((g,h)=>{s.push({id:h,title:g})}),s}async function c(){const _=We();let d=[];switch(t.value){default:case"pattern":d=l(e.data.node_list);break;case"bath":const f=a.value.split(/[\r\n]+/);d=[],e.data.node_list.forEach((y,s)=>{f[s]&&f[s].trim().length&&d.push({id:y.id??0,title:f[s].trim()})});break}const i={list:JSON.stringify(d)},r=await X("file/bath_rename",i);return console.info(r),e.data.callback(d),_.close(e.modalData.nid)}return(_,d)=>(D(),L("div",Ha,[P("div",Na,[ce(P("input",{id:`P_${e.modalData.nid}_MODE_PATTERN`,name:`P_${e.modalData.nid}_MODE`,value:"pattern",type:"radio","onUpdate:modelValue":d[0]||(d[0]=i=>Fe(t)?t.value=i:t=i)},null,8,za),[[nt,Y(t)]]),P("label",{for:`P_${e.modalData.nid}_MODE_PATTERN`},"pattern",8,Ba),ce(P("input",{id:`P_${e.modalData.nid}_MODE_BATH`,name:`P_${e.modalData.nid}_MODE`,value:"bath",type:"radio","onUpdate:modelValue":d[1]||(d[1]=i=>Fe(t)?t.value=i:t=i)},null,8,Ua),[[nt,Y(t)]]),P("label",{for:`P_${e.modalData.nid}_MODE_BATH`},"bath",8,Va)]),Y(t)=="pattern"?(D(),L(G,{key:0},[d[5]||(d[5]=zt("<p>rename pattern:</p><table><tbody><tr><td>code</td><td>description</td></tr><tr><td>{filename}</td><td>file name</td></tr><tr><td>{index}</td><td>index by sort, prefix by max len+1</td></tr><tr><td>{index:n}</td><td>index by sort, prefix len by [n]</td></tr><tr><td>{directory}</td><td>parent directory name</td></tr></tbody></table>",2)),P("label",null,[d[4]||(d[4]=P("span",null,"pattern",-1)),ce(P("input",{type:"text","onUpdate:modelValue":d[2]||(d[2]=i=>Fe(n)?n.value=i:n=i)},null,512),[[Oe,Y(n)]])])],64)):te("",!0),Y(t)=="bath"?(D(),L(G,{key:1},[d[6]||(d[6]=P("p",null,"rename bath:",-1)),ce(P("textarea",{"onUpdate:modelValue":d[3]||(d[3]=i=>Fe(a)?a.value=i:a=i)},null,512),[[Oe,Y(a)]])],64)):te("",!0),P("label",{class:"confirm"},[P("button",{onClick:c},"submit")])]))}}),ja={class:"fr_popup"},Fa=["data-ref-id","onClick"],qa=["onPointerdown","onDblclick"],Ga={class:"modal_title"},Ka={class:"modal_menu"},Ya=["onClick"],Xa=["onClick"],Qa=["onClick"],Ja={class:"modal_content"},Za=["innerHTML"],es={key:1,class:"modal_content_form"},ts={key:0},ns=["onUpdate:modelValue","onChange","disabled"],os=["onClick","disabled"],as={key:0},ss=["onUpdate:modelValue","onChange","disabled"],is=["onUpdate:modelValue","onChange","disabled"],rs=["onUpdate:modelValue","onChange","disabled"],ls=["id","name","value","onUpdate:modelValue","onChange","disabled"],cs=["for"],us=["id","name","value","onUpdate:modelValue","onChange","disabled"],ds=["for"],fs=["onUpdate:modelValue","multiple","onChange","disabled"],hs=["value"],ps={key:2,class:"modal_content_callback"},_s=["onClick"],ms=["onPointerdown"],ke=20,vs=fe({__name:"Popup",setup(o){const e={fileBrowser:wa,uploader:Ta,locator:La,renameUtil:Wa},t=new Date().valueOf(),n=F(new Map);function a(p){const m=Math.floor((new Date().valueOf()-t)/100),v=window.innerWidth,b=window.innerHeight,M=(m+Math.random()).toString(32),E={nid:M,base:{title:p.title??"",alpha:p.alpha??!1,key:p.key??"",single:p.single??!1},layout:{w:0,h:0,x:0,y:0,minW:0,minH:0,allow_resize:!1,allow_move:!1,allow_escape:!1,allow_fullscreen:!1,auto_focus:!1,active:!1,index:0,fullscreen:!1},content:{text:F(""),form:[],component:[]},callback:[],closed:!1,event:{resize:new Event("modal_resizing_"+M)}};console.info(m,E.nid);const H={};if(H.w=p.w??400,H.h=p.h??160,H.x=(v-H.w)/2,H.y=(b-H.h)/2,H.minW=p.minW??400,H.minH=p.minH??160,H.allow_resize=p.allow_resize??!0,H.allow_move=p.allow_move??!0,H.allow_escape=p.allow_escape??!0,H.allow_fullscreen=p.allow_fullscreen??!1,H.auto_focus=p.auto_focus??!0,H.active=!1,H.index=m,H.fullscreen=p.fullscreen??!1,Object.assign(E.layout,H),p.text&&(typeof p.text=="string"?E.content.text.value=p.text:E.content.text=p.text),p.form&&(Array.isArray(p.form)?E.content.form.push(...p.form):E.content.form.push(p.form),E.content.form.forEach(x=>{if(x.value=x.value??null,x.options=x.options??null,x.default=x.default??null,x.multiple=!!x.multiple,x.disabled=!!x.disabled,x.options&&Array.isArray(x.options)){let I={};x.options.forEach(V=>{I[V]=V}),x.options=I}x.on_change||(x.on_change=()=>{})})),p.component&&(Array.isArray(p.component)?p.component.forEach(x=>{let I;typeof x=="string"?I={key:"",componentName:x,data:{}}:I=Object.assign({key:"",componentName:null,data:{}},x),E.content.component.push(I)}):typeof p.component=="string"?E.content.component.push({key:"",componentName:p.component,data:{}}):E.content.component.push(Object.assign({key:"",componentName:null,data:{}},p.component))),p.callback){if(Array.isArray(p.callback))p.callback.forEach((x,I)=>{let V;typeof x=="function"?V={key:"",name:"",func:x}:V=Object.assign({key:"",name:"",func:null},x),E.callback.push(V)});else if(typeof p.callback=="function")E.callback.push({key:"",name:"",func:p.callback});else if(p.callback.func)E.callback.push(Object.assign({key:"",name:"",func:null},p.callback));else for(const x in p.callback){if(!Object.prototype.hasOwnProperty.call(p.callback,x))continue;const I=p.callback[x];E.callback.push(Object.assign({key:x,name:x,func:I}))}E.callback.forEach((x,I)=>{if(x.name&&!x.key)x.key=x.name;else if(!x.name&&x.key)x.name=x.key;else if(!x.name&&!x.key){let V="button";E.callback.length>1&&(V+=" "+I),x.name=V,x.key=V}})}return console.debug(E),E}window.addEventListener("resize",p=>{n.value.forEach(m=>{if(m.layout.fullscreen){const v={x:ke,y:ke,w:window.innerWidth-ke*2,h:window.innerHeight-ke*2};Object.assign(m.layout,v),document.dispatchEvent(m.event.resize)}})});const l=We();l.handleEvent("set",p=>{let m=null,v=null;return p.single&&n.value.forEach((b,M,E)=>{b.base.key==p.key&&(m=M,v=b)}),m?setTimeout(()=>{m&&c(m)}):(v=a(p),n.value.set(v.nid,v),setTimeout(()=>{v&&c(v.nid)})),v}),l.handleEvent("close",p=>i(p)),document.body.addEventListener("click",p=>{let m=p.target;Te(m)||c("")});function c(p){const m=Math.floor((new Date().valueOf()-t)/100);n.value.forEach(v=>{if(v.nid===p){v.layout.index=m;let b=!v.layout.active;v.layout.active=!0,v.layout.auto_focus&&b&&setTimeout(()=>{const M=document.querySelector(`.modal_dom[data-ref-id="${v.nid}"] input,.modal_dom[data-ref-id="${v.nid}"] button,.modal_dom[data-ref-id="${v.nid}"] textarea`);M&&M.focus()},100)}else v.layout.active=!1})}function _(p){const m=n.value.get(p);if(!m)return;const v={x:ke,y:ke,w:window.innerWidth-ke*2,h:window.innerHeight-ke*2,fullscreen:!0};Object.assign(m.layout,v),document.dispatchEvent(m.event.resize)}function d(p){const m=n.value.get(p);if(!m)return;const v={x:0,y:0,w:m.layout.minW,h:m.layout.minH,fullscreen:!1};v.x=(window.innerWidth-v.w)/2,v.y=(window.innerHeight-v.h)/2,Object.assign(m.layout,v),document.dispatchEvent(m.event.resize)}function i(p){const m=n.value.get(p);if(!m||!m.layout.allow_escape)return;n.value.delete(p);let v=-1,b="";return n.value.forEach(M=>{v=M.layout.index,b=M.nid}),v!=-1&&c(b),m}let r={x:0,y:0,d:"",modalX:0,modalY:0,modalW:0,modalH:0,modal:null},f=0;function y(p,m){m.preventDefault(),m.stopPropagation(),m.pointerId&&(f=m.pointerId,m.target.hasPointerCapture(m.pointerId)),r.x=m.clientX,r.y=m.clientY,r.d=m.target.className,n.value.forEach(v=>{v.nid===p&&(r.modal=v)}),r.modal&&(r.modal.layout.fullscreen||(r.modalX=r.modal.layout.x,r.modalY=r.modal.layout.y,r.modalW=r.modal.layout.w,r.modalH=r.modal.layout.h,document.addEventListener("pointerup",g),document.addEventListener("pointermove",s)))}function s(p){if(p.preventDefault(),!r.modal||!p.pointerId||f!=p.pointerId)return;const m={x:p.clientX-r.x,y:p.clientY-r.y},v={x:r.modal.layout.x,y:r.modal.layout.y,w:r.modal.layout.w,h:r.modal.layout.h};switch(r.d){case"c_l":v.x=r.modalX+m.x,v.w=r.modalW-m.x;break;case"c_r":v.x=r.modalX,v.w=r.modalW+m.x;break;case"c_t":v.y=r.modalY+m.y,v.h=r.modalH-m.y;break;case"c_b":v.y=r.modalY,v.h=r.modalH+m.y;break;case"c_lt":v.x=r.modalX+m.x,v.w=r.modalW-m.x,v.y=r.modalY+m.y,v.h=r.modalH-m.y;break;case"c_lb":v.x=r.modalX+m.x,v.w=r.modalW-m.x,v.y=r.modalY,v.h=r.modalH+m.y;break;case"c_rt":v.x=r.modalX,v.w=r.modalW+m.x,v.y=r.modalY+m.y,v.h=r.modalH-m.y;break;case"c_rb":v.x=r.modalX,v.w=r.modalW+m.x,v.y=r.modalY,v.h=r.modalH+m.y;break;case"modal_header":case"modal_title":v.x=r.modalX+m.x,v.y=r.modalY+m.y;break}const b={l:0,r:window.innerWidth,t:0,b:window.innerHeight};v.w<100&&(v.w=100),v.h<80&&(v.h=80),v.y<0&&(v.y=0),v.y>b.b-v.h/2&&(v.y=b.b-v.h/2),v.x<0-v.w/2&&(v.x=0-v.w/2),v.x>b.r-v.w/2&&(v.x=b.r-v.w/2),r.modal.layout.minW&&v.w<r.modal.layout.minW&&(v.w=r.modal.layout.minW),r.modal.layout.minH&&v.h<r.modal.layout.minH&&(v.h=r.modal.layout.minH),Object.assign(r.modal.layout,v),document.dispatchEvent(r.modal.event.resize)}function g(p){p.preventDefault(),p.stopPropagation(),!(!p.pointerId||f!=p.pointerId)&&(document.removeEventListener("pointerup",g),document.removeEventListener("pointermove",s),f=0,r.modal=null)}function h(p,m){const v=n.value.get(p);v&&v.callback.forEach(async b=>{b.key!==m||await b.func(v)||i(p)})}Se(()=>{console.info("Popup mounted"),document.addEventListener("keydown",u)}),De(()=>{console.info("unmounted"),document.removeEventListener("keydown",u)});function u(p){switch(p.key){case"Escape":n.value.forEach((v,b)=>{if(v.layout.active){if(!v.layout.allow_escape)return;setTimeout(()=>i(v.nid))}});break;case"NumpadEnter":case"Enter":if(p.target.tagName==="BODY"||p.target.tagName==="BUTTON"||p.isComposing)return;let m=p.target;for(;m.parentElement;){if(m=m.parentElement,!m.classList.contains("modal_dom"))continue;const b=m.getAttribute("data-ref-id");if(!b)break;const M=n.value.get(b);if(!M)break;for(let E=0;E<M.callback.length;E++){const H=M.callback[E].key;return h(b,H)}}break}}function w(p){console.info("processModalFile",p);const m=document.createElement("input");m.type="file",m.onchange=v=>{const b=v.target.files;!b||b.length===0||(p.value=b[0],console.info("processModalFile mod",p,p.value))},m.click()}return(p,m)=>(D(),L("div",ja,[(D(!0),L(G,null,re(n.value,([v,b])=>{var M;return D(),L("div",{key:`_modal_${v}`,class:ue({modal_dom:!0,active:b.layout.active,resizing:((M=Y(r).modal)==null?void 0:M.nid)==b.nid,modal_alpha:b.base.alpha}),"data-ref-id":b.nid,style:Bt({zIndex:b.layout.index,width:b.layout.w+"px",height:b.layout.h+"px",left:b.layout.x+"px",top:b.layout.y+"px"}),onClick:xn(E=>c(b.nid),["stop"])},[P("div",{class:"modal_header",onPointerdown:E=>y(b.nid,E),onDblclick:E=>b.layout.fullscreen?d(b.nid):_(b.nid)},[P("div",Ga,se(b.base.title),1),P("div",Ka,[b.layout.allow_move&&b.layout.allow_fullscreen?(D(),L(G,{key:0},[b.layout.fullscreen?(D(),L("span",{key:1,class:"buttonStyle sysIcon sysIcon_windowize",onClick:E=>d(b.nid)},null,8,Xa)):(D(),L("span",{key:0,class:"buttonStyle sysIcon sysIcon_maximize",onClick:E=>_(b.nid)},null,8,Ya))],64)):te("",!0),P("span",{class:"buttonStyle sysIcon sysIcon_close",onClick:E=>i(b.nid)},null,8,Qa)])],40,qa),P("div",Ja,[b.content.text&&b.content.text.length?(D(),L("div",{key:0,class:"modal_content_text",innerHTML:b.content.text},null,8,Za)):te("",!0),b.content.form&&b.content.form.length?(D(),L("div",es,[(D(!0),L(G,null,re(b.content.form,(E,H)=>(D(),L("label",{key:`_modal_${v}_form_${H}`},[E.label?(D(),L("span",ts,se(E.label),1)):te("",!0),m[0]||(m[0]=P("span",null,null,-1)),P("span",null,[E.type==="text"?ce((D(),L("input",{key:0,type:"text","onUpdate:modelValue":x=>E.value=x,onChange:x=>E.on_change(x,b,E),disabled:E.disabled},null,40,ns)),[[Oe,E.value]]):te("",!0),E.type==="file"?(D(),L(G,{key:1},[P("button",{onClick:x=>w(E),disabled:E.disabled},"select file",8,os),E.value?(D(),L("span",as,se(E.value.name),1)):te("",!0)],64)):te("",!0),E.type==="textarea"?ce((D(),L("textarea",{key:2,"onUpdate:modelValue":x=>E.value=x,onChange:x=>E.on_change(x,b,E),disabled:E.disabled},null,40,ss)),[[Oe,E.value]]):te("",!0),E.type==="date"?ce((D(),L("input",{key:3,type:"date","onUpdate:modelValue":x=>E.value=x,onChange:x=>E.on_change(x,b,E),disabled:E.disabled},null,40,is)),[[Oe,E.value]]):te("",!0),E.type==="datetime"?ce((D(),L("input",{key:4,type:"datetime-local","onUpdate:modelValue":x=>E.value=x,onChange:x=>E.on_change(x,b,E),disabled:E.disabled},null,40,rs)),[[Oe,E.value]]):te("",!0),E.type==="checkbox"?(D(!0),L(G,{key:5},re(E.options,(x,I)=>(D(),L(G,{key:`P_${v}_C_${H}_CB_${I}`},[ce(P("input",{id:`P_${v}_C_${H}_CB_${I}`,name:`P_${v}_C_${H}_CB`,type:"checkbox",value:I,"onUpdate:modelValue":V=>E.value=V,onChange:V=>E.on_change(V,b,E),disabled:E.disabled},null,40,ls),[[Sn,E.value]]),P("label",{for:`P_${v}_C_${H}_CB_${I}`},se(x),9,cs)],64))),128)):te("",!0),E.type==="radio"?(D(!0),L(G,{key:6},re(E.options,(x,I)=>(D(),L(G,{key:`P_${v}_C_${H}_RD_${I}`},[ce(P("input",{id:`P_${v}_C_${H}_RD_${I}`,name:`P_${v}_C_${H}_RD`,type:"radio",value:I,"onUpdate:modelValue":V=>E.value=V,onChange:V=>E.on_change(V,b,E),disabled:E.disabled},null,40,us),[[nt,E.value]]),P("label",{for:`P_${v}_C_${H}_RD_${I}`},se(x),9,ds)],64))),128)):te("",!0),E.type==="select"?ce((D(),L("select",{key:7,"onUpdate:modelValue":x=>E.value=x,multiple:E.multiple,onChange:x=>E.on_change(x,b,E),disabled:E.disabled},[(D(!0),L(G,null,re(E.options,(x,I)=>(D(),L("option",{key:`P_${v}_C_${H}_SL_${I}`,value:I},se(x),9,hs))),128))],40,fs)),[[He,E.value]]):te("",!0)])]))),128))])):te("",!0),(D(!0),L(G,null,re(b.content.component,(E,H)=>(D(),Ht(Nt(e[E.componentName]),{key:`CMP_${v}_${H}`,data:E.data,modalData:b},null,8,["data","modalData"]))),128)),b.callback&&b.callback.length?(D(),L("div",ps,[(D(!0),L(G,null,re(b.callback,(E,H)=>(D(),L("button",{key:`BTN_${v}_${H}`,onClick:x=>h(b.nid,E.key)},se(E.name),9,_s))),128))])):te("",!0)]),b.layout.allow_resize?(D(),L("div",{key:0,class:"modal_border",onPointerdown:E=>y(b.nid,E)},m[1]||(m[1]=[zt('<div class="c_l"></div><div class="c_r"></div><div class="c_t"></div><div class="c_b"></div><div class="c_lt"></div><div class="c_lb"></div><div class="c_rt"></div><div class="c_rb"></div>',8)]),40,ms)):te("",!0)],14,Fa)}),128))]))}}),ys={class:"fr_context"},gs=["onClick"],ws=["innerHTML"],bs={key:0,class:"context_menu_sub"},ks=["onClick"],Es=["innerHTML"],xs=fe({__name:"Context",setup(o){const t=Ve().get(),n=t?t!=null&&t.group.admin?2:1:0,a=tn(),l=F([]),c=F(null),_=F(!0),d=F({x:-1e3,y:0,w:0,h:0,sx:0,sy:0,direction:"lb"});a.register(i);function i(u,w){_.value=!1;const p=[];u.forEach(m=>{if(r(m)){if(m.child){let v=[];if(m.child.forEach(b=>{r(b)&&v.push(b)}),!v.length)return;m.child=v}p.push(m)}}),l.value=p,console.info(p),setTimeout(()=>f(w),20)}function r(u){switch(u.auth){case"none":return!1;default:case"guest":return!0;case"user":if(n<1)break;return!0;case"admin":if(n<2)break;return!0}}function f(u){if(!c.value)return;const w=c.value;let p=h();const m={x:u.clientX,y:u.clientY,w:w==null?void 0:w.offsetWidth,h:w==null?void 0:w.offsetHeight,sx:p.scrollTop,sy:p.scrollLeft,direction:"rb"};let v=["r","b"];switch(m.w+m.x>window.innerWidth&&(v[0]="l"),m.h+m.y>window.innerHeight&&(v[1]="t"),m.direction=v.join(""),m.direction){case"rb":break;case"rt":m.y-=m.h;break;case"lb":m.x-=m.w;break;case"lt":m.x-=m.w,m.y-=m.h;break}d.value=m,h().addEventListener("scroll",g),setTimeout(()=>_.value=!0,10)}function y(){h().removeEventListener("scroll",g),_.value=!1,s=null,setTimeout(()=>{l.value=[],d.value={x:-1e3,y:0,w:0,h:0,sx:0,sy:0,direction:"lb"}},10)}Se(()=>{});let s=null;function g(u){const w=h();if(!w)return;let p=d.value,m=w.scrollLeft,v=w.scrollTop,b=m-p.sx,M=v-p.sy;d.value=Object.assign(p,{x:p.x-b,y:p.y-M,sx:m,sy:v})}function h(){return s||(s=document.querySelector(".fr_content"),s)}return addEventListener("contextmenu",u=>{console.info("triggerMenu"),i([],u)}),addEventListener("click",u=>{y()}),(u,w)=>(D(),L("div",ys,[P("div",{class:ue(["context_menu",_.value?"show":"",d.value.direction]),style:Bt({left:d.value.x+"px",top:d.value.y+"px"}),ref_key:"contextDOM",ref:c},[(D(!0),L(G,null,re(l.value,(p,m)=>{var v;return D(),L("div",{key:`COM_${m}`,class:ue(["context_item",(v=p.child)!=null&&v.length?"has_sub":""]),onClick:p.method},[P("span",{innerHTML:p.title},null,8,ws),p.child&&p.child.length?(D(),L("div",bs,[(D(!0),L(G,null,re(p.child,(b,M)=>(D(),L("div",{key:`COM_${m}_${M}`,class:ue({context_item:!0}),onClick:b.method},[P("span",{innerHTML:b.title},null,8,Es)],8,ks))),128))])):te("",!0)],10,gs)}),128))],6)]))}}),Ss={class:"fr_body"},Ds=fe({__name:"main",setup(o){const t=Ve().get();t&&(document.cookie=`tosho_token=${t.token}; max-age=31536000`,a());const n=new Event("fe_config_loaded");async function a(){const l=await X("setting/get_front_conf");l&&(l.onlyoffice_enabled==="true"&&(oe.onlyOffice.enabled=!0,oe.onlyOffice.jwtSecret=l.onlyoffice_jwt_secret??""),oe.navList=[{name:"Nas",meta:{cur:!0},path:"/"}],l.link_nav&&l.link_nav.forEach(c=>{oe.navList.push({name:c[0],meta:{cur:!1},path:c[1]})}),document.dispatchEvent(n))}return(l,c)=>{const _=Dn("router-view");return D(),L(G,null,[Re(Hn,{class:"fr_header"}),Re(vs),Re(xs),P("div",Ss,[Re(Xo,{class:"fr_navi"}),Re(_)])],64)}}});Ln();const dt=Cn(Ds);dt.use(Rn());dt.use(qo);dt.mount("#app");export{Tn as _,Rs as a,Fo as b,q as c,$s as o,ta as p,jo as u};

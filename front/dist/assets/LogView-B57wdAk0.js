import{d as q,a as L,r as _,o as E,m as O,G as U,E as w,c as u,e as l,R as k,a1 as x,g as r,S as B,F as p,f as V,b as a,t as d,P as y,Q as C}from"./basic-cwdvCeQw.js";import{a as H,u as R,b as S}from"./index-D4dQ6tpz.js";const F={class:"form"},N=["value"],G=q({__name:"LogView",setup(T){L();const o=_(null),D=R(),m=S();let s={id:"",status:"",type:""},M=[["","all"],[-2,"unknown"],[-1,"failed"],[0,"success"],[1,"new"],[2,"working"]];const f=_([]);E(async()=>{s=(({id:n,status:e,type:t})=>({id:n??"",status:e??"",type:t??""}))(m.query),v(!0),o.value&&o.value.addEventListener("scroll",b)}),H(async n=>{console.info(n),s=(({id:e,status:t,type:i})=>({id:e??"",status:t??"",type:i??""}))(n.query),v(!0)});function h(){console.info("go"),D.push({path:m.path,query:s})}O(()=>{var n;o.value&&((n=o.value)==null||n.removeEventListener("scroll",b))});async function b(n){if(console.info(n),!o.value)return;let e=o.value,t=(e==null?void 0:e.scrollTop)+(e==null?void 0:e.clientHeight)+(e==null?void 0:e.clientHeight);(e==null?void 0:e.scrollHeight)<t&&U.debounce(async()=>{await v()},500,"logViewDebounce")}let c=1,g=!1;async function v(n=!1){if(g)return;g=!0,n&&(f.value=[],c=1);const e=await w("log/get",Object.assign({page:c},s));if(c+=1,g=!1,!e||!e.length){c--;return}const t=n?[]:f.value;for(let i=0;i<e.length;i++)t.push(Object.assign(e[i],{ext_key:`${new Date().valueOf()}_${Math.random()}`}));f.value=t}return(n,e)=>(a(),u("div",{class:"fr_content view_log",ref_key:"contentDOM",ref:o},[l("div",F,[l("label",null,[e[3]||(e[3]=l("span",null,"ID : ",-1)),k(l("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>r(s).id=t)},null,512),[[x,r(s).id]])]),l("label",null,[e[4]||(e[4]=l("span",null,"status : ",-1)),k(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>r(s).status=t)},[(a(!0),u(p,null,V(r(M),(t,i)=>(a(),u("option",{value:t[0],key:i},d(t[1]),9,N))),128))],512),[[B,r(s).status]])]),l("label",null,[e[5]||(e[5]=l("span",null,"type : ",-1)),k(l("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>r(s).type=t)},null,512),[[x,r(s).type]])]),l("label",null,[l("button",{type:"button",onClick:h},"query")])]),l("table",null,[l("tbody",null,[e[6]||(e[6]=l("tr",null,[l("th",null,"id"),l("th",null,"type"),l("th",null,"status"),l("th",null,"time_create"),l("th",null,"time_update"),l("th",null,"payload")],-1)),(a(!0),u(p,null,V(f.value,t=>(a(),u("tr",{key:`log_view_${t.ext_key}`},[l("td",null,d(t.id),1),l("td",null,d(t.type),1),l("td",null,[t.status===-2?(a(),u(p,{key:1},[y("unknown")],64)):t.status===-1?(a(),u(p,{key:2},[y("failed")],64)):t.status===0?(a(),u(p,{key:3},[y("success")],64)):t.status===1?(a(),u(p,{key:4},[y("waiting")],64)):t.status===2?(a(),u(p,{key:5},[y("working")],64)):C("",!0)]),l("td",null,d(t.time_create),1),l("td",null,d(t.time_update),1),l("td",null,d(t.payload),1)]))),128))])])],512))}});export{G as default};

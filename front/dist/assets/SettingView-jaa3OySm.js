import{d as D,u as E,r as k,b as A,G as C,g as O,f as j,q as c,h as i,i as s,F as d,j as p,L as z,s as M,t as U,o as u,n as _,x as B,m as I,z as h,a as r}from"./index-BJ6uacWg.js";import{_ as b}from"./ContentEditable.vue_vue_type_script_setup_true_lang-CjC2NIdr.js";const N={class:"widget_ls"},H=["onClick"],W=s("tr",null,[s("th",null,"key"),s("th",null,"value")],-1),R=s("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1),K=D({__name:"SettingView",setup(G){E();const x=k(null);M();const g=U();let f={};const o=k([]);A(async()=>{Object.assign(f,C.copyObject(g.query)),y()}),O(async e=>{console.info(e),y()}),j(()=>{});async function y(){const e=await c("setting/get",f);if(!e)return;const t=[];for(let a=0;a<e.length;a++)t.push(Object.assign(e[a],{edit_key:!1,edit_val:!1,ext_key:`${new Date().valueOf()}_${Math.random()}`,pre_name:e[a].name,pre_value:e[a].value}));o.value=t}function w(){o.value.unshift({name:"new_key",value:'"json format value"',pre_name:"",pre_value:"",edit_key:!1,edit_val:!1,ext_key:`${new Date().valueOf()}_${Math.random()}`})}async function V(e){let t=null;for(let n=0;n<o.value.length;n++){const l=o.value[n];l.ext_key===e&&(t=l)}if(!t||(t==null?void 0:t.pre_name)==(t==null?void 0:t.name)&&(t==null?void 0:t.pre_value)==(t==null?void 0:t.value))return;const a=await c("setting/mod",t);a&&(t.id=parseInt(a.id??""),t.pre_name=t.name,t.pre_value=t.value)}function m(e){const t=e.getAttribute("data-key"),a=e.getAttribute("data-type");o.value.forEach(n=>{if(n.ext_key===t)switch(a){case"key":n.edit_key=!0;break;case"val":n.edit_val=!0;break}})}function v(e){const t=e.getAttribute("data-key"),a=e.getAttribute("data-type");o.value.forEach(n=>{if(n.ext_key===t){switch(a){case"key":n.edit_key=!1;break;case"val":n.edit_val=!1;break}V(n.ext_key)}})}const $=[{type:"button",title:"syncLocalFile",method:S},{type:"button",title:"syncDatabaseFile",method:F},{type:"button",title:"checkLocalFile",method:q},{type:"button",title:"rebuildAllIndex",method:L}];async function S(){await c("setting/sync_local_file",{}),r().set({title:"success",text:"queued",w:320,h:100,minW:320,minH:100,allow_resize:!1,callback:{confirm:async function(t){}}})}async function F(){await c("setting/sync_database_file",{}),r().set({title:"success",text:"queued",w:320,h:100,minW:320,minH:100,allow_resize:!1,callback:{confirm:async function(t){}}})}async function L(){await c("setting/full_rebuild_index",{}),r().set({title:"success",text:"queued",w:320,h:100,minW:320,minH:100,allow_resize:!1,callback:{confirm:async function(t){}}})}async function q(){const e=await c("setting/check_local_file_result",{});console.info(e);const t=r();let a="",n=[];e&&e.value&&(e.value.db&&e.value.db.forEach(l=>n.push(`<tr><td>db</td><td>${l}</td></tr>`)),e.value.raw&&e.value.raw.forEach(l=>n.push(`<tr><td>raw</td><td>${l}</td></tr>`)),e.value.preview&&e.value.preview.forEach(l=>n.push(`<tr><td>preview</td><td>${l}</td></tr>`)),e.value.normal&&e.value.normal.forEach(l=>n.push(`<tr><td>normal</td><td>${l}</td></tr>`)),e.value.cover&&e.value.cover.forEach(l=>n.push(`<tr><td>cover</td><td>${l}</td></tr>`))),a=`<table>${n.join("")}</table>`,console.info(a),t.set({title:"chk result",text:a,w:480,h:360,minW:480,minH:360,allow_resize:!0,callback:{checkNew:async function(l){await c("setting/check_local_file",{})},close:async function(l){}}})}return(e,t)=>(u(),i("div",{class:"fr_content view_setting",ref_key:"contentDOM",ref:x},[s("div",N,[(u(),i(d,null,p($,a=>(u(),i(d,null,[a.type==="button"?(u(),i("div",{key:0,class:_(["widget",a.type])},[s("button",{onClick:a.method},B(a.title),9,H)],2)):I("",!0)],64))),64))]),s("table",null,[W,s("tr",null,[s("td",{colspan:"2",class:"add",onClick:w},[R,z(" add row ")])]),(u(!0),i(d,null,p(o.value,a=>(u(),i("tr",{key:`setting_view_${a.ext_key}`},[s("td",{class:_({editing:a.edit_key})},[h(b,{modelValue:a.name,"onUpdate:modelValue":n=>a.name=n,onFocus:m,onBlur:v,"data-key":a.ext_key,"data-type":"key"},null,8,["modelValue","onUpdate:modelValue","data-key"])],2),s("td",{class:_({editing:a.edit_val})},[h(b,{modelValue:a.value,"onUpdate:modelValue":n=>a.value=n,onFocus:m,onBlur:v,"data-key":a.ext_key,"data-type":"val"},null,8,["modelValue","onUpdate:modelValue","data-key"])],2)]))),128))])],512))}});export{K as default};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./FileView_N-CnW96uzD.js","./FileView.vue_vue_type_style_index_0_lang-DKjkv6YD.js","./basic-Dyvi3445.js","./basic-C8Jhbub5.css","./FileItem-CGOaekPi.js","./ContentEditable.vue_vue_type_script_setup_true_lang-C6uv9-zu.js","./Hinter-DMAaalnh.js","./Hinter-Bbfb8PrG.css","./FileItem-DlBSMwIz.css","./FileView-BSPtTJMB.css","./Favourite-iIBprWX4.js","./Favourite-BN5yJjEX.css","./FileView_R-CkxtCOFz.js","./TagView-P-27J5oU.js","./TagView-BIbJvYcw.css","./ShareView-C3TiwjRa.js","./ShareView-BRPRpGNM.css","./UserView-BCECqWIW.js","./UserView-CmWqTIhk.css","./LogView-wt3nFWIl.js","./LogView-V_AVrbUx.css","./SettingView-BAKCyvGr.js","./SettingView-EQ9DroAn.css"])))=>i.map(i=>d[i]);
var ln=Object.defineProperty;var cn=(a,e,t)=>e in a?ln(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var ee=(a,e,t)=>cn(a,typeof e!="symbol"?e+"":e,t);import{d as he,r as j,g as je,o as Le,C as se,a as de,b as S,c as D,e as P,F as q,f as re,n as ue,u as K,t as oe,h as ft,s as un,i as dn,j as we,k as fn,l as hn,m as De,p as pn,q as $e,v as _n,w as mn,x as vn,y as ve,z as Tt,A as Xe,B as Ht,D as Ce,M as yn,E as gn,G as wn,H as fe,I as bn,J as Y,K as He,L as ze,N as kn,O as En,P as xn,Q as Qe,R as zt,S as Je,T as ht,U as te,V as ce,W as Ne,X as Nt,_ as Sn,Y as Dn,Z as Ln,$ as $n,a0 as Rn,a1 as pt,a2 as Bt,a3 as at,a4 as qe,a5 as Ut,a6 as Me,a7 as _t,a8 as Vt,a9 as On,aa as Cn,ab as Pn,ac as Mn,ad as An,ae as In}from"./basic-Dyvi3445.js";const Tn={class:"fr_header"},Hn={class:"navi"},zn=["innerHTML","href"],Nn={class:"user"},Bn={class:"pointer"},Un=he({__name:"Header",setup(a){const e=j([]);let t=je();function n(){un(null),location.reload()}Le(()=>{document.addEventListener("fe_config_loaded",()=>{e.value=se.navList})});const s=se.theme;let r=de("theme")??"warm";function c(){const u={};s.forEach(o=>{u[o[0]]=o[0]}),dn({title:"theme configure",alpha:!0,key:"theme_configure",single:!0,w:360,h:160,minW:360,minH:160,allow_resize:!0,allow_move:!0,allow_escape:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"radio",label:"theme name",key:"theme",options:u,value:r}],callback:{check:async o=>{console.info(o),r=o.content.form[0].value,p(r)}}})}function p(u){s.forEach(o=>{const m=o[0],_=o[1];if(m!==u)return;we("theme",m);const g=document.body.className.trim().split(" "),i=[];g.forEach(f=>{f&&f.length&&f.indexOf("theme_")!==0&&i.push(f)}),i.push("theme_"+u);const y=document.createElement("link");y.setAttribute("rel","stylesheet"),y.setAttribute("href",_),document.body.appendChild(y),document.body.className=i.join(" ")})}return p(r),(u,o)=>(S(),D("div",Tn,[o[1]||(o[1]=P("div",{class:"logo"},"Hentai.",-1)),P("div",Hn,[(S(!0),D(q,null,re(e.value,m=>{var _;return S(),D("a",{key:m.name,class:ue({active:(_=m.meta)==null?void 0:_.cur,pointer:1}),innerHTML:m.name,href:m.path,target:"_blank"},null,10,zn)}),128))]),P("div",Nn,[K(t)&&K(t).id?(S(),D(q,{key:0},[P("div",Bn,oe(K(t).name),1),P("ul",{class:"action pointer"},[P("li",{onClick:c},"theme"),P("li",{onClick:n},"logout")])],64)):(S(),D("div",{key:1,class:"pointer",onClick:o[0]||(o[0]=(...m)=>K(ft)&&K(ft)(...m))},"login"))])]))}}),Vn=(a,e)=>{const t=a.__vccOpts||a;for(const[n,s]of e)t[n]=s;return t},Wn=Vn(Un,[["__scopeId","data-v-1c0c27ef"]]),jn="modulepreload",Fn=function(a,e){return new URL(a,e).href},mt={},ke=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){const c=document.getElementsByTagName("link"),p=document.querySelector("meta[property=csp-nonce]"),u=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));s=Promise.allSettled(t.map(o=>{if(o=Fn(o,n),o in mt)return;mt[o]=!0;const m=o.endsWith(".css"),_=m?'[rel="stylesheet"]':"";if(!!n)for(let y=c.length-1;y>=0;y--){const f=c[y];if(f.href===o&&(!m||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${_}`))return;const i=document.createElement("link");if(i.rel=m?"stylesheet":jn,m||(i.as="script"),i.crossOrigin="",i.href=o,u&&i.setAttribute("nonce",u),document.head.appendChild(i),m)return new Promise((y,f)=>{i.addEventListener("load",y),i.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${o}`)))})}))}function r(c){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=c,window.dispatchEvent(p),!p.defaultPrevented)throw c}return s.then(c=>{for(const p of c||[])p.status==="rejected"&&r(p.reason);return e().catch(r)})};/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Pe=typeof document<"u";function Wt(a){return typeof a=="object"||"displayName"in a||"props"in a||"__vccOpts"in a}function qn(a){return a.__esModule||a[Symbol.toStringTag]==="Module"||a.default&&Wt(a.default)}const G=Object.assign;function Ze(a,e){const t={};for(const n in e){const s=e[n];t[n]=me(s)?s.map(a):a(s)}return t}const Be=()=>{},me=Array.isArray,jt=/#/g,Gn=/&/g,Kn=/\//g,Yn=/=/g,Xn=/\?/g,Ft=/\+/g,Qn=/%5B/g,Jn=/%5D/g,qt=/%5E/g,Zn=/%60/g,Gt=/%7B/g,ea=/%7C/g,Kt=/%7D/g,ta=/%20/g;function lt(a){return encodeURI(""+a).replace(ea,"|").replace(Qn,"[").replace(Jn,"]")}function na(a){return lt(a).replace(Gt,"{").replace(Kt,"}").replace(qt,"^")}function st(a){return lt(a).replace(Ft,"%2B").replace(ta,"+").replace(jt,"%23").replace(Gn,"%26").replace(Zn,"`").replace(Gt,"{").replace(Kt,"}").replace(qt,"^")}function aa(a){return st(a).replace(Yn,"%3D")}function sa(a){return lt(a).replace(jt,"%23").replace(Xn,"%3F")}function oa(a){return a==null?"":sa(a).replace(Kn,"%2F")}function Ve(a){try{return decodeURIComponent(""+a)}catch{}return""+a}const ia=/\/$/,ra=a=>a.replace(ia,"");function et(a,e,t="/"){let n,s={},r="",c="";const p=e.indexOf("#");let u=e.indexOf("?");return p<u&&p>=0&&(u=-1),u>-1&&(n=e.slice(0,u),r=e.slice(u+1,p>-1?p:e.length),s=a(r)),p>-1&&(n=n||e.slice(0,p),c=e.slice(p,e.length)),n=da(n??e,t),{fullPath:n+(r&&"?")+r+c,path:n,query:s,hash:Ve(c)}}function la(a,e){const t=e.query?a(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function vt(a,e){return!e||!a.toLowerCase().startsWith(e.toLowerCase())?a:a.slice(e.length)||"/"}function ca(a,e,t){const n=e.matched.length-1,s=t.matched.length-1;return n>-1&&n===s&&Ae(e.matched[n],t.matched[s])&&Yt(e.params,t.params)&&a(e.query)===a(t.query)&&e.hash===t.hash}function Ae(a,e){return(a.aliasOf||a)===(e.aliasOf||e)}function Yt(a,e){if(Object.keys(a).length!==Object.keys(e).length)return!1;for(const t in a)if(!ua(a[t],e[t]))return!1;return!0}function ua(a,e){return me(a)?yt(a,e):me(e)?yt(e,a):a===e}function yt(a,e){return me(e)?a.length===e.length&&a.every((t,n)=>t===e[n]):a.length===1&&a[0]===e}function da(a,e){if(a.startsWith("/"))return a;if(!a)return e;const t=e.split("/"),n=a.split("/"),s=n[n.length-1];(s===".."||s===".")&&n.push("");let r=t.length-1,c,p;for(c=0;c<n.length;c++)if(p=n[c],p!==".")if(p==="..")r>1&&r--;else break;return t.slice(0,r).join("/")+"/"+n.slice(c).join("/")}const Ee={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var We;(function(a){a.pop="pop",a.push="push"})(We||(We={}));var Ue;(function(a){a.back="back",a.forward="forward",a.unknown=""})(Ue||(Ue={}));function fa(a){if(!a)if(Pe){const e=document.querySelector("base");a=e&&e.getAttribute("href")||"/",a=a.replace(/^\w+:\/\/[^\/]+/,"")}else a="/";return a[0]!=="/"&&a[0]!=="#"&&(a="/"+a),ra(a)}const ha=/^[^#]+#/;function pa(a,e){return a.replace(ha,"#")+e}function _a(a,e){const t=document.documentElement.getBoundingClientRect(),n=a.getBoundingClientRect();return{behavior:e.behavior,left:n.left-t.left-(e.left||0),top:n.top-t.top-(e.top||0)}}const Ge=()=>({left:window.scrollX,top:window.scrollY});function ma(a){let e;if("el"in a){const t=a.el,n=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?n?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=_a(s,a)}else e=a;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function gt(a,e){return(history.state?history.state.position-e:-1)+a}const ot=new Map;function va(a,e){ot.set(a,e)}function ya(a){const e=ot.get(a);return ot.delete(a),e}let ga=()=>location.protocol+"//"+location.host;function Xt(a,e){const{pathname:t,search:n,hash:s}=e,r=a.indexOf("#");if(r>-1){let p=s.includes(a.slice(r))?a.slice(r).length:1,u=s.slice(p);return u[0]!=="/"&&(u="/"+u),vt(u,"")}return vt(t,a)+n+s}function wa(a,e,t,n){let s=[],r=[],c=null;const p=({state:g})=>{const i=Xt(a,location),y=t.value,f=e.value;let d=0;if(g){if(t.value=i,e.value=g,c&&c===y){c=null;return}d=f?g.position-f.position:0}else n(i);s.forEach(l=>{l(t.value,y,{delta:d,type:We.pop,direction:d?d>0?Ue.forward:Ue.back:Ue.unknown})})};function u(){c=t.value}function o(g){s.push(g);const i=()=>{const y=s.indexOf(g);y>-1&&s.splice(y,1)};return r.push(i),i}function m(){const{history:g}=window;g.state&&g.replaceState(G({},g.state,{scroll:Ge()}),"")}function _(){for(const g of r)g();r=[],window.removeEventListener("popstate",p),window.removeEventListener("beforeunload",m)}return window.addEventListener("popstate",p),window.addEventListener("beforeunload",m,{passive:!0}),{pauseListeners:u,listen:o,destroy:_}}function wt(a,e,t,n=!1,s=!1){return{back:a,current:e,forward:t,replaced:n,position:window.history.length,scroll:s?Ge():null}}function ba(a){const{history:e,location:t}=window,n={value:Xt(a,t)},s={value:e.state};s.value||r(n.value,{back:null,current:n.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function r(u,o,m){const _=a.indexOf("#"),g=_>-1?(t.host&&document.querySelector("base")?a:a.slice(_))+u:ga()+a+u;try{e[m?"replaceState":"pushState"](o,"",g),s.value=o}catch(i){console.error(i),t[m?"replace":"assign"](g)}}function c(u,o){const m=G({},e.state,wt(s.value.back,u,s.value.forward,!0),o,{position:s.value.position});r(u,m,!0),n.value=u}function p(u,o){const m=G({},s.value,e.state,{forward:u,scroll:Ge()});r(m.current,m,!0);const _=G({},wt(n.value,u,null),{position:m.position+1},o);r(u,_,!1),n.value=u}return{location:n,state:s,push:p,replace:c}}function ka(a){a=fa(a);const e=ba(a),t=wa(a,e.state,e.location,e.replace);function n(r,c=!0){c||t.pauseListeners(),history.go(r)}const s=G({location:"",base:a,go:n,createHref:pa.bind(null,a)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function Ea(a){return typeof a=="string"||a&&typeof a=="object"}function Qt(a){return typeof a=="string"||typeof a=="symbol"}const Jt=Symbol("");var bt;(function(a){a[a.aborted=4]="aborted",a[a.cancelled=8]="cancelled",a[a.duplicated=16]="duplicated"})(bt||(bt={}));function Ie(a,e){return G(new Error,{type:a,[Jt]:!0},e)}function ge(a,e){return a instanceof Error&&Jt in a&&(e==null||!!(a.type&e))}const kt="[^/]+?",xa={sensitive:!1,strict:!1,start:!0,end:!0},Sa=/[.+*?^${}()[\]/\\]/g;function Da(a,e){const t=G({},xa,e),n=[];let s=t.start?"^":"";const r=[];for(const o of a){const m=o.length?[]:[90];t.strict&&!o.length&&(s+="/");for(let _=0;_<o.length;_++){const g=o[_];let i=40+(t.sensitive?.25:0);if(g.type===0)_||(s+="/"),s+=g.value.replace(Sa,"\\$&"),i+=40;else if(g.type===1){const{value:y,repeatable:f,optional:d,regexp:l}=g;r.push({name:y,repeatable:f,optional:d});const v=l||kt;if(v!==kt){i+=10;try{new RegExp(`(${v})`)}catch(b){throw new Error(`Invalid custom RegExp for param "${y}" (${v}): `+b.message)}}let h=f?`((?:${v})(?:/(?:${v}))*)`:`(${v})`;_||(h=d&&o.length<2?`(?:/${h})`:"/"+h),d&&(h+="?"),s+=h,i+=20,d&&(i+=-8),f&&(i+=-20),v===".*"&&(i+=-50)}m.push(i)}n.push(m)}if(t.strict&&t.end){const o=n.length-1;n[o][n[o].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const c=new RegExp(s,t.sensitive?"":"i");function p(o){const m=o.match(c),_={};if(!m)return null;for(let g=1;g<m.length;g++){const i=m[g]||"",y=r[g-1];_[y.name]=i&&y.repeatable?i.split("/"):i}return _}function u(o){let m="",_=!1;for(const g of a){(!_||!m.endsWith("/"))&&(m+="/"),_=!1;for(const i of g)if(i.type===0)m+=i.value;else if(i.type===1){const{value:y,repeatable:f,optional:d}=i,l=y in o?o[y]:"";if(me(l)&&!f)throw new Error(`Provided param "${y}" is an array but it is not repeatable (* or + modifiers)`);const v=me(l)?l.join("/"):l;if(!v)if(d)g.length<2&&(m.endsWith("/")?m=m.slice(0,-1):_=!0);else throw new Error(`Missing required param "${y}"`);m+=v}}return m||"/"}return{re:c,score:n,keys:r,parse:p,stringify:u}}function La(a,e){let t=0;for(;t<a.length&&t<e.length;){const n=e[t]-a[t];if(n)return n;t++}return a.length<e.length?a.length===1&&a[0]===80?-1:1:a.length>e.length?e.length===1&&e[0]===80?1:-1:0}function Zt(a,e){let t=0;const n=a.score,s=e.score;for(;t<n.length&&t<s.length;){const r=La(n[t],s[t]);if(r)return r;t++}if(Math.abs(s.length-n.length)===1){if(Et(n))return 1;if(Et(s))return-1}return s.length-n.length}function Et(a){const e=a[a.length-1];return a.length>0&&e[e.length-1]<0}const $a={type:0,value:""},Ra=/[a-zA-Z0-9_]/;function Oa(a){if(!a)return[[]];if(a==="/")return[[$a]];if(!a.startsWith("/"))throw new Error(`Invalid path "${a}"`);function e(i){throw new Error(`ERR (${t})/"${o}": ${i}`)}let t=0,n=t;const s=[];let r;function c(){r&&s.push(r),r=[]}let p=0,u,o="",m="";function _(){o&&(t===0?r.push({type:0,value:o}):t===1||t===2||t===3?(r.length>1&&(u==="*"||u==="+")&&e(`A repeatable param (${o}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:o,regexp:m,repeatable:u==="*"||u==="+",optional:u==="*"||u==="?"})):e("Invalid state to consume buffer"),o="")}function g(){o+=u}for(;p<a.length;){if(u=a[p++],u==="\\"&&t!==2){n=t,t=4;continue}switch(t){case 0:u==="/"?(o&&_(),c()):u===":"?(_(),t=1):g();break;case 4:g(),t=n;break;case 1:u==="("?t=2:Ra.test(u)?g():(_(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&p--);break;case 2:u===")"?m[m.length-1]=="\\"?m=m.slice(0,-1)+u:t=3:m+=u;break;case 3:_(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&p--,m="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${o}"`),_(),c(),s}function Ca(a,e,t){const n=Da(Oa(a.path),t),s=G(n,{record:a,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function Pa(a,e){const t=[],n=new Map;e=Lt({strict:!1,end:!0,sensitive:!1},e);function s(_){return n.get(_)}function r(_,g,i){const y=!i,f=St(_);f.aliasOf=i&&i.record;const d=Lt(e,_),l=[f];if("alias"in _){const b=typeof _.alias=="string"?[_.alias]:_.alias;for(const C of b)l.push(St(G({},f,{components:i?i.record.components:f.components,path:C,aliasOf:i?i.record:f})))}let v,h;for(const b of l){const{path:C}=b;if(g&&C[0]!=="/"){const w=g.record.path,M=w[w.length-1]==="/"?"":"/";b.path=g.record.path+(C&&M+C)}if(v=Ca(b,g,d),i?i.alias.push(v):(h=h||v,h!==v&&h.alias.push(v),y&&_.name&&!Dt(v)&&c(_.name)),en(v)&&u(v),f.children){const w=f.children;for(let M=0;M<w.length;M++)r(w[M],v,i&&i.children[M])}i=i||v}return h?()=>{c(h)}:Be}function c(_){if(Qt(_)){const g=n.get(_);g&&(n.delete(_),t.splice(t.indexOf(g),1),g.children.forEach(c),g.alias.forEach(c))}else{const g=t.indexOf(_);g>-1&&(t.splice(g,1),_.record.name&&n.delete(_.record.name),_.children.forEach(c),_.alias.forEach(c))}}function p(){return t}function u(_){const g=Ia(_,t);t.splice(g,0,_),_.record.name&&!Dt(_)&&n.set(_.record.name,_)}function o(_,g){let i,y={},f,d;if("name"in _&&_.name){if(i=n.get(_.name),!i)throw Ie(1,{location:_});d=i.record.name,y=G(xt(g.params,i.keys.filter(h=>!h.optional).concat(i.parent?i.parent.keys.filter(h=>h.optional):[]).map(h=>h.name)),_.params&&xt(_.params,i.keys.map(h=>h.name))),f=i.stringify(y)}else if(_.path!=null)f=_.path,i=t.find(h=>h.re.test(f)),i&&(y=i.parse(f),d=i.record.name);else{if(i=g.name?n.get(g.name):t.find(h=>h.re.test(g.path)),!i)throw Ie(1,{location:_,currentLocation:g});d=i.record.name,y=G({},g.params,_.params),f=i.stringify(y)}const l=[];let v=i;for(;v;)l.unshift(v.record),v=v.parent;return{name:d,path:f,params:y,matched:l,meta:Aa(l)}}a.forEach(_=>r(_));function m(){t.length=0,n.clear()}return{addRoute:r,resolve:o,removeRoute:c,clearRoutes:m,getRoutes:p,getRecordMatcher:s}}function xt(a,e){const t={};for(const n of e)n in a&&(t[n]=a[n]);return t}function St(a){const e={path:a.path,redirect:a.redirect,name:a.name,meta:a.meta||{},aliasOf:a.aliasOf,beforeEnter:a.beforeEnter,props:Ma(a),children:a.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in a?a.components||null:a.component&&{default:a.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function Ma(a){const e={},t=a.props||!1;if("component"in a)e.default=t;else for(const n in a.components)e[n]=typeof t=="object"?t[n]:t;return e}function Dt(a){for(;a;){if(a.record.aliasOf)return!0;a=a.parent}return!1}function Aa(a){return a.reduce((e,t)=>G(e,t.meta),{})}function Lt(a,e){const t={};for(const n in a)t[n]=n in e?e[n]:a[n];return t}function Ia(a,e){let t=0,n=e.length;for(;t!==n;){const r=t+n>>1;Zt(a,e[r])<0?n=r:t=r+1}const s=Ta(a);return s&&(n=e.lastIndexOf(s,n-1)),n}function Ta(a){let e=a;for(;e=e.parent;)if(en(e)&&Zt(a,e)===0)return e}function en({record:a}){return!!(a.name||a.components&&Object.keys(a.components).length||a.redirect)}function Ha(a){const e={};if(a===""||a==="?")return e;const n=(a[0]==="?"?a.slice(1):a).split("&");for(let s=0;s<n.length;++s){const r=n[s].replace(Ft," "),c=r.indexOf("="),p=Ve(c<0?r:r.slice(0,c)),u=c<0?null:Ve(r.slice(c+1));if(p in e){let o=e[p];me(o)||(o=e[p]=[o]),o.push(u)}else e[p]=u}return e}function $t(a){let e="";for(let t in a){const n=a[t];if(t=aa(t),n==null){n!==void 0&&(e+=(e.length?"&":"")+t);continue}(me(n)?n.map(r=>r&&st(r)):[n&&st(n)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+t,r!=null&&(e+="="+r))})}return e}function za(a){const e={};for(const t in a){const n=a[t];n!==void 0&&(e[t]=me(n)?n.map(s=>s==null?null:""+s):n==null?n:""+n)}return e}const tn=Symbol(""),Rt=Symbol(""),Ke=Symbol(""),ct=Symbol(""),it=Symbol("");function Te(){let a=[];function e(n){return a.push(n),()=>{const s=a.indexOf(n);s>-1&&a.splice(s,1)}}function t(){a=[]}return{add:e,list:()=>a.slice(),reset:t}}function Na(a,e,t){const n=()=>{a[e].delete(t)};$e(n),_n(n),mn(()=>{a[e].add(t)}),a[e].add(t)}function To(a){const e=De(tn,{}).value;e&&Na(e,"updateGuards",a)}function Se(a,e,t,n,s,r=c=>c()){const c=n&&(n.enterCallbacks[s]=n.enterCallbacks[s]||[]);return()=>new Promise((p,u)=>{const o=g=>{g===!1?u(Ie(4,{from:t,to:e})):g instanceof Error?u(g):Ea(g)?u(Ie(2,{from:e,to:g})):(c&&n.enterCallbacks[s]===c&&typeof g=="function"&&c.push(g),p())},m=r(()=>a.call(n&&n.instances[s],e,t,o));let _=Promise.resolve(m);a.length<3&&(_=_.then(o)),_.catch(g=>u(g))})}function tt(a,e,t,n,s=r=>r()){const r=[];for(const c of a)for(const p in c.components){let u=c.components[p];if(!(e!=="beforeRouteEnter"&&!c.instances[p]))if(Wt(u)){const m=(u.__vccOpts||u)[e];m&&r.push(Se(m,t,n,c,p,s))}else{let o=u();r.push(()=>o.then(m=>{if(!m)throw new Error(`Couldn't resolve component "${p}" at "${c.path}"`);const _=qn(m)?m.default:m;c.mods[p]=m,c.components[p]=_;const i=(_.__vccOpts||_)[e];return i&&Se(i,t,n,c,p,s)()}))}}return r}function Ot(a){const e=De(Ke),t=De(ct),n=ve(()=>{const u=K(a.to);return e.resolve(u)}),s=ve(()=>{const{matched:u}=n.value,{length:o}=u,m=u[o-1],_=t.matched;if(!m||!_.length)return-1;const g=_.findIndex(Ae.bind(null,m));if(g>-1)return g;const i=Ct(u[o-2]);return o>1&&Ct(m)===i&&_[_.length-1].path!==i?_.findIndex(Ae.bind(null,u[o-2])):g}),r=ve(()=>s.value>-1&&ja(t.params,n.value.params)),c=ve(()=>s.value>-1&&s.value===t.matched.length-1&&Yt(t.params,n.value.params));function p(u={}){if(Wa(u)){const o=e[K(a.replace)?"replace":"push"](K(a.to)).catch(Be);return a.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>o),o}return Promise.resolve()}return{route:n,href:ve(()=>n.value.href),isActive:r,isExactActive:c,navigate:p}}function Ba(a){return a.length===1?a[0]:a}const Ua=he({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Ot,setup(a,{slots:e}){const t=vn(Ot(a)),{options:n}=De(Ke),s=ve(()=>({[Pt(a.activeClass,n.linkActiveClass,"router-link-active")]:t.isActive,[Pt(a.exactActiveClass,n.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const r=e.default&&Ba(e.default(t));return a.custom?r:Tt("a",{"aria-current":t.isExactActive?a.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},r)}}}),Va=Ua;function Wa(a){if(!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)&&!a.defaultPrevented&&!(a.button!==void 0&&a.button!==0)){if(a.currentTarget&&a.currentTarget.getAttribute){const e=a.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return a.preventDefault&&a.preventDefault(),!0}}function ja(a,e){for(const t in e){const n=e[t],s=a[t];if(typeof n=="string"){if(n!==s)return!1}else if(!me(s)||s.length!==n.length||n.some((r,c)=>r!==s[c]))return!1}return!0}function Ct(a){return a?a.aliasOf?a.aliasOf.path:a.path:""}const Pt=(a,e,t)=>a??e??t,Fa=he({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(a,{attrs:e,slots:t}){const n=De(it),s=ve(()=>a.route||n.value),r=De(Rt,0),c=ve(()=>{let o=K(r);const{matched:m}=s.value;let _;for(;(_=m[o])&&!_.components;)o++;return o}),p=ve(()=>s.value.matched[c.value]);Xe(Rt,ve(()=>c.value+1)),Xe(tn,p),Xe(it,s);const u=j();return Ht(()=>[u.value,p.value,a.name],([o,m,_],[g,i,y])=>{m&&(m.instances[_]=o,i&&i!==m&&o&&o===g&&(m.leaveGuards.size||(m.leaveGuards=i.leaveGuards),m.updateGuards.size||(m.updateGuards=i.updateGuards))),o&&m&&(!i||!Ae(m,i)||!g)&&(m.enterCallbacks[_]||[]).forEach(f=>f(o))},{flush:"post"}),()=>{const o=s.value,m=a.name,_=p.value,g=_&&_.components[m];if(!g)return Mt(t.default,{Component:g,route:o});const i=_.props[m],y=i?i===!0?o.params:typeof i=="function"?i(o):i:null,d=Tt(g,G({},y,e,{onVnodeUnmounted:l=>{l.component.isUnmounted&&(_.instances[m]=null)},ref:u}));return Mt(t.default,{Component:d,route:o})||d}}});function Mt(a,e){if(!a)return null;const t=a(e);return t.length===1?t[0]:t}const qa=Fa;function Ga(a){const e=Pa(a.routes,a),t=a.parseQuery||Ha,n=a.stringifyQuery||$t,s=a.history,r=Te(),c=Te(),p=Te(),u=fn(Ee);let o=Ee;Pe&&a.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const m=Ze.bind(null,k=>""+k),_=Ze.bind(null,oa),g=Ze.bind(null,Ve);function i(k,$){let R,O;return Qt(k)?(R=e.getRecordMatcher(k),O=$):O=k,e.addRoute(O,R)}function y(k){const $=e.getRecordMatcher(k);$&&e.removeRoute($)}function f(){return e.getRoutes().map(k=>k.record)}function d(k){return!!e.getRecordMatcher(k)}function l(k,$){if($=G({},$||u.value),typeof k=="string"){const V=et(t,k,$.path),T=e.resolve({path:V.path},$),ae=s.createHref(V.fullPath);return G(V,T,{params:g(T.params),hash:Ve(V.hash),redirectedFrom:void 0,href:ae})}let R;if(k.path!=null)R=G({},k,{path:et(t,k.path,$.path).path});else{const V=G({},k.params);for(const T in V)V[T]==null&&delete V[T];R=G({},k,{params:_(V)}),$.params=_($.params)}const O=e.resolve(R,$),W=k.hash||"";O.params=m(g(O.params));const X=la(n,G({},k,{hash:na(W),path:O.path})),z=s.createHref(X);return G({fullPath:X,hash:W,query:n===$t?za(k.query):k.query||{}},O,{redirectedFrom:void 0,href:z})}function v(k){return typeof k=="string"?et(t,k,u.value.path):G({},k)}function h(k,$){if(o!==k)return Ie(8,{from:$,to:k})}function b(k){return M(k)}function C(k){return b(G(v(k),{replace:!0}))}function w(k){const $=k.matched[k.matched.length-1];if($&&$.redirect){const{redirect:R}=$;let O=typeof R=="function"?R(k):R;return typeof O=="string"&&(O=O.includes("?")||O.includes("#")?O=v(O):{path:O},O.params={}),G({query:k.query,hash:k.hash,params:O.path!=null?{}:k.params},O)}}function M(k,$){const R=o=l(k),O=u.value,W=k.state,X=k.force,z=k.replace===!0,V=w(R);if(V)return M(G(v(V),{state:typeof V=="object"?G({},W,V.state):W,force:X,replace:z}),$||R);const T=R;T.redirectedFrom=$;let ae;return!X&&ca(n,O,R)&&(ae=Ie(16,{to:T,from:O}),E(O,O,!0,!1)),(ae?Promise.resolve(ae):N(T,O)).catch(Z=>ge(Z)?ge(Z,2)?Z:L(Z):_e(Z,T,O)).then(Z=>{if(Z){if(ge(Z,2))return M(G({replace:z},v(Z.to),{state:typeof Z.to=="object"?G({},W,Z.to.state):W,force:X}),$||T)}else Z=le(T,O,!0,z,W);return ne(T,O,Z),Z})}function x(k,$){const R=h(k,$);return R?Promise.reject(R):Promise.resolve()}function I(k){const $=A.values().next().value;return $&&typeof $.runWithContext=="function"?$.runWithContext(k):k()}function N(k,$){let R;const[O,W,X]=Ka(k,$);R=tt(O.reverse(),"beforeRouteLeave",k,$);for(const V of O)V.leaveGuards.forEach(T=>{R.push(Se(T,k,$))});const z=x.bind(null,k,$);return R.push(z),ie(R).then(()=>{R=[];for(const V of r.list())R.push(Se(V,k,$));return R.push(z),ie(R)}).then(()=>{R=tt(W,"beforeRouteUpdate",k,$);for(const V of W)V.updateGuards.forEach(T=>{R.push(Se(T,k,$))});return R.push(z),ie(R)}).then(()=>{R=[];for(const V of X)if(V.beforeEnter)if(me(V.beforeEnter))for(const T of V.beforeEnter)R.push(Se(T,k,$));else R.push(Se(V.beforeEnter,k,$));return R.push(z),ie(R)}).then(()=>(k.matched.forEach(V=>V.enterCallbacks={}),R=tt(X,"beforeRouteEnter",k,$,I),R.push(z),ie(R))).then(()=>{R=[];for(const V of c.list())R.push(Se(V,k,$));return R.push(z),ie(R)}).catch(V=>ge(V,8)?V:Promise.reject(V))}function ne(k,$,R){p.list().forEach(O=>I(()=>O(k,$,R)))}function le(k,$,R,O,W){const X=h(k,$);if(X)return X;const z=$===Ee,V=Pe?history.state:{};R&&(O||z?s.replace(k.fullPath,G({scroll:z&&V&&V.scroll},W)):s.push(k.fullPath,W)),u.value=k,E(k,$,R,z),L()}let J;function Re(){J||(J=s.listen((k,$,R)=>{if(!Q.listening)return;const O=l(k),W=w(O);if(W){M(G(W,{replace:!0,force:!0}),O).catch(Be);return}o=O;const X=u.value;Pe&&va(gt(X.fullPath,R.delta),Ge()),N(O,X).catch(z=>ge(z,12)?z:ge(z,2)?(M(G(v(z.to),{force:!0}),O).then(V=>{ge(V,20)&&!R.delta&&R.type===We.pop&&s.go(-1,!1)}).catch(Be),Promise.reject()):(R.delta&&s.go(-R.delta,!1),_e(z,O,X))).then(z=>{z=z||le(O,X,!1),z&&(R.delta&&!ge(z,8)?s.go(-R.delta,!1):R.type===We.pop&&ge(z,20)&&s.go(-1,!1)),ne(O,X,z)}).catch(Be)}))}let pe=Te(),be=Te(),Oe;function _e(k,$,R){L(k);const O=be.list();return O.length?O.forEach(W=>W(k,$,R)):console.error(k),Promise.reject(k)}function Fe(){return Oe&&u.value!==Ee?Promise.resolve():new Promise((k,$)=>{pe.add([k,$])})}function L(k){return Oe||(Oe=!k,Re(),pe.list().forEach(([$,R])=>k?R(k):$()),pe.reset()),k}function E(k,$,R,O){const{scrollBehavior:W}=a;if(!Pe||!W)return Promise.resolve();const X=!R&&ya(gt(k.fullPath,0))||(O||!R)&&history.state&&history.state.scroll||null;return pn().then(()=>W(k,$,X)).then(z=>z&&ma(z)).catch(z=>_e(z,k,$))}const H=k=>s.go(k);let B;const A=new Set,Q={currentRoute:u,listening:!0,addRoute:i,removeRoute:y,clearRoutes:e.clearRoutes,hasRoute:d,getRoutes:f,resolve:l,options:a,push:b,replace:C,go:H,back:()=>H(-1),forward:()=>H(1),beforeEach:r.add,beforeResolve:c.add,afterEach:p.add,onError:be.add,isReady:Fe,install(k){const $=this;k.component("RouterLink",Va),k.component("RouterView",qa),k.config.globalProperties.$router=$,Object.defineProperty(k.config.globalProperties,"$route",{enumerable:!0,get:()=>K(u)}),Pe&&!B&&u.value===Ee&&(B=!0,b(s.location).catch(W=>{}));const R={};for(const W in Ee)Object.defineProperty(R,W,{get:()=>u.value[W],enumerable:!0});k.provide(Ke,$),k.provide(ct,hn(R)),k.provide(it,u);const O=k.unmount;A.add(k),k.unmount=function(){A.delete(k),A.size<1&&(o=Ee,J&&J(),J=null,u.value=Ee,B=!1,Oe=!1),O()}}};function ie(k){return k.reduce(($,R)=>$.then(()=>I(R)),Promise.resolve())}return Q}function Ka(a,e){const t=[],n=[],s=[],r=Math.max(e.matched.length,a.matched.length);for(let c=0;c<r;c++){const p=e.matched[c];p&&(a.matched.find(o=>Ae(o,p))?n.push(p):t.push(p));const u=a.matched[c];u&&(e.matched.find(o=>Ae(o,u))||s.push(u))}return[t,n,s]}function Ya(){return De(Ke)}function Xa(a){return De(ct)}const nn=[{path:"/",name:"Directory",component:()=>ke(()=>import("./FileView_N-CnW96uzD.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),meta:{icon:"sysIcon_folderopen",deny_user:!1,deny_guest:!1}},{path:"/favourite",name:"Favourite",component:()=>ke(()=>import("./Favourite-iIBprWX4.js"),__vite__mapDeps([10,2,3,5,4,6,7,8,11]),import.meta.url),meta:{icon:"sysIcon_star-o",deny_user:!1,deny_guest:!0}},{path:"/recycle",name:"Recycle",component:()=>ke(()=>import("./FileView_R-CkxtCOFz.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9]),import.meta.url),meta:{icon:"sysIcon_delete",deny_user:!1,deny_guest:!0}},{path:"/tag",name:"Tag",component:()=>ke(()=>import("./TagView-P-27J5oU.js"),__vite__mapDeps([13,2,3,5,6,7,14]),import.meta.url),meta:{icon:"sysIcon_tagso",deny_user:!1,deny_guest:!0}},{path:"/shares",name:"Share",component:()=>ke(()=>import("./ShareView-C3TiwjRa.js"),__vite__mapDeps([15,2,3,16]),import.meta.url),meta:{icon:"sysIcon_export",deny_user:!1,deny_guest:!0}},{path:"/group",name:"User",component:()=>ke(()=>import("./UserView-BCECqWIW.js"),__vite__mapDeps([17,2,3,5,6,7,18]),import.meta.url),meta:{icon:"sysIcon_team",deny_user:!0,deny_guest:!0}},{path:"/log",name:"ProcessLog",component:()=>ke(()=>import("./LogView-wt3nFWIl.js"),__vite__mapDeps([19,2,3,20]),import.meta.url),meta:{icon:"sysIcon_filetext",deny_user:!0,deny_guest:!0}},{path:"/setting",name:"Setting",component:()=>ke(()=>import("./SettingView-BAKCyvGr.js"),__vite__mapDeps([21,2,3,5,22]),import.meta.url),meta:{icon:"sysIcon_setting",deny_user:!0,deny_guest:!0}}],Qa=Ga({history:ka("./"),routes:nn}),Ja=["onClick"],Za={class:"content"},es=he({__name:"NaviContent",props:{depth:{},records:{}},setup(a){const e=a;e.depth&&e.depth;const t=e.records,n=Ya(),s=Xa();async function r(p){console.info("go",p);const u=await n.push(p.path);console.info(u)}const c=je();return(p,u)=>(S(!0),D(q,null,re(K(t),(o,m)=>{var _,g,i,y,f,d;return S(),D(q,{key:m},[(_=o.meta)!=null&&_.hide?(S(),D(q,{key:0},[],64)):(g=o.meta)!=null&&g.deny_guest&&((i=K(c))==null?void 0:i.group.title)=="guest"?(S(),D(q,{key:1},[],64)):(y=o.meta)!=null&&y.deny_user&&!((f=K(c))!=null&&f.group.admin)?(S(),D(q,{key:2},[],64)):(S(),D("p",{key:3,onClick:l=>r(o),class:ue({title:!0,active:o.path===K(s).path})},[P("span",{class:ue(["icon","sysIcon",(d=o.meta)==null?void 0:d.icon])},null,2),P("span",Za,oe(o.name),1)],10,Ja))],64)}),128))}}),ts=he({__name:"Navi",setup(a){return(e,t)=>(S(),D("div",{class:ue(["fr_navi",{folded:!1}])},[Ce(es,{records:K(nn),depth:1},null,8,["records"])]))}});let rt=null;function an(a){rt=a}function ns(a,e){rt&&rt(a,e)}const as=Object.freeze(Object.defineProperty({__proto__:null,register:an,trigger:ns},Symbol.toStringTag,{value:"Module"}));var sn={};Object.defineProperty(sn,"__esModule",{value:!0});function ss(a){a===void 0&&(a={});var e=/^0/,t=/\s+/g,n=/^\s+|\s+$/g,s=/[^\x00-\x80]/,r=/^0x[0-9a-f]+$/i,c=/(0x[\da-fA-F]+|(^[\+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|\d+)/g,p=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,u=String.prototype.toLocaleLowerCase||String.prototype.toLowerCase,o=a.desc?-1:1,m=-o,_=a.insensitive?function(y){return u.call(""+y).replace(n,"")}:function(y){return(""+y).replace(n,"")};function g(y){return y.replace(c,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0")}function i(y,f){return(!y.match(e)||f===1)&&parseFloat(y)||y.replace(t," ").replace(n,"")||0}return function(y,f){var d=_(y),l=_(f);if(!d&&!l)return 0;if(!d&&l)return m;if(d&&!l)return o;var v=g(d),h=g(l),b=d.match(r),C=l.match(r),w=b&&C?parseInt(b[0],16):v.length!==1&&Date.parse(d),M=b&&C?parseInt(C[0],16):w&&l.match(p)&&Date.parse(l)||null;if(M){if(w===M)return 0;if(w<M)return m;if(w>M)return o}for(var x=v.length,I=h.length,N=0,ne=Math.max(x,I);N<ne;N+=1){var le=i(v[N]||"",x),J=i(h[N]||"",I);if(isNaN(le)!==isNaN(J))return isNaN(le)?o:m;if(s.test(le+J)&&le.localeCompare){var Re=le.localeCompare(J);if(Re>0)return o;if(Re<0)return m;if(N===ne-1)return 0}if(le<J)return m;if(le>J)return o;if(""+le<""+J)return m;if(""+le>""+J)return o}return 0}}var os=sn.default=ss;let U;class Ho{constructor(e){ee(this,"nodeList",j([]));ee(this,"getList");ee(this,"route");ee(this,"router");ee(this,"contentDOM");ee(this,"emitGo");ee(this,"modal");ee(this,"context");ee(this,"mode",j(""));ee(this,"modeKey","");ee(this,"sortVal",j(""));ee(this,"selecting",!1);ee(this,"selectingMovEvtCount",0);ee(this,"selectingOffset",[[0,0],[0,0]]);ee(this,"preSelectedNodeIndexSet",new Set);ee(this,"selectingKeyDef","");ee(this,"showSelectionOp",j(!1));ee(this,"lastSelectIndex",-1);ee(this,"reloadOffset_timer",0);ee(this,"reloadOffset_count",0);ee(this,"startScroll",!1);this.contentDOM=e.contentDOM,this.getList=e.getList,this.route=e.route,this.router=e.router,this.emitGo=e.emitGo,this.modal=yn,this.context=as,this.mode.value=de("file_view_mode")??"detail",this.modeKey=gn("file_view_mode",t=>this.mode.value=t),this.sortVal=j(de("file_view_sort")??"name_asc"),this.contextMenuEvt=this.contextMenuEvt.bind(this),this.mouseDownEvt=this.mouseDownEvt.bind(this),this.mouseMoveEvt=this.mouseMoveEvt.bind(this),this.mouseUpEvt=this.mouseUpEvt.bind(this),this.keymap=this.keymap.bind(this),this.reloadOffset=this.reloadOffset.bind(this),this.scrollEvt=this.scrollEvt.bind(this),addEventListener("contextmenu",this.contextMenuEvt),addEventListener("pointerdown",this.mouseDownEvt),addEventListener("pointermove",this.mouseMoveEvt),addEventListener("pointerup",this.mouseUpEvt),addEventListener("keydown",this.keymap),addEventListener("resize",this.reloadOffset),this.contentDOM.addEventListener("scroll",this.scrollEvt),U=this}destructor(){console.info("destructor loaded"),wn("file_view_mode",this.modeKey),removeEventListener("contextmenu",this.contextMenuEvt),removeEventListener("pointerdown",this.mouseDownEvt),removeEventListener("pointermove",this.mouseMoveEvt),removeEventListener("pointerup",this.mouseUpEvt),removeEventListener("keydown",this.keymap),removeEventListener("resize",this.reloadOffset),this.contentDOM&&this.contentDOM.removeEventListener("scroll",this.scrollEvt),U=null}setList(e){this.nodeList.value=e,setTimeout(()=>{this.reloadOffset(void 0)},se.timeouts.offsetDebounce)}deleteFromList(e){const t=[],n=new Set;e.forEach(s=>n.add(s)),this.nodeList.value.forEach(s=>{n.has(s.id??0)||t.push(s)}),this.getList(t)}inDetailView(e){let t=!1,n=e.target;for(;n;){if(n.contentEditable==="true"){t=!1;break}if(n.classList.contains("rater")){t=!1;break}if(n.classList.contains("list_fav")){t=!0;break}if(n.classList.contains("view_fav")){t=!1;break}if(n.classList.contains("content_meta")){t=!1;break}if(n.classList.contains("fr_content")){t=!0;break}if(!n.parentElement)break;n=n.parentElement}return t}inTaggingDOM(e){let t=!1,n=e.target;for(;n;){if(n.classList.contains("content_detail"))return!1;if(n.classList.contains("tag_list")){t=!0;break}if(!n.parentElement)break;n=n.parentElement}return t}mouseDownEvt(e){var c,p,u,o;if(!this.inDetailView(e)||e.button===1)return;if(this.selectingOffset[0]=[e.x+(((c=this.contentDOM)==null?void 0:c.scrollLeft)??0),e.y+(((p=this.contentDOM)==null?void 0:p.scrollTop)??0)],this.selectingOffset[1]=[e.x+(((u=this.contentDOM)==null?void 0:u.scrollLeft)??0),e.y+(((o=this.contentDOM)==null?void 0:o.scrollTop)??0)],this.preSelectedNodeIndexSet.clear(),e.preventDefault(),e.button!==0)return this.rightMouseDownEvt(e);this.nodeList.value.forEach((m,_)=>{m._selected&&this.preSelectedNodeIndexSet.add(_)}),this.selecting=!0,this.selectingMovEvtCount=0;const t=this.getSelection(this.selectingOffset),n=[];e.ctrlKey&&n.push("ctrl"),e.shiftKey&&n.push("shift"),this.selectingKeyDef=n.join("_");let s=-1;const r=Array.from(t);switch(r.length&&(s=r.pop()??-1),this.selectingKeyDef){case"shift":this.preSelectedNodeIndexSet.clear();case"ctrl_shift":if(s==-1||this.lastSelectIndex==-1)break;const m=Math.min(s,this.lastSelectIndex),_=Math.max(s,this.lastSelectIndex);for(let g=m;g<=_;g++)t.has(g)||this.preSelectedNodeIndexSet.add(g);break;default:this.preSelectedNodeIndexSet.clear();break;case"ctrl":break}this.nodeList.value.forEach((m,_)=>{let g=0;this.preSelectedNodeIndexSet.has(_)&&(g+=1),t.has(_)&&(g+=1),m._selected=g===1}),this.lastSelectIndex=s,this.showSelectionOp.value=this.preSelectedNodeIndexSet.size+t.size>0}rightMouseDownEvt(e){const t=this.getSelection(this.selectingOffset);let n=!1;const s=new Set;this.nodeList.value.forEach((r,c)=>{r._selected&&(s.add(c),t.has(c)&&(n=!0))}),n?this.preSelectedNodeIndexSet=s:this.preSelectedNodeIndexSet=t,this.nodeList.value.forEach((r,c)=>{r._selected=this.preSelectedNodeIndexSet.has(c)})}mouseMoveEvt(e){var s,r;if(!this.selecting||(this.selectingMovEvtCount+=1,this.selectingMovEvtCount<10))return;e.preventDefault(),this.selectingOffset[1]=[e.x+(((s=this.contentDOM)==null?void 0:s.scrollLeft)??0),e.y+(((r=this.contentDOM)==null?void 0:r.scrollTop)??0)];const t=this.getSelection(this.selectingOffset);this.nodeList.value.forEach((c,p)=>{let u=0;this.preSelectedNodeIndexSet.has(p)&&(u+=1),t.has(p)&&(u+=1),c._selected=u===1});const n=this.getSelection([this.selectingOffset[1],this.selectingOffset[1]]);n.size&&(this.lastSelectIndex=Array.from(n).pop()??-1),this.showSelectionOp.value=this.preSelectedNodeIndexSet.size+t.size>0}mouseUpEvt(e){this.selecting&&(e.preventDefault(),setTimeout(()=>{this.selecting=!1,this.selectingMovEvtCount=0,this.selectingOffset=[[0,0],[0,0]],this.preSelectedNodeIndexSet.clear(),this.selectingKeyDef=""},se.timeouts.selectEvt))}async contextMenuEvt(e){if(!this.inDetailView(e))return;let t=this.route.name==="Recycle",n=this.getSelected();if(!n.nodeLs||!n.nodeLs.length)return;let s=n.nodeLs.length!==1;const r=n.nodeLs,c=n.idSet;let p=de("file_view_mode")??"detail";this.route.name!=="Directory"&&(p="detail");let u=p==="detail";this.route.name==="Recycle"&&(u=!1),e.preventDefault(),e.stopPropagation(),this.context.trigger([{title:"Open",auth:"guest",method:async o=>{console.info("Open",o),s?await F.op_bath_browser(c,r):this.emitGo("node",r[0].id)}},{title:"Open New Tab",auth:"guest",method:async o=>{var g;console.info("Open",o,this.route,this.router);let m=null;s||r.length&&r[0].type==="directory"&&(m=r[0]),fe.copyObject(this.route.query);const _=new URL(location.href);m&&_.searchParams.set("id_dir",`${m.id??0}`),(g=window.open(_,"_blank"))==null||g.focus()}},{title:"Download",auth:s||r[0].type=="directory"?"none":"guest",method:o=>{var y,f;console.info("Download",o);const m=r[0];let _=(f=(y=m.file_index)==null?void 0:y.raw)==null?void 0:f.path,g=(m==null?void 0:m.title)??"";if(!_)return;let i=document.createElement("a");i.style.display="none",i.href=_+"?filename="+g,i.target="_blank",i.setAttribute("download",g),i.click()}},{title:"Download Selected",auth:s||r[0].type=="directory"?"guest":"none",method:async o=>{if(console.info("DownloadSelected",o),console.info(this,r),!U||!U.modal)return;const m=At("",r),_=new bn(m,async y=>{const f=await Y("file/get",Object.assign({mode:"directory",cascade_dir:"0",id_dir:y.id.toString(),with:"file"}));return f?At(y.path,f.list):[]}),g=j("downloading 0/0 (0%)"),i=U.modal.set({title:_.title,alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:g});await _.prepare(),await _.download((y,f,d,l,v)=>{const h=y+f,b=Math.round(1e4*h/d)/100+"%";i.content.text.value=`downloading ${h}/${d} (${b})`}),await _.build(),await _.complete(),U.modal.close(i.nid)}},{title:"Rename",auth:u?"user":"none",method:async o=>{console.info("Rename",o),s?await F.op_bath_rename(c,r):await F.op_rename(r[0])}},{title:"Move",auth:u?"user":"none",method:async o=>{console.info("Move",o),s?await F.op_bath_move(c,r):await F.op_move(r[0])}},{title:"Delete",auth:t?"none":"user",method:async o=>{console.info("Delete",o),s?await F.op_bath_delete(c,r):await F.op_delete(r[0])}},{title:"Recover",auth:t?"user":"none",method:async o=>{console.info("Recover",o),s?await F.op_bath_delete(c,r,!0):await F.op_delete(r[0],!0)}},{title:"Delete Forever",auth:t?"user":"none",method:async o=>{console.info("Delete Forever",o),s?await F.op_bath_delete_forever(c,r):await F.op_delete_forever(r[0])}},{title:"Favourite",auth:u?"user":"none",method:async o=>{console.info("Favourite",o),s?await F.op_bath_favourite(c,r):await F.op_toggle_favourite(r[0])}},{title:"Share",auth:"user",method:async o=>{console.info("Share",o),await F.op_share(c)}},{title:"Extra",auth:"guest",method:o=>{console.info("Extra",o)},child:[{title:"Tagging",auth:u?"user":"none",method:async o=>{console.info("Tagging",o),r.forEach(m=>{F.op_tag(m)})}},{title:"Set Cover",auth:s?"none":"user",method:async o=>{console.info("Set Cover",o),await F.op_set_cover(r[0])}},{title:"Import EHT",auth:"admin",method:async o=>{console.info("Import EHT",o),await F.op_imp_tag_eh(Array.from(c))}},{title:"Cascade Tag",auth:"user",method:async o=>{console.info("Cascade Tag",o),await F.op_cascade_tag(Array.from(c))}}]},{title:"Admin",auth:"admin",method:o=>{console.info("Extra",o)},child:[{title:"ReBuild",auth:"admin",method:async o=>{console.info("ReBuild",o),await F.op_rebuild(Array.from(c))}},{title:"ReHash",auth:s?"none":"admin",method:async o=>{console.info("ReHash",o),await F.op_rehash(Array.from(c))}},{title:"RM RAW",auth:"admin",method:async o=>{console.info("RMRAW",o),await F.op_rm_raw(Array.from(c))}}]}],e)}getSelection(e){let t=e[0][0]>e[1][0]?e[1][0]:e[0][0],n=e[0][1]>e[1][1]?e[1][1]:e[0][1],s=e[0][0]<e[1][0]?e[1][0]:e[0][0],r=e[0][1]<e[1][1]?e[1][1]:e[0][1];const c=new Set;return this.nodeList.value.forEach((p,u)=>{if(!p._offsets)return;let o=p==null?void 0:p._offsets[0],m=p==null?void 0:p._offsets[1],_=p==null?void 0:p._offsets[2],g=p==null?void 0:p._offsets[3],i=o>=t&&o<=s||_>=t&&_<=s||o<=s&&_>=t,y=m>=n&&m<=r||g>=n&&g<=r||m<=r&&g>=n;!i||!y||c.add(u)}),c}clearSelect(e){e.target.classList.contains("content_detail")&&(this.nodeList.value.forEach(t=>{t._selected=!1}),this.showSelectionOp.value=!1)}async bathOp(e){let{idSet:t,nodeLs:n}=this.getSelected();if(t.size)switch(e){case"rename":await F.op_bath_rename(t,n);break;case"move":await F.op_bath_move(t,n);break;case"delete":await F.op_bath_delete(t,n);break;case"delete_forever":await F.op_bath_delete_forever(t,n);break;case"browser":await F.op_bath_browser(t,n);break;case"favourite":await F.op_bath_favourite(t,n);break}}getSelected(){const e=[],t=new Set;return this.nodeList.value.forEach(n=>{n._selected&&(e.push(n),t.add((n==null?void 0:n.id)??0))}),{nodeLs:e,idSet:t}}arrowSelection(e){if(!this.nodeList.value.length)return;let t=this.lastSelectIndex;if(t===-1){const o=this.getSelected();o.idSet.size?t=Array.from(o.idSet).pop()??0:t=0}de("file_view_mode"),this.route.name;const n=this.nodeList.value[t];if(!n)return;n._offsets||(n._offsets=[]);const s=n._offsets[2]-n._offsets[0],r=this.contentDOM.offsetWidth,c=Math.floor(r/s);let p=t;switch(e.key){case"ArrowRight":p+=1;break;case"ArrowLeft":p-=1;break;case"ArrowUp":p-=1*c;break;case"ArrowDown":p+=1*c;break}let u=!1;(e.ctrlKey||e.shiftKey)&&(u=!0),p<0&&(p=0),p>this.nodeList.value.length-1&&(p=this.nodeList.value.length-1),this.lastSelectIndex=p,this.nodeList.value.forEach((o,m)=>{if(p===m)return o._selected=!0;o._selected&&!u&&(o._selected=!1)})}setMode(e){we("file_view_mode",e),this.setList(this.nodeList.value)}setSort(e){console.info("setSort",e),we("file_view_sort",e);const t=this.nodeList.value;this.nodeList.value=[],setTimeout(()=>{this.nodeList.value=this.sortList(t,this.sortVal.value),this.setList(this.nodeList.value)},se.timeouts.sort)}sortList(e,t){return e=on(e,t),e}async keymap(e){let t;const n=e.target;switch(e.key){case"F2":if(He(n)||ze(n)||this.mode.value!="detail")return;t=this.getSelected(),t.nodeLs.length!==1?await F.op_bath_rename(t.idSet,t.nodeLs):await F.op_rename(t.nodeLs[0]);break;case"Delete":if(He(n)||ze(n))return;t=this.getSelected(),this.route.name==="Recycle"?await F.op_bath_delete_forever(t.idSet,t.nodeLs):await F.op_bath_delete(t.idSet,t.nodeLs);break;case"NumpadEnter":case"Enter":if(He(n)||ze(n)||(t=this.getSelected(),!t.idSet.size))return;if(console.info(t.idSet.size),e.altKey&&t.idSet.size==1)return this.emitGo("node",Array.from(t.idSet)[0]);await F.op_bath_browser(t.idSet,t.nodeLs);break;case"ArrowRight":case"ArrowLeft":case"ArrowUp":case"ArrowDown":return He(n)||ze(n)?void 0:this.arrowSelection(e)}}reloadOffset(e){if(this.reloadOffset_count>100)return;let t=!0;if(this.nodeList.value.forEach(n=>{n._dom||(t=!1)}),clearTimeout(this.reloadOffset_timer),!t){this.reloadOffset_timer=setTimeout(()=>{this.reloadOffset_count+=1,this.reloadOffset(e)},se.timeouts.offsetDebounce);return}this.nodeList.value.forEach(n=>{if(!n._dom)return;const s=n._dom;let r=0,c=0,p=0,u=0;r=fe.nodeOffsetX(s),c=fe.nodeOffsetY(s),p=r+s.offsetWidth,u=c+s.offsetHeight,n._offsets=[r,c,p,u]}),this.scrollEvt(e)}go(e){const t=Object.assign({id_dir:"",id_tag:""},e);this.router.push({path:"/",query:t})}scrollEvt(e){fe.debounce(()=>{this.saveScroll(),this.reloadLazyLoad()},se.timeouts.scrollEvt,"debounce_scroll_view")}saveScroll(){const e=this.route.query??{},t=[this.route.path,e.mode?e.mode:"",e.pid?e.pid:"",e.id?e.id:"",e.id?e.id:"",e.tag_id?e.tag_id:""].join(":"),n=[this.contentDOM.scrollTop,this.contentDOM.scrollLeft];!n[0]&&!n[1]||fe.debounce(()=>{kn("scroll_log",t,n)},se.timeouts.scrollSave,"debounce_scroll_save")}async reloadScroll(){const e=this.route.query??{},t=[this.route.path,e.mode?e.mode:"",e.pid?e.pid:"",e.id?e.id:"",e.id?e.id:"",e.tag_id?e.tag_id:""].join(":"),n=await En("scroll_log",t);n&&(this.contentDOM.scrollTop=n[0]??0,this.contentDOM.scrollLeft=n[1]??0)}reloadLazyLoad(){if(!this.contentDOM)return;const e=this.contentDOM,t=fe.nodeOffsetY(e),n=e.scrollTop+t,s=n+e.clientHeight+t;this.nodeList.value.forEach(r=>{let c=!0;if(!r._offsets||!r._offsets.length)return;let p=r._offsets;p[1]>s&&(c=!1),p[3]<n&&(c=!1),r._in_screen=c})}}class F{static async op_download(e){var n,s;let t=(s=(n=e.file_index)==null?void 0:n.raw)==null?void 0:s.path;t&&window.open(`${t}?filename=${e.title}`)}static async op_rename(e){if(e._renaming){const t=new FormData;t.set("id",`${e.id}`),t.set("title",e.title??""),t.set("description",e.description??""),await Y("file/mod",t),U&&U.emitGo("reload")}e._renaming=!e._renaming,setTimeout(()=>{let t=document.body.querySelector('[contenteditable="true"]');t&&t.focus()},50)}static async op_bath_rename(e,t){U&&U.modal.set({title:"bath rename",alpha:!1,key:"",single:!1,w:400,h:275,minW:400,minH:275,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"renameUtil",data:{node_list:t,callback:()=>{U&&U.getList()}}}]})}static async op_move(e){U&&U.modal.set({title:`locator | move ${e.title} to:`,alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async t=>{const n=new FormData;n.set("id_node",`${e.id}`),n.set("id_target",`${t.id}`),await Y("file/mov",n),U&&U.emitGo("reload")}}}]})}static async op_bath_move(e,t){U&&U.modal.set({title:`locator | move ${e.size} files to:`,alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async n=>{const s={id_list:Array.from(e).join(","),id_parent:`${n.id}`},r=await Y("file/bath_move",s);U&&U.getList()}}}]})}static async op_delete(e,t=!1){const n=new FormData;n.set("id",`${e.id}`);const s=await Y("file/delete",n);return console.info(U),U&&e.id&&U.deleteFromList([e.id]),s}static async op_bath_delete(e,t,n=!1,s){U&&U.modal.set({title:`confirm to ${n?"recover":"delete"} ${e.size} files`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:"conform to "+(n?"recover":"delete"),callback:{confirm:async r=>{const c=Array.from(e),p={id_list:c.join(",")},u=await Y("file/bath_delete",p);U&&U.deleteFromList(c),s&&s()}}})}static async op_delete_forever(e){const t=new FormData;t.set("id",`${e.id}`);const n=await Y("file/delete_forever",t);return U&&e.id&&U.deleteFromList([e.id]),n}static async op_bath_delete_forever(e,t){U&&U.modal.set({title:`confirm to delete ${e.size} files forever`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:"conform to delete forever",callback:{confirm:async n=>{const s=Array.from(e),r={id_list:s.join(",")},c=await Y("file/bath_delete_forever",r);U&&U.deleteFromList(s)}}})}static async op_toggle_favourite(e){const t=await Y("favourite_group/get",{}),n={};t&&t.forEach(s=>{s.auto||(n[s.id??0]=s.title??"")}),U&&U.modal.set({title:"select fav group:",alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"checkbox",label:"attach to",key:"target_group",value:e.list_fav,options:n}],callback:{submit:async function(s){const c=s.content.form[0].value.join(",");await Y("favourite/attach",{id_node:e.id,list_group:c}),location.reload()}}})}static async op_bath_favourite(e,t){const n=await Y("favourite_group/get",{}),s={};n&&n.forEach(r=>{r.auto||(s[r.id??0]=r.title??"")}),U&&U.modal.set({title:"select fav group:",alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"checkbox",label:"attach to:",key:"target_group",value:[],options:s}],callback:{submit:async function(r){const c=r.content.form[0].value.join(",");await Y("favourite/bath_attach",{node_id_list:Array.from(e),list_group:c})}}})}static async op_bath_browser(e,t){let n=Array.from(e),s={};s.with="crumb,file",n.length==1?(s.mode="directory",s.id_dir=`${t[0].type==="directory"?t[0].id:t[0].id_parent}`):(s.mode="id_iterate",s.keyword=n.join(",")),s.cascade_dir="0",is(s,n[0])}static async op_tag(e){if(e._tagging){const t=new Set;if(e.tag)for(let s=0;s<e.tag.length;s++)for(let r=0;r<e.tag[s].sub.length;r++){const c=e.tag[s].sub[r].id;c&&t.add(c)}const n=new FormData;n.set("id_node",`${e.id}`),n.set("tag_list",Array.from(t).join(",")),await Y("tag/attach",n)}e._tagging=!e._tagging}static async op_set_cover(e){const t=new FormData;return t.set("id",`${e.id}`),await Y("file/cover",t)}static async op_rebuild(e){const t=new FormData;return t.set("id_list",e.join(",")),await Y("file/rebuild",t)}static async op_rehash(e){const t=new FormData;return t.set("id_list",e.join(",")),await Y("file/rehash",t)}static async op_cascade_tag(e){const t=new FormData;return t.set("id_list",e.join(",")),await Y("file/cascade_tag",t)}static async op_rm_raw(e){const t=new FormData;return t.set("id_list",e.join(",")),await Y("file/rm_raw",t)}static async op_imp_tag_eh(e){const t=new FormData;return t.set("id_list",e.join(",")),await Y("setting/import_eht_tag",t)}static async op_rate(e,t){if(!U)return;let n=U.getSelected();t&&!n.idSet.size&&(n.idSet.add((t==null?void 0:t.id)??0),n.nodeLs.push(t)),n.nodeLs.forEach(r=>{r.rate=e});const s=new FormData;s.set("node_id_list",Array.from(n.idSet).join(",")),s.set("rate",`${e}`),await Y("rate/attach",s)}static async op_share(e){const t={title:"share file",alpha:!1,key:"",single:!1,w:400,h:120,minW:400,minH:120,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:'<a href="./share.html?id=#id#" target="_blank" style="text-decoration: underline">url generated<br> id: #id#</a>',callback:{submit:async n=>{}}};U==null||U.modal.set({title:"share file",alpha:!1,key:"",single:!1,w:400,h:160,minW:400,minH:160,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"radio",label:"duration",key:"status",value:"1",options:{1:"long",2:"1 day",3:"7 day",4:"30 day",5:"manual"},on_change:(n,s,r)=>{const c=new Date;switch(r.value){case"1":s.content.form[1].disabled=!0;break;case"2":s.content.form[1].disabled=!0,c.setDate(c.getDate()+1),s.content.form[1].value=c.toISOString().substring(0,16);break;case"3":s.content.form[1].disabled=!0,c.setDate(c.getDate()+7),s.content.form[1].value=c.toISOString().substring(0,16);break;case"4":s.content.form[1].disabled=!0,c.setDate(c.getDate()+30),s.content.form[1].value=c.toISOString().substring(0,16);break;case"5":s.content.form[1].disabled=!1,c.setDate(c.getDate()+30),s.content.form[1].value=c.toISOString().substring(0,16);break}}},{type:"datetime",label:"expire",key:"time_to",value:new Date().toISOString().substring(0,16),disabled:!0}],callback:{submit:async n=>{const s=new FormData;s.set("node_id_list",Array.from(e).join(",")),n.content.form[0].value=="1"?s.set("status","2"):(s.set("status","1"),s.set("time_to",n.content.form[1].value));const r=await Y("share/set",s);r&&(t.text&&(t.text=t.text.replace(/#id#/ig,`${r.id}`)),U==null||U.modal.set(t))}}})}}function At(a,e){const t=[];return e.forEach(n=>{var r;const s={id:n.id,id_parent:n.id_parent,path:"",url:"",size:0,type:n.type??""};if(s.path=[a??"",n.title??""].join("/"),n.type!=="directory"){const c=(r=n.file_index)==null?void 0:r.raw;if(!c)return;c.path&&(s.url=c.path+"?filename="+n.title),s.size=c.size??0}t.push(s)}),t}function is(a,e){if(!U)return;let t=de("browser_layout_w"),n=de("browser_layout_h");const s=window.innerWidth,r=window.innerHeight;s<t&&(t=0),r<n&&(n=0),U.modal.set({title:"file browser",alpha:!1,key:"",single:!1,w:t||400,h:n||400,minW:400>window.innerWidth?window.innerWidth*.9:400,minH:400>window.innerHeight?window.innerHeight*.9:400,allow_resize:!0,allow_move:!0,allow_fullscreen:!0,auto_focus:!1,component:[{componentName:"fileBrowser",data:{query:fe.copyObject(a),curId:e}}]})}function on(a,e){let t=["id","asc"];switch(e){default:case"id_asc":t=["id","asc"];break;case"id_desc":t=["id","desc"];break;case"name_asc":t=["title","asc"];break;case"name_desc":t=["title","desc"];break;case"crt_asc":t=["time_create","asc"];break;case"crt_desc":t=["time_create","desc"];break;case"upd_asc":t=["time_update","asc"];break;case"upd_desc":t=["time_update","desc"];break;case"rate_asc":t=["rate","asc"];break;case"rate_desc":t=["rate","desc"];break}for(let r=0;r<a.length;r++){const c=a[r];c._sort_index||(c._sort_index=c.node_path+"/"+c.title)}const n=t[1]==="desc",s=n?-1:1;return a.sort((r,c)=>{let p="",u="";switch(t[0]){default:p=r[t[0]],u=c[t[0]];break;case"title":return p=s*(r.type==="directory"?0:1)+(r._sort_index??""),u=s*(c.type==="directory"?0:1)+(c._sort_index??""),os({desc:n,insensitive:!0})(p,u)}return(p>u?1:-1)*s}),a}var Ye={},ye=ye||function(a,e){var t={},n=t.lib={},s=function(){},r=n.Base={extend:function(i){s.prototype=this;var y=new s;return i&&y.mixIn(i),y.hasOwnProperty("init")||(y.init=function(){y.$super.init.apply(this,arguments)}),y.init.prototype=y,y.$super=this,y},create:function(){var i=this.extend();return i.init.apply(i,arguments),i},init:function(){},mixIn:function(i){for(var y in i)i.hasOwnProperty(y)&&(this[y]=i[y]);i.hasOwnProperty("toString")&&(this.toString=i.toString)},clone:function(){return this.init.prototype.extend(this)}},c=n.WordArray=r.extend({init:function(i,y){i=this.words=i||[],this.sigBytes=y!=e?y:4*i.length},toString:function(i){return(i||u).stringify(this)},concat:function(i){var y=this.words,f=i.words,d=this.sigBytes;if(i=i.sigBytes,this.clamp(),d%4)for(var l=0;l<i;l++)y[d+l>>>2]|=(f[l>>>2]>>>24-8*(l%4)&255)<<24-8*((d+l)%4);else if(65535<f.length)for(l=0;l<i;l+=4)y[d+l>>>2]=f[l>>>2];else y.push.apply(y,f);return this.sigBytes+=i,this},clamp:function(){var i=this.words,y=this.sigBytes;i[y>>>2]&=4294967295<<32-8*(y%4),i.length=a.ceil(y/4)},clone:function(){var i=r.clone.call(this);return i.words=this.words.slice(0),i},random:function(i){for(var y=[],f=0;f<i;f+=4)y.push(4294967296*a.random()|0);return new c.init(y,i)}}),p=t.enc={},u=p.Hex={stringify:function(i){var y=i.words;i=i.sigBytes;for(var f=[],d=0;d<i;d++){var l=y[d>>>2]>>>24-8*(d%4)&255;f.push((l>>>4).toString(16)),f.push((l&15).toString(16))}return f.join("")},parse:function(i){for(var y=i.length,f=[],d=0;d<y;d+=2)f[d>>>3]|=parseInt(i.substr(d,2),16)<<24-4*(d%8);return new c.init(f,y/2)}},o=p.Latin1={stringify:function(i){var y=i.words;i=i.sigBytes;for(var f=[],d=0;d<i;d++)f.push(String.fromCharCode(y[d>>>2]>>>24-8*(d%4)&255));return f.join("")},parse:function(i){for(var y=i.length,f=[],d=0;d<y;d++)f[d>>>2]|=(i.charCodeAt(d)&255)<<24-8*(d%4);return new c.init(f,y)}},m=p.Utf8={stringify:function(i){try{return decodeURIComponent(escape(o.stringify(i)))}catch{throw Error("Malformed UTF-8 data")}},parse:function(i){return o.parse(unescape(encodeURIComponent(i)))}},_=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(i){typeof i=="string"&&(i=m.parse(i)),this._data.concat(i),this._nDataBytes+=i.sigBytes},_process:function(i){var y=this._data,f=y.words,d=y.sigBytes,l=this.blockSize,v=d/(4*l),v=i?a.ceil(v):a.max((v|0)-this._minBufferSize,0);if(i=v*l,d=a.min(4*i,d),i){for(var h=0;h<i;h+=l)this._doProcessBlock(f,h);h=f.splice(0,i),y.sigBytes-=d}return new c.init(h,d)},clone:function(){var i=r.clone.call(this);return i._data=this._data.clone(),i},_minBufferSize:0});n.Hasher=_.extend({cfg:r.extend(),init:function(i){this.cfg=this.cfg.extend(i),this.reset()},reset:function(){_.reset.call(this),this._doReset()},update:function(i){return this._append(i),this._process(),this},finalize:function(i){return i&&this._append(i),this._doFinalize()},blockSize:16,_createHelper:function(i){return function(y,f){return new i.init(f).finalize(y)}},_createHmacHelper:function(i){return function(y,f){return new g.HMAC.init(i,f).finalize(y)}}});var g=t.algo={};return t}(Math);(function(a){for(var e=ye,i=e.lib,t=i.WordArray,n=i.Hasher,i=e.algo,s=[],r=[],c=function(f){return 4294967296*(f-(f|0))|0},p=2,u=0;64>u;){var o;e:{o=p;for(var m=a.sqrt(o),_=2;_<=m;_++)if(!(o%_)){o=!1;break e}o=!0}o&&(8>u&&(s[u]=c(a.pow(p,.5))),r[u]=c(a.pow(p,1/3)),u++),p++}var g=[],i=i.SHA256=n.extend({_doReset:function(){this._hash=new t.init(s.slice(0))},_doProcessBlock:function(y,f){for(var d=this._hash.words,l=d[0],v=d[1],h=d[2],b=d[3],C=d[4],w=d[5],M=d[6],x=d[7],I=0;64>I;I++){if(16>I)g[I]=y[f+I]|0;else{var N=g[I-15],ne=g[I-2];g[I]=((N<<25|N>>>7)^(N<<14|N>>>18)^N>>>3)+g[I-7]+((ne<<15|ne>>>17)^(ne<<13|ne>>>19)^ne>>>10)+g[I-16]}N=x+((C<<26|C>>>6)^(C<<21|C>>>11)^(C<<7|C>>>25))+(C&w^~C&M)+r[I]+g[I],ne=((l<<30|l>>>2)^(l<<19|l>>>13)^(l<<10|l>>>22))+(l&v^l&h^v&h),x=M,M=w,w=C,C=b+N|0,b=h,h=v,v=l,l=N+ne|0}d[0]=d[0]+l|0,d[1]=d[1]+v|0,d[2]=d[2]+h|0,d[3]=d[3]+b|0,d[4]=d[4]+C|0,d[5]=d[5]+w|0,d[6]=d[6]+M|0,d[7]=d[7]+x|0},_doFinalize:function(){var y=this._data,f=y.words,d=8*this._nDataBytes,l=8*y.sigBytes;return f[l>>>5]|=128<<24-l%32,f[(l+64>>>9<<4)+14]=a.floor(d/4294967296),f[(l+64>>>9<<4)+15]=d,y.sigBytes=4*f.length,this._process(),this._hash},clone:function(){var y=n.clone.call(this);return y._hash=this._hash.clone(),y}});e.SHA256=n._createHelper(i),e.HmacSHA256=n._createHmacHelper(i)})(Math);(function(){var a=ye,e=a.enc.Utf8;a.algo.HMAC=a.lib.Base.extend({init:function(t,n){t=this._hasher=new t.init,typeof n=="string"&&(n=e.parse(n));var s=t.blockSize,r=4*s;n.sigBytes>r&&(n=t.finalize(n)),n.clamp();for(var c=this._oKey=n.clone(),p=this._iKey=n.clone(),u=c.words,o=p.words,m=0;m<s;m++)u[m]^=1549556828,o[m]^=909522486;c.sigBytes=p.sigBytes=r,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var n=this._hasher;return t=n.finalize(t),n.reset(),n.finalize(this._oKey.clone().concat(t))}})})();(function(){var a=ye,e=a.lib.WordArray;a.enc.Base64={stringify:function(t){var n=t.words,s=t.sigBytes,r=this._map;t.clamp(),t=[];for(var c=0;c<s;c+=3)for(var p=(n[c>>>2]>>>24-8*(c%4)&255)<<16|(n[c+1>>>2]>>>24-8*((c+1)%4)&255)<<8|n[c+2>>>2]>>>24-8*((c+2)%4)&255,u=0;4>u&&c+.75*u<s;u++)t.push(r.charAt(p>>>6*(3-u)&63));if(n=r.charAt(64))for(;t.length%4;)t.push(n);return t.join("")},parse:function(t){var n=t.length,s=this._map,r=s.charAt(64);r&&(r=t.indexOf(r),r!=-1&&(n=r));for(var r=[],c=0,p=0;p<n;p++)if(p%4){var u=s.indexOf(t.charAt(p-1))<<2*(p%4),o=s.indexOf(t.charAt(p))>>>6-2*(p%4);r[c>>>2]|=(u|o)<<24-8*(c%4),c++}return e.create(r,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(a){for(var e=ye,i=e.lib,t=i.WordArray,n=i.Hasher,i=e.algo,s=[],r=[],c=function(f){return 4294967296*(f-(f|0))|0},p=2,u=0;64>u;){var o;e:{o=p;for(var m=a.sqrt(o),_=2;_<=m;_++)if(!(o%_)){o=!1;break e}o=!0}o&&(8>u&&(s[u]=c(a.pow(p,.5))),r[u]=c(a.pow(p,1/3)),u++),p++}var g=[],i=i.SHA256=n.extend({_doReset:function(){this._hash=new t.init(s.slice(0))},_doProcessBlock:function(y,f){for(var d=this._hash.words,l=d[0],v=d[1],h=d[2],b=d[3],C=d[4],w=d[5],M=d[6],x=d[7],I=0;64>I;I++){if(16>I)g[I]=y[f+I]|0;else{var N=g[I-15],ne=g[I-2];g[I]=((N<<25|N>>>7)^(N<<14|N>>>18)^N>>>3)+g[I-7]+((ne<<15|ne>>>17)^(ne<<13|ne>>>19)^ne>>>10)+g[I-16]}N=x+((C<<26|C>>>6)^(C<<21|C>>>11)^(C<<7|C>>>25))+(C&w^~C&M)+r[I]+g[I],ne=((l<<30|l>>>2)^(l<<19|l>>>13)^(l<<10|l>>>22))+(l&v^l&h^v&h),x=M,M=w,w=C,C=b+N|0,b=h,h=v,v=l,l=N+ne|0}d[0]=d[0]+l|0,d[1]=d[1]+v|0,d[2]=d[2]+h|0,d[3]=d[3]+b|0,d[4]=d[4]+C|0,d[5]=d[5]+w|0,d[6]=d[6]+M|0,d[7]=d[7]+x|0},_doFinalize:function(){var y=this._data,f=y.words,d=8*this._nDataBytes,l=8*y.sigBytes;return f[l>>>5]|=128<<24-l%32,f[(l+64>>>9<<4)+14]=a.floor(d/4294967296),f[(l+64>>>9<<4)+15]=d,y.sigBytes=4*f.length,this._process(),this._hash},clone:function(){var y=n.clone.call(this);return y._hash=this._hash.clone(),y}});e.SHA256=n._createHelper(i),e.HmacSHA256=n._createHmacHelper(i)})(Math);Ye.enc={Base64:ye.enc.Base64,Utf8:ye.enc.Utf8,Latin1:ye.enc.Latin1};Ye.SHA256=ye.SHA256;Ye.HmacSHA256=ye.HmacSHA256;const ut=Ye,rs={alg:"HS256",typ:"JWT"};function rn(a){return ut.enc.Base64.stringify(a).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function ls(a,e,t={}){const n=Object.assign(rs,t);if(n.alg!=="HS256"&&n.typ!=="JWT")throw new Error("jwt-encode only support the HS256 algorithm and the JWT type of hash");const s=It(n),r=It(a);let c=`${s}.${r}`;return c=ut.HmacSHA256(c,e),c=rn(c),`${s}.${r}.${c}`}function It(a){const e=ut.enc.Utf8.parse(JSON.stringify(a));return rn(e)}var cs=ls;const us=xn(cs),ds={class:"modal_browser office"},fs={class:"base"},hs={class:"l"},ps={class:"r"},_s={class:"content"},ms=["id"],nt=100,vs=he({__name:"office",props:{extId:{},curIndex:{},isActive:{type:Boolean},file:{},dom:{}},setup(a){const e=a;""+e.extId,j(null);const t=je();Le(()=>{console.warn("mounted");const p=new URL(location.href);r(`${p.origin}/onlyoffice_server/web-apps/apps/api/documents/api.js`),setTimeout(()=>n(),nt)});function n(){if(!s)return setTimeout(()=>n(),nt);const p="modal_office_"+e.extId;if(!document.getElementById(p))return setTimeout(()=>n(),nt);const o=se.onlyOffice.jwtSecret,m=e.file,_=m.title.lastIndexOf("."),g=m.title.substring(_+1),i=c(g);if(!i)return;const y=new URL(location.href),f={document:{fileType:g,key:m.id.toString(16)+"_"+Math.floor(new Date().valueOf()).toString(),title:m.title,url:`${y.origin}${m.raw}?tosho_token=${t==null?void 0:t.token}`},documentType:i,editorConfig:{callbackUrl:`${y.origin}/api/onlyoffice/callback?id=${m.id}&tosho_token=${t==null?void 0:t.token}`},token:""};f.token=us(f,o),console.info(f),DocsAPI.DocEditor(p,f)}Ht(()=>e.file,async p=>{console.info("onMod props.curNode")}),$e(()=>{});let s=!1;function r(p){var u=document.createElement("script");u.type="text/javascript",u.src=p,u.onload=o=>{console.info(o),s=!0},document.body.appendChild(u)}function c(p){let u=!1;switch(p){default:break;case"doc":case"docm":case"docx":case"dot":case"dotm":case"dotx":case"epub":case"fb2":case"fodt":case"htm":case"html":case"mht":case"mhtml":case"odt":case"ott":case"rtf":case"stw":case"sxw":case"txt":case"wps":case"wpt":u="word";break;case"csv":case"et":case"ett":case"fods":case"ods":case"ots":case"sxc":case"xls":case"xlsb":case"xlsm":case"xlsx":case"xlt":case"xltm":case"xltx":u="cell";break;case"dps":case"dpt":case"fodp":case"odp":case"otp":case"pot":case"potm":case"potx":case"pps":case"ppsm":case"ppsx":case"ppt":case"pptm":case"pptx":case"sxi":u="slide";break}return u}return(p,u)=>(S(),D("div",ds,[P("div",fs,[P("div",hs,[Qe(p.$slots,"info")]),P("div",ps,[Qe(p.$slots,"btnContainer")])]),Qe(p.$slots,"navigator"),P("div",_s,[P("div",{id:"modal_office_"+p.extId},null,8,ms)])]))}});class ys{constructor(e){ee(this,"dom");ee(this,"pointerMap",new Map);ee(this,"callbacks",{move:null,end:null});this.dom=e,this.dom.addEventListener("pointerdown",this.onPointerDown.bind(this)),this.dom.addEventListener("pointermove",this.onPointerMove.bind(this)),this.dom.addEventListener("pointerup",this.onPointerUp.bind(this)),this.dom.addEventListener("pointercancel",this.onPointerUp.bind(this)),this.dom.addEventListener("pointerout",this.onPointerUp.bind(this))}onPointerDown(e){if(e.pointerType!=="touch"||this.pointerMap.get(e.pointerId))return;const n={plot_start:[e.clientX,e.clientY],plot_middle:[e.clientX,e.clientY],plot_current:[e.clientX,e.clientY],time_start:new Date().valueOf(),length:0,degree:0,speed:0};this.pointerMap.set(e.pointerId,n)}onPointerMove(e){if(e.pointerType!=="touch")return;const t=this.pointerMap.get(e.pointerId);if(!t)return;t.plot_current=[e.clientX,e.clientY],t.plot_middle=[(t.plot_start[0]+t.plot_current[0])/2,(t.plot_start[1]+t.plot_current[1])/2];let n={x:t.plot_current[0]-t.plot_start[0],y:t.plot_current[1]-t.plot_start[1],time:new Date().valueOf()-t.time_start};t.length=Math.sqrt(n.x*n.x+n.y*n.y),t.degree=180*Math.atan2(-1*n.y,n.x)/Math.PI,t.degree<0&&(t.degree=360+t.degree),t.speed=t.length/(n.time/1e3),this.callbacks.move&&this.callbacks.move(this.processGesture(),e)}onPointerUp(e){e.pointerType!=="touch"||!this.pointerMap.get(e.pointerId)||(this.pointerMap.size==1&&this.callbacks.end&&this.callbacks.end(this.processGesture(),e),this.pointerMap.delete(e.pointerId))}processGesture(){const e={plot_start:[0,0],plot_middle:[0,0],plot_current:[0,0],time_start:0,length:0,degree:0,speed:0,pointerMap:this.pointerMap};if(!this.pointerMap.size)return e;this.pointerMap.forEach(n=>{e.plot_start[0]+=n.plot_start[0],e.plot_start[1]+=n.plot_start[1],e.plot_current[0]+=n.plot_current[0],e.plot_current[1]+=n.plot_current[1],e.time_start=Math.min(n.time_start)}),e.plot_start[0]/=this.pointerMap.size,e.plot_start[1]/=this.pointerMap.size,e.plot_current[0]/=this.pointerMap.size,e.plot_current[1]/=this.pointerMap.size,e.plot_middle=[(e.plot_start[0]+e.plot_current[0])/2,(e.plot_start[1]+e.plot_current[1])/2];let t={x:e.plot_current[0]-e.plot_start[0],y:e.plot_current[1]-e.plot_start[1],time:new Date().valueOf()-e.time_start};return e.length=Math.sqrt(t.x*t.x+t.y*t.y),e.degree=180*Math.atan2(-1*t.y,t.x)/Math.PI,e.degree<0&&(e.degree=360+e.degree),e.speed=e.length/(t.time/1e3),e}onMove(e){this.callbacks.move=e}onEnd(e){this.callbacks.end=e}reset(){this.pointerMap.forEach(e=>{e.plot_start=e.plot_current,e.plot_middle=e.plot_current,e.length=0,e.time_start=new Date().valueOf(),e.degree=0,e.speed=0})}destory(){this.dom.removeEventListener("pointerup",this.onPointerUp.bind(this)),this.dom.removeEventListener("pointercancel",this.onPointerUp.bind(this)),this.dom.removeEventListener("pointerout",this.onPointerUp.bind(this)),this.dom.removeEventListener("pointermove",this.onPointerMove.bind(this)),this.dom.removeEventListener("pointerdown",this.onPointerDown.bind(this))}}const gs={key:0},ws={class:"preLine"},bs={class:"btnContainer"},ks=["value"],Es=["value","innerHTML"],xs=["value"],Ss=["value"],Ds=he({__name:"browser",props:{data:{},modalData:{}},setup(a){const e=a,t=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1,n={audio:Sn,video:Dn,image:Ln,pdf:$n,text:Rn,office:pt,base:pt};se.onlyOffice.enabled&&(n.office=vs),console.info("regComponentLs",n);let s=!1;function r(){if(s&&!e.modalData.layout.fullscreen){let L=de("browser_layout_w"),E=de("browser_layout_h");e.modalData.layout.w=L,e.modalData.layout.h=E,e.modalData.layout.x=(window.innerWidth-L)/2,e.modalData.layout.y=(window.innerHeight-E)/2}else e.modalData.layout.fullscreen||(we("browser_layout_w",e.modalData.layout.w),we("browser_layout_h",e.modalData.layout.h));s=e.modalData.layout.fullscreen,v.value={w:e.modalData.layout.w,h:e.modalData.layout.h}}const c=j(de("browser_play_mode")??"loop");function p(){let L=se.playMode.indexOf(c.value);L+=1,L>se.playMode.length-1&&(L=0),c.value=se.playMode[L],we("browser_play_mode",c.value)}const u=j(de("browser_show_detail")??!1);function o(){u.value=!u.value,we("browser_show_detail",u.value)}let m;Le(()=>{document.addEventListener("keydown",ne),document.addEventListener(`modal_resizing_${e.modalData.nid}`,r),v.value={w:e.modalData.layout.w,h:e.modalData.layout.h},setTimeout(()=>{document.activeElement&&document.activeElement.blur()},100);const L=document.querySelector(`[data-ref-id='${e.modalData.nid}']`);L&&(m=new ys(L),m.onMove((E,H)=>{let B=20;E.length>window.innerWidth*.2&&((E.degree<B||E.degree>360-B)&&(w(f.value,-1),m.reset()),E.degree>180-B&&E.degree<180+B&&(w(f.value,1),m.reset()))}))}),$e(()=>{document.removeEventListener("keydown",ne),document.removeEventListener(`modal_resizing_${e.modalData.nid}`,r),m&&m.destory()});const _=j([]),g=j([]),i=j([]);let y=0;const f=j(0),d=j(null),l=j({id:0,title:"",cover:"",preview:"",normal:"",raw:"",sameName:[]}),v=j({w:0,h:0});async function h(L){const E=await Y("file/get",{node_type:"directory",id_dir:`${L}`,with:"none"});return E||{path:[],list:[]}}C();function b(){let L=[];return y=0,g.value.forEach(E=>{if(!x(E))return;const H=E.rate?E.rate+2:2;L.push(Object.assign(E,{_weight_stack:y})),y+=H}),L=pe(L,J.value),L}async function C(L={}){var ie;L&&(e.data.query=Object.assign(e.data.query,L));let E=await Y("file/get",e.data.query);if(!E||!E.list.length)return!1;let H=[];if(E.list.forEach(k=>{k.is_file&&H.push(k)}),E.list=H,!E.list.length){if(parseInt(((ie=e.data.query)==null?void 0:ie.cascade_dir)??""))return!1;const k=fe.copyObject(e.data.query);if(k.cascade_dir="1",E=await Y("file/get",k),!E||!E.list.length)return!1;H=[],E.list.forEach($=>{$.is_file&&H.push($)}),E.list=H}if(!E.list.length)return!1;let B=0,A=null;for(let k=0;k<E.list.length;k++)if(E.list[k].id===e.data.curId){B=k,A=E.list[k];break}console.info(B,A),_.value=E.path,g.value=E.list;let Q=b();return Q.length?(i.value=pe(Q,J.value),A||(A=i.value[0]),f.value=le(i.value,A),console.info(f.value),I(),!0):!1}function w(L,E,H=0){let B=i.value.length;if(B<=1)return;let A=0;if(c.value==="shuffle"){let Q=Math.random()*y;E=0;for(let ie=0;ie<B&&(E=ie,!(i.value[ie]._weight_stack>Q));ie++);A=E}else A=L+E;for(;A<0;)A+=B;for(;A>B-1;)A-=B;H||(H=0),H+=1,!(H>B)&&(f.value=A,I())}function M(L){let E=L-f.value;w(f.value,E)}function x(L){const E=parseInt(_e.value)??0;if((L.rate??0)<E)return!1;switch(be.value){case"any":case"file":return se.ignoreFileType.indexOf(L.type??"directory")===-1;default:return be.value==L.type}}function I(){var B,A,Q,ie;if(!i.value.length)return;const L=i.value[f.value];if(d.value=L,!L.file_index.preview&&["audio","video"].indexOf(L.type)!==-1){let k=!1;g.value.forEach($=>{if($.id_parent!==L.id_parent||k)return;let R=!1;if(se.coverKeyword.forEach(O=>{se.imgKeyword.forEach(W=>{L.title.toLowerCase().indexOf(O)!==-1&&L.title.toLowerCase().indexOf(W)!==-1&&(R=!0)})}),R){k=!0;let O;O||(O=L.file_index.preview),O||(O=L.file_index.normal),O||(O=L.file_index.raw),L.file_index.preview=O}})}const E={id:L.id,title:L.title,cover:((B=L.file_index.cover)==null?void 0:B.path)??"",preview:((A=L.file_index.preview)==null?void 0:A.path)??"",normal:((Q=L.file_index.normal)==null?void 0:Q.path)??"",raw:((ie=L.file_index.raw)==null?void 0:ie.path)??"",sameName:[]};let H=E.title.lastIndexOf(".");if(H!==-1){let k=E.title.substring(0,H)??"";k&&g.value.forEach($=>{var O,W,X,z,V,T,ae,Z;if($.id==E.id||((O=$.title)==null?void 0:O.indexOf(k))!==0)return;let R=(W=$.title)==null?void 0:W.substring(k.length);E.sameName.push({title:R,type:$.type??"",raw:((z=(X=$.file_index)==null?void 0:X.raw)==null?void 0:z.path)??"",normal:((T=(V=$.file_index)==null?void 0:V.normal)==null?void 0:T.path)??"",preview:((Z=(ae=$.file_index)==null?void 0:ae.preview)==null?void 0:Z.path)??""})})}l.value=E,N()}function N(){d.value&&(e.modalData.base.title=f.value+1+"/"+i.value.length+" "+(d.value.title??""))}async function ne(L){if(!d.value||He(L.target)||!e.modalData.layout.active)return;let E,H,B,A,Q,ie;switch(L.key){case"ArrowLeft":if(L.preventDefault(),L.stopPropagation(),["audio","video"].indexOf(d.value.type??"")!==-1)return;w(f.value,-1);break;case"ArrowRight":if(L.preventDefault(),L.stopPropagation(),["audio","video"].indexOf(d.value.type??"")!==-1)return;w(f.value,1);break;case"a":case"PageUp":L.preventDefault(),L.stopPropagation(),w(f.value,-1);break;case"d":case"PageDown":L.preventDefault(),L.stopPropagation(),w(f.value,1);break;case"w":case"[":switch(e.data.query.mode){default:const $=_.value.length?_.value[_.value.length-1]:{id:0,id_parent:0,type:"directory",title:"root",description:"",status:1,building:0};if(E=await h($.id_parent),H=pe(E.list,J.value),B=H.length,B<2)return;A=0,H.forEach((T,ae)=>{T.id==e.data.query.id_dir&&(A=ae)}),ie=H.length;do{for(A-=1;A<0;)A+=B;for(;A>B-1;)A-=B;if(Q=H[A],e.data.query.id_dir=`${Q.id}`,await C())break}while(--ie>0);break;case"id_iterate":if(!e.data.query.keyword)break;const R=e.data.query.keyword.split(","),O=[];R.forEach(T=>O.push(parseInt(T)));let W=null;if(d.value.crumb_node)for(let T=0;T<d.value.crumb_node.length;T++){const ae=d.value.crumb_node[T];if(O.indexOf(ae.id)!==-1){W=ae.id;break}}if(!W)break;const X=O.indexOf(W);B=O.length;let z=X-1;for(;z<0;)z+=B;for(;z>B-1;)z-=B;const V=O[z];for(let T=0;T<i.value.length;T++){const ae=i.value[T];for(let Z=0;Z<ae.crumb_node.length;Z++)if(ae.crumb_node[Z].id===V)return w(T,0)}}break;case"s":case"]":switch(e.data.query.mode){default:const $=_.value.length?_.value[_.value.length-1]:{id:0,id_parent:0,type:"directory",title:"root",description:"",status:1,building:0};if(E=await h($.id_parent),H=pe(E.list,J.value),B=H.length,B<2)return;A=0,H.forEach((T,ae)=>{T.id==e.data.query.id_dir&&(A=ae)}),ie=H.length;do{for(A+=1;A<0;)A+=B;for(;A>B-1;)A-=B;if(Q=H[A],e.data.query.id_dir=`${Q.id}`,await C())break}while(--ie>0);break;case"id_iterate":if(!e.data.query.keyword)break;const R=e.data.query.keyword.split(","),O=[];R.forEach(T=>O.push(parseInt(T)));let W=null;for(let T=0;T<d.value.crumb_node.length;T++){const ae=d.value.crumb_node[T];if(O.indexOf(ae.id)!==-1){W=ae.id;break}}if(!W)break;const X=O.indexOf(W);B=O.length;let z=X+1;for(;z<0;)z+=B;for(;z>B-1;)z-=B;const V=O[z];for(let T=0;T<i.value.length;T++){const ae=i.value[T];for(let Z=0;Z<ae.crumb_node.length;Z++)if(ae.crumb_node[Z].id===V)return w(T,0)}break}break;case"NumpadEnter":case"Enter":break;case"Delete":L.preventDefault(),L.stopPropagation();const k=new Set;d.value&&d.value.id&&k.add(d.value.id),await F.op_bath_delete(k,[],!1,()=>{w(f.value,1)});break}}function le(L,E){let H=0;return L.forEach((B,A)=>{B.id===E.id&&(H=A)}),H}const J=j(de("browser_list_sort")??"name_asc");function Re(L){var H;if(!d.value)return;console.info("setSort",J.value,L),(H=L.target)==null||H.blur();const E=i.value;i.value=[],pe(E,J.value),i.value=E,f.value=le(E,d.value),N()}function pe(L,E){return L=on(L,E),f.value=le(L,d.value??{}),we("browser_list_sort",J.value),L}const be=j(de("browser_list_filter")??"any");function Oe(L){we("browser_list_filter",L);let E=i.value[f.value],H=b();i.value=pe(H,J.value),f.value=le(i.value,E),console.info(f.value),I()}const _e=j("0");function Fe(L){let E=i.value[f.value],H=b();i.value=pe(H,J.value),f.value=le(i.value,E),console.info(f.value),I()}return(L,E)=>d.value?(S(),zt(Nt(n[d.value.type]?n[d.value.type]:n.base),{key:0,extId:e.modalData.nid,isActive:e.modalData.layout.active,curIndex:f.value,file:l.value,dom:v.value,onNav:M},{info:Je(()=>{var H,B;return[P("div",{class:ue({info:!0,detail:u.value})},[u.value?(S(),D(q,{key:0},[P("p",null,oe(d.value.title)+" ("+oe(K(fe).kmgt(((B=(H=d.value.file_index)==null?void 0:H.raw)==null?void 0:B.size)??0,2))+") ",1),d.value.crumb_node?(S(),D("p",gs,[E[11]||(E[11]=ht("Dir : ")),(S(!0),D(q,null,re(d.value.crumb_node,A=>(S(),D(q,null,[ht("/"+oe(A.title),1)],64))),256))])):te("",!0),P("p",ws,oe(d.value.description),1)],64)):te("",!0)],2)]}),btnContainer:Je(()=>{var H,B;return[P("div",bs,[u.value?(S(),D(q,{key:0},[t?ce((S(),D("select",{key:0,"onUpdate:modelValue":E[0]||(E[0]=A=>_e.value=A),onChange:E[1]||(E[1]=A=>Fe(_e.value))},[(S(!0),D(q,null,re(K(se).rateMobile,(A,Q)=>(S(),D("option",{value:Q,key:"BROWSER_RATE_"+L.modalData.nid+"_"+Q},oe(A),9,ks))),128))],544)),[[Ne,_e.value]]):ce((S(),D("select",{key:1,class:"sysIcon","onUpdate:modelValue":E[2]||(E[2]=A=>_e.value=A),onChange:E[3]||(E[3]=A=>Fe(_e.value))},[(S(!0),D(q,null,re(K(se).rate,(A,Q)=>(S(),D("option",{class:"sysIcon_A sysIcon",value:Q,innerHTML:A,key:"BROWSER_RATE_"+L.modalData.nid+"_"+Q},null,8,Es))),128))],544)),[[Ne,_e.value]]),ce(P("select",{"onUpdate:modelValue":E[4]||(E[4]=A=>be.value=A),onChange:E[5]||(E[5]=A=>Oe(be.value))},[(S(!0),D(q,null,re(K(se).fileType,(A,Q)=>(S(),D("option",{value:A,key:"BROWSER_TYPE_"+L.modalData.nid+"_"+Q},oe(A),9,xs))),128))],544),[[Ne,be.value]]),E[12]||(E[12]=P("br",null,null,-1))],64)):te("",!0),ce(P("select",{"onUpdate:modelValue":E[6]||(E[6]=A=>J.value=A),onChange:E[7]||(E[7]=A=>Re(A))},[(S(!0),D(q,null,re(K(se).sort,(A,Q)=>(S(),D("option",{value:Q,key:"BROWSER_SORT_"+L.modalData.nid+"_"+Q},oe(A),9,Ss))),128))],544),[[Ne,J.value]]),P("button",{class:ue(["sysIcon",`sysIcon_player_${c.value}`]),onClick:p},null,2),P("button",{class:ue(["sysIcon","sysIcon_info-cirlce-o"]),onClick:o}),(B=(H=d.value.file_index)==null?void 0:H.raw)!=null&&B.path?(S(),D("button",{key:1,class:ue(["sysIcon","sysIcon_download"]),onClick:E[8]||(E[8]=A=>K(F).op_download(d.value))})):te("",!0)])]}),navigator:Je(()=>[P("div",{class:ue({pagination:1,isMobile:t})},[P("div",{class:"left",onClick:E[9]||(E[9]=H=>w(f.value,-1))},E[13]||(E[13]=[P("span",{class:"sysIcon sysIcon_arrowleft"},null,-1)])),P("div",{class:"right",onClick:E[10]||(E[10]=H=>w(f.value,1))},E[14]||(E[14]=[P("span",{class:"sysIcon sysIcon_arrowright"},null,-1)]))],2)]),_:1},40,["extId","isActive","curIndex","file","dom"])):te("",!0)}}),Ls={class:"modal_locator"},$s={class:"locator_list"},Rs=["onClick"],Os={class:"type"},Cs={class:"tree"},Ps={class:"title"},Ms=he({__name:"locator",props:{data:{},modalData:{}},setup(a){const e=j(null);let t={mode:"directory",id_dir:"",keyword:"",id_tag:"",cascade_dir:"1",node_type:"directory",with:"crumb",limit:"20"};const n=a,s=j([]);Le(()=>{var o;(o=e.value)==null||o.focus()}),$e(()=>{});async function r(){const o=await Y("file/get",t);!o||!o.list||(t.keyword&&"root".indexOf(t.keyword)!==-1&&o.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),s.value=o.list,s.value.length&&(s.value[0]._sel=!0,n.modalData.layout.h<220&&(n.modalData.layout.h=220)))}async function c(o){console.info(o),!await u(o)&&fe.debounce(()=>{var g;let _=(g=e.value)==null?void 0:g.value;if(!_||!_.length){s.value=[];return}console.info(_),console.info(n.modalData),t.keyword=_,r()},200,"locator")}async function p(o){if(console.info(o),!await n.data.call(o))return Bt(n.modalData.nid)}async function u(o){let m,_,g=!1;switch(o.code){case"ArrowDown":if(g=!0,o.stopPropagation(),o.preventDefault(),!s.value.length)break;for(m=-1,s.value.forEach((y,f)=>{y._sel&&(m=f)}),_=m+1;_<0;)_+=s.value.length;for(;_>=s.value.length;)_-=s.value.length;s.value.forEach((y,f)=>{y._sel=f==_});break;case"ArrowUp":if(g=!0,o.stopPropagation(),o.preventDefault(),!s.value.length)break;for(m=0,s.value.forEach((y,f)=>{y._sel&&(m=f)}),_=m-1;_<0;)_+=s.value.length;for(;_>=s.value.length;)_-=s.value.length;s.value.forEach((y,f)=>{y._sel=f==_});break;case"NumpadEnter":case"Enter":if(g=!0,o.stopPropagation(),o.preventDefault(),!s.value.length||(m=-1,s.value.forEach((y,f)=>{y._sel&&(m=f)}),m==-1))break;const i=s.value[m];p(i);break}return g}return(o,m)=>(S(),D("div",Ls,[P("input",{type:"text",class:"locator_input",placeholder:"type title/desc here ...",ref_key:"locatorInput",ref:e,onKeydown:c},null,544),P("div",$s,[(S(!0),D(q,null,re(s.value,_=>(S(),D("div",{onClick:g=>p(_),class:ue({active:_._sel})},[P("p",Os,oe(_.type),1),P("p",Cs,[P("span",Ps,oe(_.title),1),_.crumb_node?(S(!0),D(q,{key:0},re(_.crumb_node,g=>(S(),D("span",null,oe(g.title),1))),256)):te("",!0)])],10,Rs))),256))])]))}}),As={class:"upload_list"},Is={class:"title"},Ts={class:"meta"},Hs={key:0},zs={key:1},Ns=["onClick"],Bs={class:"upload_menu"},Us={key:1},Vs=he({__name:"uploader",props:{data:{},modalData:{}},setup(a){const e=a,t=j([]),n=new Map;Le(()=>{}),$e(()=>{});function s(f){console.info("onSelectFile",f);const d=document.createElement("input");d.type="file",d.setAttribute("multiple",!0),d.onchange=l=>{var v;if((v=d.files)!=null&&v.length)for(let h=0;h<d.files.length;h++){const b=d.files[h];t.value.push({name:"/"+b.name,size:b.size,file:b,isDir:!1,status:"waiting",start:0,loaded:0})}},d.click()}function r(f){var d,l,v;if(console.debug("onDrop",f.type,(d=f.dataTransfer)==null?void 0:d.files,f),f.preventDefault(),f.stopPropagation(),!(!f.dataTransfer||!f.dataTransfer.files.length)){for(let h=0;h<((l=f.dataTransfer)==null?void 0:l.files.length);h++){const b=(v=f.dataTransfer)==null?void 0:v.items[h],C=b.webkitGetAsEntry();if(C.isFile){const w=b.getAsFile();t.value.push({name:C.fullPath,size:w.size,file:w,isDir:!1,status:"waiting",start:0,loaded:0})}else c(C).then(w=>{w.forEach(M=>t.value.push(M))})}console.info(t.value)}}async function c(f){const d=[];d.push({name:f.fullPath,size:0,file:null,isDir:!0,status:"waiting",start:0,loaded:0});const l=f.createReader(),v=await u(l);for(let h=0;h<v.length;h++){const b=v[h];if(b.isFile){const C=await p(b);d.push({name:b.fullPath,size:C.size,file:C,isDir:!1,status:"waiting",start:0,loaded:0})}b.isDirectory&&(await c(b)).forEach(w=>d.push(w))}return d}function p(f){return new Promise(d=>{f.file(l=>d(l))})}function u(f){return new Promise(d=>{f.readEntries(l=>{d(l)})})}function o(f){f.stopPropagation(),f.preventDefault()}let m=j(!1);async function _(){if(t.value.length){m.value=!0;for(let f=0;f<t.value.length;f++)t.value[f].status==="waiting"&&await g(t.value[f]);m.value=!1,e.data.emitGo("reload")}}async function g(f){let d=null,[l,v,h]=i(f.name);if(f.isDir){const b=new FormData;b.set("pid",l),b.set("title",h),f.status="uploading",d=await Y("file/mkdir",b),n.set(v+h+"/",d.id)}else{const b=new FormData;b.set("pid",l),b.set("file",f.file),f.status="uploading",d=await Y("file/upd",b,{upload:C=>{f.loaded=C.loaded}})}return f.status="complete",d}function i(f){const d=f.replace(/[\\/]+$/i).split(/[\\/]/i),l=d.pop();if(!d.length)return[e.data.pid,"/",l];let v="";for(let b=0;b<d.length;b++)v+=d[b]+"/";return v=="/"?[e.data.pid,v,l]:[n.get(v),v,l]}function y(f){t.value.splice(f,1)}return(f,d)=>(S(),D("div",{class:"modal_uploader",onDrop:r,onDragover:o},[P("div",As,[(S(!0),D(q,null,re(t.value,(l,v)=>(S(),D("div",{key:`file_upload_${v}`},[P("div",Is,oe(l.name),1),P("div",Ts,[l.status==="uploading"?(S(),D("span",Hs,oe(Math.round(100*l.loaded/l.size))+" % ",1)):(S(),D("span",zs,oe(l.status),1)),P("span",null,oe(K(fe).kmgt(l.size)),1),l.status==="waiting"?(S(),D("span",{key:2,onClick:h=>y(v),class:"pointer"},"X",8,Ns)):te("",!0)])]))),128)),P("div",{onClick:s},"drag / drop files here...")]),P("div",Bs,[K(m)?(S(),D("button",Us,"uploading")):(S(),D("button",{key:0,onClick:_},"upload"))])],32))}}),Ws={class:"modal_rename_util"},js={class:"mode_selector"},Fs=["id","name"],qs=["for"],Gs=["id","name"],Ks=["for"],Ys=he({__name:"renameUtil",props:{data:{},modalData:{}},setup(a){j(null);const e=a;let t=j("pattern"),n=j("{index}_{filename}"),s=j("");Le(()=>{const p=[];e.data.node_list.forEach(u=>{p.push((u==null?void 0:u.title)??"")}),s.value=p.join(`\r
`),console.info(s)}),$e(()=>{});function r(p){let u=p.length.toString().length+1,o=0,m="",_=n.value.match(/\{index:(\d+)}/);_&&(o=parseInt(_[1]),m=_[0]);const g=new Map;p.forEach((y,f)=>{const d=y.crumb_node?y.crumb_node[y.crumb_node.length-1]:null,l=d?d.title:"";let v=new Map;v.set("{filename}",y.title??""),v.set("{index}",fe.prefix(f+1,u,"0")),v.set("{directory}",l??""),v.set(`{index:${m}}`,fe.prefix(f+1,o,"0"));let h=n.value;v.forEach((b,C)=>{h=h.replace(C,b)}),g.set(y.id??0,h)});const i=[];return g.forEach((y,f)=>{i.push({id:f,title:y})}),i}async function c(){let p=[];switch(t.value){default:case"pattern":p=r(e.data.node_list);break;case"bath":const m=s.value.split(/[\r\n]+/);p=[],e.data.node_list.forEach((_,g)=>{m[g]&&m[g].trim().length&&p.push({id:_.id??0,title:m[g].trim()})});break}const u={list:JSON.stringify(p)},o=await Y("file/bath_rename",u);return console.info(o),e.data.callback(p),Bt(e.modalData.nid)}return(p,u)=>(S(),D("div",Ws,[P("div",js,[ce(P("input",{id:`P_${e.modalData.nid}_MODE_PATTERN`,name:`P_${e.modalData.nid}_MODE`,value:"pattern",type:"radio","onUpdate:modelValue":u[0]||(u[0]=o=>qe(t)?t.value=o:t=o)},null,8,Fs),[[at,K(t)]]),P("label",{for:`P_${e.modalData.nid}_MODE_PATTERN`},"pattern",8,qs),ce(P("input",{id:`P_${e.modalData.nid}_MODE_BATH`,name:`P_${e.modalData.nid}_MODE`,value:"bath",type:"radio","onUpdate:modelValue":u[1]||(u[1]=o=>qe(t)?t.value=o:t=o)},null,8,Gs),[[at,K(t)]]),P("label",{for:`P_${e.modalData.nid}_MODE_BATH`},"bath",8,Ks)]),K(t)=="pattern"?(S(),D(q,{key:0},[u[5]||(u[5]=Ut("<p>rename pattern:</p><table><tbody><tr><td>code</td><td>description</td></tr><tr><td>{filename}</td><td>file name</td></tr><tr><td>{index}</td><td>index by sort, prefix by max len+1</td></tr><tr><td>{index:n}</td><td>index by sort, prefix len by [n]</td></tr><tr><td>{directory}</td><td>parent directory name</td></tr></tbody></table>",2)),P("label",null,[u[4]||(u[4]=P("span",null,"pattern",-1)),ce(P("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=o=>qe(n)?n.value=o:n=o)},null,512),[[Me,K(n)]])])],64)):te("",!0),K(t)=="bath"?(S(),D(q,{key:1},[u[6]||(u[6]=P("p",null,"rename bath:",-1)),ce(P("textarea",{"onUpdate:modelValue":u[3]||(u[3]=o=>qe(s)?s.value=o:s=o)},null,512),[[Me,K(s)]])],64)):te("",!0),P("label",{class:"confirm"},[P("button",{onClick:c},"submit")])]))}}),Xs={class:"fr_popup"},Qs=["data-ref-id","onClick"],Js=["onPointerdown","onDblclick"],Zs={class:"modal_title"},eo={class:"modal_menu"},to=["onClick"],no=["onClick"],ao=["onClick"],so={class:"modal_content"},oo=["innerHTML"],io={key:1,class:"modal_content_form"},ro={key:0},lo=["onUpdate:modelValue","onChange","disabled"],co=["onClick","disabled"],uo={key:0},fo=["onUpdate:modelValue","onChange","disabled"],ho=["onUpdate:modelValue","onChange","disabled"],po=["onUpdate:modelValue","onChange","disabled"],_o=["id","name","value","onUpdate:modelValue","onChange","disabled"],mo=["for"],vo=["id","name","value","onUpdate:modelValue","onChange","disabled"],yo=["for"],go=["onUpdate:modelValue","multiple","onChange","disabled"],wo=["value"],bo={key:2,class:"modal_content_callback"},ko=["onClick"],Eo=["onPointerdown"],xe=20,xo=he({__name:"Popup",setup(a){const e={fileBrowser:Ds,uploader:Vs,locator:Ms,renameUtil:Ys},t=new Date().valueOf(),n=j(new Map);function s(l){const v=Math.floor((new Date().valueOf()-t)/100),h=window.innerWidth,b=window.innerHeight,C=(v+Math.random()).toString(32),w={nid:C,base:{title:l.title??"",alpha:l.alpha??!1,key:l.key??"",single:l.single??!1},layout:{w:0,h:0,x:0,y:0,minW:0,minH:0,allow_resize:!1,allow_move:!1,allow_escape:!1,allow_fullscreen:!1,auto_focus:!1,active:!1,index:0,fullscreen:!1},content:{text:j(""),form:[],component:[]},callback:[],closed:!1,event:{resize:new Event("modal_resizing_"+C)}};console.info(v,w.nid);const M={};if(M.w=l.w??400,M.h=l.h??160,M.x=(h-M.w)/2,M.y=(b-M.h)/2,M.minW=l.minW??400,M.minH=l.minH??160,M.allow_resize=l.allow_resize??!0,M.allow_move=l.allow_move??!0,M.allow_escape=l.allow_escape??!0,M.allow_fullscreen=l.allow_fullscreen??!1,M.auto_focus=l.auto_focus??!0,M.active=!1,M.index=v,M.fullscreen=l.fullscreen??!1,Object.assign(w.layout,M),l.text&&(typeof l.text=="string"?w.content.text.value=l.text:w.content.text=l.text),l.form&&(Array.isArray(l.form)?w.content.form.push(...l.form):w.content.form.push(l.form),w.content.form.forEach(x=>{if(x.value=x.value??null,x.options=x.options??null,x.default=x.default??null,x.multiple=!!x.multiple,x.disabled=!!x.disabled,x.options&&Array.isArray(x.options)){let I={};x.options.forEach(N=>{I[N]=N}),x.options=I}x.on_change||(x.on_change=()=>{})})),l.component&&(Array.isArray(l.component)?l.component.forEach(x=>{let I;typeof x=="string"?I={key:"",componentName:x,data:{}}:I=Object.assign({key:"",componentName:null,data:{}},x),w.content.component.push(I)}):typeof l.component=="string"?w.content.component.push({key:"",componentName:l.component,data:{}}):w.content.component.push(Object.assign({key:"",componentName:null,data:{}},l.component))),l.callback){if(Array.isArray(l.callback))l.callback.forEach((x,I)=>{let N;typeof x=="function"?N={key:"",name:"",func:x}:N=Object.assign({key:"",name:"",func:null},x),w.callback.push(N)});else if(typeof l.callback=="function")w.callback.push({key:"",name:"",func:l.callback});else if(l.callback.func)w.callback.push(Object.assign({key:"",name:"",func:null},l.callback));else for(const x in l.callback){if(!Object.prototype.hasOwnProperty.call(l.callback,x))continue;const I=l.callback[x];w.callback.push(Object.assign({key:x,name:x,func:I}))}w.callback.forEach((x,I)=>{if(x.name&&!x.key)x.key=x.name;else if(!x.name&&x.key)x.name=x.key;else if(!x.name&&!x.key){let N="button";w.callback.length>1&&(N+=" "+I),x.name=N,x.key=N}})}return console.debug(w),w}window.addEventListener("resize",l=>{n.value.forEach(v=>{if(v.layout.fullscreen){const h={x:xe,y:xe,w:window.innerWidth-xe*2,h:window.innerHeight-xe*2};Object.assign(v.layout,h),document.dispatchEvent(v.event.resize)}})}),_t("set",l=>{let v=null,h=null;return l.single&&n.value.forEach((b,C,w)=>{b.base.key==l.key&&(v=C,h=b)}),v?setTimeout(()=>{v&&r(v)}):(h=s(l),n.value.set(h.nid,h),setTimeout(()=>{h&&r(h.nid)})),h}),_t("close",l=>u(l)),document.body.addEventListener("click",l=>{let v=l.target;ze(v)||r("")});function r(l){const v=Math.floor((new Date().valueOf()-t)/100);n.value.forEach(h=>{if(h.nid===l){h.layout.index=v;let b=!h.layout.active;h.layout.active=!0,h.layout.auto_focus&&b&&setTimeout(()=>{const C=document.querySelector(`.modal_dom[data-ref-id="${h.nid}"] input,.modal_dom[data-ref-id="${h.nid}"] button,.modal_dom[data-ref-id="${h.nid}"] textarea`);C&&C.focus()},100)}else h.layout.active=!1})}function c(l){const v=n.value.get(l);if(!v)return;const h={x:xe,y:xe,w:window.innerWidth-xe*2,h:window.innerHeight-xe*2,fullscreen:!0};Object.assign(v.layout,h),document.dispatchEvent(v.event.resize)}function p(l){const v=n.value.get(l);if(!v)return;const h={x:0,y:0,w:v.layout.minW,h:v.layout.minH,fullscreen:!1};h.x=(window.innerWidth-h.w)/2,h.y=(window.innerHeight-h.h)/2,Object.assign(v.layout,h),document.dispatchEvent(v.event.resize)}function u(l){const v=n.value.get(l);if(!v||!v.layout.allow_escape)return;n.value.delete(l);let h=-1,b="";return n.value.forEach(C=>{h=C.layout.index,b=C.nid}),h!=-1&&r(b),v}let o={x:0,y:0,d:"",modalX:0,modalY:0,modalW:0,modalH:0,modal:null},m=0;function _(l,v){v.preventDefault(),v.stopPropagation(),v.pointerId&&(m=v.pointerId,v.target.hasPointerCapture(v.pointerId)),o.x=v.clientX,o.y=v.clientY,o.d=v.target.className,n.value.forEach(h=>{h.nid===l&&(o.modal=h)}),o.modal&&(o.modal.layout.fullscreen||(o.modalX=o.modal.layout.x,o.modalY=o.modal.layout.y,o.modalW=o.modal.layout.w,o.modalH=o.modal.layout.h,document.addEventListener("pointerup",i),document.addEventListener("pointermove",g)))}function g(l){if(l.preventDefault(),!o.modal||!l.pointerId||m!=l.pointerId)return;const v={x:l.clientX-o.x,y:l.clientY-o.y},h={x:o.modal.layout.x,y:o.modal.layout.y,w:o.modal.layout.w,h:o.modal.layout.h};switch(o.d){case"c_l":h.x=o.modalX+v.x,h.w=o.modalW-v.x;break;case"c_r":h.x=o.modalX,h.w=o.modalW+v.x;break;case"c_t":h.y=o.modalY+v.y,h.h=o.modalH-v.y;break;case"c_b":h.y=o.modalY,h.h=o.modalH+v.y;break;case"c_lt":h.x=o.modalX+v.x,h.w=o.modalW-v.x,h.y=o.modalY+v.y,h.h=o.modalH-v.y;break;case"c_lb":h.x=o.modalX+v.x,h.w=o.modalW-v.x,h.y=o.modalY,h.h=o.modalH+v.y;break;case"c_rt":h.x=o.modalX,h.w=o.modalW+v.x,h.y=o.modalY+v.y,h.h=o.modalH-v.y;break;case"c_rb":h.x=o.modalX,h.w=o.modalW+v.x,h.y=o.modalY,h.h=o.modalH+v.y;break;case"modal_header":case"modal_title":h.x=o.modalX+v.x,h.y=o.modalY+v.y;break}const b={l:0,r:window.innerWidth,t:0,b:window.innerHeight};h.w<100&&(h.w=100),h.h<80&&(h.h=80),h.y<0&&(h.y=0),h.y>b.b-h.h/2&&(h.y=b.b-h.h/2),h.x<0-h.w/2&&(h.x=0-h.w/2),h.x>b.r-h.w/2&&(h.x=b.r-h.w/2),o.modal.layout.minW&&h.w<o.modal.layout.minW&&(h.w=o.modal.layout.minW),o.modal.layout.minH&&h.h<o.modal.layout.minH&&(h.h=o.modal.layout.minH),Object.assign(o.modal.layout,h),document.dispatchEvent(o.modal.event.resize)}function i(l){l.preventDefault(),l.stopPropagation(),!(!l.pointerId||m!=l.pointerId)&&(document.removeEventListener("pointerup",i),document.removeEventListener("pointermove",g),m=0,o.modal=null)}function y(l,v){const h=n.value.get(l);h&&h.callback.forEach(async b=>{b.key!==v||await b.func(h)||u(l)})}Le(()=>{console.info("Popup mounted"),document.addEventListener("keydown",f)}),$e(()=>{console.info("unmounted"),document.removeEventListener("keydown",f)});function f(l){switch(l.key){case"Escape":n.value.forEach((h,b)=>{if(h.layout.active){if(!h.layout.allow_escape)return;setTimeout(()=>u(h.nid))}});break;case"NumpadEnter":case"Enter":if(l.target.tagName==="BODY"||l.target.tagName==="BUTTON"||l.isComposing)return;let v=l.target;for(;v.parentElement;){if(v=v.parentElement,!v.classList.contains("modal_dom"))continue;const b=v.getAttribute("data-ref-id");if(!b)break;const C=n.value.get(b);if(!C)break;for(let w=0;w<C.callback.length;w++){const M=C.callback[w].key;return y(b,M)}}break}}function d(l){console.info("processModalFile",l);const v=document.createElement("input");v.type="file",v.onchange=h=>{const b=h.target.files;!b||b.length===0||(l.value=b[0],console.info("processModalFile mod",l,l.value))},v.click()}return(l,v)=>(S(),D("div",Xs,[(S(!0),D(q,null,re(n.value,([h,b])=>{var C;return S(),D("div",{key:`_modal_${h}`,class:ue({modal_dom:!0,active:b.layout.active,resizing:((C=K(o).modal)==null?void 0:C.nid)==b.nid,modal_alpha:b.base.alpha}),"data-ref-id":b.nid,style:Vt({zIndex:b.layout.index,width:b.layout.w+"px",height:b.layout.h+"px",left:b.layout.x+"px",top:b.layout.y+"px"}),onClick:On(w=>r(b.nid),["stop"])},[P("div",{class:"modal_header",onPointerdown:w=>_(b.nid,w),onDblclick:w=>b.layout.fullscreen?p(b.nid):c(b.nid)},[P("div",Zs,oe(b.base.title),1),P("div",eo,[b.layout.allow_move&&b.layout.allow_fullscreen?(S(),D(q,{key:0},[b.layout.fullscreen?(S(),D("span",{key:1,class:"buttonStyle sysIcon sysIcon_windowize",onClick:w=>p(b.nid)},null,8,no)):(S(),D("span",{key:0,class:"buttonStyle sysIcon sysIcon_maximize",onClick:w=>c(b.nid)},null,8,to))],64)):te("",!0),P("span",{class:"buttonStyle sysIcon sysIcon_close",onClick:w=>u(b.nid)},null,8,ao)])],40,Js),P("div",so,[b.content.text&&b.content.text.length?(S(),D("div",{key:0,class:"modal_content_text",innerHTML:b.content.text},null,8,oo)):te("",!0),b.content.form&&b.content.form.length?(S(),D("div",io,[(S(!0),D(q,null,re(b.content.form,(w,M)=>(S(),D("label",{key:`_modal_${h}_form_${M}`},[w.label?(S(),D("span",ro,oe(w.label),1)):te("",!0),v[0]||(v[0]=P("span",null,null,-1)),P("span",null,[w.type==="text"?ce((S(),D("input",{key:0,type:"text","onUpdate:modelValue":x=>w.value=x,onChange:x=>w.on_change(x,b,w),disabled:w.disabled},null,40,lo)),[[Me,w.value]]):te("",!0),w.type==="file"?(S(),D(q,{key:1},[P("button",{onClick:x=>d(w),disabled:w.disabled},"select file",8,co),w.value?(S(),D("span",uo,oe(w.value.name),1)):te("",!0)],64)):te("",!0),w.type==="textarea"?ce((S(),D("textarea",{key:2,"onUpdate:modelValue":x=>w.value=x,onChange:x=>w.on_change(x,b,w),disabled:w.disabled},null,40,fo)),[[Me,w.value]]):te("",!0),w.type==="date"?ce((S(),D("input",{key:3,type:"date","onUpdate:modelValue":x=>w.value=x,onChange:x=>w.on_change(x,b,w),disabled:w.disabled},null,40,ho)),[[Me,w.value]]):te("",!0),w.type==="datetime"?ce((S(),D("input",{key:4,type:"datetime-local","onUpdate:modelValue":x=>w.value=x,onChange:x=>w.on_change(x,b,w),disabled:w.disabled},null,40,po)),[[Me,w.value]]):te("",!0),w.type==="checkbox"?(S(!0),D(q,{key:5},re(w.options,(x,I)=>(S(),D(q,{key:`P_${h}_C_${M}_CB_${I}`},[ce(P("input",{id:`P_${h}_C_${M}_CB_${I}`,name:`P_${h}_C_${M}_CB`,type:"checkbox",value:I,"onUpdate:modelValue":N=>w.value=N,onChange:N=>w.on_change(N,b,w),disabled:w.disabled},null,40,_o),[[Cn,w.value]]),P("label",{for:`P_${h}_C_${M}_CB_${I}`},oe(x),9,mo)],64))),128)):te("",!0),w.type==="radio"?(S(!0),D(q,{key:6},re(w.options,(x,I)=>(S(),D(q,{key:`P_${h}_C_${M}_RD_${I}`},[ce(P("input",{id:`P_${h}_C_${M}_RD_${I}`,name:`P_${h}_C_${M}_RD`,type:"radio",value:I,"onUpdate:modelValue":N=>w.value=N,onChange:N=>w.on_change(N,b,w),disabled:w.disabled},null,40,vo),[[at,w.value]]),P("label",{for:`P_${h}_C_${M}_RD_${I}`},oe(x),9,yo)],64))),128)):te("",!0),w.type==="select"?ce((S(),D("select",{key:7,"onUpdate:modelValue":x=>w.value=x,multiple:w.multiple,onChange:x=>w.on_change(x,b,w),disabled:w.disabled},[(S(!0),D(q,null,re(w.options,(x,I)=>(S(),D("option",{key:`P_${h}_C_${M}_SL_${I}`,value:I},oe(x),9,wo))),128))],40,go)),[[Ne,w.value]]):te("",!0)])]))),128))])):te("",!0),(S(!0),D(q,null,re(b.content.component,(w,M)=>(S(),zt(Nt(e[w.componentName]),{key:`CMP_${h}_${M}`,data:w.data,modalData:b},null,8,["data","modalData"]))),128)),b.callback&&b.callback.length?(S(),D("div",bo,[(S(!0),D(q,null,re(b.callback,(w,M)=>(S(),D("button",{key:`BTN_${h}_${M}`,onClick:x=>y(b.nid,w.key)},oe(w.name),9,ko))),128))])):te("",!0)]),b.layout.allow_resize?(S(),D("div",{key:0,class:"modal_border",onPointerdown:w=>_(b.nid,w)},v[1]||(v[1]=[Ut('<div class="c_l"></div><div class="c_r"></div><div class="c_t"></div><div class="c_b"></div><div class="c_lt"></div><div class="c_lb"></div><div class="c_rt"></div><div class="c_rb"></div>',8)]),40,Eo)):te("",!0)],14,Qs)}),128))]))}}),So={class:"fr_context"},Do=["onClick"],Lo=["innerHTML"],$o={key:0,class:"context_menu_sub"},Ro=["onClick"],Oo=["innerHTML"],Co=he({__name:"Context",setup(a){const e=je(),t=e?e!=null&&e.group.admin?2:1:0,n=j([]),s=j(null),r=j(!0),c=j({x:-1e3,y:0,w:0,h:0,sx:0,sy:0,direction:"lb"});an(p);function p(y,f){r.value=!1;const d=[];y.forEach(l=>{if(u(l)){if(l.child){let v=[];if(l.child.forEach(h=>{u(h)&&v.push(h)}),!v.length)return;l.child=v}d.push(l)}}),n.value=d,console.info(d),setTimeout(()=>o(f),20)}function u(y){switch(y.auth){case"none":return!1;default:case"guest":return!0;case"user":if(t<1)break;return!0;case"admin":if(t<2)break;return!0}}function o(y){if(!s.value)return;const f=s.value;let d=i();const l={x:y.clientX,y:y.clientY,w:f==null?void 0:f.offsetWidth,h:f==null?void 0:f.offsetHeight,sx:d.scrollTop,sy:d.scrollLeft,direction:"rb"};let v=["r","b"];switch(l.w+l.x>window.innerWidth&&(v[0]="l"),l.h+l.y>window.innerHeight&&(v[1]="t"),l.direction=v.join(""),l.direction){case"rb":break;case"rt":l.y-=l.h;break;case"lb":l.x-=l.w;break;case"lt":l.x-=l.w,l.y-=l.h;break}c.value=l,i().addEventListener("scroll",g),setTimeout(()=>r.value=!0,10)}function m(){i().removeEventListener("scroll",g),r.value=!1,_=null,setTimeout(()=>{n.value=[],c.value={x:-1e3,y:0,w:0,h:0,sx:0,sy:0,direction:"lb"}},10)}Le(()=>{});let _=null;function g(y){const f=i();if(!f)return;let d=c.value,l=f.scrollLeft,v=f.scrollTop,h=l-d.sx,b=v-d.sy;c.value=Object.assign(d,{x:d.x-h,y:d.y-b,sx:l,sy:v})}function i(){return _||(_=document.querySelector(".fr_content"),_)}return addEventListener("contextmenu",y=>{console.info("triggerMenu"),p([],y)}),addEventListener("click",y=>{m()}),(y,f)=>(S(),D("div",So,[P("div",{class:ue(["context_menu",r.value?"show":"",c.value.direction]),style:Vt({left:c.value.x+"px",top:c.value.y+"px"}),ref_key:"contextDOM",ref:s},[(S(!0),D(q,null,re(n.value,(d,l)=>{var v;return S(),D("div",{key:`COM_${l}`,class:ue(["context_item",(v=d.child)!=null&&v.length?"has_sub":""]),onClick:d.method},[P("span",{innerHTML:d.title},null,8,Lo),d.child&&d.child.length?(S(),D("div",$o,[(S(!0),D(q,null,re(d.child,(h,b)=>(S(),D("div",{key:`COM_${l}_${b}`,class:ue({context_item:!0}),onClick:h.method},[P("span",{innerHTML:h.title},null,8,Oo)],8,Ro))),128))])):te("",!0)],10,Do)}),128))],6)]))}}),Po={class:"fr_body"},Mo=he({__name:"main",setup(a){const e=je();e&&(document.cookie=`tosho_token=${e.token}; max-age=31536000`,n());const t=new Event("fe_config_loaded");async function n(){const s=await Y("setting/get_front_conf");s&&(s.onlyoffice_enabled==="true"&&(se.onlyOffice.enabled=!0,se.onlyOffice.jwtSecret=s.onlyoffice_jwt_secret??""),se.navList=[{name:"Nas",meta:{cur:!0},path:"/"}],s.link_nav&&s.link_nav.forEach(r=>{se.navList.push({name:r[0],meta:{cur:!1},path:r[1]})}),document.dispatchEvent(t))}return(s,r)=>{const c=Pn("router-view");return S(),D(q,null,[Ce(Wn,{class:"fr_header"}),Ce(xo),Ce(Co),P("div",Po,[Ce(ts,{class:"fr_navi"}),Ce(c)])],64)}}});Mn();const dt=An(Mo);dt.use(In());dt.use(Qa);dt.mount("#app");export{Vn as _,To as a,Xa as b,F as c,Ho as o,is as p,Ya as u};

import{d as H,u as J,r as m,b as Q,G as K,g as P,q as y,f as T,h as i,i as l,n as p,F as _,j as $,m as S,s as W,t as X,o as u,x as v,z as f,w as V,A,I as D}from"./index-BHSM3JiG.js";import{_ as k}from"./ContentEditable.vue_vue_type_script_setup_true_lang-BFMO5wpS.js";import{H as Y}from"./Hinter-BDKNVHEk.js";const Z={key:0,class:"list_user_group"},g={class:"title"},ee=["onClick"],te={class:"operator"},se=["onClick"],le=["onClick"],ae=["onClick"],ne=["onClick"],oe={class:"auth"},ie=["onClick"],ue=["onClick"],de={class:"operator"},ce=["onUpdate:modelValue","id"],_e=["for"],re=["onUpdate:modelValue","id","name"],ye=["for"],ve=["onUpdate:modelValue","id","name"],fe=["for"],me=["onClick"],ke={class:"list_user"},he={class:"title"},pe=["onClick"],Ve={class:"mail"},Ce={class:"status"},Ue={class:"title"},$e=["onUpdate:modelValue","id"],be=["for"],we=["onClick"],Ae=H({__name:"UserView",setup(Ge){J();const q=m(null),x=W(),b=X();let h={id:""};const n=m([]),d=m([]);m(null);const c=m(-1);Q(async()=>{Object.assign(h,K.copyObject(b.query)),w()}),P(async t=>{h.id=t.query.id??"",w()});async function w(){if(!n.value||!n.value.length){const s=await y("user_group/get",h);if(!s)return;n.value=s}let t=parseInt(h.id);if(t){let s=!1;for(let e=0;e<n.value.length;e++)t&&t===n.value[e].id&&(s=!0,c.value=e);s||(c.value=-1),O()}}async function O(){if(d.value=[],c.value===-1)return;const s={id_group:n.value[c.value].id},e=await y("user/get",s);e&&(d.value=e)}T(()=>{});async function G(t){var o,a,r,U,B;if(!n.value[t].edit){n.value[t].edit=!0;return}const s={title:n.value[t].title,description:n.value[t].description,admin:(o=n.value[t].admin)==null?void 0:o.toString(),status:(a=n.value[t].status)==null?void 0:a.toString(),auth:JSON.stringify(n.value[t].auth)};(r=n.value[t])!=null&&r.id&&(s.id=(B=(U=n.value[t])==null?void 0:U.id)==null?void 0:B.toString());const e=await y("user_group/mod",s);e&&(n.value[t].edit=!1,n.value[t].id=e.id??0)}async function L(t){const s=n.value.splice(t,1)[0];s.id&&await y("user_group/del",{id:s.id})}async function M(){n.value.unshift({title:"",description:"",auth:{allow:[],deny:[]},admin:0,status:1,edit:!0,ext_key:new Date().valueOf(),user:[]})}async function j(t){console.info("addAuth");const s=n.value[t];s.auth||(s.auth={}),s.auth.deny||(s.auth.deny=[]),s.auth.deny.push({id:0,title:"root",status:1,type:"directory",crumb_node:[]})}async function N(t,s){console.info("delAuth");const e=n.value[t];e.auth||(e.auth={}),e.auth.deny||(e.auth.deny=[]),e.auth.deny.splice(s,1),n.value[t]=e}async function R(t){console.info("node_hint");const e=await y("file/get",{mode:"directory",node_type:"directory",keyword:t,with:"none",limit:"20"});return e?("root".indexOf(t)!==-1&&e.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),e.list):!1}function F(t,s){console.info("node_add",t,s);const e=s[0],o=s[1],a=n.value[e];a.auth.deny[o]=t}function z(t){var e;if(console.info("node_parse"),!t)return"";const s=[];return(e=t.crumb_node)==null||e.forEach(o=>{o.title&&s.push(o.title)}),t.title&&s.push(t.title),`/ ${s.join(" / ")}`}function C(t){let s=0;t!==-1&&(s=n.value[t].id??0),x.push({path:b.path,query:{id:s}})}function E(){if(c.value==-1)return;const t=d.value,s=n.value[c.value];t.unshift({name:"",mail:"",id_group:s.id,password:"",status:1,ext_key:new Date().valueOf(),edit:!0})}async function I(t){if(!d.value[t].edit){d.value[t].edit=!0;return}const s=await y("user/mod",d.value[t]);s&&(d.value[t].edit=!1,d.value[t].id=parseInt(s.id??""))}return(t,s)=>(u(),i("div",{class:"fr_content view_user",ref_key:"contentDOM",ref:q},[n.value&&n.value.length?(u(),i("div",Z,[l("div",{class:p({user_group:!0,user_group_add:!0,active:c.value===-1}),onClick:M},s[0]||(s[0]=[l("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1)]),2),(u(!0),i(_,null,$(n.value,(e,o)=>(u(),i("div",{key:`userView_group_${e.ext_key?e.ext_key:e.id}`,class:p({active:c.value===o,user_group:!0,edit:e.edit})},[e.edit?(u(),i(_,{key:1},[f(k,{class:"title",modelValue:e.title,"onUpdate:modelValue":a=>e.title=a,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),f(k,{class:"description",modelValue:e.description,"onUpdate:modelValue":a=>e.description=a},null,8,["modelValue","onUpdate:modelValue"]),l("dl",oe,[s[1]||(s[1]=l("dt",null,"denyDir",-1)),e.auth?(u(!0),i(_,{key:0},$(e.auth.deny,(a,r)=>(u(),i("dd",{key:`userView_group_${e.ext_key?e.ext_key:e.id}_${r}`},[f(Y,{"get-list":R,submit:F,"parse-text":z,"model-value":a,meta:[o,r]},null,8,["model-value","meta"]),l("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:U=>N(o,r)},null,8,ie)]))),128)):S("",!0),l("dd",{class:"pointer add",onClick:a=>j(o)},"+",8,ue)]),l("div",de,[V(l("input",{type:"checkbox","onUpdate:modelValue":a=>e.status=a,id:`UV_G_CB_S_${e.ext_key?e.ext_key:e.id}`,"true-value":1,"false-value":0},null,8,ce),[[A,e.status]]),l("label",{class:"no_bg",for:`UV_G_CB_S_${e.ext_key?e.ext_key:e.id}`},null,8,_e),V(l("input",{type:"radio","onUpdate:modelValue":a=>e.admin=a,id:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_1`,name:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}`,value:1},null,8,re),[[D,e.admin]]),l("label",{class:"no_bg",for:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_1`}," isAdmin ",8,ye),V(l("input",{type:"radio","onUpdate:modelValue":a=>e.admin=a,id:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_0`,name:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}`,value:0},null,8,ve),[[D,e.admin]]),l("label",{class:"no_bg",for:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_0`}," isUser ",8,fe),l("div",null,[l("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:a=>G(o)},null,8,me)])])],64)):(u(),i(_,{key:0},[l("div",g,[l("div",{onClick:a=>C(o)},v(e.title),9,ee),l("div",te,[l("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:a=>G(o)},null,8,se),l("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:a=>L(o)},null,8,le)])]),l("div",{onClick:a=>C(o),class:"description"},v(e.description),9,ae),l("div",{onClick:a=>C(o),class:"meta"},[l("span",null,v(e.admin?"admin":"user"),1)],8,ne)],64))],2))),128))])):S("",!0),l("div",ke,[l("div",{class:p({user:!0,user_add:!0}),onClick:E},s[2]||(s[2]=[l("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1)])),(u(!0),i(_,null,$(d.value,(e,o)=>(u(),i("div",{class:p({user:!0,edit:e.edit}),key:`user_view_${e.ext_key?e.ext_key:e.id}`},[e.edit?(u(),i(_,{key:1},[l("div",Ue,[f(k,{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),l("div",null,[V(l("input",{type:"checkbox","onUpdate:modelValue":a=>e.status=a,id:`UV_U_CB_${e.ext_key?e.ext_key:e.id}`,"true-value":1,"false-value":0},null,8,$e),[[A,e.status]]),l("label",{class:"no_bg",for:`UV_U_CB_${e.ext_key?e.ext_key:e.id}`},null,8,be),l("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:a=>I(o)},null,8,we)])]),f(k,{modelValue:e.mail,"onUpdate:modelValue":a=>e.mail=a,class:"mail"},null,8,["modelValue","onUpdate:modelValue"]),f(k,{modelValue:e.password,"onUpdate:modelValue":a=>e.password=a,class:"password"},null,8,["modelValue","onUpdate:modelValue"]),s[3]||(s[3]=l("label",{class:"status"},null,-1))],64)):(u(),i(_,{key:0},[l("div",he,[l("div",null,v(e.name),1),l("div",null,[l("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:a=>I(o)},null,8,pe)])]),l("div",Ve,v(e.mail),1),l("div",Ce,v(e.status?"activate":"inactivate"),1)],64))],2))),128))])],512))}});export{Ae as default};

import{d as ne,r as d,o as ae,C as W,c as u,e as l,t as w,Q as m,F as b,g as _,n as M,f as X,N as se,O as j,T as le,a2 as ie,D as oe,G,_ as re,U as ue,V as ce,W as de,X as ve,Y as J,b as r,R as pe,a4 as Ae,P as Q,a7 as fe,a8 as we}from"./basic-cwdvCeQw.js";const ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAF1mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0ZURhdGU9IjIwMjUtMDQtMjlUMTk6NTk6MzQrMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDI1LTA1LTI1VDAwOjQ5OjAxKzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI1LTA1LTI1VDAwOjQ5OjAxKzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjVlMmU1MGU4LTg3ZmQtN2M0My04NGE3LTk4NjVkMmExMGY5MiIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmFkYjg3ZWVhLWIyZWYtODA0Ni1hZjE5LTg2ZmI4MDA4ZTFkZiIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjM3NzYzOTg3LTEzNWYtZWU0Ny1iYWNlLTBjZDNiMGNmNGNkOCI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjM3NzYzOTg3LTEzNWYtZWU0Ny1iYWNlLTBjZDNiMGNmNGNkOCIgc3RFdnQ6d2hlbj0iMjAyNS0wNS0yNVQwMDo0OTowMSswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo1ZTJlNTBlOC04N2ZkLTdjNDMtODRhNy05ODY1ZDJhMTBmOTIiIHN0RXZ0OndoZW49IjIwMjUtMDUtMjVUMDA6NDk6MDErMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE4IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6TS4caAAABQklEQVR4nO3d0YnCQBRA0Sj+by/biZXaib1sBbMdJELE88B7fhUyeHmYcRQva60tzlUv4NsVACsAVgCsAFgBsAJgt6Mn/G3b8xMLOeFXL2DPz8HjTQBWAKwAWAGwAmAFwAqAHe4DXjD6Pny6JgArAFYArABYAbACYAXACoAVACsAVgDsHZ8FnXXH13/IizcBWAGwAmAFwAqAFQArADZhH0Dvw7UmACsAVgCsAFgBsAJgBcAm7AM6D4hTAKwA2CvvAX3/f9/R76h3X78mACsAVgBswj6g84A4BcAKgBUAKwBWAKwA2IR9QOcBcQqAFQArAFYArABYAbAJ+4DOA+IUACsAVgCsAFgBsAJgBcAKgBUAKwA24bOgs6b/z9muJgArAFYArABYAbACYAXALmstvYav1gRgBcAKgBUAKwBWAKwA2D94NhAMfrN7rgAAAABJRU5ErkJggg==",he={class:"sh_fr_header"},Ie={class:"operator"},ge={key:0,class:"err_msg"},me={class:"sh_fr_list"},be=["id","value"],ke=["for"],De=["onClick"],Ne={class:"operates"},_e={key:0},Me=["onClick"],Re=["onClick"],Ce=["onClick"],Ge={key:0},Le={class:"preLine"},Ze={class:M({pagination:1,isMobile:!1})},Oe={class:"sh_fr_footer"},Be=ne({__name:"share",setup(Te){const L=d(""),h=d(0);let I="";const p=d([]),Z=d(null),O=d(null),k=d([]),D=d(null);ae(async()=>{const e=new URL(location.href);B(e)});function x(e,t){const n=new URL(location.href);n.searchParams.set("id",e),t?n.searchParams.set("node",t.toString()):n.searchParams.delete("node"),history.pushState(null,"",n),B(n)}addEventListener("popstate",e=>{B(new URL(location.href))});async function B(e){if(I=e.searchParams.get("id")??"",!I)return C("invalid uuid");let t=e.searchParams.get("node");k.value=[];const n=await S(I,t??!1);if(!n)return C("data fetch failed");p.value=n.node??[],O.value=n.parent??null,Z.value=n.cur}const E=d(""),P=d("");async function R(e,t){var n;if(e.type==="directory")x(I,e.id);else{if(!((n=e==null?void 0:e.file_index)!=null&&n.raw))return;switch(t){default:return await T("single",e);case"detail":c.value=e,p.value.forEach((s,a)=>{s.type!="directory"&&s.id==e.id&&(v.value=a)}),V(),h.value=1,setTimeout(()=>{var s,a;z.value={h:((s=D.value)==null?void 0:s.clientHeight)??0,w:((a=D.value)==null?void 0:a.clientWidth)??0}},10);break}}}async function T(e,t){const n=[];switch(e){case"list":k.value.forEach(a=>{p.value.forEach(o=>{o.id===a&&n.push(o)})});break;case"total":p.value.forEach(a=>{n.push(a)});break;case"single":t&&n.push(t);break}if(!n.length)return;console.info(n);const s=new oe(U("",n),async a=>{const o=await S(I,a.id);return o?U(a.path,o.node??[]):[]});await s.prepare(),await s.download((a,o,i,A,f)=>{let N=(a+o)/i;N*=1e4,N=Math.round(N),N/=100,E.value=`${A}/${f} Files, ${N}%, ${G.kmgt(o)} / ${G.kmgt(i)}`,P.value=`width: ${N}%;`}),console.info(n.length===1,n[0].type!=="directory"),n.length===1&&n[0].type!=="directory"?await s.completeFile():(await s.build(),s.complete())}async function S(e,t){return await te("share/node_list",t?{id:e,id_node:t}:{id:e})}function U(e,t){const n=[];return t.forEach(s=>{var o;const a={id:s.id,id_parent:s.id_parent,path:"",url:"",size:0,type:s.type??""};if(a.path=[e??"",s.title??""].join("/"),s.type!=="directory"){const i=(o=s.file_index)==null?void 0:o.raw;if(!i)return;a.url=y(s,"raw"),a.size=i.size??0}n.push(a)}),n}function y(e,t="raw"){return e.file_index[t]?e.file_index[t].path+"?shareId="+I+"&filename="+e.title:""}const Y={audio:re,video:ue,image:ce,pdf:de,text:ve,office:J,base:J};let v=d(-1);const c=d(null),F=d({id:0,title:"",cover:"",preview:"",normal:"",raw:"",sameName:[]}),z=d({w:0,h:0});function $(e){let t=e-v.value;g(v.value,t)}function g(e,t,n=0){let s=p.value.length;if(s<1)return;let a=e;do{for(a=a+t;a<0;)a+=s;for(;a>s-1;)a-=s;if(n||(n=0),n+=1,n>s)return;console.info(a)}while(!p.value[a]||p.value[a].type==="directory");v.value=a,V()}function V(){const e=p.value[v.value];if(c.value=e,!e.file_index.preview&&["audio","video"].indexOf(e.type)!==-1){let s=!1;p.value.forEach(a=>{if(a.id_parent!==e.id_parent||s)return;let o=!1;if(W.coverKeyword.forEach(i=>{W.imgKeyword.forEach(A=>{e.title.toLowerCase().indexOf(i)!==-1&&e.title.toLowerCase().indexOf(A)!==-1&&(o=!0)})}),o){s=!0;let i;i||(i=e.file_index.preview),i||(i=e.file_index.normal),i||(i=e.file_index.raw),e.file_index.preview=i}})}const t={id:e.id,title:e.title,cover:y(e,"cover"),preview:y(e,"preview"),normal:y(e,"normal"),raw:y(e,"raw"),sameName:[]};let n=t.title.lastIndexOf(".");if(n!==-1){let s=t.title.substring(0,n)??"";s&&p.value.forEach(a=>{var i,A;if(a.id==t.id||((i=a.title)==null?void 0:i.indexOf(s))!==0)return;let o=(A=a.title)==null?void 0:A.substring(s.length);t.sameName.push({title:o,type:a.type??"",preview:y(a,"preview"),normal:y(a,"normal"),raw:y(a,"raw")})})}F.value=t,console.warn(t)}function K(){setTimeout(()=>{var e,t;D.value&&(z.value={h:((e=D.value)==null?void 0:e.clientHeight)??0,w:((t=D.value)==null?void 0:t.clientWidth)??0})},10)}window.addEventListener("resize",K);function q(){v.value=-1,c.value=null,h.value=0}async function ee(e){if(c.value)switch(e.key){case"ArrowLeft":if(e.preventDefault(),e.stopPropagation(),["audio","video"].indexOf(c.value.type??"")!==-1)return;g(v.value,-1);break;case"ArrowRight":if(e.preventDefault(),e.stopPropagation(),["audio","video"].indexOf(c.value.type??"")!==-1)return;g(v.value,1);break;case"a":case"PageUp":e.preventDefault(),e.stopPropagation(),g(v.value,-1);break;case"d":case"PageDown":e.preventDefault(),e.stopPropagation(),g(v.value,1);break}}document.addEventListener("keydown",ee);function te(e,t,n){return new Promise((s,a)=>{let o;if(t instanceof FormData)o=t;else{o=new FormData;for(const f in t)Object.prototype.hasOwnProperty.call(t,f)&&o.append(f,t[f])}const i=new XMLHttpRequest;i.withCredentials=!0,i.onreadystatechange=function(){if(i.readyState!==4)return;if(i.status>=400)return C(`${i.status}: ${i.statusText}`);const f=JSON.parse(i.responseText);f.code&&C(f.msg),s(f.data)};let A=new URL(location.href).pathname;i.open("POST",A.substring(0,A.lastIndexOf("/"))+W.apiPath+e),i.send(o)})}function C(e){throw L.value=e,new Error(e)}return(e,t)=>(r(),u(b,null,[l("div",he,[t[7]||(t[7]=l("div",null,[l("img",{src:ye}),l("span",null,"MyNas Share")],-1)),l("div",Ie,[k.value.length?(r(),u("span",{key:0,class:"pointer sysIcon sysIcon_download",onClick:t[0]||(t[0]=n=>T("list"))},w(k.value.length)+" Selected",1)):m("",!0),l("span",{class:"pointer sysIcon sysIcon_download",onClick:t[1]||(t[1]=n=>T("total"))},"Down All"),h.value?(r(),u("span",{key:1,class:"pointer sysIcon sysIcon_forward",onClick:t[2]||(t[2]=n=>q())},"Close")):m("",!0)])]),l("div",{class:M({sh_fr_body:!0,showDetail:h.value})},[L.value.length?(r(),u("p",ge,w(L.value),1)):(r(),u(b,{key:1},[l("ul",me,[Z.value&&Z.value.id?(r(),u("li",{key:0,class:"pointer",onClick:t[3]||(t[3]=n=>x(_(I),O.value?O.value.id:0))},t[8]||(t[8]=[l("p",null,[l("span",{class:M(["thumb","listIcon","listIcon_file_directory"])}),l("span",null,"../")],-1)]))):m("",!0),(r(!0),u(b,null,X(p.value,n=>{var s,a;return r(),u("li",{key:n.id},[l("p",null,[pe(l("input",{type:"checkbox",name:"selector",id:`selector_${n.id}`,value:n.id,"onUpdate:modelValue":t[4]||(t[4]=o=>k.value=o)},null,8,be),[[Ae,k.value]]),l("label",{for:`selector_${n.id}`,class:"pointer"},null,8,ke),l("span",{class:M(["thumb","listIcon",`listIcon_file_${n.type}`])},null,2),l("span",{class:"pointer title",onClick:o=>R(n)},w(n.title),9,De)]),l("p",Ne,[n.type!=="directory"?(r(),u("span",_e,w(_(G).kmgt(((a=(s=n==null?void 0:n.file_index)==null?void 0:s.raw)==null?void 0:a.size)??0)),1)):m("",!0),n.type==="directory"?(r(),u("span",{key:1,class:"pointer sysIcon sysIcon_folder",onClick:o=>R(n)},null,8,Me)):(r(),u(b,{key:2},[l("span",{class:"pointer sysIcon sysIcon_eye",onClick:o=>R(n,"detail")},null,8,Re),l("span",{class:"pointer sysIcon sysIcon_download",onClick:o=>R(n)},null,8,Ce)],64))])])}),128))]),c.value&&h.value?(r(),u("div",{key:0,class:"sh_fr_detail",ref_key:"detailDOM",ref:D,"data-ref-id":"1"},[(r(),se(le(Y[c.value.type]?Y[c.value.type]:Y.base),{extId:"1",isActive:!0,curIndex:0,file:F.value,dom:z.value,onNav:$},{info:j(()=>{var n,s;return[l("div",{class:M({info:!0,detail:h.value})},[h.value?(r(),u(b,{key:0},[l("p",null,w(c.value.title)+" ("+w(_(G).kmgt(((s=(n=c.value.file_index)==null?void 0:n.raw)==null?void 0:s.size)??0,2))+") ",1),c.value.crumb_node?(r(),u("p",Ge,[t[9]||(t[9]=Q("Dir : ")),(r(!0),u(b,null,X(c.value.crumb_node,a=>(r(),u(b,null,[Q("/"+w(a.title),1)],64))),256))])):m("",!0),l("p",Le,w(c.value.description),1)],64)):m("",!0)],2)]}),btnContainer:j(()=>t[10]||(t[10]=[])),navigator:j(()=>[l("div",Ze,[l("div",{class:"left",onClick:t[5]||(t[5]=n=>g(_(v),-1))},t[11]||(t[11]=[l("span",{class:"sysIcon sysIcon_arrowleft"},null,-1)])),l("div",{class:"right",onClick:t[6]||(t[6]=n=>g(_(v),1))},t[12]||(t[12]=[l("span",{class:"sysIcon sysIcon_arrowright"},null,-1)]))])]),_:1},40,["file","dom"]))],512)):m("",!0)],64))],2),l("div",Oe,[l("div",{class:"process",style:ie(P.value)},w(E.value),5)])],64))}}),H=fe(Be);H.use(we());H.mount("#app");

import{d as le,a as oe,i as se,r as S,o as ne,m as ae,E as w,c as u,e as o,n as m,F as y,f,R as b,a1 as ie,g as a,S as g,Q as U,G as q,b as i,t as V,a3 as P,A as I,C as $,a4 as Q,N as ue}from"./basic-cwdvCeQw.js";import{o as re,a as de,p as ce,u as _e,b as ye}from"./index-DN6EPjSg.js";import{_ as z}from"./ContentEditable.vue_vue_type_script_setup_true_lang-DcqCX2WK.js";import{R as fe,F as ve}from"./FileItem-DqKtN6tr.js";import{H as K}from"./Hinter-D3ESJFiP.js";const pe={class:"fr_content view_fav"},ke={class:"list_fav_group"},me=["onClick"],be={class:"title"},Ce=["onClick"],Ve=["onClick"],we={class:"operator"},$e=["onClick"],Se=["onClick"],ge=["onUpdate:modelValue"],Ie=["value"],he={class:"favTagLs"},Oe=["onClick"],Ge=["onUpdate:modelValue","id"],Ae=["for"],Ue=["onUpdate:modelValue","id"],Ee=["for"],Te=["onClick"],De={class:"title"},Fe=["onClick"],Me=["onClick"],Le={class:"operator"},Re=["onClick"],Ne=["onClick"],je={class:"content_meta"},Be={class:"search"},He=["value"],qe=["value","innerHTML"],Pe={key:0,class:"display"},Qe={key:2},ze=["value"],Ke=["onClick"],tt=le({__name:"Favourite",setup(Ye){oe(),se();const E=S(null),T=_e(),v=ye();let p={id:"",keyword:""};const c=S([]),D=S(null),C=S(-1),Y=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1;ne(async()=>{p.id=v.query.id??"",await x(),r=new re({route:v,router:T,getList:G,contentDOM:E.value,emitGo:j}),p.id&&(M(),R(v.query),await G(),await r.reloadScroll()),document.addEventListener("keydown",B)}),ae(()=>{r.destructor(),document.removeEventListener("keydown",B)}),de(async l=>{console.info(l),p.id=l.query.id??"",p.id&&(M(),R(l.query),await G())});async function x(){const l=await w("favourite_group/get",p);l&&(l.forEach(e=>{e.edit=!1,e.ext_key=e.id}),c.value=l||[])}async function h(l){const e=c.value[l];await w("favourite_group/del",e),location.reload()}async function O(l){console.info(c.value[l]);const e=q.copyObject(c.value[l]);if(e.edit){c.value[l].edit=!1,e.meta=JSON.stringify(e.meta);const t=await w("favourite_group/mod",e);if(!t)return;c.value[l].id=parseInt(t.id??"")}else c.value[l].edit=!0}function F(l){c.value.unshift({title:"",status:1,auto:l,meta:{node_type:"any",id_tag:"",rate:"",id_dir:"",cascade_dir:"1",tag_or:"1"},edit:!0,ext_key:new Date().valueOf()})}function M(){if(!p.id)return;let l=parseInt(p.id);c.value.forEach((e,t)=>{l===e.id&&(C.value=t,D.value=e)})}async function L(l){const e=c.value[l];T.push({path:v.path,query:{id:e.id}})}let _={mode:"directory",id_dir:"",id_tag:""},d={keyword:"",node_type:"",rate:"",cascade_dir:"1"};function R(l){if(l){for(let e in _)if(Object.prototype.hasOwnProperty.call(_,e))switch(e){default:_[e]=l[e]??"";break;case"mode":_[e]=l[e]??"directory";break;case"id_dir":_[e]=l[e]??"";break}for(let e in d)if(Object.prototype.hasOwnProperty.call(d,e))switch(e){default:d[e]=l[e]??"";break;case"cascade_dir":d[e]=l[e]??"1";break}}}const k=S([]);let r;function N(){const l=q.copyObject(d);_.id_tag&&(l.id_tag=_.id_tag),_.id_dir&&(l.id_dir=_.id_dir),!d.rate&&!d.node_type&&!d.keyword.trim()?l.mode="directory":l.mode="search",r.go(l)}async function G(l){var e;if(console.info("getList",v.name),k.value=[],l)k.value=l;else{switch(v.name){default:break;case"Recycle":_.status="deleted";break;case"Favourite":break}let t={id_fav:(e=D.value)==null?void 0:e.id};switch(_.mode){case"directory":t=Object.assign(t,_);break;case"search":t=Object.assign(t,_,d);break}const s=await w("file/get",t);if(!s)return;k.value=r.sortList(s.list,r.sortVal.value)}r&&r.setList(k.value)}function j(l,e){switch(l){case"reload":G();break;case"tag":r.go({id_tag:`${e}`,mode:"tag"});break;case"node":let t;for(let s=0;s<k.value.length;s++)if(k.value[s].id===e){t=k.value[s];break}if(!t)break;switch(t.type){case"directory":r.go({id_dir:`${t.id}`,mode:"directory"});break;default:ce({mode:"favourite",id_fav:p.id,with:"file,crumb"},t.id??0);break}break}}function B(l){const e=[];switch(l.ctrlKey&&e.push("ctrl"),l.shiftKey&&e.push("shift"),e.push(l.code),e.join("_")){default:return;case"NumpadEnter":case"Enter":if(!l.target||l.target.id!=="searchBarInput")return;N();break}}async function J(l){console.info("node_hint");const t=await w("file/get",{mode:"search",node_type:"directory",keyword:l,with:"crumb",limit:"20"});return t?("root".indexOf(l)!==-1&&t.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),t.list):!1}function X(l,e){console.info("node_add",l,e);const t=c.value[e];t.meta=Object.assign(t.meta??{},{pid:l.id}),c.value[e].node=l}function Z(l){var t;if(console.info("node_parse"),!l)return"";const e=[];return(t=l.crumb_node)==null||t.forEach(s=>{s.title&&e.push(s.title)}),l.title&&e.push(l.title),`/ ${e.join(" / ")}`}async function W(l){const e=new FormData;return e.set("keyword",l),e.set("size","20"),await w("tag/get",e)}function ee(l,e){const t=c.value[e];t.tag||(t.tag=[]),t.tag.push(l);const s=[];t.tag.forEach(n=>s.push(n.id??0)),t.meta=Object.assign(t.meta??{},{id_tag:s.join(",")})}function H(l){return l?`${l.group.title} : ${l.title}`:""}function te(l,e){const t=c.value[l];t.tag||(t.tag=[]),t.tag.splice(e,1);const s=[];t.tag.forEach(n=>s.push(n.id??0)),t.meta=Object.assign(t.meta??{},{id_tag:s.join(",")})}return(l,e)=>(i(),u("div",pe,[o("div",ke,[o("div",{class:m({fav_group:!0,fav_group_add:!0,active:C.value===-1})},[o("span",{class:"buttonStyle sysIcon sysIcon_plus-square-o",onClick:e[0]||(e[0]=t=>F(0))}),o("span",{class:"buttonStyle sysIcon sysIcon_A",onClick:e[1]||(e[1]=t=>F(1))})],2),(i(!0),u(y,null,f(c.value,(t,s)=>(i(),u("div",{key:`favView_group_${t.ext_key?t.ext_key:t.id}`,class:m({active:C.value===s,fav_group:!0,edit:t.edit})},[t.auto?(i(),u(y,{key:0},[t.edit?(i(),u("div",{key:1,class:m({active:C.value==s,auto:!0})},[I(z,{class:"title",modelValue:t.title,"onUpdate:modelValue":n=>t.title=n,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),o("div",we,[o("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:n=>O(s)},null,8,$e),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>h(s)},null,8,Se)]),o("table",null,[o("tbody",null,[o("tr",null,[e[15]||(e[15]=o("td",null,"nodeType",-1)),o("td",null,[b(o("select",{"onUpdate:modelValue":n=>t.meta.node_type=n},[(i(!0),u(y,null,f(a($).fileType,(n,A)=>(i(),u("option",{value:n,key:`FAV_G_${t.ext_key}_NODE_TYPE_${A}`},V(n),9,Ie))),128))],8,ge),[[g,t.meta.node_type]])])]),o("tr",null,[e[16]||(e[16]=o("td",null,"withTag",-1)),o("td",he,[o("div",null,[(i(!0),u(y,null,f(t.tag,(n,A)=>(i(),u("p",{key:`FAV_G_${t.ext_key}_TAG_BTN_${A}`},[o("span",null,V(H(n)),1),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:xe=>te(s,A)},null,8,Oe)]))),128))]),I(K,{"get-list":W,submit:ee,"parse-text":H,meta:s},null,8,["meta"])])]),o("tr",null,[e[17]||(e[17]=o("td",null,"or",-1)),o("td",null,[b(o("input",{type:"checkbox","onUpdate:modelValue":n=>t.meta.tag_or=n,id:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_TAG_OR`,"true-value":"1","false-value":""},null,8,Ge),[[Q,t.meta.tag_or]]),o("label",{class:"buttonStyle",for:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_TAG_OR`},null,8,Ae)])]),o("tr",null,[e[18]||(e[18]=o("td",null,"root",-1)),o("td",null,[I(K,{"get-list":J,submit:X,"parse-text":Z,modelValue:t.node,"onUpdate:modelValue":n=>t.node=n,meta:s},null,8,["modelValue","onUpdate:modelValue","meta"])])]),o("tr",null,[e[19]||(e[19]=o("td",null,"cascade",-1)),o("td",null,[b(o("input",{type:"checkbox","onUpdate:modelValue":n=>t.meta.cascade_dir=n,id:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_CASCADE`,"true-value":"1","false-value":""},null,8,Ue),[[Q,t.meta.cascade_dir]]),o("label",{class:"buttonStyle",for:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_CASCADE`},null,8,Ee)])]),o("tr",null,[e[20]||(e[20]=o("td",null,"rate",-1)),o("td",null,[I(fe,{node:null,modelValue:t.meta.rate,"onUpdate:modelValue":n=>t.meta.rate=n},null,8,["modelValue","onUpdate:modelValue"])])])])])],2)):(i(),u("div",{key:0,class:m({active:C.value==s,auto:!0}),onClick:n=>L(s)},[o("div",be,V(t.title),1),o("div",{class:"operator",onClick:e[2]||(e[2]=P(()=>{},["stop"]))},[o("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:n=>O(s)},null,8,Ce),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>h(s)},null,8,Ve)])],10,me))],64)):(i(),u(y,{key:1},[t.edit?(i(),u("div",{key:1,class:m({active:C.value==s})},[I(z,{class:"title",modelValue:t.title,"onUpdate:modelValue":n=>t.title=n,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),o("div",Le,[o("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:n=>O(s)},null,8,Re),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>h(s)},null,8,Ne)])],2)):(i(),u("div",{key:0,class:m({active:C.value==s}),onClick:n=>L(s)},[o("div",De,V(t.title),1),o("div",{class:"operator",onClick:e[3]||(e[3]=P(()=>{},["stop"]))},[o("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:n=>O(s)},null,8,Fe),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>h(s)},null,8,Me)])],10,Te))],64))],2))),128))]),o("div",{class:"fav_content",ref_key:"contentDOM",ref:E},[o("div",je,[o("div",Be,[o("label",null,[e[21]||(e[21]=o("span",null,"Title : ",-1)),b(o("input",{id:"searchBarInput",type:"text","onUpdate:modelValue":e[4]||(e[4]=t=>a(d).keyword=t)},null,512),[[ie,a(d).keyword]])]),o("label",null,[e[22]||(e[22]=o("span",null,"Type : ",-1)),b(o("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>a(d).node_type=t)},[(i(!0),u(y,null,f(a($).fileType,(t,s)=>(i(),u("option",{key:`FAV_SCH_CON_TYPE_${s}`},V(t),1))),128))],512),[[g,a(d).node_type]])]),o("label",null,[e[23]||(e[23]=o("span",null,"Rate : ",-1)),Y?b((i(),u("select",{key:0,"onUpdate:modelValue":e[6]||(e[6]=t=>a(d).rate=t)},[(i(!0),u(y,null,f(a($).rateMobile,(t,s)=>(i(),u("option",{value:s,key:`FAV_SCH_CON_RATE_${s}`},V(t),9,He))),128))],512)),[[g,a(d).rate]]):b((i(),u("select",{key:1,class:"sysIcon","onUpdate:modelValue":e[7]||(e[7]=t=>a(d).rate=t)},[(i(!0),u(y,null,f(a($).rate,(t,s)=>(i(),u("option",{value:s,innerHTML:t,key:`FAV_SCH_CON_RATE_${s}`},null,8,qe))),128))],512)),[[g,a(d).rate]])]),o("label",null,[o("button",{class:"buttonStyle sysIcon sysIcon_search",onClick:N})])]),a(r)&&a(r).showSelectionOp?(i(),u("div",Pe,[o("a",{class:"buttonStyle",onClick:e[8]||(e[8]=t=>a(r).bathOp("browser"))},"OP"),o("a",{class:"buttonStyle",onClick:e[9]||(e[9]=t=>a(r).bathOp("rename"))},"RN"),o("a",{class:"buttonStyle",onClick:e[10]||(e[10]=t=>a(r).bathOp("move"))},"MV"),a(v).name!=="Recycle"?(i(),u("a",{key:0,class:"buttonStyle",onClick:e[11]||(e[11]=t=>a(r).bathOp("delete"))},"DEL")):U("",!0),a(v).name==="Recycle"?(i(),u("a",{key:1,class:"buttonStyle",onClick:e[12]||(e[12]=t=>a(r).bathOp("delete_forever"))},"rDEL")):U("",!0),e[25]||(e[25]=o("a",{class:"sysIcon sysIcon_fengefu"},null,-1)),a(r)&&a(r).sortVal?(i(),u("label",Qe,[e[24]||(e[24]=o("span",null,"Sort : ",-1)),b(o("select",{"onUpdate:modelValue":e[13]||(e[13]=t=>a(r).sortVal.value=t),onChange:e[14]||(e[14]=t=>a(r).setSort(l.sortVal))},[(i(!0),u(y,null,f(a($).sort,(t,s)=>(i(),u("option",{value:s,key:`FV_SCH_CON_SORT_${s}`},V(t),9,ze))),128))],544),[[g,a(r).sortVal.value]])])):U("",!0),e[26]||(e[26]=o("a",{class:"sysIcon sysIcon_fengefu"},null,-1)),(i(!0),u(y,null,f(a($).listType,(t,s)=>(i(),u("a",{class:m(["buttonStyle","sysIcon",`sysIcon_listType_${t}`,{active:a(r).mode.value===t}]),onClick:n=>a(r).setMode(t),key:`FAV_SCH_CON_ICON_${s}`},null,10,Ke))),128))])):U("",!0)]),o("div",{class:m(["list_fav",`mode_${a(r)?a(r).mode.value:""}`])},[(i(!0),u(y,null,f(k.value,(t,s)=>(i(),ue(ve,{key:s,node:t,index:s,selected:!1,onGo:j},null,8,["node","index"]))),128))],2)],512)]))}});export{tt as default};

import{a as O,r as m,z as L,G as x,h as q,c as s,b as t,D as b,Q as D,u as i,E,F as r,e as M,o as u,t as d,M as y,A as U}from"./basic-DfhHe1pL.js";import{u as j,b as w,q as B,c as C,d as H}from"./index-CghNFSQ6.js";const $={class:"form"},F=["value"],T=O({__name:"LogView",setup(N){j();const o=m(null);C();const V=H();let a={id:"",status:"",type:""},_=[[-2,"unknown"],[-1,"failed"],[0,"success"],[1,"new"],[2,"working"]];const g=m([]);L(async()=>{Object.assign(a,x.copyObject(V.query)),c(),o.value&&o.value.addEventListener("scroll",k)}),w(async n=>{console.info(n),c()}),q(()=>{var n;o.value&&((n=o.value)==null||n.removeEventListener("scroll",k))});async function k(n){if(console.info(n),!o.value)return;let e=o.value,l=(e==null?void 0:e.scrollTop)+(e==null?void 0:e.clientHeight)+(e==null?void 0:e.clientHeight);(e==null?void 0:e.scrollHeight)<l&&x.debounce(async()=>{await c()},500,"logViewDebounce")}let f=1,v=!1;async function c(n=!1){if(v)return;v=!0,n&&(f=1);const e=await B("log/get",Object.assign({page:f},a));if(f+=1,v=!1,!e)return;if(!e.length){f--;return}const l=n?[]:g.value;for(let p=0;p<e.length;p++)l.push(Object.assign(e[p],{ext_key:`${new Date().valueOf()}_${Math.random()}`}));g.value=l}return(n,e)=>(u(),s("div",{class:"fr_content view_log",ref_key:"contentDOM",ref:o},[t("div",$,[t("label",null,[e[4]||(e[4]=t("span",null,"ID : ",-1)),b(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>i(a).id=l)},null,512),[[D,i(a).id]])]),t("label",null,[e[5]||(e[5]=t("span",null,"status : ",-1)),b(t("select",{"onUpdate:modelValue":e[1]||(e[1]=l=>i(a).status=l)},[(u(!0),s(r,null,M(i(_),(l,p)=>(u(),s("option",{value:l[0],key:p},d(l[1]),9,F))),128))],512),[[E,i(a).status]])]),t("label",null,[e[6]||(e[6]=t("span",null,"type : ",-1)),b(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=l=>i(a).type=l)},null,512),[[D,i(a).type]])]),t("label",null,[t("button",{type:"button",onClick:e[3]||(e[3]=l=>c(!0))},"query")])]),t("table",null,[t("tbody",null,[e[7]||(e[7]=t("tr",null,[t("th",null,"id"),t("th",null,"type"),t("th",null,"status"),t("th",null,"time_create"),t("th",null,"time_update"),t("th",null,"payload")],-1)),(u(!0),s(r,null,M(g.value,l=>(u(),s("tr",{key:`log_view_${l.ext_key}`},[t("td",null,d(l.id),1),t("td",null,d(l.type),1),t("td",null,[l.status===-2?(u(),s(r,{key:1},[y("unknown")],64)):l.status===-1?(u(),s(r,{key:2},[y("failed")],64)):l.status===0?(u(),s(r,{key:3},[y("success")],64)):l.status===1?(u(),s(r,{key:4},[y("waiting")],64)):l.status===2?(u(),s(r,{key:5},[y("working")],64)):U("",!0)]),t("td",null,d(l.time_create),1),t("td",null,d(l.time_update),1),t("td",null,d(l.payload),1)]))),128))])])],512))}});export{T as default};

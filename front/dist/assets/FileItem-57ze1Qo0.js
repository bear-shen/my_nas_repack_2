import{a as K,r as F,w as x,o as Q,b as n,c as o,F as d,f as D,A as M,j as ee,u as h,e as l,n as r,x as G,R as C,t as s,G as X}from"./basic-BYt0z23_.js";import{e as L,_ as Y,a as ne,u as oe,q as te}from"./index-7dhopxhZ.js";import{_ as J}from"./ContentEditable.vue_vue_type_script_setup_true_lang-BfoL63xV.js";import{H as se}from"./Hinter-BL9XPkTY.js";const le={key:0,class:"sysIcon sysIcon_cc-star"},ie={key:1,class:"sysIcon sysIcon_cc-star-half"},de={key:2,class:"sysIcon sysIcon_c-cstar-o"},ae=K({__name:"Rater",props:{node:{},modelValue:{}},emits:["update:modelValue"],setup(S,{emit:E}){const p=E,b=S,k=F(null),_=F(b.modelValue),y=F(b.modelValue);x(()=>b.modelValue,async f=>{_.value=f,y.value=f,g()}),Q(()=>{g(),k.value&&(k.value.addEventListener("mousemove",f=>{var v;let m=Math.round(10*f.offsetX/(((v=k.value)==null?void 0:v.offsetWidth)??1));m<0&&(m=0),m>10&&(m=10),y.value=m,g()}),k.value.addEventListener("mouseleave",f=>{y.value=_.value,g()}),k.value.addEventListener("click",async f=>{_.value=y.value,g(),b.node?await L.op_rate(_.value,b.node):p("update:modelValue",_.value)}))});const u=F([]);function g(){switch(y.value){default:case 0:u.value=[0,0,0,0,0];break;case 1:u.value=[1,0,0,0,0];break;case 2:u.value=[2,0,0,0,0];break;case 3:u.value=[2,1,0,0,0];break;case 4:u.value=[2,2,0,0,0];break;case 5:u.value=[2,2,1,0,0];break;case 6:u.value=[2,2,2,0,0];break;case 7:u.value=[2,2,2,1,0];break;case 8:u.value=[2,2,2,2,0];break;case 9:u.value=[2,2,2,2,1];break;case 10:u.value=[2,2,2,2,2];break}}return(f,m)=>(n(),o("span",{class:"rater",ref_key:"rater",ref:k},[(n(!0),o(d,null,D(u.value,v=>(n(),o(d,null,[v==2?(n(),o("span",le)):M("",!0),v==1?(n(),o("span",ie)):M("",!0),v==0?(n(),o("span",de)):M("",!0)],64))),256))],512))}}),re=Y(ae,[["__scopeId","data-v-06421b4e"]]),ue=["data-index","data-id"],ce={class:"content"},pe=["src"],_e={key:0,class:"thumb"},ke=["src"],ye={class:"meta"},fe=["title"],me=["title"],ve={class:"time"},he=["title"],be={key:2},ge={key:3},Ie=["title"],we=["title"],$e={key:2},Ve={key:3},Ce={key:0,class:"tag_list"},De=["onClick"],Fe={key:1,class:"tag_list editing"},Me=["onClick"],Ge={class:"tag_hinter_bar"},Se=["src"],Ee=["title"],Le=["title"],Be={key:0,class:"thumb"},Re=["src"],Te=["title"],Ue=["title"],ze=["title"],Ne={class:"time"},Oe=K({__name:"FileItem",props:{node:{},index:{}},emits:["go","onSelect"],setup(S,{emit:E}){ne();const p=S,b=E,k=oe();let _=F(k.get("file_view_mode")??"detail");k.listen("file_view_mode",e=>{_.value=e});const y=F(null);Q(()=>{y.value&&(p.node._dom=y.value)}),ee(()=>{});function u(e,t){console.info("go",e,t),t&&b("go",e,t)}function g(e){if(e&&p.node.tag){for(let t=0;t<p.node.tag.length;t++)for(let a=0;a<p.node.tag[t].sub.length;a++)if(p.node.tag[t].sub[a].id===e){p.node.tag[t].sub.splice(a,1);return}}}async function f(e){const t=new FormData;return t.set("keyword",e),t.set("size","20"),await te("tag/get",t)}function m(e){const t=p.node;t.tag||(t.tag=[]);let a=null;for(let w=0;w<t.tag.length;w++)if(t.tag[w].id===e.id_group){a=t.tag[w];break}a||(a=e.group,a.sub=[],t.tag.push(a)),a.sub.push(e)}function v(e){return e?`${e.group.title} : ${e.title}`:""}async function I(e){console.info("op_dblclick",p.node.id,e),u("node",p.node.id)}let B=new Date().valueOf();async function $(e){const t=new Date().valueOf(),a=t-B;switch(B=t,e==null?void 0:e.pointerType){default:case"mouse":case"pen":break;case"touch":a<300&&await I(e);break}}function V(e){}return(e,t)=>{var a,w,R,T,U,z,N,O,A,P,q,H,j,W;return n(),o("div",{class:r(["node_node",`mode_${h(_)}`,{select:e.node._selected}]),"data-index":e.index,"data-id":e.node.id,ref_key:"curDOM",ref:y},[h(_)==="detail"?(n(),o(d,{key:0},[l("div",ce,[e.node.status?(n(),o(d,{key:0},[(a=e.node.file_index)!=null&&a.cover&&e.node._in_screen?(n(),o("div",{key:0,class:"thumb",onDblclick:I,onClick:$},[l("img",{src:(w=e.node.file_index)==null?void 0:w.cover.path},null,8,pe)],32)):(n(),o("div",{key:1,onDblclick:I,onClick:$,class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`])},null,34))],64)):(n(),o(d,{key:1},[(R=e.node.file_index)!=null&&R.cover&&e.node._in_screen?(n(),o("div",_e,[l("img",{src:(T=e.node.file_index)==null?void 0:T.cover.path},null,8,ke)])):(n(),o("div",{key:1,class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`])},null,2))],64)),l("div",ye,[e.node.status?(n(),o(d,{key:0},[e.node._renaming?(n(),o(d,{key:0},[G(J,{modelValue:e.node.title,"onUpdate:modelValue":t[0]||(t[0]=i=>e.node.title=i),class:"title editing","auto-focus":!0,onMousedown:C(V,["stop"]),onPointerdown:C(V,["stop"])},null,8,["modelValue"]),G(J,{modelValue:e.node.description,"onUpdate:modelValue":t[1]||(t[1]=i=>e.node.description=i),class:"editing",onMousedown:C(V,["stop"]),onPointerdown:C(V,["stop"])},null,8,["modelValue"]),l("button",{class:r(["active","sysIcon","sysIcon_save"]),onClick:t[2]||(t[2]=i=>h(L).op_rename(e.node))},"SAVE")],64)):(n(),o(d,{key:1},[e.node.type==="directory"?(n(),o("p",{key:0,class:r(["title","listIcon",`listIcon_file_${e.node.type}`]),title:e.node.title},s(e.node.title),11,fe)):(n(),o("p",{key:1,class:r(["title"]),title:e.node.title},s(e.node.title),9,me)),l("p",ve,[G(re,{node:e.node,modelValue:e.node.rate,"onUpdate:modelValue":t[3]||(t[3]=i=>e.node.rate=i)},null,8,["node","modelValue"]),l("span",{title:`C:${e.node.time_create}\r
U:${e.node.time_update}`},s((e.node.time_create??"").substring(0,10)),9,he)]),e.node.is_file?(n(),o("p",be,s(h(X).kmgt(((N=(z=(U=e.node)==null?void 0:U.file_index)==null?void 0:z.raw)==null?void 0:N.size)??0,2))+"B "+s(e.node.description),1)):(n(),o("p",ge,s(e.node.description),1))],64))],64)):(n(),o(d,{key:1},[e.node.type==="directory"?(n(),o("p",{key:0,class:r(["title","listIcon","listIcon_file_directory"]),title:e.node.title},s(e.node.title),9,Ie)):(n(),o("p",{key:1,class:r(["title"]),title:e.node.title},s(e.node.title),9,we)),l("p",null,[(n(!0),o(d,null,D(e.node.crumb_node,(i,c)=>(n(),o("span",{key:"FI_CR_"+e.node.id+"_"+c}," / "+s(i.title),1))),128))]),l("p",null,s(e.node.time_create),1),e.node.is_file?(n(),o("p",$e,s(h(X).kmgt(((P=(A=(O=e.node)==null?void 0:O.file_index)==null?void 0:A.raw)==null?void 0:P.size)??0,2))+"B "+s(e.node.description),1)):(n(),o("p",Ve,s(e.node.description),1))],64))])]),!e.node._tagging&&e.node.tag?(n(),o("div",Ce,[(n(!0),o(d,null,D(e.node.tag,i=>(n(),o("dl",{key:"FI_TG_"+e.node.id+"_"+i.id},[l("dt",null,s(i.title),1),(n(!0),o(d,null,D(i.sub,c=>(n(),o("dd",{key:"FI_TG_"+e.node.id+"_"+i.id+"_"+c.id,onClick:Z=>u("tag",(c==null?void 0:c.id)??0)},s(c.title),9,De))),128))]))),128))])):M("",!0),e.node._tagging?(n(),o("div",Fe,[(n(!0),o(d,null,D(e.node.tag,i=>(n(),o("dl",{key:"FI_TG_"+e.node.id+"_"+i.id},[l("dt",null,s(i.title),1),(n(!0),o(d,null,D(i.sub,c=>(n(),o("dd",{key:"FI_TG_"+e.node.id+"_"+i.id+"_"+c.id,onClick:Z=>g((c==null?void 0:c.id)??0)},[l("span",null,s(c.title),1),t[5]||(t[5]=l("span",{class:"sysIcon sysIcon_delete"},null,-1))],8,Me))),128))]))),128)),l("div",Ge,[G(se,{"get-list":f,submit:m,"parse-text":v,onMousedown:C(V,["stop"]),onPointerdown:C(V,["stop"])}),l("button",{class:r(["active","sysIcon","sysIcon_save"]),onClick:t[4]||(t[4]=i=>h(L).op_tag(e.node))},"SAVE")])])):M("",!0)],64)):h(_)==="img"?(n(),o(d,{key:1},[e.node.status?(n(),o(d,{key:0},[(q=e.node.file_index)!=null&&q.cover&&e.node._in_screen?(n(),o("div",{key:0,class:"thumb",onDblclick:I,onClick:$},[l("img",{src:(H=e.node.file_index)==null?void 0:H.cover.path},null,8,Se)],32)):(n(),o("div",{key:1,class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`]),onDblclick:I,onClick:$},null,34)),e.node.type==="directory"?(n(),o("p",{key:2,class:r(["title","listIcon",`listIcon_file_${e.node.type}`]),title:e.node.title},s(e.node.title),11,Ee)):(n(),o("p",{key:3,class:r(["title"]),title:e.node.title},s(e.node.title),9,Le))],64)):(n(),o(d,{key:1},[(j=e.node.file_index)!=null&&j.cover&&e.node._in_screen?(n(),o("div",Be,[l("img",{src:(W=e.node.file_index)==null?void 0:W.cover.path},null,8,Re)])):(n(),o("div",{key:1,class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`])},null,2)),e.node.type==="directory"?(n(),o("p",{key:2,class:r(["title","listIcon",`listIcon_file_${e.node.type}`]),title:e.node.title},s(e.node.title),11,Te)):(n(),o("p",{key:3,class:r(["title"]),title:e.node.title},s(e.node.title),9,Ue))],64))],64)):h(_)==="text"?(n(),o(d,{key:2},[l("p",{class:"type",onDblclick:I,onClick:$},[l("span",{class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`])},null,2),l("span",null,s(e.node.type),1)],32),l("p",{class:"title",onDblclick:I,onClick:$,title:e.node.title},s(e.node.title),41,ze),l("p",Ne,s(e.node.time_create),1)],64)):M("",!0)],10,ue)}}}),je=Y(Oe,[["__scopeId","data-v-c64ae5dd"]]);export{je as F,re as R};

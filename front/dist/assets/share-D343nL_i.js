import{d as ne,r as d,o as ae,C as j,c,e as i,t as y,U as m,F as b,u as M,n as _,f as J,R as se,S as x,X as le,a8 as ie,I as re,H as L,_ as oe,Y as ue,Z as ce,$ as de,a0 as ve,a1 as H,b as o,V as pe,aa as Ae,T as Q,ad as fe,ae as we}from"./basic-BtQQXLGp.js";const ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAF1mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0ZURhdGU9IjIwMjUtMDQtMjlUMTk6NTk6MzQrMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDI1LTA1LTI1VDAwOjQ5OjAxKzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI1LTA1LTI1VDAwOjQ5OjAxKzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjVlMmU1MGU4LTg3ZmQtN2M0My04NGE3LTk4NjVkMmExMGY5MiIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmFkYjg3ZWVhLWIyZWYtODA0Ni1hZjE5LTg2ZmI4MDA4ZTFkZiIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjM3NzYzOTg3LTEzNWYtZWU0Ny1iYWNlLTBjZDNiMGNmNGNkOCI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjM3NzYzOTg3LTEzNWYtZWU0Ny1iYWNlLTBjZDNiMGNmNGNkOCIgc3RFdnQ6d2hlbj0iMjAyNS0wNS0yNVQwMDo0OTowMSswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo1ZTJlNTBlOC04N2ZkLTdjNDMtODRhNy05ODY1ZDJhMTBmOTIiIHN0RXZ0OndoZW49IjIwMjUtMDUtMjVUMDA6NDk6MDErMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE4IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6TS4caAAABQklEQVR4nO3d0YnCQBRA0Sj+by/biZXaib1sBbMdJELE88B7fhUyeHmYcRQva60tzlUv4NsVACsAVgCsAFgBsAJgt6Mn/G3b8xMLOeFXL2DPz8HjTQBWAKwAWAGwAmAFwAqAHe4DXjD6Pny6JgArAFYArABYAbACYAXACoAVACsAVgDsHZ8FnXXH13/IizcBWAGwAmAFwAqAFQArADZhH0Dvw7UmACsAVgCsAFgBsAJgBcAm7AM6D4hTAKwA2CvvAX3/f9/R76h3X78mACsAVgBswj6g84A4BcAKgBUAKwBWAKwA2IR9QOcBcQqAFQArAFYArABYAbAJ+4DOA+IUACsAVgCsAFgBsAJgBcAKgBUAKwA24bOgs6b/z9muJgArAFYArABYAbACYAXALmstvYav1gRgBcAKgBUAKwBWAKwA2D94NhAMfrN7rgAAAABJRU5ErkJggg==",he={class:"sh_fr_header"},Ie={class:"operator"},ge={key:0,class:"err_msg"},me={class:"sh_fr_list"},be=["id","value"],ke=["for"],De=["onClick"],Ne={class:"operates"},_e={key:0},Me=["onClick"],Re=["onClick"],Ce=["onClick"],Le={key:0},Ge={class:"preLine"},Ze={class:_({pagination:1,isMobile:!1})},Oe={class:"sh_fr_footer"},Be=ne({__name:"share",setup(Te){const G=d(""),v=d(0);let I="";const p=d([]),Z=d(null),O=d(null),k=d([]),D=d(null);ae(async()=>{const e=new URL(location.href);B(e)});function E(e,t){const n=new URL(location.href);n.searchParams.set("id",e),t?n.searchParams.set("node",t.toString()):n.searchParams.delete("node"),history.pushState(null,"",n),B(n)}addEventListener("popstate",e=>{B(new URL(location.href))});async function B(e){if(I=e.searchParams.get("id")??"",!I)return C("invalid uuid");let t=e.searchParams.get("node");k.value=[];const n=await P(I,t??!1);if(!n)return C("data fetch failed");p.value=n.node??[],O.value=n.parent??null,Z.value=n.cur}const S=d(""),U=d("");async function R(e,t){var n;if(e.type==="directory")E(I,e.id),X();else{if(!((n=e==null?void 0:e.file_index)!=null&&n.raw))return;switch(t){default:return await T("single",e);case"detail":u.value=e,p.value.forEach((s,a)=>{s.type!="directory"&&s.id==e.id&&(A.value=a)}),V(),v.value=1,setTimeout(()=>{var s,a;W.value={h:((s=D.value)==null?void 0:s.clientHeight)??0,w:((a=D.value)==null?void 0:a.clientWidth)??0}},10);break}}}async function T(e,t){const n=[];switch(e){case"list":k.value.forEach(a=>{p.value.forEach(l=>{l.id===a&&n.push(l)})});break;case"total":p.value.forEach(a=>{n.push(a)});break;case"single":t&&n.push(t);break}if(!n.length)return;console.info(n);const s=new re(F("",n),async a=>{const l=await P(I,a.id);return l?F(a.path,l.node??[]):[]});await s.prepare(),await s.download((a,l,r,f,w)=>{let N=(a+l)/r;N*=1e4,N=Math.round(N),N/=100,S.value=`${f}/${w} Files, ${N}%, ${L.kmgt(l)} / ${L.kmgt(r)}`,U.value=`width: ${N}%;`}),console.info(n.length===1,n[0].type!=="directory"),n.length===1&&n[0].type!=="directory"?await s.completeFile():(await s.build(),s.complete())}async function P(e,t){return await te("share/node_list",t?{id:e,id_node:t}:{id:e})}function F(e,t){const n=[];return t.forEach(s=>{var l;const a={id:s.id,id_parent:s.id_parent,path:"",url:"",size:0,type:s.type??""};if(a.path=[e??"",s.title??""].join("/"),s.type!=="directory"){const r=(l=s.file_index)==null?void 0:l.raw;if(!r)return;a.url=h(s,"raw"),a.size=r.size??0}n.push(a)}),n}function h(e,t="raw"){if(!e.file_index[t])return"";let n=new URL(location.href).pathname;return n.substring(0,n.lastIndexOf("/"))+e.file_index[t].path+"?shareId="+I+"&filename="+e.title}const Y={audio:oe,video:ue,image:ce,pdf:de,text:ve,office:H,base:H};let A=d(-1);const u=d(null),z=d({id:0,title:"",cover:"",preview:"",normal:"",raw:"",sameName:[]}),W=d({w:0,h:0});function K(e){console.info("emitNav",e),g(A.value,e)}function g(e,t,n=0){if(!t)return;let s=p.value.length;if(s<1)return;let a=e,l=0;do{for(a=a+t;a<0;)a+=s;for(;a>s-1;)a-=s;if(l+=1,l>s)return;if(p.value[a]&&p.value[a].type!=="directory")break}while(!0);A.value=a,V()}function V(){const e=p.value[A.value];if(u.value=e,!e.file_index.preview&&["audio","video"].indexOf(e.type)!==-1){let s=!1;p.value.forEach(a=>{if(a.id_parent!==e.id_parent||s)return;let l=!1;if(j.coverKeyword.forEach(r=>{j.imgKeyword.forEach(f=>{e.title.toLowerCase().indexOf(r)!==-1&&e.title.toLowerCase().indexOf(f)!==-1&&(l=!0)})}),l){s=!0;let r;r||(r=e.file_index.preview),r||(r=e.file_index.normal),r||(r=e.file_index.raw),e.file_index.preview=r}})}const t={id:e.id,title:e.title,cover:h(e,"cover"),preview:h(e,"preview"),normal:h(e,"normal"),raw:h(e,"raw"),sameName:[]};let n=t.title.lastIndexOf(".");if(n!==-1){let s=t.title.substring(0,n)??"";s&&p.value.forEach(a=>{var r,f;if(a.id==t.id||((r=a.title)==null?void 0:r.indexOf(s))!==0)return;let l=(f=a.title)==null?void 0:f.substring(s.length);t.sameName.push({title:l,type:a.type??"",preview:h(a,"preview"),normal:h(a,"normal"),raw:h(a,"raw")})})}t.id!=z.value.id&&(z.value=t)}function q(){setTimeout(()=>{var e,t;D.value&&(W.value={h:((e=D.value)==null?void 0:e.clientHeight)??0,w:((t=D.value)==null?void 0:t.clientWidth)??0})},10)}window.addEventListener("resize",q);function X(){A.value=-1,u.value=null,v.value=0}async function ee(e){if(u.value)switch(e.key){case"ArrowLeft":if(!v.value)break;if(e.preventDefault(),e.stopPropagation(),["audio","video"].indexOf(u.value.type??"")!==-1)return;g(A.value,-1);break;case"ArrowRight":if(!v.value)break;if(e.preventDefault(),e.stopPropagation(),["audio","video"].indexOf(u.value.type??"")!==-1)return;g(A.value,1);break;case"a":case"PageUp":if(!v.value)break;e.preventDefault(),e.stopPropagation(),g(A.value,-1);break;case"d":case"PageDown":if(!v.value)break;e.preventDefault(),e.stopPropagation(),g(A.value,1);break}}document.addEventListener("keydown",ee);function te(e,t,n){return new Promise((s,a)=>{let l;if(t instanceof FormData)l=t;else{l=new FormData;for(const w in t)Object.prototype.hasOwnProperty.call(t,w)&&l.append(w,t[w])}const r=new XMLHttpRequest;r.withCredentials=!0,r.onreadystatechange=function(){if(r.readyState!==4)return;if(r.status>=400)return C(`${r.status}: ${r.statusText}`);const w=JSON.parse(r.responseText);w.code&&C(w.msg),s(w.data)};let f=new URL(location.href).pathname;r.open("POST",f.substring(0,f.lastIndexOf("/"))+j.apiPath+e),r.send(l)})}function C(e){throw G.value=e,new Error(e)}return(e,t)=>(o(),c(b,null,[i("div",he,[t[7]||(t[7]=i("div",null,[i("img",{src:ye}),i("span",null,"MyNas Share")],-1)),i("div",Ie,[k.value.length?(o(),c("span",{key:0,class:"pointer sysIcon sysIcon_download",onClick:t[0]||(t[0]=n=>T("list"))},y(k.value.length)+" Selected",1)):m("",!0),i("span",{class:"pointer sysIcon sysIcon_download",onClick:t[1]||(t[1]=n=>T("total"))},"Down All"),v.value?(o(),c("span",{key:1,class:"pointer sysIcon sysIcon_forward",onClick:t[2]||(t[2]=n=>X())},"Close")):m("",!0)])]),i("div",{class:_({sh_fr_body:!0,showDetail:v.value})},[G.value.length?(o(),c("p",ge,y(G.value),1)):(o(),c(b,{key:1},[i("ul",me,[Z.value&&Z.value.id?(o(),c("li",{key:0,class:"pointer",onClick:t[3]||(t[3]=n=>E(M(I),O.value?O.value.id:0))},t[8]||(t[8]=[i("p",null,[i("span",{class:_(["thumb","listIcon","listIcon_file_directory"])}),i("span",null,"../")],-1)]))):m("",!0),(o(!0),c(b,null,J(p.value,n=>{var s,a;return o(),c("li",{key:n.id,class:_({active:u.value&&n.id==u.value.id})},[i("p",null,[pe(i("input",{type:"checkbox",name:"selector",id:`selector_${n.id}`,value:n.id,"onUpdate:modelValue":t[4]||(t[4]=l=>k.value=l)},null,8,be),[[Ae,k.value]]),i("label",{for:`selector_${n.id}`,class:"pointer"},null,8,ke),i("span",{class:_(["thumb","listIcon",`listIcon_file_${n.type}`])},null,2),i("span",{class:"pointer title",onClick:l=>R(n,"detail")},y(n.title),9,De)]),i("p",Ne,[n.type!=="directory"?(o(),c("span",_e,y(M(L).kmgt(((a=(s=n==null?void 0:n.file_index)==null?void 0:s.raw)==null?void 0:a.size)??0)),1)):m("",!0),n.type==="directory"?(o(),c("span",{key:1,class:"pointer sysIcon sysIcon_folder",onClick:l=>R(n)},null,8,Me)):(o(),c(b,{key:2},[i("span",{class:"pointer sysIcon sysIcon_eye",onClick:l=>R(n,"detail")},null,8,Re),i("span",{class:"pointer sysIcon sysIcon_download",onClick:l=>R(n)},null,8,Ce)],64))])],2)}),128))]),u.value&&v.value?(o(),c("div",{key:0,class:"sh_fr_detail",ref_key:"detailDOM",ref:D,"data-ref-id":"1"},[(o(),se(le(Y[u.value.type]?Y[u.value.type]:Y.base),{extId:"1",isActive:!0,curIndex:0,file:z.value,dom:W.value,onNav:K},{info:x(()=>{var n,s;return[i("div",{class:_({info:!0,detail:v.value})},[v.value?(o(),c(b,{key:0},[i("p",null,y(u.value.title)+" ("+y(M(L).kmgt(((s=(n=u.value.file_index)==null?void 0:n.raw)==null?void 0:s.size)??0,2))+") ",1),u.value.crumb_node?(o(),c("p",Le,[t[9]||(t[9]=Q("Dir : ")),(o(!0),c(b,null,J(u.value.crumb_node,a=>(o(),c(b,null,[Q("/"+y(a.title),1)],64))),256))])):m("",!0),i("p",Ge,y(u.value.description),1)],64)):m("",!0)],2)]}),btnContainer:x(()=>t[10]||(t[10]=[])),navigator:x(()=>[i("div",Ze,[i("div",{class:"left",onClick:t[5]||(t[5]=n=>g(M(A),-1))},t[11]||(t[11]=[i("span",{class:"sysIcon sysIcon_arrowleft"},null,-1)])),i("div",{class:"right",onClick:t[6]||(t[6]=n=>g(M(A),1))},t[12]||(t[12]=[i("span",{class:"sysIcon sysIcon_arrowright"},null,-1)]))])]),_:1},40,["file","dom"]))],512)):m("",!0)],64))],2),i("div",Oe,[i("div",{class:"process",style:ie(U.value)},y(S.value),5)])],64))}}),$=fe(Be);$.use(we());$.mount("#app");

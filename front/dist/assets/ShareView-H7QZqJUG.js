import{u as $,b as x,q as g,c as L,d as C}from"./index-CghNFSQ6.js";import{a as M,r as v,z as S,G as k,h as V,c as l,b as n,F as o,e as m,o as s,t as i,M as h,A as b}from"./basic-DfhHe1pL.js";const j=["href"],q=["onClick"],F=M({__name:"ShareView",setup(B){$();const r=v(null);L();const D=C();let y={status:""};const _=v([]);S(async()=>{Object.assign(y,k.copyObject(D.query)),f(),r.value&&r.value.addEventListener("scroll",p)}),x(async a=>{console.info(a),f()}),V(()=>{var a;r.value&&((a=r.value)==null||a.removeEventListener("scroll",p))});async function p(a){if(console.info(a),!r.value)return;let e=r.value,t=(e==null?void 0:e.scrollTop)+(e==null?void 0:e.clientHeight)+(e==null?void 0:e.clientHeight);(e==null?void 0:e.scrollHeight)<t&&k.debounce(async()=>{await f()},500,"logViewDebounce")}let c=1,d=!1;async function f(a=!1){if(d)return;d=!0,a&&(c=1);const e=await g("share/list",Object.assign({page:c},y));if(c+=1,d=!1,!e)return;if(!e.length){c--;return}const t=a?[]:_.value;for(let u=0;u<e.length;u++)t.push(Object.assign(e[u],{ext_key:`${new Date().valueOf()}_${Math.random()}`}));_.value=t}async function O(a){await g("share/del",{id:a}),await f(!0)}return(a,e)=>(s(),l("div",{class:"fr_content view_share",ref_key:"contentDOM",ref:r},[n("table",null,[n("tbody",null,[e[0]||(e[0]=n("tr",null,[n("th",null,"id"),n("th",null,"user"),n("th",null,"path"),n("th",null,"time_to"),n("th",null,"time_create"),n("th",null,"time_update"),n("th",null,"operate")],-1)),(s(!0),l(o,null,m(_.value,t=>(s(),l("tr",{key:`share_view_${t.ext_key}`},[n("td",null,[n("a",{href:`./share.html/${t.id}`,target:"_blank"},i(t.id),9,j)]),n("td",null,i(t.user.name),1),n("td",null,[(s(!0),l(o,null,m(t.node,u=>(s(),l("p",{key:`share_view_${t.ext_key}_${u.id}`},i(u.node_path)+"/"+i(u.title),1))),128))]),n("td",null,[t.status===0?(s(),l(o,{key:1},[h("Stopped")],64)):t.status===1?(s(),l(o,{key:2},[h(i(t.time_to),1)],64)):t.status===2?(s(),l(o,{key:3},[h("Long")],64)):b("",!0)]),n("td",null,i(t.time_create),1),n("td",null,i(t.time_update),1),n("td",null,[t.status!==0?(s(),l("button",{key:0,class:"sysIcon sysIcon_delete",onClick:u=>O(t.id)},"Delete ",8,q)):b("",!0)])]))),128))])])],512))}});export{F as default};

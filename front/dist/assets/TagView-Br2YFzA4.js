import{a as R,u as E,b as F}from"./index-DuaeZG_K.js";import{d as H,r as k,o as N,H as z,J as _,q as J,c,e as o,n as h,F as v,f as I,U as V,b as d,t as y,D as p}from"./basic-CIm7r3-8.js";import{_ as m}from"./ContentEditable.vue_vue_type_script_setup_true_lang-DzChvZgB.js";import{H as Q}from"./Hinter-BvA4fZLK.js";const A={class:"list_tag_group"},K={class:"title"},P=["onClick"],W={class:"operator"},X=["onClick"],Y=["onClick"],Z=["onClick"],x=["onClick"],ee={class:"operator"},te=["onClick"],se=["onClick"],oe={class:"list_tag"},le={class:"title"},ne=["onClick"],ae=["onClick"],ie={key:0,class:"description"},ue={key:1,class:"alt"},ce={class:"title"},de=["onClick"],re=["onClick"],me=H({__name:"TagView",setup(_e){const q=k(null),D=E(),w=F();let f={id:"",keyword:"",is_del:""};const l=k([]),u=k([]);k(null);const r=k(-1);N(async()=>{Object.assign(f,z.copyObject(w.query)),b()}),R(async t=>{console.info(t),f.id=t.query.id??"",f.keyword=t.query.keyword??"",f.is_del=t.query.is_del??"",b()});async function b(){if(!l.value||!l.value.length){const s=await _("tag_group/get",f);if(!s)return;l.value=s}let t=parseInt(f.id);if(t){let s=!1;for(let e=0;e<l.value.length;e++)t&&t===l.value[e].id&&(s=!0,r.value=e);s||(r.value=-1),S()}}async function S(){if(u.value=[],r.value===-1)return;const s={id_group:l.value[r.value].id},e=await _("tag/get",s);e&&(e.forEach(n=>{var i;n.alt_text=(i=n.alt)==null?void 0:i.join(",")}),u.value=e,console.info(u))}J(()=>{});async function U(t){if(!l.value[t].edit){l.value[t].edit=!0;return}const s=await _("tag_group/mod",l.value[t]);s&&(l.value[t].edit=!1,l.value[t].id=parseInt(s.id??""))}async function $(t){console.info(t);const s=l.value.splice(t,1)[0];s.id&&await _("tag_group/del",{id:s.id})}async function L(){l.value.unshift({title:"",description:"",id_node:0,sort:0,status:1,node:{},edit:!0,ext_key:new Date().valueOf()})}async function O(t){console.info("node_hint");const e=await _("file/get",{mode:"search",node_type:"directory",keyword:t,with:"none",limit:"20"});return e?("root".indexOf(t)!==-1&&e.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),e.list):!1}function T(t,s){console.info("node_add",t,s),l.value[s].id_node=t.id,l.value[s].node=t}function j(t){var e;if(console.info("node_parse"),!t)return"";const s=[];return(e=t.crumb_node)==null||e.forEach(n=>{n.title&&s.push(n.title)}),t.title&&s.push(t.title),`/ ${s.join(" / ")}`}function C(t){let s=0;t!==-1&&(s=l.value[t].id??0),D.push({path:w.path,query:{id:s}})}function B(){if(r.value==-1)return;const t=u.value,s=l.value[r.value];t.unshift({title:"",description:"",group:{},id_group:s.id,alt_text:"",ext_key:new Date().valueOf(),edit:!0})}async function g(t){const s=u.value.splice(t,1)[0];s.id&&await _("tag/del",{id:s.id})}async function G(t){var e;if(!u.value[t].edit){u.value[t].edit=!0;return}u.value[t].alt=(e=u.value[t].alt_text)==null?void 0:e.split(/,/m);const s=await _("tag/mod",u.value[t]);s&&(u.value[t].edit=!1,u.value[t].id=parseInt(s.id??""))}return(t,s)=>(d(),c("div",{class:"fr_content view_tag",ref_key:"contentDOM",ref:q},[o("div",A,[o("div",{class:h({tag_group:!0,tag_group_add:!0,active:r.value===-1}),onClick:L},s[0]||(s[0]=[o("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1)]),2),l.value&&l.value.length?(d(!0),c(v,{key:0},I(l.value,(e,n)=>{var i;return d(),c("div",{key:`tagView_group_${e.ext_key?e.ext_key:e.id}`,class:h({active:r.value===n,tag_group:!0,edit:e.edit})},[e.edit?(d(),c(v,{key:1},[p(m,{class:"title",modelValue:e.title,"onUpdate:modelValue":a=>e.title=a,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),p(m,{class:"description",modelValue:e.description,"onUpdate:modelValue":a=>e.description=a},null,8,["modelValue","onUpdate:modelValue"]),p(Q,{class:"node","get-list":O,submit:T,"parse-text":j,modelValue:e.node,"onUpdate:modelValue":a=>e.node=a,meta:n},null,8,["modelValue","onUpdate:modelValue","meta"]),o("div",ee,[p(m,{class:"sort",modelValue:e.sort,"onUpdate:modelValue":a=>e.sort=a},null,8,["modelValue","onUpdate:modelValue"]),o("div",null,[o("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:a=>U(n)},null,8,te),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:a=>$(n)},null,8,se)])])],64)):(d(),c(v,{key:0},[o("div",K,[o("div",{onClick:a=>C(n)},y(e.title),9,P),o("div",W,[o("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:a=>U(n)},null,8,X),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:a=>$(n)},null,8,Y)])]),o("div",{onClick:a=>C(n),class:"description"},y(e.description),9,Z),o("div",{onClick:a=>C(n),class:"node"},[e.node&&e.node.crumb_node?(d(!0),c(v,{key:0},I(e.node.crumb_node,(a,M)=>(d(),c("span",{key:`tagView_group_${e.ext_key?e.ext_key:e.id}_CR_${M}`},y(a.title),1))),128)):V("",!0),o("span",null,y((i=e.node)==null?void 0:i.title),1)],8,x)],64))],2)}),128)):V("",!0)]),o("div",oe,[o("div",{class:h({tag:!0,tag_add:!0}),onClick:B},s[1]||(s[1]=[o("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1)])),(d(!0),c(v,null,I(u.value,(e,n)=>(d(),c("div",{class:h({tag:!0,edit:e.edit}),key:`tag_view_${e.ext_key?e.ext_key:e.id}`},[e.edit?(d(),c(v,{key:1},[o("div",ce,[p(m,{modelValue:e.title,"onUpdate:modelValue":i=>e.title=i,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),o("div",null,[o("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:i=>G(n)},null,8,de),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:i=>g(n)},null,8,re)])]),p(m,{modelValue:e.description,"onUpdate:modelValue":i=>e.description=i,class:"description"},null,8,["modelValue","onUpdate:modelValue"]),p(m,{modelValue:e.alt_text,"onUpdate:modelValue":i=>e.alt_text=i,class:"alt"},null,8,["modelValue","onUpdate:modelValue"])],64)):(d(),c(v,{key:0},[o("div",le,[o("div",null,y(e.title),1),o("div",null,[o("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:i=>G(n)},null,8,ne),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:i=>g(n)},null,8,ae)])]),e.description?(d(),c("div",ie,y(e.description),1)):V("",!0),e.alt?(d(),c("div",ue,y(e.alt_text),1)):V("",!0)],64))],2))),128))])],512))}});export{me as default};

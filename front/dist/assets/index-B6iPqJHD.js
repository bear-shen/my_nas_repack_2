const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./FileView_N-yzuBUO0R.js","./FileView.vue_vue_type_style_index_0_lang-B9xJi6z-.js","./basic-DEjvk56T.js","./basic-C8Jhbub5.css","./FileItem-DfWlUCpv.js","./ContentEditable.vue_vue_type_script_setup_true_lang-BqxwSmm9.js","./Hinter-CmDQffzv.js","./Hinter-Bbfb8PrG.css","./FileItem-DlBSMwIz.css","./FileView-BSPtTJMB.css","./Favourite-CXUjeZeR.js","./Favourite-BN5yJjEX.css","./FileView_R-DFElAOId.js","./TagView-CWzmuTH6.js","./TagView-BIbJvYcw.css","./ShareView-tq_idUQI.js","./ShareView-BRPRpGNM.css","./UserView-Bap99P2C.js","./UserView-CmWqTIhk.css","./LogView-CPzjbwZb.js","./LogView-V_AVrbUx.css","./SettingView-CO5w7ZAL.js","./SettingView-EQ9DroAn.css"])))=>i.map(i=>d[i]);
var un=Object.defineProperty;var dn=(a,e,t)=>e in a?un(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var Z=(a,e,t)=>dn(a,typeof e!="symbol"?e+"":e,t);import{d as fe,r as F,g as Fe,o as Re,C as te,a as ue,b as L,c as $,e as A,F as K,f as ae,n as ce,u as X,t as ne,h as pt,s as fn,i as hn,j as Ee,k as pn,l as _n,m as $e,p as mn,q as Oe,v as vn,w as yn,x as gn,y as ge,z as zt,A as Je,B as Nt,D as Ce,M as wn,E as bn,G as kn,H as de,I as En,J as Q,K as ze,L as Ne,N as xn,O as Sn,P as Dn,Q as Ze,R as Bt,S as et,T as _t,U as ee,V as le,W as Be,X as Ut,_ as Ln,Y as $n,Z as Rn,$ as On,a0 as Cn,a1 as mt,a2 as Vt,a3 as ot,a4 as Ge,a5 as Wt,a6 as Me,a7 as vt,a8 as jt,a9 as Pn,aa as Mn,ab as An,ac as In,ad as Tn,ae as Hn}from"./basic-DEjvk56T.js";const zn={class:"fr_header"},Nn={class:"navi"},Bn=["innerHTML","href"],Un={class:"user"},Vn={class:"pointer"},Wn=fe({__name:"Header",setup(a){const e=F([]);let t=Fe();function n(){fn(null),location.reload()}Re(()=>{document.addEventListener("fe_config_loaded",()=>{e.value=te.navList})});const s=te.theme;let r=ue("theme")??"warm";function c(){const u={};s.forEach(o=>{u[o[0]]=o[0]}),hn({title:"theme configure",alpha:!0,key:"theme_configure",single:!0,w:360,h:160,minW:360,minH:160,allow_resize:!0,allow_move:!0,allow_escape:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"radio",label:"theme name",key:"theme",options:u,value:r}],callback:{check:async o=>{console.info(o),r=o.content.form[0].value,h(r)}}})}function h(u){s.forEach(o=>{const v=o[0],_=o[1];if(v!==u)return;Ee("theme",v);const g=document.body.className.trim().split(" "),l=[];g.forEach(m=>{m&&m.length&&m.indexOf("theme_")!==0&&l.push(m)}),l.push("theme_"+u);const p=document.createElement("link");p.setAttribute("rel","stylesheet"),p.setAttribute("href",_),document.body.appendChild(p),document.body.className=l.join(" ")})}return h(r),(u,o)=>(L(),$("div",zn,[o[1]||(o[1]=A("div",{class:"logo"},"Hentai.",-1)),A("div",Nn,[(L(!0),$(K,null,ae(e.value,v=>{var _;return L(),$("a",{key:v.name,class:ce({active:(_=v.meta)==null?void 0:_.cur,pointer:1}),innerHTML:v.name,href:v.path,target:"_blank"},null,10,Bn)}),128))]),A("div",Un,[X(t)&&X(t).id?(L(),$(K,{key:0},[A("div",Vn,ne(X(t).name),1),A("ul",{class:"action pointer"},[A("li",{onClick:c},"theme"),A("li",{onClick:n},"logout")])],64)):(L(),$("div",{key:1,class:"pointer",onClick:o[0]||(o[0]=(...v)=>X(pt)&&X(pt)(...v))},"login"))])]))}}),jn=(a,e)=>{const t=a.__vccOpts||a;for(const[n,s]of e)t[n]=s;return t},Fn=jn(Wn,[["__scopeId","data-v-1c0c27ef"]]),qn="modulepreload",Gn=function(a,e){return new URL(a,e).href},yt={},xe=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){const c=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),u=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));s=Promise.allSettled(t.map(o=>{if(o=Gn(o,n),o in yt)return;yt[o]=!0;const v=o.endsWith(".css"),_=v?'[rel="stylesheet"]':"";if(!!n)for(let p=c.length-1;p>=0;p--){const m=c[p];if(m.href===o&&(!v||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${_}`))return;const l=document.createElement("link");if(l.rel=v?"stylesheet":qn,v||(l.as="script"),l.crossOrigin="",l.href=o,u&&l.setAttribute("nonce",u),document.head.appendChild(l),v)return new Promise((p,m)=>{l.addEventListener("load",p),l.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${o}`)))})}))}function r(c){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=c,window.dispatchEvent(h),!h.defaultPrevented)throw c}return s.then(c=>{for(const h of c||[])h.status==="rejected"&&r(h.reason);return e().catch(r)})};/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Pe=typeof document<"u";function Ft(a){return typeof a=="object"||"displayName"in a||"props"in a||"__vccOpts"in a}function Kn(a){return a.__esModule||a[Symbol.toStringTag]==="Module"||a.default&&Ft(a.default)}const Y=Object.assign;function tt(a,e){const t={};for(const n in e){const s=e[n];t[n]=me(s)?s.map(a):a(s)}return t}const Ue=()=>{},me=Array.isArray,qt=/#/g,Yn=/&/g,Xn=/\//g,Qn=/=/g,Jn=/\?/g,Gt=/\+/g,Zn=/%5B/g,ea=/%5D/g,Kt=/%5E/g,ta=/%60/g,Yt=/%7B/g,na=/%7C/g,Xt=/%7D/g,aa=/%20/g;function ut(a){return encodeURI(""+a).replace(na,"|").replace(Zn,"[").replace(ea,"]")}function sa(a){return ut(a).replace(Yt,"{").replace(Xt,"}").replace(Kt,"^")}function it(a){return ut(a).replace(Gt,"%2B").replace(aa,"+").replace(qt,"%23").replace(Yn,"%26").replace(ta,"`").replace(Yt,"{").replace(Xt,"}").replace(Kt,"^")}function oa(a){return it(a).replace(Qn,"%3D")}function ia(a){return ut(a).replace(qt,"%23").replace(Jn,"%3F")}function ra(a){return a==null?"":ia(a).replace(Xn,"%2F")}function We(a){try{return decodeURIComponent(""+a)}catch{}return""+a}const la=/\/$/,ca=a=>a.replace(la,"");function nt(a,e,t="/"){let n,s={},r="",c="";const h=e.indexOf("#");let u=e.indexOf("?");return h<u&&h>=0&&(u=-1),u>-1&&(n=e.slice(0,u),r=e.slice(u+1,h>-1?h:e.length),s=a(r)),h>-1&&(n=n||e.slice(0,h),c=e.slice(h,e.length)),n=ha(n??e,t),{fullPath:n+(r&&"?")+r+c,path:n,query:s,hash:We(c)}}function ua(a,e){const t=e.query?a(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function gt(a,e){return!e||!a.toLowerCase().startsWith(e.toLowerCase())?a:a.slice(e.length)||"/"}function da(a,e,t){const n=e.matched.length-1,s=t.matched.length-1;return n>-1&&n===s&&Ae(e.matched[n],t.matched[s])&&Qt(e.params,t.params)&&a(e.query)===a(t.query)&&e.hash===t.hash}function Ae(a,e){return(a.aliasOf||a)===(e.aliasOf||e)}function Qt(a,e){if(Object.keys(a).length!==Object.keys(e).length)return!1;for(const t in a)if(!fa(a[t],e[t]))return!1;return!0}function fa(a,e){return me(a)?wt(a,e):me(e)?wt(e,a):a===e}function wt(a,e){return me(e)?a.length===e.length&&a.every((t,n)=>t===e[n]):a.length===1&&a[0]===e}function ha(a,e){if(a.startsWith("/"))return a;if(!a)return e;const t=e.split("/"),n=a.split("/"),s=n[n.length-1];(s===".."||s===".")&&n.push("");let r=t.length-1,c,h;for(c=0;c<n.length;c++)if(h=n[c],h!==".")if(h==="..")r>1&&r--;else break;return t.slice(0,r).join("/")+"/"+n.slice(c).join("/")}const Se={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var je;(function(a){a.pop="pop",a.push="push"})(je||(je={}));var Ve;(function(a){a.back="back",a.forward="forward",a.unknown=""})(Ve||(Ve={}));function pa(a){if(!a)if(Pe){const e=document.querySelector("base");a=e&&e.getAttribute("href")||"/",a=a.replace(/^\w+:\/\/[^\/]+/,"")}else a="/";return a[0]!=="/"&&a[0]!=="#"&&(a="/"+a),ca(a)}const _a=/^[^#]+#/;function ma(a,e){return a.replace(_a,"#")+e}function va(a,e){const t=document.documentElement.getBoundingClientRect(),n=a.getBoundingClientRect();return{behavior:e.behavior,left:n.left-t.left-(e.left||0),top:n.top-t.top-(e.top||0)}}const Ke=()=>({left:window.scrollX,top:window.scrollY});function ya(a){let e;if("el"in a){const t=a.el,n=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?n?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=va(s,a)}else e=a;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function bt(a,e){return(history.state?history.state.position-e:-1)+a}const rt=new Map;function ga(a,e){rt.set(a,e)}function wa(a){const e=rt.get(a);return rt.delete(a),e}let ba=()=>location.protocol+"//"+location.host;function Jt(a,e){const{pathname:t,search:n,hash:s}=e,r=a.indexOf("#");if(r>-1){let h=s.includes(a.slice(r))?a.slice(r).length:1,u=s.slice(h);return u[0]!=="/"&&(u="/"+u),gt(u,"")}return gt(t,a)+n+s}function ka(a,e,t,n){let s=[],r=[],c=null;const h=({state:g})=>{const l=Jt(a,location),p=t.value,m=e.value;let d=0;if(g){if(t.value=l,e.value=g,c&&c===p){c=null;return}d=m?g.position-m.position:0}else n(l);s.forEach(i=>{i(t.value,p,{delta:d,type:je.pop,direction:d?d>0?Ve.forward:Ve.back:Ve.unknown})})};function u(){c=t.value}function o(g){s.push(g);const l=()=>{const p=s.indexOf(g);p>-1&&s.splice(p,1)};return r.push(l),l}function v(){const{history:g}=window;g.state&&g.replaceState(Y({},g.state,{scroll:Ke()}),"")}function _(){for(const g of r)g();r=[],window.removeEventListener("popstate",h),window.removeEventListener("beforeunload",v)}return window.addEventListener("popstate",h),window.addEventListener("beforeunload",v,{passive:!0}),{pauseListeners:u,listen:o,destroy:_}}function kt(a,e,t,n=!1,s=!1){return{back:a,current:e,forward:t,replaced:n,position:window.history.length,scroll:s?Ke():null}}function Ea(a){const{history:e,location:t}=window,n={value:Jt(a,t)},s={value:e.state};s.value||r(n.value,{back:null,current:n.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function r(u,o,v){const _=a.indexOf("#"),g=_>-1?(t.host&&document.querySelector("base")?a:a.slice(_))+u:ba()+a+u;try{e[v?"replaceState":"pushState"](o,"",g),s.value=o}catch(l){console.error(l),t[v?"replace":"assign"](g)}}function c(u,o){const v=Y({},e.state,kt(s.value.back,u,s.value.forward,!0),o,{position:s.value.position});r(u,v,!0),n.value=u}function h(u,o){const v=Y({},s.value,e.state,{forward:u,scroll:Ke()});r(v.current,v,!0);const _=Y({},kt(n.value,u,null),{position:v.position+1},o);r(u,_,!1),n.value=u}return{location:n,state:s,push:h,replace:c}}function xa(a){a=pa(a);const e=Ea(a),t=ka(a,e.state,e.location,e.replace);function n(r,c=!0){c||t.pauseListeners(),history.go(r)}const s=Y({location:"",base:a,go:n,createHref:ma.bind(null,a)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function Sa(a){return typeof a=="string"||a&&typeof a=="object"}function Zt(a){return typeof a=="string"||typeof a=="symbol"}const en=Symbol("");var Et;(function(a){a[a.aborted=4]="aborted",a[a.cancelled=8]="cancelled",a[a.duplicated=16]="duplicated"})(Et||(Et={}));function Ie(a,e){return Y(new Error,{type:a,[en]:!0},e)}function ke(a,e){return a instanceof Error&&en in a&&(e==null||!!(a.type&e))}const xt="[^/]+?",Da={sensitive:!1,strict:!1,start:!0,end:!0},La=/[.+*?^${}()[\]/\\]/g;function $a(a,e){const t=Y({},Da,e),n=[];let s=t.start?"^":"";const r=[];for(const o of a){const v=o.length?[]:[90];t.strict&&!o.length&&(s+="/");for(let _=0;_<o.length;_++){const g=o[_];let l=40+(t.sensitive?.25:0);if(g.type===0)_||(s+="/"),s+=g.value.replace(La,"\\$&"),l+=40;else if(g.type===1){const{value:p,repeatable:m,optional:d,regexp:i}=g;r.push({name:p,repeatable:m,optional:d});const y=i||xt;if(y!==xt){l+=10;try{new RegExp(`(${y})`)}catch(b){throw new Error(`Invalid custom RegExp for param "${p}" (${y}): `+b.message)}}let f=m?`((?:${y})(?:/(?:${y}))*)`:`(${y})`;_||(f=d&&o.length<2?`(?:/${f})`:"/"+f),d&&(f+="?"),s+=f,l+=20,d&&(l+=-8),m&&(l+=-20),y===".*"&&(l+=-50)}v.push(l)}n.push(v)}if(t.strict&&t.end){const o=n.length-1;n[o][n[o].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const c=new RegExp(s,t.sensitive?"":"i");function h(o){const v=o.match(c),_={};if(!v)return null;for(let g=1;g<v.length;g++){const l=v[g]||"",p=r[g-1];_[p.name]=l&&p.repeatable?l.split("/"):l}return _}function u(o){let v="",_=!1;for(const g of a){(!_||!v.endsWith("/"))&&(v+="/"),_=!1;for(const l of g)if(l.type===0)v+=l.value;else if(l.type===1){const{value:p,repeatable:m,optional:d}=l,i=p in o?o[p]:"";if(me(i)&&!m)throw new Error(`Provided param "${p}" is an array but it is not repeatable (* or + modifiers)`);const y=me(i)?i.join("/"):i;if(!y)if(d)g.length<2&&(v.endsWith("/")?v=v.slice(0,-1):_=!0);else throw new Error(`Missing required param "${p}"`);v+=y}}return v||"/"}return{re:c,score:n,keys:r,parse:h,stringify:u}}function Ra(a,e){let t=0;for(;t<a.length&&t<e.length;){const n=e[t]-a[t];if(n)return n;t++}return a.length<e.length?a.length===1&&a[0]===80?-1:1:a.length>e.length?e.length===1&&e[0]===80?1:-1:0}function tn(a,e){let t=0;const n=a.score,s=e.score;for(;t<n.length&&t<s.length;){const r=Ra(n[t],s[t]);if(r)return r;t++}if(Math.abs(s.length-n.length)===1){if(St(n))return 1;if(St(s))return-1}return s.length-n.length}function St(a){const e=a[a.length-1];return a.length>0&&e[e.length-1]<0}const Oa={type:0,value:""},Ca=/[a-zA-Z0-9_]/;function Pa(a){if(!a)return[[]];if(a==="/")return[[Oa]];if(!a.startsWith("/"))throw new Error(`Invalid path "${a}"`);function e(l){throw new Error(`ERR (${t})/"${o}": ${l}`)}let t=0,n=t;const s=[];let r;function c(){r&&s.push(r),r=[]}let h=0,u,o="",v="";function _(){o&&(t===0?r.push({type:0,value:o}):t===1||t===2||t===3?(r.length>1&&(u==="*"||u==="+")&&e(`A repeatable param (${o}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:o,regexp:v,repeatable:u==="*"||u==="+",optional:u==="*"||u==="?"})):e("Invalid state to consume buffer"),o="")}function g(){o+=u}for(;h<a.length;){if(u=a[h++],u==="\\"&&t!==2){n=t,t=4;continue}switch(t){case 0:u==="/"?(o&&_(),c()):u===":"?(_(),t=1):g();break;case 4:g(),t=n;break;case 1:u==="("?t=2:Ca.test(u)?g():(_(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&h--);break;case 2:u===")"?v[v.length-1]=="\\"?v=v.slice(0,-1)+u:t=3:v+=u;break;case 3:_(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&h--,v="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${o}"`),_(),c(),s}function Ma(a,e,t){const n=$a(Pa(a.path),t),s=Y(n,{record:a,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function Aa(a,e){const t=[],n=new Map;e=Rt({strict:!1,end:!0,sensitive:!1},e);function s(_){return n.get(_)}function r(_,g,l){const p=!l,m=Lt(_);m.aliasOf=l&&l.record;const d=Rt(e,_),i=[m];if("alias"in _){const b=typeof _.alias=="string"?[_.alias]:_.alias;for(const C of b)i.push(Lt(Y({},m,{components:l?l.record.components:m.components,path:C,aliasOf:l?l.record:m})))}let y,f;for(const b of i){const{path:C}=b;if(g&&C[0]!=="/"){const k=g.record.path,O=k[k.length-1]==="/"?"":"/";b.path=g.record.path+(C&&O+C)}if(y=Ma(b,g,d),l?l.alias.push(y):(f=f||y,f!==y&&f.alias.push(y),p&&_.name&&!$t(y)&&c(_.name)),nn(y)&&u(y),m.children){const k=m.children;for(let O=0;O<k.length;O++)r(k[O],y,l&&l.children[O])}l=l||y}return f?()=>{c(f)}:Ue}function c(_){if(Zt(_)){const g=n.get(_);g&&(n.delete(_),t.splice(t.indexOf(g),1),g.children.forEach(c),g.alias.forEach(c))}else{const g=t.indexOf(_);g>-1&&(t.splice(g,1),_.record.name&&n.delete(_.record.name),_.children.forEach(c),_.alias.forEach(c))}}function h(){return t}function u(_){const g=Ha(_,t);t.splice(g,0,_),_.record.name&&!$t(_)&&n.set(_.record.name,_)}function o(_,g){let l,p={},m,d;if("name"in _&&_.name){if(l=n.get(_.name),!l)throw Ie(1,{location:_});d=l.record.name,p=Y(Dt(g.params,l.keys.filter(f=>!f.optional).concat(l.parent?l.parent.keys.filter(f=>f.optional):[]).map(f=>f.name)),_.params&&Dt(_.params,l.keys.map(f=>f.name))),m=l.stringify(p)}else if(_.path!=null)m=_.path,l=t.find(f=>f.re.test(m)),l&&(p=l.parse(m),d=l.record.name);else{if(l=g.name?n.get(g.name):t.find(f=>f.re.test(g.path)),!l)throw Ie(1,{location:_,currentLocation:g});d=l.record.name,p=Y({},g.params,_.params),m=l.stringify(p)}const i=[];let y=l;for(;y;)i.unshift(y.record),y=y.parent;return{name:d,path:m,params:p,matched:i,meta:Ta(i)}}a.forEach(_=>r(_));function v(){t.length=0,n.clear()}return{addRoute:r,resolve:o,removeRoute:c,clearRoutes:v,getRoutes:h,getRecordMatcher:s}}function Dt(a,e){const t={};for(const n of e)n in a&&(t[n]=a[n]);return t}function Lt(a){const e={path:a.path,redirect:a.redirect,name:a.name,meta:a.meta||{},aliasOf:a.aliasOf,beforeEnter:a.beforeEnter,props:Ia(a),children:a.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in a?a.components||null:a.component&&{default:a.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function Ia(a){const e={},t=a.props||!1;if("component"in a)e.default=t;else for(const n in a.components)e[n]=typeof t=="object"?t[n]:t;return e}function $t(a){for(;a;){if(a.record.aliasOf)return!0;a=a.parent}return!1}function Ta(a){return a.reduce((e,t)=>Y(e,t.meta),{})}function Rt(a,e){const t={};for(const n in a)t[n]=n in e?e[n]:a[n];return t}function Ha(a,e){let t=0,n=e.length;for(;t!==n;){const r=t+n>>1;tn(a,e[r])<0?n=r:t=r+1}const s=za(a);return s&&(n=e.lastIndexOf(s,n-1)),n}function za(a){let e=a;for(;e=e.parent;)if(nn(e)&&tn(a,e)===0)return e}function nn({record:a}){return!!(a.name||a.components&&Object.keys(a.components).length||a.redirect)}function Na(a){const e={};if(a===""||a==="?")return e;const n=(a[0]==="?"?a.slice(1):a).split("&");for(let s=0;s<n.length;++s){const r=n[s].replace(Gt," "),c=r.indexOf("="),h=We(c<0?r:r.slice(0,c)),u=c<0?null:We(r.slice(c+1));if(h in e){let o=e[h];me(o)||(o=e[h]=[o]),o.push(u)}else e[h]=u}return e}function Ot(a){let e="";for(let t in a){const n=a[t];if(t=oa(t),n==null){n!==void 0&&(e+=(e.length?"&":"")+t);continue}(me(n)?n.map(r=>r&&it(r)):[n&&it(n)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+t,r!=null&&(e+="="+r))})}return e}function Ba(a){const e={};for(const t in a){const n=a[t];n!==void 0&&(e[t]=me(n)?n.map(s=>s==null?null:""+s):n==null?n:""+n)}return e}const an=Symbol(""),Ct=Symbol(""),Ye=Symbol(""),dt=Symbol(""),lt=Symbol("");function He(){let a=[];function e(n){return a.push(n),()=>{const s=a.indexOf(n);s>-1&&a.splice(s,1)}}function t(){a=[]}return{add:e,list:()=>a.slice(),reset:t}}function Ua(a,e,t){const n=()=>{a[e].delete(t)};Oe(n),vn(n),yn(()=>{a[e].add(t)}),a[e].add(t)}function zo(a){const e=$e(an,{}).value;e&&Ua(e,"updateGuards",a)}function Le(a,e,t,n,s,r=c=>c()){const c=n&&(n.enterCallbacks[s]=n.enterCallbacks[s]||[]);return()=>new Promise((h,u)=>{const o=g=>{g===!1?u(Ie(4,{from:t,to:e})):g instanceof Error?u(g):Sa(g)?u(Ie(2,{from:e,to:g})):(c&&n.enterCallbacks[s]===c&&typeof g=="function"&&c.push(g),h())},v=r(()=>a.call(n&&n.instances[s],e,t,o));let _=Promise.resolve(v);a.length<3&&(_=_.then(o)),_.catch(g=>u(g))})}function at(a,e,t,n,s=r=>r()){const r=[];for(const c of a)for(const h in c.components){let u=c.components[h];if(!(e!=="beforeRouteEnter"&&!c.instances[h]))if(Ft(u)){const v=(u.__vccOpts||u)[e];v&&r.push(Le(v,t,n,c,h,s))}else{let o=u();r.push(()=>o.then(v=>{if(!v)throw new Error(`Couldn't resolve component "${h}" at "${c.path}"`);const _=Kn(v)?v.default:v;c.mods[h]=v,c.components[h]=_;const l=(_.__vccOpts||_)[e];return l&&Le(l,t,n,c,h,s)()}))}}return r}function Pt(a){const e=$e(Ye),t=$e(dt),n=ge(()=>{const u=X(a.to);return e.resolve(u)}),s=ge(()=>{const{matched:u}=n.value,{length:o}=u,v=u[o-1],_=t.matched;if(!v||!_.length)return-1;const g=_.findIndex(Ae.bind(null,v));if(g>-1)return g;const l=Mt(u[o-2]);return o>1&&Mt(v)===l&&_[_.length-1].path!==l?_.findIndex(Ae.bind(null,u[o-2])):g}),r=ge(()=>s.value>-1&&qa(t.params,n.value.params)),c=ge(()=>s.value>-1&&s.value===t.matched.length-1&&Qt(t.params,n.value.params));function h(u={}){if(Fa(u)){const o=e[X(a.replace)?"replace":"push"](X(a.to)).catch(Ue);return a.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>o),o}return Promise.resolve()}return{route:n,href:ge(()=>n.value.href),isActive:r,isExactActive:c,navigate:h}}function Va(a){return a.length===1?a[0]:a}const Wa=fe({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Pt,setup(a,{slots:e}){const t=gn(Pt(a)),{options:n}=$e(Ye),s=ge(()=>({[At(a.activeClass,n.linkActiveClass,"router-link-active")]:t.isActive,[At(a.exactActiveClass,n.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const r=e.default&&Va(e.default(t));return a.custom?r:zt("a",{"aria-current":t.isExactActive?a.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},r)}}}),ja=Wa;function Fa(a){if(!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)&&!a.defaultPrevented&&!(a.button!==void 0&&a.button!==0)){if(a.currentTarget&&a.currentTarget.getAttribute){const e=a.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return a.preventDefault&&a.preventDefault(),!0}}function qa(a,e){for(const t in e){const n=e[t],s=a[t];if(typeof n=="string"){if(n!==s)return!1}else if(!me(s)||s.length!==n.length||n.some((r,c)=>r!==s[c]))return!1}return!0}function Mt(a){return a?a.aliasOf?a.aliasOf.path:a.path:""}const At=(a,e,t)=>a??e??t,Ga=fe({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(a,{attrs:e,slots:t}){const n=$e(lt),s=ge(()=>a.route||n.value),r=$e(Ct,0),c=ge(()=>{let o=X(r);const{matched:v}=s.value;let _;for(;(_=v[o])&&!_.components;)o++;return o}),h=ge(()=>s.value.matched[c.value]);Je(Ct,ge(()=>c.value+1)),Je(an,h),Je(lt,s);const u=F();return Nt(()=>[u.value,h.value,a.name],([o,v,_],[g,l,p])=>{v&&(v.instances[_]=o,l&&l!==v&&o&&o===g&&(v.leaveGuards.size||(v.leaveGuards=l.leaveGuards),v.updateGuards.size||(v.updateGuards=l.updateGuards))),o&&v&&(!l||!Ae(v,l)||!g)&&(v.enterCallbacks[_]||[]).forEach(m=>m(o))},{flush:"post"}),()=>{const o=s.value,v=a.name,_=h.value,g=_&&_.components[v];if(!g)return It(t.default,{Component:g,route:o});const l=_.props[v],p=l?l===!0?o.params:typeof l=="function"?l(o):l:null,d=zt(g,Y({},p,e,{onVnodeUnmounted:i=>{i.component.isUnmounted&&(_.instances[v]=null)},ref:u}));return It(t.default,{Component:d,route:o})||d}}});function It(a,e){if(!a)return null;const t=a(e);return t.length===1?t[0]:t}const Ka=Ga;function Ya(a){const e=Aa(a.routes,a),t=a.parseQuery||Na,n=a.stringifyQuery||Ot,s=a.history,r=He(),c=He(),h=He(),u=pn(Se);let o=Se;Pe&&a.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const v=tt.bind(null,w=>""+w),_=tt.bind(null,ra),g=tt.bind(null,We);function l(w,R){let x,P;return Zt(w)?(x=e.getRecordMatcher(w),P=R):P=w,e.addRoute(P,x)}function p(w){const R=e.getRecordMatcher(w);R&&e.removeRoute(R)}function m(){return e.getRoutes().map(w=>w.record)}function d(w){return!!e.getRecordMatcher(w)}function i(w,R){if(R=Y({},R||u.value),typeof w=="string"){const V=nt(t,w,R.path),q=e.resolve({path:V.path},R),pe=s.createHref(V.fullPath);return Y(V,q,{params:g(q.params),hash:We(V.hash),redirectedFrom:void 0,href:pe})}let x;if(w.path!=null)x=Y({},w,{path:nt(t,w.path,R.path).path});else{const V=Y({},w.params);for(const q in V)V[q]==null&&delete V[q];x=Y({},w,{params:_(V)}),R.params=_(R.params)}const P=e.resolve(x,R),j=w.hash||"";P.params=v(g(P.params));const U=ua(n,Y({},w,{hash:sa(j),path:P.path})),N=s.createHref(U);return Y({fullPath:U,hash:j,query:n===Ot?Ba(w.query):w.query||{}},P,{redirectedFrom:void 0,href:N})}function y(w){return typeof w=="string"?nt(t,w,u.value.path):Y({},w)}function f(w,R){if(o!==w)return Ie(8,{from:R,to:w})}function b(w){return O(w)}function C(w){return b(Y(y(w),{replace:!0}))}function k(w){const R=w.matched[w.matched.length-1];if(R&&R.redirect){const{redirect:x}=R;let P=typeof x=="function"?x(w):x;return typeof P=="string"&&(P=P.includes("?")||P.includes("#")?P=y(P):{path:P},P.params={}),Y({query:w.query,hash:w.hash,params:P.path!=null?{}:w.params},P)}}function O(w,R){const x=o=i(w),P=u.value,j=w.state,U=w.force,N=w.replace===!0,V=k(x);if(V)return O(Y(y(V),{state:typeof V=="object"?Y({},j,V.state):j,force:U,replace:N}),R||x);const q=x;q.redirectedFrom=R;let pe;return!U&&da(n,P,x)&&(pe=Ie(16,{to:q,from:P}),Te(P,P,!0,!1)),(pe?Promise.resolve(pe):H(q,P)).catch(W=>ke(W)?ke(W,2)?W:_e(W):be(W,q,P)).then(W=>{if(W){if(ke(W,2))return O(Y({replace:N},y(W.to),{state:typeof W.to=="object"?Y({},j,W.to.state):j,force:U}),R||q)}else W=ie(q,P,!0,N,j);return J(q,P,W),W})}function S(w,R){const x=f(w,R);return x?Promise.reject(x):Promise.resolve()}function I(w){const R=T.values().next().value;return R&&typeof R.runWithContext=="function"?R.runWithContext(w):w()}function H(w,R){let x;const[P,j,U]=Xa(w,R);x=at(P.reverse(),"beforeRouteLeave",w,R);for(const V of P)V.leaveGuards.forEach(q=>{x.push(Le(q,w,R))});const N=S.bind(null,w,R);return x.push(N),M(x).then(()=>{x=[];for(const V of r.list())x.push(Le(V,w,R));return x.push(N),M(x)}).then(()=>{x=at(j,"beforeRouteUpdate",w,R);for(const V of j)V.updateGuards.forEach(q=>{x.push(Le(q,w,R))});return x.push(N),M(x)}).then(()=>{x=[];for(const V of U)if(V.beforeEnter)if(me(V.beforeEnter))for(const q of V.beforeEnter)x.push(Le(q,w,R));else x.push(Le(V.beforeEnter,w,R));return x.push(N),M(x)}).then(()=>(w.matched.forEach(V=>V.enterCallbacks={}),x=at(U,"beforeRouteEnter",w,R,I),x.push(N),M(x))).then(()=>{x=[];for(const V of c.list())x.push(Le(V,w,R));return x.push(N),M(x)}).catch(V=>ke(V,8)?V:Promise.reject(V))}function J(w,R,x){h.list().forEach(P=>I(()=>P(w,R,x)))}function ie(w,R,x,P,j){const U=f(w,R);if(U)return U;const N=R===Se,V=Pe?history.state:{};x&&(P||N?s.replace(w.fullPath,Y({scroll:N&&V&&V.scroll},j)):s.push(w.fullPath,j)),u.value=w,Te(w,R,x,N),_e()}let oe;function ve(){oe||(oe=s.listen((w,R,x)=>{if(!z.listening)return;const P=i(w),j=k(P);if(j){O(Y(j,{replace:!0,force:!0}),P).catch(Ue);return}o=P;const U=u.value;Pe&&ga(bt(U.fullPath,x.delta),Ke()),H(P,U).catch(N=>ke(N,12)?N:ke(N,2)?(O(Y(y(N.to),{force:!0}),P).then(V=>{ke(V,20)&&!x.delta&&x.type===je.pop&&s.go(-1,!1)}).catch(Ue),Promise.reject()):(x.delta&&s.go(-x.delta,!1),be(N,P,U))).then(N=>{N=N||ie(P,U,!1),N&&(x.delta&&!ke(N,8)?s.go(-x.delta,!1):x.type===je.pop&&ke(N,20)&&s.go(-1,!1)),J(P,U,N)}).catch(Ue)}))}let re=He(),qe=He(),he;function be(w,R,x){_e(w);const P=qe.list();return P.length?P.forEach(j=>j(w,R,x)):console.error(w),Promise.reject(w)}function Qe(){return he&&u.value!==Se?Promise.resolve():new Promise((w,R)=>{re.add([w,R])})}function _e(w){return he||(he=!w,ve(),re.list().forEach(([R,x])=>w?x(w):R()),re.reset()),w}function Te(w,R,x,P){const{scrollBehavior:j}=a;if(!Pe||!j)return Promise.resolve();const U=!x&&wa(bt(w.fullPath,0))||(P||!x)&&history.state&&history.state.scroll||null;return mn().then(()=>j(w,R,U)).then(N=>N&&ya(N)).catch(N=>be(N,w,R))}const D=w=>s.go(w);let E;const T=new Set,z={currentRoute:u,listening:!0,addRoute:l,removeRoute:p,clearRoutes:e.clearRoutes,hasRoute:d,getRoutes:m,resolve:i,options:a,push:b,replace:C,go:D,back:()=>D(-1),forward:()=>D(1),beforeEach:r.add,beforeResolve:c.add,afterEach:h.add,onError:qe.add,isReady:Qe,install(w){const R=this;w.component("RouterLink",ja),w.component("RouterView",Ka),w.config.globalProperties.$router=R,Object.defineProperty(w.config.globalProperties,"$route",{enumerable:!0,get:()=>X(u)}),Pe&&!E&&u.value===Se&&(E=!0,b(s.location).catch(j=>{}));const x={};for(const j in Se)Object.defineProperty(x,j,{get:()=>u.value[j],enumerable:!0});w.provide(Ye,R),w.provide(dt,_n(x)),w.provide(lt,u);const P=w.unmount;T.add(w),w.unmount=function(){T.delete(w),T.size<1&&(o=Se,oe&&oe(),oe=null,u.value=Se,E=!1,he=!1),P()}}};function M(w){return w.reduce((R,x)=>R.then(()=>I(x)),Promise.resolve())}return z}function Xa(a,e){const t=[],n=[],s=[],r=Math.max(e.matched.length,a.matched.length);for(let c=0;c<r;c++){const h=e.matched[c];h&&(a.matched.find(o=>Ae(o,h))?n.push(h):t.push(h));const u=a.matched[c];u&&(e.matched.find(o=>Ae(o,u))||s.push(u))}return[t,n,s]}function Qa(){return $e(Ye)}function Ja(a){return $e(dt)}const sn=[{path:"/",name:"Directory",component:()=>xe(()=>import("./FileView_N-yzuBUO0R.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),meta:{icon:"sysIcon_folderopen",deny_user:!1,deny_guest:!1}},{path:"/favourite",name:"Favourite",component:()=>xe(()=>import("./Favourite-CXUjeZeR.js"),__vite__mapDeps([10,2,3,5,4,6,7,8,11]),import.meta.url),meta:{icon:"sysIcon_star-o",deny_user:!1,deny_guest:!0}},{path:"/recycle",name:"Recycle",component:()=>xe(()=>import("./FileView_R-DFElAOId.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9]),import.meta.url),meta:{icon:"sysIcon_delete",deny_user:!1,deny_guest:!0}},{path:"/tag",name:"Tag",component:()=>xe(()=>import("./TagView-CWzmuTH6.js"),__vite__mapDeps([13,2,3,5,6,7,14]),import.meta.url),meta:{icon:"sysIcon_tagso",deny_user:!1,deny_guest:!0}},{path:"/shares",name:"Share",component:()=>xe(()=>import("./ShareView-tq_idUQI.js"),__vite__mapDeps([15,2,3,16]),import.meta.url),meta:{icon:"sysIcon_export",deny_user:!1,deny_guest:!0}},{path:"/group",name:"User",component:()=>xe(()=>import("./UserView-Bap99P2C.js"),__vite__mapDeps([17,2,3,5,6,7,18]),import.meta.url),meta:{icon:"sysIcon_team",deny_user:!0,deny_guest:!0}},{path:"/log",name:"ProcessLog",component:()=>xe(()=>import("./LogView-CPzjbwZb.js"),__vite__mapDeps([19,2,3,20]),import.meta.url),meta:{icon:"sysIcon_filetext",deny_user:!0,deny_guest:!0}},{path:"/setting",name:"Setting",component:()=>xe(()=>import("./SettingView-CO5w7ZAL.js"),__vite__mapDeps([21,2,3,5,22]),import.meta.url),meta:{icon:"sysIcon_setting",deny_user:!0,deny_guest:!0}}],Za=Ya({history:xa("./"),routes:sn}),es=["onClick"],ts={class:"content"},ns=fe({__name:"NaviContent",props:{depth:{},records:{}},setup(a){const e=a;e.depth&&e.depth;const t=e.records,n=Qa(),s=Ja();async function r(h){console.info("go",h);const u=await n.push(h.path);console.info(u)}const c=Fe();return(h,u)=>(L(!0),$(K,null,ae(X(t),(o,v)=>{var _,g,l,p,m,d;return L(),$(K,{key:v},[(_=o.meta)!=null&&_.hide?(L(),$(K,{key:0},[],64)):(g=o.meta)!=null&&g.deny_guest&&((l=X(c))==null?void 0:l.group.title)=="guest"?(L(),$(K,{key:1},[],64)):(p=o.meta)!=null&&p.deny_user&&!((m=X(c))!=null&&m.group.admin)?(L(),$(K,{key:2},[],64)):(L(),$("p",{key:3,onClick:i=>r(o),class:ce({title:!0,active:o.path===X(s).path})},[A("span",{class:ce(["icon","sysIcon",(d=o.meta)==null?void 0:d.icon])},null,2),A("span",ts,ne(o.name),1)],10,es))],64)}),128))}}),as=fe({__name:"Navi",setup(a){return(e,t)=>(L(),$("div",{class:ce(["fr_navi",{folded:!1}])},[Ce(ns,{records:X(sn),depth:1},null,8,["records"])]))}});let ct=null;function on(a){ct=a}function ss(a,e){ct&&ct(a,e)}const os=Object.freeze(Object.defineProperty({__proto__:null,register:on,trigger:ss},Symbol.toStringTag,{value:"Module"}));var rn={};Object.defineProperty(rn,"__esModule",{value:!0});function is(a){a===void 0&&(a={});var e=/^0/,t=/\s+/g,n=/^\s+|\s+$/g,s=/[^\x00-\x80]/,r=/^0x[0-9a-f]+$/i,c=/(0x[\da-fA-F]+|(^[\+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|\d+)/g,h=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,u=String.prototype.toLocaleLowerCase||String.prototype.toLowerCase,o=a.desc?-1:1,v=-o,_=a.insensitive?function(p){return u.call(""+p).replace(n,"")}:function(p){return(""+p).replace(n,"")};function g(p){return p.replace(c,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0")}function l(p,m){return(!p.match(e)||m===1)&&parseFloat(p)||p.replace(t," ").replace(n,"")||0}return function(p,m){var d=_(p),i=_(m);if(!d&&!i)return 0;if(!d&&i)return v;if(d&&!i)return o;var y=g(d),f=g(i),b=d.match(r),C=i.match(r),k=b&&C?parseInt(b[0],16):y.length!==1&&Date.parse(d),O=b&&C?parseInt(C[0],16):k&&i.match(h)&&Date.parse(i)||null;if(O){if(k===O)return 0;if(k<O)return v;if(k>O)return o}for(var S=y.length,I=f.length,H=0,J=Math.max(S,I);H<J;H+=1){var ie=l(y[H]||"",S),oe=l(f[H]||"",I);if(isNaN(ie)!==isNaN(oe))return isNaN(ie)?o:v;if(s.test(ie+oe)&&ie.localeCompare){var ve=ie.localeCompare(oe);if(ve>0)return o;if(ve<0)return v;if(H===J-1)return 0}if(ie<oe)return v;if(ie>oe)return o;if(""+ie<""+oe)return v;if(""+ie>""+oe)return o}return 0}}var rs=rn.default=is;let B;class No{constructor(e){Z(this,"nodeList",F([]));Z(this,"getList");Z(this,"route");Z(this,"router");Z(this,"contentDOM");Z(this,"emitGo");Z(this,"modal");Z(this,"context");Z(this,"mode",F(""));Z(this,"modeKey","");Z(this,"sortVal",F(""));Z(this,"selecting",!1);Z(this,"selectingMovEvtCount",0);Z(this,"selectingOffset",[[0,0],[0,0]]);Z(this,"preSelectedNodeIndexSet",new Set);Z(this,"selectingKeyDef","");Z(this,"showSelectionOp",F(!1));Z(this,"lastSelectIndex",-1);Z(this,"reloadOffset_timer",0);Z(this,"reloadOffset_count",0);Z(this,"startScroll",!1);this.contentDOM=e.contentDOM,this.getList=e.getList,this.route=e.route,this.router=e.router,this.emitGo=e.emitGo,this.modal=wn,this.context=os,this.mode.value=ue("file_view_mode")??"detail",this.modeKey=bn("file_view_mode",t=>this.mode.value=t),this.sortVal=F(ue("file_view_sort")??"name_asc"),this.contextMenuEvt=this.contextMenuEvt.bind(this),this.mouseDownEvt=this.mouseDownEvt.bind(this),this.mouseMoveEvt=this.mouseMoveEvt.bind(this),this.mouseUpEvt=this.mouseUpEvt.bind(this),this.keymap=this.keymap.bind(this),this.reloadOffset=this.reloadOffset.bind(this),this.scrollEvt=this.scrollEvt.bind(this),addEventListener("contextmenu",this.contextMenuEvt),addEventListener("pointerdown",this.mouseDownEvt),addEventListener("pointermove",this.mouseMoveEvt),addEventListener("pointerup",this.mouseUpEvt),addEventListener("keydown",this.keymap),addEventListener("resize",this.reloadOffset),this.contentDOM.addEventListener("scroll",this.scrollEvt),B=this}destructor(){console.info("destructor loaded"),kn("file_view_mode",this.modeKey),removeEventListener("contextmenu",this.contextMenuEvt),removeEventListener("pointerdown",this.mouseDownEvt),removeEventListener("pointermove",this.mouseMoveEvt),removeEventListener("pointerup",this.mouseUpEvt),removeEventListener("keydown",this.keymap),removeEventListener("resize",this.reloadOffset),this.contentDOM&&this.contentDOM.removeEventListener("scroll",this.scrollEvt),B=null}setList(e){this.nodeList.value=e,setTimeout(()=>{this.reloadOffset(void 0)},te.timeouts.offsetDebounce)}deleteFromList(e){const t=[],n=new Set;e.forEach(s=>n.add(s)),this.nodeList.value.forEach(s=>{n.has(s.id??0)||t.push(s)}),this.getList(t)}inDetailView(e){let t=!1,n=e.target;for(;n;){if(n.contentEditable==="true"){t=!1;break}if(n.classList.contains("rater")){t=!1;break}if(n.classList.contains("list_fav")){t=!0;break}if(n.classList.contains("view_fav")){t=!1;break}if(n.classList.contains("content_meta")){t=!1;break}if(n.classList.contains("fr_content")){t=!0;break}if(!n.parentElement)break;n=n.parentElement}return t}inTaggingDOM(e){let t=!1,n=e.target;for(;n;){if(n.classList.contains("content_detail"))return!1;if(n.classList.contains("tag_list")){t=!0;break}if(!n.parentElement)break;n=n.parentElement}return t}mouseDownEvt(e){var c,h,u,o;if(!this.inDetailView(e)||e.button===1)return;if(this.selectingOffset[0]=[e.x+(((c=this.contentDOM)==null?void 0:c.scrollLeft)??0),e.y+(((h=this.contentDOM)==null?void 0:h.scrollTop)??0)],this.selectingOffset[1]=[e.x+(((u=this.contentDOM)==null?void 0:u.scrollLeft)??0),e.y+(((o=this.contentDOM)==null?void 0:o.scrollTop)??0)],this.preSelectedNodeIndexSet.clear(),e.preventDefault(),e.button!==0)return this.rightMouseDownEvt(e);this.nodeList.value.forEach((v,_)=>{v._selected&&this.preSelectedNodeIndexSet.add(_)}),this.selecting=!0,this.selectingMovEvtCount=0;const t=this.getSelection(this.selectingOffset),n=[];e.ctrlKey&&n.push("ctrl"),e.shiftKey&&n.push("shift"),this.selectingKeyDef=n.join("_");let s=-1;const r=Array.from(t);switch(r.length&&(s=r.pop()??-1),this.selectingKeyDef){case"shift":this.preSelectedNodeIndexSet.clear();case"ctrl_shift":if(s==-1||this.lastSelectIndex==-1)break;const v=Math.min(s,this.lastSelectIndex),_=Math.max(s,this.lastSelectIndex);for(let g=v;g<=_;g++)t.has(g)||this.preSelectedNodeIndexSet.add(g);break;default:this.preSelectedNodeIndexSet.clear();break;case"ctrl":break}this.nodeList.value.forEach((v,_)=>{let g=0;this.preSelectedNodeIndexSet.has(_)&&(g+=1),t.has(_)&&(g+=1),v._selected=g===1}),this.lastSelectIndex=s,this.showSelectionOp.value=this.preSelectedNodeIndexSet.size+t.size>0}rightMouseDownEvt(e){const t=this.getSelection(this.selectingOffset);let n=!1;const s=new Set;this.nodeList.value.forEach((r,c)=>{r._selected&&(s.add(c),t.has(c)&&(n=!0))}),n?this.preSelectedNodeIndexSet=s:this.preSelectedNodeIndexSet=t,this.nodeList.value.forEach((r,c)=>{r._selected=this.preSelectedNodeIndexSet.has(c)})}mouseMoveEvt(e){var s,r;if(!this.selecting||(this.selectingMovEvtCount+=1,this.selectingMovEvtCount<10))return;e.preventDefault(),this.selectingOffset[1]=[e.x+(((s=this.contentDOM)==null?void 0:s.scrollLeft)??0),e.y+(((r=this.contentDOM)==null?void 0:r.scrollTop)??0)];const t=this.getSelection(this.selectingOffset);this.nodeList.value.forEach((c,h)=>{let u=0;this.preSelectedNodeIndexSet.has(h)&&(u+=1),t.has(h)&&(u+=1),c._selected=u===1});const n=this.getSelection([this.selectingOffset[1],this.selectingOffset[1]]);n.size&&(this.lastSelectIndex=Array.from(n).pop()??-1),this.showSelectionOp.value=this.preSelectedNodeIndexSet.size+t.size>0}mouseUpEvt(e){this.selecting&&(e.preventDefault(),setTimeout(()=>{this.selecting=!1,this.selectingMovEvtCount=0,this.selectingOffset=[[0,0],[0,0]],this.preSelectedNodeIndexSet.clear(),this.selectingKeyDef=""},te.timeouts.selectEvt))}async contextMenuEvt(e){if(!this.inDetailView(e))return;let t=this.route.name==="Recycle",n=this.getSelected();if(!n.nodeLs||!n.nodeLs.length)return;let s=n.nodeLs.length!==1;const r=n.nodeLs,c=n.idSet;let h=ue("file_view_mode")??"detail";this.route.name!=="Directory"&&(h="detail");let u=h==="detail";this.route.name==="Recycle"&&(u=!1),e.preventDefault(),e.stopPropagation(),this.context.trigger([{title:"Open",auth:"guest",method:async o=>{console.info("Open",o),s?await G.op_bath_browser(c,r):this.emitGo("node",r[0].id)}},{title:"Open New Tab",auth:"guest",method:async o=>{var g;console.info("Open",o,this.route,this.router);let v=null;s||r.length&&r[0].type==="directory"&&(v=r[0]),de.copyObject(this.route.query);const _=new URL(location.href);v&&_.searchParams.set("id_dir",`${v.id??0}`),(g=window.open(_,"_blank"))==null||g.focus()}},{title:"Download",auth:s||r[0].type=="directory"?"none":"guest",method:o=>{var p,m;console.info("Download",o);const v=r[0];let _=(m=(p=v.file_index)==null?void 0:p.raw)==null?void 0:m.path,g=(v==null?void 0:v.title)??"";if(!_)return;let l=document.createElement("a");l.style.display="none",l.href=_+"?filename="+g,l.target="_blank",l.setAttribute("download",g),l.click()}},{title:"Download Selected",auth:s||r[0].type=="directory"?"guest":"none",method:async o=>{if(console.info("DownloadSelected",o),console.info(this,r),!B||!B.modal)return;const v=Tt("",r),_=new En(v,async p=>{const m=await Q("file/get",Object.assign({mode:"directory",cascade_dir:"0",id_dir:p.id.toString(),with:"file"}));return m?Tt(p.path,m.list):[]}),g=F("downloading 0/0 (0%)"),l=B.modal.set({title:_.title,alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:g});await _.prepare(),await _.download((p,m,d,i,y)=>{const f=p+m,b=Math.round(1e4*f/d)/100+"%";l.content.text.value=`downloading ${f}/${d} (${b})`}),await _.build(),await _.complete(),B.modal.close(l.nid)}},{title:"Rename",auth:u?"user":"none",method:async o=>{console.info("Rename",o),s?await G.op_bath_rename(c,r):await G.op_rename(r[0])}},{title:"Move",auth:u?"user":"none",method:async o=>{console.info("Move",o),s?await G.op_bath_move(c,r):await G.op_move(r[0])}},{title:"Delete",auth:t?"none":"user",method:async o=>{console.info("Delete",o),s?await G.op_bath_delete(c,r):await G.op_delete(r[0])}},{title:"Recover",auth:t?"user":"none",method:async o=>{console.info("Recover",o),s?await G.op_bath_delete(c,r,!0):await G.op_delete(r[0],!0)}},{title:"Delete Forever",auth:t?"user":"none",method:async o=>{console.info("Delete Forever",o),s?await G.op_bath_delete_forever(c,r):await G.op_delete_forever(r[0])}},{title:"Favourite",auth:u?"user":"none",method:async o=>{console.info("Favourite",o),s?await G.op_bath_favourite(c,r):await G.op_toggle_favourite(r[0])}},{title:"Share",auth:"user",method:async o=>{console.info("Share",o),await G.op_share(c)}},{title:"Extra",auth:"guest",method:o=>{console.info("Extra",o)},child:[{title:"Tagging",auth:u?"user":"none",method:async o=>{console.info("Tagging",o),r.forEach(v=>{G.op_tag(v)})}},{title:"Set Cover",auth:s?"none":"user",method:async o=>{console.info("Set Cover",o),await G.op_set_cover(r[0])}},{title:"Import EHT",auth:"admin",method:async o=>{console.info("Import EHT",o),await G.op_imp_tag_eh(Array.from(c))}},{title:"Cascade Tag",auth:"user",method:async o=>{console.info("Cascade Tag",o),await G.op_cascade_tag(Array.from(c))}}]},{title:"Admin",auth:"admin",method:o=>{console.info("Extra",o)},child:[{title:"ReBuild",auth:"admin",method:async o=>{console.info("ReBuild",o),await G.op_rebuild(Array.from(c))}},{title:"ReHash",auth:s?"none":"admin",method:async o=>{console.info("ReHash",o),await G.op_rehash(Array.from(c))}},{title:"RM RAW",auth:"admin",method:async o=>{console.info("RMRAW",o),await G.op_rm_raw(Array.from(c))}}]}],e)}getSelection(e){let t=e[0][0]>e[1][0]?e[1][0]:e[0][0],n=e[0][1]>e[1][1]?e[1][1]:e[0][1],s=e[0][0]<e[1][0]?e[1][0]:e[0][0],r=e[0][1]<e[1][1]?e[1][1]:e[0][1];const c=new Set;return this.nodeList.value.forEach((h,u)=>{if(!h._offsets)return;let o=h==null?void 0:h._offsets[0],v=h==null?void 0:h._offsets[1],_=h==null?void 0:h._offsets[2],g=h==null?void 0:h._offsets[3],l=o>=t&&o<=s||_>=t&&_<=s||o<=s&&_>=t,p=v>=n&&v<=r||g>=n&&g<=r||v<=r&&g>=n;!l||!p||c.add(u)}),c}clearSelect(e){e.target.classList.contains("content_detail")&&(this.nodeList.value.forEach(t=>{t._selected=!1}),this.showSelectionOp.value=!1)}async bathOp(e){let{idSet:t,nodeLs:n}=this.getSelected();if(t.size)switch(e){case"rename":await G.op_bath_rename(t,n);break;case"move":await G.op_bath_move(t,n);break;case"delete":await G.op_bath_delete(t,n);break;case"delete_forever":await G.op_bath_delete_forever(t,n);break;case"browser":await G.op_bath_browser(t,n);break;case"favourite":await G.op_bath_favourite(t,n);break}}getSelected(){const e=[],t=new Set;return this.nodeList.value.forEach(n=>{n._selected&&(e.push(n),t.add((n==null?void 0:n.id)??0))}),{nodeLs:e,idSet:t}}arrowSelection(e){if(!this.nodeList.value.length)return;let t=this.lastSelectIndex;if(t===-1){const o=this.getSelected();o.idSet.size?t=Array.from(o.idSet).pop()??0:t=0}ue("file_view_mode"),this.route.name;const n=this.nodeList.value[t];if(!n)return;n._offsets||(n._offsets=[]);const s=n._offsets[2]-n._offsets[0],r=this.contentDOM.offsetWidth,c=Math.floor(r/s);let h=t;switch(e.key){case"ArrowRight":h+=1;break;case"ArrowLeft":h-=1;break;case"ArrowUp":h-=1*c;break;case"ArrowDown":h+=1*c;break}let u=!1;(e.ctrlKey||e.shiftKey)&&(u=!0),h<0&&(h=0),h>this.nodeList.value.length-1&&(h=this.nodeList.value.length-1),this.lastSelectIndex=h,this.nodeList.value.forEach((o,v)=>{if(h===v)return o._selected=!0;o._selected&&!u&&(o._selected=!1)})}setMode(e){Ee("file_view_mode",e),this.setList(this.nodeList.value)}setSort(e){console.info("setSort",e),Ee("file_view_sort",e);const t=this.nodeList.value;this.nodeList.value=[],setTimeout(()=>{this.nodeList.value=this.sortList(t,this.sortVal.value),this.setList(this.nodeList.value)},te.timeouts.sort)}sortList(e,t){return e=ln(e,t),e}async keymap(e){let t;const n=e.target;switch(e.key){case"F2":if(ze(n)||Ne(n)||this.mode.value!="detail")return;t=this.getSelected(),t.nodeLs.length!==1?await G.op_bath_rename(t.idSet,t.nodeLs):await G.op_rename(t.nodeLs[0]);break;case"Delete":if(ze(n)||Ne(n))return;t=this.getSelected(),this.route.name==="Recycle"?await G.op_bath_delete_forever(t.idSet,t.nodeLs):await G.op_bath_delete(t.idSet,t.nodeLs);break;case"NumpadEnter":case"Enter":if(ze(n)||Ne(n)||(t=this.getSelected(),!t.idSet.size))return;if(console.info(t.idSet.size),e.altKey&&t.idSet.size==1)return this.emitGo("node",Array.from(t.idSet)[0]);await G.op_bath_browser(t.idSet,t.nodeLs);break;case"ArrowRight":case"ArrowLeft":case"ArrowUp":case"ArrowDown":return ze(n)||Ne(n)?void 0:this.arrowSelection(e)}}reloadOffset(e){if(this.reloadOffset_count>100)return;let t=!0;if(this.nodeList.value.forEach(n=>{n._dom||(t=!1)}),clearTimeout(this.reloadOffset_timer),!t){this.reloadOffset_timer=setTimeout(()=>{this.reloadOffset_count+=1,this.reloadOffset(e)},te.timeouts.offsetDebounce);return}this.nodeList.value.forEach(n=>{if(!n._dom)return;const s=n._dom;let r=0,c=0,h=0,u=0;r=de.nodeOffsetX(s),c=de.nodeOffsetY(s),h=r+s.offsetWidth,u=c+s.offsetHeight,n._offsets=[r,c,h,u]}),this.scrollEvt(e)}go(e){const t=Object.assign({id_dir:"",id_tag:""},e);this.router.push({path:"/",query:t})}scrollEvt(e){de.debounce(()=>{this.saveScroll(),this.reloadLazyLoad()},te.timeouts.scrollEvt,"debounce_scroll_view")}saveScroll(){const e=this.route.query??{},t=[this.route.path,e.mode?e.mode:"",e.pid?e.pid:"",e.id?e.id:"",e.id?e.id:"",e.tag_id?e.tag_id:""].join(":"),n=[this.contentDOM.scrollTop,this.contentDOM.scrollLeft];!n[0]&&!n[1]||de.debounce(()=>{xn("scroll_log",t,n)},te.timeouts.scrollSave,"debounce_scroll_save")}async reloadScroll(){const e=this.route.query??{},t=[this.route.path,e.mode?e.mode:"",e.pid?e.pid:"",e.id?e.id:"",e.id?e.id:"",e.tag_id?e.tag_id:""].join(":"),n=await Sn("scroll_log",t);n&&(this.contentDOM.scrollTop=n[0]??0,this.contentDOM.scrollLeft=n[1]??0)}reloadLazyLoad(){if(!this.contentDOM)return;const e=this.contentDOM,t=de.nodeOffsetY(e),n=e.scrollTop+t,s=n+e.clientHeight+t;this.nodeList.value.forEach(r=>{let c=!0;if(!r._offsets||!r._offsets.length)return;let h=r._offsets;h[1]>s&&(c=!1),h[3]<n&&(c=!1),r._in_screen=c})}}class G{static async op_download(e){var n,s;let t=(s=(n=e.file_index)==null?void 0:n.raw)==null?void 0:s.path;t&&window.open(`${t}?filename=${e.title}`)}static async op_rename(e){if(e._renaming){const t=new FormData;t.set("id",`${e.id}`),t.set("title",e.title??""),t.set("description",e.description??""),await Q("file/mod",t),B&&B.emitGo("reload")}e._renaming=!e._renaming,setTimeout(()=>{let t=document.body.querySelector('[contenteditable="true"]');t&&t.focus()},50)}static async op_bath_rename(e,t){B&&B.modal.set({title:"bath rename",alpha:!1,key:"",single:!1,w:400,h:275,minW:400,minH:275,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"renameUtil",data:{node_list:t,callback:()=>{B&&B.getList()}}}]})}static async op_move(e){B&&B.modal.set({title:`locator | move ${e.title} to:`,alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async t=>{const n=new FormData;n.set("id_node",`${e.id}`),n.set("id_target",`${t.id}`),await Q("file/mov",n),B&&B.emitGo("reload")}}}]})}static async op_bath_move(e,t){B&&B.modal.set({title:`locator | move ${e.size} files to:`,alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async n=>{const s={id_list:Array.from(e).join(","),id_parent:`${n.id}`},r=await Q("file/bath_move",s);B&&B.getList()}}}]})}static async op_delete(e,t=!1){const n=new FormData;n.set("id",`${e.id}`);const s=await Q("file/delete",n);return console.info(B),B&&e.id&&B.deleteFromList([e.id]),s}static async op_bath_delete(e,t,n=!1,s){B&&B.modal.set({title:`confirm to ${n?"recover":"delete"} ${e.size} files`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:"conform to "+(n?"recover":"delete"),callback:{confirm:async r=>{const c=Array.from(e),h={id_list:c.join(",")},u=await Q("file/bath_delete",h);B&&B.deleteFromList(c),s&&s()}}})}static async op_delete_forever(e){const t=new FormData;t.set("id",`${e.id}`);const n=await Q("file/delete_forever",t);return B&&e.id&&B.deleteFromList([e.id]),n}static async op_bath_delete_forever(e,t){B&&B.modal.set({title:`confirm to delete ${e.size} files forever`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:"conform to delete forever",callback:{confirm:async n=>{const s=Array.from(e),r={id_list:s.join(",")},c=await Q("file/bath_delete_forever",r);B&&B.deleteFromList(s)}}})}static async op_toggle_favourite(e){const t=await Q("favourite_group/get",{}),n={};t&&t.forEach(s=>{s.auto||(n[s.id??0]=s.title??"")}),B&&B.modal.set({title:"select fav group:",alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"checkbox",label:"attach to",key:"target_group",value:e.list_fav,options:n}],callback:{submit:async function(s){const c=s.content.form[0].value.join(",");await Q("favourite/attach",{id_node:e.id,list_group:c}),location.reload()}}})}static async op_bath_favourite(e,t){const n=await Q("favourite_group/get",{}),s={};n&&n.forEach(r=>{r.auto||(s[r.id??0]=r.title??"")}),B&&B.modal.set({title:"select fav group:",alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"checkbox",label:"attach to:",key:"target_group",value:[],options:s}],callback:{submit:async function(r){const c=r.content.form[0].value.join(",");await Q("favourite/bath_attach",{node_id_list:Array.from(e),list_group:c})}}})}static async op_bath_browser(e,t){let n=Array.from(e),s={};s.with="crumb,file",n.length==1?(s.mode="directory",s.id_dir=`${t[0].type==="directory"?t[0].id:t[0].id_parent}`):(s.mode="id_iterate",s.keyword=n.join(",")),s.cascade_dir="0",ls(s,n[0])}static async op_tag(e){if(e._tagging){const t=new Set;if(e.tag)for(let s=0;s<e.tag.length;s++)for(let r=0;r<e.tag[s].sub.length;r++){const c=e.tag[s].sub[r].id;c&&t.add(c)}const n=new FormData;n.set("id_node",`${e.id}`),n.set("tag_list",Array.from(t).join(",")),await Q("tag/attach",n)}e._tagging=!e._tagging}static async op_set_cover(e){const t=new FormData;return t.set("id",`${e.id}`),await Q("file/cover",t)}static async op_rebuild(e){const t=new FormData;return t.set("id_list",e.join(",")),await Q("file/rebuild",t)}static async op_rehash(e){const t=new FormData;return t.set("id_list",e.join(",")),await Q("file/rehash",t)}static async op_cascade_tag(e){const t=new FormData;return t.set("id_list",e.join(",")),await Q("file/cascade_tag",t)}static async op_rm_raw(e){const t=new FormData;return t.set("id_list",e.join(",")),await Q("file/rm_raw",t)}static async op_imp_tag_eh(e){const t=new FormData;return t.set("id_list",e.join(",")),await Q("setting/import_eht_tag",t)}static async op_rate(e,t){if(!B)return;let n=B.getSelected();t&&!n.idSet.size&&(n.idSet.add((t==null?void 0:t.id)??0),n.nodeLs.push(t)),n.nodeLs.forEach(r=>{r.rate=e});const s=new FormData;s.set("node_id_list",Array.from(n.idSet).join(",")),s.set("rate",`${e}`),await Q("rate/attach",s)}static async op_share(e){const t={title:"share file",alpha:!1,key:"",single:!1,w:400,h:120,minW:400,minH:120,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:'<a href="./share.html?id=#id#" target="_blank" style="text-decoration: underline">url generated<br> id: #id#</a>',callback:{submit:async n=>{}}};B==null||B.modal.set({title:"share file",alpha:!1,key:"",single:!1,w:400,h:160,minW:400,minH:160,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"radio",label:"duration",key:"status",value:"1",options:{1:"long",2:"1 day",3:"7 day",4:"30 day",5:"manual"},on_change:(n,s,r)=>{const c=new Date;switch(r.value){case"1":s.content.form[1].disabled=!0;break;case"2":s.content.form[1].disabled=!0,c.setDate(c.getDate()+1),s.content.form[1].value=c.toISOString().substring(0,16);break;case"3":s.content.form[1].disabled=!0,c.setDate(c.getDate()+7),s.content.form[1].value=c.toISOString().substring(0,16);break;case"4":s.content.form[1].disabled=!0,c.setDate(c.getDate()+30),s.content.form[1].value=c.toISOString().substring(0,16);break;case"5":s.content.form[1].disabled=!1,c.setDate(c.getDate()+30),s.content.form[1].value=c.toISOString().substring(0,16);break}}},{type:"datetime",label:"expire",key:"time_to",value:new Date().toISOString().substring(0,16),disabled:!0}],callback:{submit:async n=>{const s=new FormData;s.set("node_id_list",Array.from(e).join(",")),n.content.form[0].value=="1"?s.set("status","2"):(s.set("status","1"),s.set("time_to",n.content.form[1].value));const r=await Q("share/set",s);r&&(t.text&&(t.text=t.text.replace(/#id#/ig,`${r.id}`)),B==null||B.modal.set(t))}}})}}function Tt(a,e){const t=[];return e.forEach(n=>{var r;const s={id:n.id,id_parent:n.id_parent,path:"",url:"",size:0,type:n.type??""};if(s.path=[a??"",n.title??""].join("/"),n.type!=="directory"){const c=(r=n.file_index)==null?void 0:r.raw;if(!c)return;c.path&&(s.url=c.path+"?filename="+n.title),s.size=c.size??0}t.push(s)}),t}function ls(a,e){if(!B)return;let t=ue("browser_layout_w"),n=ue("browser_layout_h");const s=window.innerWidth,r=window.innerHeight;s<t&&(t=0),r<n&&(n=0),B.modal.set({title:"file browser",alpha:!1,key:"",single:!1,w:t||400,h:n||400,minW:400>window.innerWidth?window.innerWidth*.9:400,minH:400>window.innerHeight?window.innerHeight*.9:400,allow_resize:!0,allow_move:!0,allow_fullscreen:!0,auto_focus:!1,component:[{componentName:"fileBrowser",data:{query:de.copyObject(a),curId:e}}]})}function ln(a,e){let t=["id","asc"];switch(e){default:case"id_asc":t=["id","asc"];break;case"id_desc":t=["id","desc"];break;case"name_asc":t=["title","asc"];break;case"name_desc":t=["title","desc"];break;case"crt_asc":t=["time_create","asc"];break;case"crt_desc":t=["time_create","desc"];break;case"upd_asc":t=["time_update","asc"];break;case"upd_desc":t=["time_update","desc"];break;case"rate_asc":t=["rate","asc"];break;case"rate_desc":t=["rate","desc"];break}for(let r=0;r<a.length;r++){const c=a[r];c._sort_index||(c._sort_index=c.node_path+"/"+c.title)}const n=t[1]==="desc",s=n?-1:1;return a.sort((r,c)=>{let h="",u="";switch(t[0]){default:h=r[t[0]],u=c[t[0]];break;case"title":return h=s*(r.type==="directory"?0:1)+(r._sort_index??""),u=s*(c.type==="directory"?0:1)+(c._sort_index??""),rs({desc:n,insensitive:!0})(h,u)}return(h>u?1:-1)*s}),a}var Xe={},we=we||function(a,e){var t={},n=t.lib={},s=function(){},r=n.Base={extend:function(l){s.prototype=this;var p=new s;return l&&p.mixIn(l),p.hasOwnProperty("init")||(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var l=this.extend();return l.init.apply(l,arguments),l},init:function(){},mixIn:function(l){for(var p in l)l.hasOwnProperty(p)&&(this[p]=l[p]);l.hasOwnProperty("toString")&&(this.toString=l.toString)},clone:function(){return this.init.prototype.extend(this)}},c=n.WordArray=r.extend({init:function(l,p){l=this.words=l||[],this.sigBytes=p!=e?p:4*l.length},toString:function(l){return(l||u).stringify(this)},concat:function(l){var p=this.words,m=l.words,d=this.sigBytes;if(l=l.sigBytes,this.clamp(),d%4)for(var i=0;i<l;i++)p[d+i>>>2]|=(m[i>>>2]>>>24-8*(i%4)&255)<<24-8*((d+i)%4);else if(65535<m.length)for(i=0;i<l;i+=4)p[d+i>>>2]=m[i>>>2];else p.push.apply(p,m);return this.sigBytes+=l,this},clamp:function(){var l=this.words,p=this.sigBytes;l[p>>>2]&=4294967295<<32-8*(p%4),l.length=a.ceil(p/4)},clone:function(){var l=r.clone.call(this);return l.words=this.words.slice(0),l},random:function(l){for(var p=[],m=0;m<l;m+=4)p.push(4294967296*a.random()|0);return new c.init(p,l)}}),h=t.enc={},u=h.Hex={stringify:function(l){var p=l.words;l=l.sigBytes;for(var m=[],d=0;d<l;d++){var i=p[d>>>2]>>>24-8*(d%4)&255;m.push((i>>>4).toString(16)),m.push((i&15).toString(16))}return m.join("")},parse:function(l){for(var p=l.length,m=[],d=0;d<p;d+=2)m[d>>>3]|=parseInt(l.substr(d,2),16)<<24-4*(d%8);return new c.init(m,p/2)}},o=h.Latin1={stringify:function(l){var p=l.words;l=l.sigBytes;for(var m=[],d=0;d<l;d++)m.push(String.fromCharCode(p[d>>>2]>>>24-8*(d%4)&255));return m.join("")},parse:function(l){for(var p=l.length,m=[],d=0;d<p;d++)m[d>>>2]|=(l.charCodeAt(d)&255)<<24-8*(d%4);return new c.init(m,p)}},v=h.Utf8={stringify:function(l){try{return decodeURIComponent(escape(o.stringify(l)))}catch{throw Error("Malformed UTF-8 data")}},parse:function(l){return o.parse(unescape(encodeURIComponent(l)))}},_=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(l){typeof l=="string"&&(l=v.parse(l)),this._data.concat(l),this._nDataBytes+=l.sigBytes},_process:function(l){var p=this._data,m=p.words,d=p.sigBytes,i=this.blockSize,y=d/(4*i),y=l?a.ceil(y):a.max((y|0)-this._minBufferSize,0);if(l=y*i,d=a.min(4*l,d),l){for(var f=0;f<l;f+=i)this._doProcessBlock(m,f);f=m.splice(0,l),p.sigBytes-=d}return new c.init(f,d)},clone:function(){var l=r.clone.call(this);return l._data=this._data.clone(),l},_minBufferSize:0});n.Hasher=_.extend({cfg:r.extend(),init:function(l){this.cfg=this.cfg.extend(l),this.reset()},reset:function(){_.reset.call(this),this._doReset()},update:function(l){return this._append(l),this._process(),this},finalize:function(l){return l&&this._append(l),this._doFinalize()},blockSize:16,_createHelper:function(l){return function(p,m){return new l.init(m).finalize(p)}},_createHmacHelper:function(l){return function(p,m){return new g.HMAC.init(l,m).finalize(p)}}});var g=t.algo={};return t}(Math);(function(a){for(var e=we,l=e.lib,t=l.WordArray,n=l.Hasher,l=e.algo,s=[],r=[],c=function(m){return 4294967296*(m-(m|0))|0},h=2,u=0;64>u;){var o;e:{o=h;for(var v=a.sqrt(o),_=2;_<=v;_++)if(!(o%_)){o=!1;break e}o=!0}o&&(8>u&&(s[u]=c(a.pow(h,.5))),r[u]=c(a.pow(h,1/3)),u++),h++}var g=[],l=l.SHA256=n.extend({_doReset:function(){this._hash=new t.init(s.slice(0))},_doProcessBlock:function(p,m){for(var d=this._hash.words,i=d[0],y=d[1],f=d[2],b=d[3],C=d[4],k=d[5],O=d[6],S=d[7],I=0;64>I;I++){if(16>I)g[I]=p[m+I]|0;else{var H=g[I-15],J=g[I-2];g[I]=((H<<25|H>>>7)^(H<<14|H>>>18)^H>>>3)+g[I-7]+((J<<15|J>>>17)^(J<<13|J>>>19)^J>>>10)+g[I-16]}H=S+((C<<26|C>>>6)^(C<<21|C>>>11)^(C<<7|C>>>25))+(C&k^~C&O)+r[I]+g[I],J=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&y^i&f^y&f),S=O,O=k,k=C,C=b+H|0,b=f,f=y,y=i,i=H+J|0}d[0]=d[0]+i|0,d[1]=d[1]+y|0,d[2]=d[2]+f|0,d[3]=d[3]+b|0,d[4]=d[4]+C|0,d[5]=d[5]+k|0,d[6]=d[6]+O|0,d[7]=d[7]+S|0},_doFinalize:function(){var p=this._data,m=p.words,d=8*this._nDataBytes,i=8*p.sigBytes;return m[i>>>5]|=128<<24-i%32,m[(i+64>>>9<<4)+14]=a.floor(d/4294967296),m[(i+64>>>9<<4)+15]=d,p.sigBytes=4*m.length,this._process(),this._hash},clone:function(){var p=n.clone.call(this);return p._hash=this._hash.clone(),p}});e.SHA256=n._createHelper(l),e.HmacSHA256=n._createHmacHelper(l)})(Math);(function(){var a=we,e=a.enc.Utf8;a.algo.HMAC=a.lib.Base.extend({init:function(t,n){t=this._hasher=new t.init,typeof n=="string"&&(n=e.parse(n));var s=t.blockSize,r=4*s;n.sigBytes>r&&(n=t.finalize(n)),n.clamp();for(var c=this._oKey=n.clone(),h=this._iKey=n.clone(),u=c.words,o=h.words,v=0;v<s;v++)u[v]^=1549556828,o[v]^=909522486;c.sigBytes=h.sigBytes=r,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var n=this._hasher;return t=n.finalize(t),n.reset(),n.finalize(this._oKey.clone().concat(t))}})})();(function(){var a=we,e=a.lib.WordArray;a.enc.Base64={stringify:function(t){var n=t.words,s=t.sigBytes,r=this._map;t.clamp(),t=[];for(var c=0;c<s;c+=3)for(var h=(n[c>>>2]>>>24-8*(c%4)&255)<<16|(n[c+1>>>2]>>>24-8*((c+1)%4)&255)<<8|n[c+2>>>2]>>>24-8*((c+2)%4)&255,u=0;4>u&&c+.75*u<s;u++)t.push(r.charAt(h>>>6*(3-u)&63));if(n=r.charAt(64))for(;t.length%4;)t.push(n);return t.join("")},parse:function(t){var n=t.length,s=this._map,r=s.charAt(64);r&&(r=t.indexOf(r),r!=-1&&(n=r));for(var r=[],c=0,h=0;h<n;h++)if(h%4){var u=s.indexOf(t.charAt(h-1))<<2*(h%4),o=s.indexOf(t.charAt(h))>>>6-2*(h%4);r[c>>>2]|=(u|o)<<24-8*(c%4),c++}return e.create(r,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(a){for(var e=we,l=e.lib,t=l.WordArray,n=l.Hasher,l=e.algo,s=[],r=[],c=function(m){return 4294967296*(m-(m|0))|0},h=2,u=0;64>u;){var o;e:{o=h;for(var v=a.sqrt(o),_=2;_<=v;_++)if(!(o%_)){o=!1;break e}o=!0}o&&(8>u&&(s[u]=c(a.pow(h,.5))),r[u]=c(a.pow(h,1/3)),u++),h++}var g=[],l=l.SHA256=n.extend({_doReset:function(){this._hash=new t.init(s.slice(0))},_doProcessBlock:function(p,m){for(var d=this._hash.words,i=d[0],y=d[1],f=d[2],b=d[3],C=d[4],k=d[5],O=d[6],S=d[7],I=0;64>I;I++){if(16>I)g[I]=p[m+I]|0;else{var H=g[I-15],J=g[I-2];g[I]=((H<<25|H>>>7)^(H<<14|H>>>18)^H>>>3)+g[I-7]+((J<<15|J>>>17)^(J<<13|J>>>19)^J>>>10)+g[I-16]}H=S+((C<<26|C>>>6)^(C<<21|C>>>11)^(C<<7|C>>>25))+(C&k^~C&O)+r[I]+g[I],J=((i<<30|i>>>2)^(i<<19|i>>>13)^(i<<10|i>>>22))+(i&y^i&f^y&f),S=O,O=k,k=C,C=b+H|0,b=f,f=y,y=i,i=H+J|0}d[0]=d[0]+i|0,d[1]=d[1]+y|0,d[2]=d[2]+f|0,d[3]=d[3]+b|0,d[4]=d[4]+C|0,d[5]=d[5]+k|0,d[6]=d[6]+O|0,d[7]=d[7]+S|0},_doFinalize:function(){var p=this._data,m=p.words,d=8*this._nDataBytes,i=8*p.sigBytes;return m[i>>>5]|=128<<24-i%32,m[(i+64>>>9<<4)+14]=a.floor(d/4294967296),m[(i+64>>>9<<4)+15]=d,p.sigBytes=4*m.length,this._process(),this._hash},clone:function(){var p=n.clone.call(this);return p._hash=this._hash.clone(),p}});e.SHA256=n._createHelper(l),e.HmacSHA256=n._createHmacHelper(l)})(Math);Xe.enc={Base64:we.enc.Base64,Utf8:we.enc.Utf8,Latin1:we.enc.Latin1};Xe.SHA256=we.SHA256;Xe.HmacSHA256=we.HmacSHA256;const ft=Xe,cs={alg:"HS256",typ:"JWT"};function cn(a){return ft.enc.Base64.stringify(a).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function us(a,e,t={}){const n=Object.assign(cs,t);if(n.alg!=="HS256"&&n.typ!=="JWT")throw new Error("jwt-encode only support the HS256 algorithm and the JWT type of hash");const s=Ht(n),r=Ht(a);let c=`${s}.${r}`;return c=ft.HmacSHA256(c,e),c=cn(c),`${s}.${r}.${c}`}function Ht(a){const e=ft.enc.Utf8.parse(JSON.stringify(a));return cn(e)}var ds=us;const fs=Dn(ds),hs={class:"modal_browser office"},ps={class:"base"},_s={class:"l"},ms={class:"r"},vs={class:"content"},ys=["id"],st=100,gs=fe({__name:"office",props:{extId:{},curIndex:{},isActive:{type:Boolean},file:{},dom:{}},setup(a){const e=a;""+e.extId,F(null);const t=Fe();Re(()=>{console.warn("mounted");const h=new URL(location.href);r(`${h.origin}/onlyoffice_server/web-apps/apps/api/documents/api.js`),setTimeout(()=>n(),st)});function n(){if(!s)return setTimeout(()=>n(),st);const h="modal_office_"+e.extId;if(!document.getElementById(h))return setTimeout(()=>n(),st);const o=te.onlyOffice.jwtSecret,v=e.file,_=v.title.lastIndexOf("."),g=v.title.substring(_+1),l=c(g);if(!l)return;const p=new URL(location.href),m={document:{fileType:g,key:v.id.toString(16)+"_"+Math.floor(new Date().valueOf()).toString(),title:v.title,url:`${p.origin}${v.raw}?tosho_token=${t==null?void 0:t.token}`},documentType:l,editorConfig:{callbackUrl:`${p.origin}/api/onlyoffice/callback?id=${v.id}&tosho_token=${t==null?void 0:t.token}`},token:""};m.token=fs(m,o),console.info(m),DocsAPI.DocEditor(h,m)}Nt(()=>e.file,async h=>{console.info("onMod props.curNode")}),Oe(()=>{});let s=!1;function r(h){var u=document.createElement("script");u.type="text/javascript",u.src=h,u.onload=o=>{console.info(o),s=!0},document.body.appendChild(u)}function c(h){let u=!1;switch(h){default:break;case"doc":case"docm":case"docx":case"dot":case"dotm":case"dotx":case"epub":case"fb2":case"fodt":case"htm":case"html":case"mht":case"mhtml":case"odt":case"ott":case"rtf":case"stw":case"sxw":case"txt":case"wps":case"wpt":u="word";break;case"csv":case"et":case"ett":case"fods":case"ods":case"ots":case"sxc":case"xls":case"xlsb":case"xlsm":case"xlsx":case"xlt":case"xltm":case"xltx":u="cell";break;case"dps":case"dpt":case"fodp":case"odp":case"otp":case"pot":case"potm":case"potx":case"pps":case"ppsm":case"ppsx":case"ppt":case"pptm":case"pptx":case"sxi":u="slide";break}return u}return(h,u)=>(L(),$("div",hs,[A("div",ps,[A("div",_s,[Ze(h.$slots,"info")]),A("div",ms,[Ze(h.$slots,"btnContainer")])]),Ze(h.$slots,"navigator"),A("div",vs,[A("div",{id:"modal_office_"+h.extId},null,8,ys)])]))}});class ws{constructor(e){Z(this,"dom");Z(this,"pointerMap",new Map);Z(this,"callbacks",{move:null,end:null});this.dom=e,this.dom.addEventListener("pointerdown",this.onPointerDown.bind(this)),this.dom.addEventListener("pointermove",this.onPointerMove.bind(this)),this.dom.addEventListener("pointerup",this.onPointerUp.bind(this)),this.dom.addEventListener("pointercancel",this.onPointerUp.bind(this)),this.dom.addEventListener("pointerout",this.onPointerUp.bind(this))}onPointerDown(e){if(e.pointerType!=="touch"||this.pointerMap.get(e.pointerId))return;const n={plot_start:[e.clientX,e.clientY],plot_middle:[e.clientX,e.clientY],plot_current:[e.clientX,e.clientY],time_start:new Date().valueOf(),length:0,degree:0,speed:0};this.pointerMap.set(e.pointerId,n)}onPointerMove(e){if(e.pointerType!=="touch")return;const t=this.pointerMap.get(e.pointerId);if(!t)return;t.plot_current=[e.clientX,e.clientY],t.plot_middle=[(t.plot_start[0]+t.plot_current[0])/2,(t.plot_start[1]+t.plot_current[1])/2];let n={x:t.plot_current[0]-t.plot_start[0],y:t.plot_current[1]-t.plot_start[1],time:new Date().valueOf()-t.time_start};t.length=Math.sqrt(n.x*n.x+n.y*n.y),t.degree=180*Math.atan2(-1*n.y,n.x)/Math.PI,t.degree<0&&(t.degree=360+t.degree),t.speed=t.length/(n.time/1e3),this.callbacks.move&&this.callbacks.move(this.processGesture(),e)}onPointerUp(e){e.pointerType!=="touch"||!this.pointerMap.get(e.pointerId)||(this.pointerMap.size==1&&this.callbacks.end&&this.callbacks.end(this.processGesture(),e),this.pointerMap.delete(e.pointerId))}processGesture(){const e={plot_start:[0,0],plot_middle:[0,0],plot_current:[0,0],time_start:0,length:0,degree:0,speed:0,pointerMap:this.pointerMap};if(!this.pointerMap.size)return e;this.pointerMap.forEach(n=>{e.plot_start[0]+=n.plot_start[0],e.plot_start[1]+=n.plot_start[1],e.plot_current[0]+=n.plot_current[0],e.plot_current[1]+=n.plot_current[1],e.time_start=Math.min(n.time_start)}),e.plot_start[0]/=this.pointerMap.size,e.plot_start[1]/=this.pointerMap.size,e.plot_current[0]/=this.pointerMap.size,e.plot_current[1]/=this.pointerMap.size,e.plot_middle=[(e.plot_start[0]+e.plot_current[0])/2,(e.plot_start[1]+e.plot_current[1])/2];let t={x:e.plot_current[0]-e.plot_start[0],y:e.plot_current[1]-e.plot_start[1],time:new Date().valueOf()-e.time_start};return e.length=Math.sqrt(t.x*t.x+t.y*t.y),e.degree=180*Math.atan2(-1*t.y,t.x)/Math.PI,e.degree<0&&(e.degree=360+e.degree),e.speed=e.length/(t.time/1e3),e}onMove(e){this.callbacks.move=e}onEnd(e){this.callbacks.end=e}reset(){this.pointerMap.forEach(e=>{e.plot_start=e.plot_current,e.plot_middle=e.plot_current,e.length=0,e.time_start=new Date().valueOf(),e.degree=0,e.speed=0})}destory(){this.dom.removeEventListener("pointerup",this.onPointerUp.bind(this)),this.dom.removeEventListener("pointercancel",this.onPointerUp.bind(this)),this.dom.removeEventListener("pointerout",this.onPointerUp.bind(this)),this.dom.removeEventListener("pointermove",this.onPointerMove.bind(this)),this.dom.removeEventListener("pointerdown",this.onPointerDown.bind(this))}}const bs={key:0},ks={class:"preLine"},Es={class:"btnContainer"},xs=["value"],Ss=["value","innerHTML"],Ds=["value"],Ls=["value"],$s=fe({__name:"browser",props:{data:{},modalData:{}},setup(a){const e=a,t=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1,n={audio:Ln,video:$n,image:Rn,pdf:On,text:Cn,office:mt,base:mt};te.onlyOffice.enabled&&(n.office=gs),console.info("regComponentLs",n);let s=!1;function r(){if(s&&!e.modalData.layout.fullscreen){let D=ue("browser_layout_w"),E=ue("browser_layout_h");e.modalData.layout.w=D,e.modalData.layout.h=E,e.modalData.layout.x=(window.innerWidth-D)/2,e.modalData.layout.y=(window.innerHeight-E)/2}else e.modalData.layout.fullscreen||(Ee("browser_layout_w",e.modalData.layout.w),Ee("browser_layout_h",e.modalData.layout.h));s=e.modalData.layout.fullscreen,f.value={w:e.modalData.layout.w,h:e.modalData.layout.h}}const c=F(ue("browser_play_mode")??"loop");function h(){let D=te.playMode.indexOf(c.value);D+=1,D>te.playMode.length-1&&(D=0),c.value=te.playMode[D],Ee("browser_play_mode",c.value)}const u=F(ue("browser_show_detail")??!1);function o(){u.value=!u.value,Ee("browser_show_detail",u.value)}let v;const _=new Set;Re(()=>{document.addEventListener("keydown",oe),document.addEventListener(`modal_resizing_${e.modalData.nid}`,r),f.value={w:e.modalData.layout.w,h:e.modalData.layout.h},setTimeout(()=>{document.activeElement&&document.activeElement.blur()},100);const D=document.querySelector(`[data-ref-id='${e.modalData.nid}']`);D&&(v=new ws(D),v.onMove((E,T)=>{if(_.has(e.modalData.nid))return;let z=20;E.length>window.innerWidth*.2&&((E.degree<z||E.degree>360-z)&&(O(d.value,1),v.reset()),E.degree>180-z&&E.degree<180+z&&(O(d.value,-1),v.reset()))}))}),Oe(()=>{document.removeEventListener("keydown",oe),document.removeEventListener(`modal_resizing_${e.modalData.nid}`,r),v&&v.destory()});const g=F([]),l=F([]),p=F([]);let m=0;const d=F(0),i=F(null),y=F({id:0,title:"",cover:"",preview:"",normal:"",raw:"",sameName:[]}),f=F({w:0,h:0});async function b(D){const E=await Q("file/get",{node_type:"directory",id_dir:`${D}`,with:"none"});return E||{path:[],list:[]}}k();function C(){let D=[];return m=0,l.value.forEach(E=>{if(!H(E))return;const T=E.rate?E.rate+2:2;D.push(Object.assign(E,{_weight_stack:m})),m+=T}),D=he(D,re.value),D}async function k(D={}){var R;D&&(e.data.query=Object.assign(e.data.query,D));let E=await Q("file/get",e.data.query);if(!E||!E.list.length)return!1;let T=[];if(E.list.forEach(x=>{x.is_file&&T.push(x)}),E.list=T,!E.list.length){if(parseInt(((R=e.data.query)==null?void 0:R.cascade_dir)??""))return!1;const x=de.copyObject(e.data.query);if(x.cascade_dir="1",E=await Q("file/get",x),!E||!E.list.length)return!1;T=[],E.list.forEach(P=>{P.is_file&&T.push(P)}),E.list=T}if(!E.list.length)return!1;let z=0,M=null;for(let x=0;x<E.list.length;x++)if(E.list[x].id===e.data.curId){z=x,M=E.list[x];break}console.info(z,M),g.value=E.path,l.value=E.list;let w=C();return w.length?(p.value=he(w,re.value),M||(M=p.value[0]),d.value=ve(p.value,M),console.info(d.value),J(),!0):!1}function O(D,E,T=0){let z=p.value.length;if(z<=1)return;let M=0;if(c.value==="shuffle"){let w=Math.random()*m;E=0;for(let R=0;R<z&&(E=R,!(p.value[R]._weight_stack>w));R++);M=E}else M=D+E;for(;M<0;)M+=z;for(;M>z-1;)M-=z;T||(T=0),T+=1,!(T>z)&&(d.value=M,J())}function S(D){let E=D-d.value;O(d.value,E)}function I(D,E){console.info("emitPreventGesture",D),E?_.delete(D):_.add(D)}function H(D){const E=parseInt(_e.value)??0;if((D.rate??0)<E)return!1;switch(be.value){case"any":case"file":return te.ignoreFileType.indexOf(D.type??"directory")===-1;default:return be.value==D.type}}function J(){var z,M,w,R;if(!p.value.length)return;const D=p.value[d.value];if(i.value=D,!D.file_index.preview&&["audio","video"].indexOf(D.type)!==-1){let x=!1;l.value.forEach(P=>{if(P.id_parent!==D.id_parent||x)return;let j=!1;if(te.coverKeyword.forEach(U=>{te.imgKeyword.forEach(N=>{D.title.toLowerCase().indexOf(U)!==-1&&D.title.toLowerCase().indexOf(N)!==-1&&(j=!0)})}),j){x=!0;let U;U||(U=D.file_index.preview),U||(U=D.file_index.normal),U||(U=D.file_index.raw),D.file_index.preview=U}})}const E={id:D.id,title:D.title,cover:((z=D.file_index.cover)==null?void 0:z.path)??"",preview:((M=D.file_index.preview)==null?void 0:M.path)??"",normal:((w=D.file_index.normal)==null?void 0:w.path)??"",raw:((R=D.file_index.raw)==null?void 0:R.path)??"",sameName:[]};let T=E.title.lastIndexOf(".");if(T!==-1){let x=E.title.substring(0,T)??"";x&&l.value.forEach(P=>{var U,N,V,q,pe,W,se,ye;if(P.id==E.id||((U=P.title)==null?void 0:U.indexOf(x))!==0)return;let j=(N=P.title)==null?void 0:N.substring(x.length);E.sameName.push({title:j,type:P.type??"",raw:((q=(V=P.file_index)==null?void 0:V.raw)==null?void 0:q.path)??"",normal:((W=(pe=P.file_index)==null?void 0:pe.normal)==null?void 0:W.path)??"",preview:((ye=(se=P.file_index)==null?void 0:se.preview)==null?void 0:ye.path)??""})})}y.value=E,ie()}function ie(){i.value&&(e.modalData.base.title=d.value+1+"/"+p.value.length+" "+(i.value.title??""))}async function oe(D){if(!i.value||ze(D.target)||!e.modalData.layout.active)return;let E,T,z,M,w,R;switch(D.key){case"ArrowLeft":if(D.preventDefault(),D.stopPropagation(),["audio","video"].indexOf(i.value.type??"")!==-1)return;O(d.value,-1);break;case"ArrowRight":if(D.preventDefault(),D.stopPropagation(),["audio","video"].indexOf(i.value.type??"")!==-1)return;O(d.value,1);break;case"a":case"PageUp":D.preventDefault(),D.stopPropagation(),O(d.value,-1);break;case"d":case"PageDown":D.preventDefault(),D.stopPropagation(),O(d.value,1);break;case"w":case"[":switch(e.data.query.mode){default:const P=g.value.length?g.value[g.value.length-1]:{id:0,id_parent:0,type:"directory",title:"root",description:"",status:1,building:0};if(E=await b(P.id_parent),T=he(E.list,re.value),z=T.length,z<2)return;M=0,T.forEach((W,se)=>{W.id==e.data.query.id_dir&&(M=se)}),R=T.length;do{for(M-=1;M<0;)M+=z;for(;M>z-1;)M-=z;if(w=T[M],e.data.query.id_dir=`${w.id}`,await k())break}while(--R>0);break;case"id_iterate":if(!e.data.query.keyword)break;const j=e.data.query.keyword.split(","),U=[];j.forEach(W=>U.push(parseInt(W)));let N=null;if(i.value.crumb_node)for(let W=0;W<i.value.crumb_node.length;W++){const se=i.value.crumb_node[W];if(U.indexOf(se.id)!==-1){N=se.id;break}}if(!N)break;const V=U.indexOf(N);z=U.length;let q=V-1;for(;q<0;)q+=z;for(;q>z-1;)q-=z;const pe=U[q];for(let W=0;W<p.value.length;W++){const se=p.value[W];for(let ye=0;ye<se.crumb_node.length;ye++)if(se.crumb_node[ye].id===pe)return O(W,0)}}break;case"s":case"]":switch(e.data.query.mode){default:const P=g.value.length?g.value[g.value.length-1]:{id:0,id_parent:0,type:"directory",title:"root",description:"",status:1,building:0};if(E=await b(P.id_parent),T=he(E.list,re.value),z=T.length,z<2)return;M=0,T.forEach((W,se)=>{W.id==e.data.query.id_dir&&(M=se)}),R=T.length;do{for(M+=1;M<0;)M+=z;for(;M>z-1;)M-=z;if(w=T[M],e.data.query.id_dir=`${w.id}`,await k())break}while(--R>0);break;case"id_iterate":if(!e.data.query.keyword)break;const j=e.data.query.keyword.split(","),U=[];j.forEach(W=>U.push(parseInt(W)));let N=null;for(let W=0;W<i.value.crumb_node.length;W++){const se=i.value.crumb_node[W];if(U.indexOf(se.id)!==-1){N=se.id;break}}if(!N)break;const V=U.indexOf(N);z=U.length;let q=V+1;for(;q<0;)q+=z;for(;q>z-1;)q-=z;const pe=U[q];for(let W=0;W<p.value.length;W++){const se=p.value[W];for(let ye=0;ye<se.crumb_node.length;ye++)if(se.crumb_node[ye].id===pe)return O(W,0)}break}break;case"NumpadEnter":case"Enter":break;case"Delete":D.preventDefault(),D.stopPropagation();const x=new Set;i.value&&i.value.id&&x.add(i.value.id),await G.op_bath_delete(x,[],!1,()=>{O(d.value,1)});break}}function ve(D,E){let T=0;return D.forEach((z,M)=>{z.id===E.id&&(T=M)}),T}const re=F(ue("browser_list_sort")??"name_asc");function qe(D){var T;if(!i.value)return;console.info("setSort",re.value,D),(T=D.target)==null||T.blur();const E=p.value;p.value=[],he(E,re.value),p.value=E,d.value=ve(E,i.value),ie()}function he(D,E){return D=ln(D,E),d.value=ve(D,i.value??{}),Ee("browser_list_sort",re.value),D}const be=F(ue("browser_list_filter")??"any");function Qe(D){Ee("browser_list_filter",D);let E=p.value[d.value],T=C();p.value=he(T,re.value),d.value=ve(p.value,E),console.info(d.value),J()}const _e=F("0");function Te(D){let E=p.value[d.value],T=C();p.value=he(T,re.value),d.value=ve(p.value,E),console.info(d.value),J()}return(D,E)=>i.value?(L(),Bt(Ut(n[i.value.type]?n[i.value.type]:n.base),{key:0,extId:e.modalData.nid,isActive:e.modalData.layout.active,curIndex:d.value,file:y.value,dom:f.value,onNav:S,onPreventGesture:I},{info:et(()=>{var T,z;return[A("div",{class:ce({info:!0,detail:u.value})},[u.value?(L(),$(K,{key:0},[A("p",null,ne(i.value.title)+" ("+ne(X(de).kmgt(((z=(T=i.value.file_index)==null?void 0:T.raw)==null?void 0:z.size)??0,2))+") ",1),i.value.crumb_node?(L(),$("p",bs,[E[11]||(E[11]=_t("Dir : ")),(L(!0),$(K,null,ae(i.value.crumb_node,M=>(L(),$(K,null,[_t("/"+ne(M.title),1)],64))),256))])):ee("",!0),A("p",ks,ne(i.value.description),1)],64)):ee("",!0)],2)]}),btnContainer:et(()=>{var T,z;return[A("div",Es,[u.value?(L(),$(K,{key:0},[t?le((L(),$("select",{key:0,"onUpdate:modelValue":E[0]||(E[0]=M=>_e.value=M),onChange:E[1]||(E[1]=M=>Te(_e.value))},[(L(!0),$(K,null,ae(X(te).rateMobile,(M,w)=>(L(),$("option",{value:w,key:"BROWSER_RATE_"+D.modalData.nid+"_"+w},ne(M),9,xs))),128))],544)),[[Be,_e.value]]):le((L(),$("select",{key:1,class:"sysIcon","onUpdate:modelValue":E[2]||(E[2]=M=>_e.value=M),onChange:E[3]||(E[3]=M=>Te(_e.value))},[(L(!0),$(K,null,ae(X(te).rate,(M,w)=>(L(),$("option",{class:"sysIcon_A sysIcon",value:w,innerHTML:M,key:"BROWSER_RATE_"+D.modalData.nid+"_"+w},null,8,Ss))),128))],544)),[[Be,_e.value]]),le(A("select",{"onUpdate:modelValue":E[4]||(E[4]=M=>be.value=M),onChange:E[5]||(E[5]=M=>Qe(be.value))},[(L(!0),$(K,null,ae(X(te).fileType,(M,w)=>(L(),$("option",{value:M,key:"BROWSER_TYPE_"+D.modalData.nid+"_"+w},ne(M),9,Ds))),128))],544),[[Be,be.value]]),E[12]||(E[12]=A("br",null,null,-1))],64)):ee("",!0),le(A("select",{"onUpdate:modelValue":E[6]||(E[6]=M=>re.value=M),onChange:E[7]||(E[7]=M=>qe(M))},[(L(!0),$(K,null,ae(X(te).sort,(M,w)=>(L(),$("option",{value:w,key:"BROWSER_SORT_"+D.modalData.nid+"_"+w},ne(M),9,Ls))),128))],544),[[Be,re.value]]),A("button",{class:ce(["sysIcon",`sysIcon_player_${c.value}`]),onClick:h},null,2),A("button",{class:ce(["sysIcon","sysIcon_info-cirlce-o"]),onClick:o}),(z=(T=i.value.file_index)==null?void 0:T.raw)!=null&&z.path?(L(),$("button",{key:1,class:ce(["sysIcon","sysIcon_download"]),onClick:E[8]||(E[8]=M=>X(G).op_download(i.value))})):ee("",!0)])]}),navigator:et(()=>[A("div",{class:ce({pagination:1,isMobile:t})},[A("div",{class:"left",onClick:E[9]||(E[9]=T=>O(d.value,-1))},E[13]||(E[13]=[A("span",{class:"sysIcon sysIcon_arrowleft"},null,-1)])),A("div",{class:"right",onClick:E[10]||(E[10]=T=>O(d.value,1))},E[14]||(E[14]=[A("span",{class:"sysIcon sysIcon_arrowright"},null,-1)]))],2)]),_:1},40,["extId","isActive","curIndex","file","dom"])):ee("",!0)}}),Rs={class:"modal_locator"},Os={class:"locator_list"},Cs=["onClick"],Ps={class:"type"},Ms={class:"tree"},As={class:"title"},Is=fe({__name:"locator",props:{data:{},modalData:{}},setup(a){const e=F(null);let t={mode:"directory",id_dir:"",keyword:"",id_tag:"",cascade_dir:"1",node_type:"directory",with:"crumb",limit:"20"};const n=a,s=F([]);Re(()=>{var o;(o=e.value)==null||o.focus()}),Oe(()=>{});async function r(){const o=await Q("file/get",t);!o||!o.list||(t.keyword&&"root".indexOf(t.keyword)!==-1&&o.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),s.value=o.list,s.value.length&&(s.value[0]._sel=!0,n.modalData.layout.h<220&&(n.modalData.layout.h=220)))}async function c(o){console.info(o),!await u(o)&&de.debounce(()=>{var g;let _=(g=e.value)==null?void 0:g.value;if(!_||!_.length){s.value=[];return}console.info(_),console.info(n.modalData),t.keyword=_,r()},200,"locator")}async function h(o){if(console.info(o),!await n.data.call(o))return Vt(n.modalData.nid)}async function u(o){let v,_,g=!1;switch(o.code){case"ArrowDown":if(g=!0,o.stopPropagation(),o.preventDefault(),!s.value.length)break;for(v=-1,s.value.forEach((p,m)=>{p._sel&&(v=m)}),_=v+1;_<0;)_+=s.value.length;for(;_>=s.value.length;)_-=s.value.length;s.value.forEach((p,m)=>{p._sel=m==_});break;case"ArrowUp":if(g=!0,o.stopPropagation(),o.preventDefault(),!s.value.length)break;for(v=0,s.value.forEach((p,m)=>{p._sel&&(v=m)}),_=v-1;_<0;)_+=s.value.length;for(;_>=s.value.length;)_-=s.value.length;s.value.forEach((p,m)=>{p._sel=m==_});break;case"NumpadEnter":case"Enter":if(g=!0,o.stopPropagation(),o.preventDefault(),!s.value.length||(v=-1,s.value.forEach((p,m)=>{p._sel&&(v=m)}),v==-1))break;const l=s.value[v];h(l);break}return g}return(o,v)=>(L(),$("div",Rs,[A("input",{type:"text",class:"locator_input",placeholder:"type title/desc here ...",ref_key:"locatorInput",ref:e,onKeydown:c},null,544),A("div",Os,[(L(!0),$(K,null,ae(s.value,_=>(L(),$("div",{onClick:g=>h(_),class:ce({active:_._sel})},[A("p",Ps,ne(_.type),1),A("p",Ms,[A("span",As,ne(_.title),1),_.crumb_node?(L(!0),$(K,{key:0},ae(_.crumb_node,g=>(L(),$("span",null,ne(g.title),1))),256)):ee("",!0)])],10,Cs))),256))])]))}}),Ts={class:"upload_list"},Hs={class:"title"},zs={class:"meta"},Ns={key:0},Bs={key:1},Us=["onClick"],Vs={class:"upload_menu"},Ws={key:1},js=fe({__name:"uploader",props:{data:{},modalData:{}},setup(a){const e=a,t=F([]),n=new Map;Re(()=>{}),Oe(()=>{});function s(m){console.info("onSelectFile",m);const d=document.createElement("input");d.type="file",d.setAttribute("multiple",!0),d.onchange=i=>{var y;if((y=d.files)!=null&&y.length)for(let f=0;f<d.files.length;f++){const b=d.files[f];t.value.push({name:"/"+b.name,size:b.size,file:b,isDir:!1,status:"waiting",start:0,loaded:0})}},d.click()}function r(m){var d,i,y;if(console.debug("onDrop",m.type,(d=m.dataTransfer)==null?void 0:d.files,m),m.preventDefault(),m.stopPropagation(),!(!m.dataTransfer||!m.dataTransfer.files.length)){for(let f=0;f<((i=m.dataTransfer)==null?void 0:i.files.length);f++){const b=(y=m.dataTransfer)==null?void 0:y.items[f],C=b.webkitGetAsEntry();if(C.isFile){const k=b.getAsFile();t.value.push({name:C.fullPath,size:k.size,file:k,isDir:!1,status:"waiting",start:0,loaded:0})}else c(C).then(k=>{k.forEach(O=>t.value.push(O))})}console.info(t.value)}}async function c(m){const d=[];d.push({name:m.fullPath,size:0,file:null,isDir:!0,status:"waiting",start:0,loaded:0});const i=m.createReader(),y=await u(i);for(let f=0;f<y.length;f++){const b=y[f];if(b.isFile){const C=await h(b);d.push({name:b.fullPath,size:C.size,file:C,isDir:!1,status:"waiting",start:0,loaded:0})}b.isDirectory&&(await c(b)).forEach(k=>d.push(k))}return d}function h(m){return new Promise(d=>{m.file(i=>d(i))})}function u(m){return new Promise(d=>{m.readEntries(i=>{d(i)})})}function o(m){m.stopPropagation(),m.preventDefault()}let v=F(!1);async function _(){if(t.value.length){v.value=!0;for(let m=0;m<t.value.length;m++)t.value[m].status==="waiting"&&await g(t.value[m]);v.value=!1,e.data.emitGo("reload")}}async function g(m){let d=null,[i,y,f]=l(m.name);if(m.isDir){const b=new FormData;b.set("pid",i),b.set("title",f),m.status="uploading",d=await Q("file/mkdir",b),n.set(y+f+"/",d.id)}else{const b=new FormData;b.set("pid",i),b.set("file",m.file),m.status="uploading",d=await Q("file/upd",b,{upload:C=>{m.loaded=C.loaded}})}return m.status="complete",d}function l(m){const d=m.replace(/[\\/]+$/i).split(/[\\/]/i),i=d.pop();if(!d.length)return[e.data.pid,"/",i];let y="";for(let b=0;b<d.length;b++)y+=d[b]+"/";return y=="/"?[e.data.pid,y,i]:[n.get(y),y,i]}function p(m){t.value.splice(m,1)}return(m,d)=>(L(),$("div",{class:"modal_uploader",onDrop:r,onDragover:o},[A("div",Ts,[(L(!0),$(K,null,ae(t.value,(i,y)=>(L(),$("div",{key:`file_upload_${y}`},[A("div",Hs,ne(i.name),1),A("div",zs,[i.status==="uploading"?(L(),$("span",Ns,ne(Math.round(100*i.loaded/i.size))+" % ",1)):(L(),$("span",Bs,ne(i.status),1)),A("span",null,ne(X(de).kmgt(i.size)),1),i.status==="waiting"?(L(),$("span",{key:2,onClick:f=>p(y),class:"pointer"},"X",8,Us)):ee("",!0)])]))),128)),A("div",{onClick:s},"drag / drop files here...")]),A("div",Vs,[X(v)?(L(),$("button",Ws,"uploading")):(L(),$("button",{key:0,onClick:_},"upload"))])],32))}}),Fs={class:"modal_rename_util"},qs={class:"mode_selector"},Gs=["id","name"],Ks=["for"],Ys=["id","name"],Xs=["for"],Qs=fe({__name:"renameUtil",props:{data:{},modalData:{}},setup(a){F(null);const e=a;let t=F("pattern"),n=F("{index}_{filename}"),s=F("");Re(()=>{const h=[];e.data.node_list.forEach(u=>{h.push((u==null?void 0:u.title)??"")}),s.value=h.join(`\r
`),console.info(s)}),Oe(()=>{});function r(h){let u=h.length.toString().length+1,o=0,v="",_=n.value.match(/\{index:(\d+)}/);_&&(o=parseInt(_[1]),v=_[0]);const g=new Map;h.forEach((p,m)=>{const d=p.crumb_node?p.crumb_node[p.crumb_node.length-1]:null,i=d?d.title:"";let y=new Map;y.set("{filename}",p.title??""),y.set("{index}",de.prefix(m+1,u,"0")),y.set("{directory}",i??""),y.set(`{index:${v}}`,de.prefix(m+1,o,"0"));let f=n.value;y.forEach((b,C)=>{f=f.replace(C,b)}),g.set(p.id??0,f)});const l=[];return g.forEach((p,m)=>{l.push({id:m,title:p})}),l}async function c(){let h=[];switch(t.value){default:case"pattern":h=r(e.data.node_list);break;case"bath":const v=s.value.split(/[\r\n]+/);h=[],e.data.node_list.forEach((_,g)=>{v[g]&&v[g].trim().length&&h.push({id:_.id??0,title:v[g].trim()})});break}const u={list:JSON.stringify(h)},o=await Q("file/bath_rename",u);return console.info(o),e.data.callback(h),Vt(e.modalData.nid)}return(h,u)=>(L(),$("div",Fs,[A("div",qs,[le(A("input",{id:`P_${e.modalData.nid}_MODE_PATTERN`,name:`P_${e.modalData.nid}_MODE`,value:"pattern",type:"radio","onUpdate:modelValue":u[0]||(u[0]=o=>Ge(t)?t.value=o:t=o)},null,8,Gs),[[ot,X(t)]]),A("label",{for:`P_${e.modalData.nid}_MODE_PATTERN`},"pattern",8,Ks),le(A("input",{id:`P_${e.modalData.nid}_MODE_BATH`,name:`P_${e.modalData.nid}_MODE`,value:"bath",type:"radio","onUpdate:modelValue":u[1]||(u[1]=o=>Ge(t)?t.value=o:t=o)},null,8,Ys),[[ot,X(t)]]),A("label",{for:`P_${e.modalData.nid}_MODE_BATH`},"bath",8,Xs)]),X(t)=="pattern"?(L(),$(K,{key:0},[u[5]||(u[5]=Wt("<p>rename pattern:</p><table><tbody><tr><td>code</td><td>description</td></tr><tr><td>{filename}</td><td>file name</td></tr><tr><td>{index}</td><td>index by sort, prefix by max len+1</td></tr><tr><td>{index:n}</td><td>index by sort, prefix len by [n]</td></tr><tr><td>{directory}</td><td>parent directory name</td></tr></tbody></table>",2)),A("label",null,[u[4]||(u[4]=A("span",null,"pattern",-1)),le(A("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=o=>Ge(n)?n.value=o:n=o)},null,512),[[Me,X(n)]])])],64)):ee("",!0),X(t)=="bath"?(L(),$(K,{key:1},[u[6]||(u[6]=A("p",null,"rename bath:",-1)),le(A("textarea",{"onUpdate:modelValue":u[3]||(u[3]=o=>Ge(s)?s.value=o:s=o)},null,512),[[Me,X(s)]])],64)):ee("",!0),A("label",{class:"confirm"},[A("button",{onClick:c},"submit")])]))}}),Js={class:"fr_popup"},Zs=["data-ref-id","onClick"],eo=["onPointerdown","onDblclick"],to={class:"modal_title"},no={class:"modal_menu"},ao=["onClick"],so=["onClick"],oo=["onClick"],io={class:"modal_content"},ro=["innerHTML"],lo={key:1,class:"modal_content_form"},co={key:0},uo=["onUpdate:modelValue","onChange","disabled"],fo=["onClick","disabled"],ho={key:0},po=["onUpdate:modelValue","onChange","disabled"],_o=["onUpdate:modelValue","onChange","disabled"],mo=["onUpdate:modelValue","onChange","disabled"],vo=["id","name","value","onUpdate:modelValue","onChange","disabled"],yo=["for"],go=["id","name","value","onUpdate:modelValue","onChange","disabled"],wo=["for"],bo=["onUpdate:modelValue","multiple","onChange","disabled"],ko=["value"],Eo={key:2,class:"modal_content_callback"},xo=["onClick"],So=["onPointerdown"],De=20,Do=fe({__name:"Popup",setup(a){const e={fileBrowser:$s,uploader:js,locator:Is,renameUtil:Qs},t=new Date().valueOf(),n=F(new Map);function s(i){const y=Math.floor((new Date().valueOf()-t)/100),f=window.innerWidth,b=window.innerHeight,C=(y+Math.random()).toString(32),k={nid:C,base:{title:i.title??"",alpha:i.alpha??!1,key:i.key??"",single:i.single??!1},layout:{w:0,h:0,x:0,y:0,minW:0,minH:0,allow_resize:!1,allow_move:!1,allow_escape:!1,allow_fullscreen:!1,auto_focus:!1,active:!1,index:0,fullscreen:!1},content:{text:F(""),form:[],component:[]},callback:[],closed:!1,event:{resize:new Event("modal_resizing_"+C)}};console.info(y,k.nid);const O={};if(O.w=i.w??400,O.h=i.h??160,O.x=(f-O.w)/2,O.y=(b-O.h)/2,O.minW=i.minW??400,O.minH=i.minH??160,O.allow_resize=i.allow_resize??!0,O.allow_move=i.allow_move??!0,O.allow_escape=i.allow_escape??!0,O.allow_fullscreen=i.allow_fullscreen??!1,O.auto_focus=i.auto_focus??!0,O.active=!1,O.index=y,O.fullscreen=i.fullscreen??!1,Object.assign(k.layout,O),i.text&&(typeof i.text=="string"?k.content.text.value=i.text:k.content.text=i.text),i.form&&(Array.isArray(i.form)?k.content.form.push(...i.form):k.content.form.push(i.form),k.content.form.forEach(S=>{if(S.value=S.value??null,S.options=S.options??null,S.default=S.default??null,S.multiple=!!S.multiple,S.disabled=!!S.disabled,S.options&&Array.isArray(S.options)){let I={};S.options.forEach(H=>{I[H]=H}),S.options=I}S.on_change||(S.on_change=()=>{})})),i.component&&(Array.isArray(i.component)?i.component.forEach(S=>{let I;typeof S=="string"?I={key:"",componentName:S,data:{}}:I=Object.assign({key:"",componentName:null,data:{}},S),k.content.component.push(I)}):typeof i.component=="string"?k.content.component.push({key:"",componentName:i.component,data:{}}):k.content.component.push(Object.assign({key:"",componentName:null,data:{}},i.component))),i.callback){if(Array.isArray(i.callback))i.callback.forEach((S,I)=>{let H;typeof S=="function"?H={key:"",name:"",func:S}:H=Object.assign({key:"",name:"",func:null},S),k.callback.push(H)});else if(typeof i.callback=="function")k.callback.push({key:"",name:"",func:i.callback});else if(i.callback.func)k.callback.push(Object.assign({key:"",name:"",func:null},i.callback));else for(const S in i.callback){if(!Object.prototype.hasOwnProperty.call(i.callback,S))continue;const I=i.callback[S];k.callback.push(Object.assign({key:S,name:S,func:I}))}k.callback.forEach((S,I)=>{if(S.name&&!S.key)S.key=S.name;else if(!S.name&&S.key)S.name=S.key;else if(!S.name&&!S.key){let H="button";k.callback.length>1&&(H+=" "+I),S.name=H,S.key=H}})}return console.debug(k),k}window.addEventListener("resize",i=>{n.value.forEach(y=>{if(y.layout.fullscreen){const f={x:De,y:De,w:window.innerWidth-De*2,h:window.innerHeight-De*2};Object.assign(y.layout,f),document.dispatchEvent(y.event.resize)}})}),vt("set",i=>{let y=null,f=null;return i.single&&n.value.forEach((b,C,k)=>{b.base.key==i.key&&(y=C,f=b)}),y?setTimeout(()=>{y&&r(y)}):(f=s(i),n.value.set(f.nid,f),setTimeout(()=>{f&&r(f.nid)})),f}),vt("close",i=>u(i)),document.body.addEventListener("click",i=>{let y=i.target;Ne(y)||r("")});function r(i){const y=Math.floor((new Date().valueOf()-t)/100);n.value.forEach(f=>{if(f.nid===i){f.layout.index=y;let b=!f.layout.active;f.layout.active=!0,f.layout.auto_focus&&b&&setTimeout(()=>{const C=document.querySelector(`.modal_dom[data-ref-id="${f.nid}"] input,.modal_dom[data-ref-id="${f.nid}"] button,.modal_dom[data-ref-id="${f.nid}"] textarea`);C&&C.focus()},100)}else f.layout.active=!1})}function c(i){const y=n.value.get(i);if(!y)return;const f={x:De,y:De,w:window.innerWidth-De*2,h:window.innerHeight-De*2,fullscreen:!0};Object.assign(y.layout,f),document.dispatchEvent(y.event.resize)}function h(i){const y=n.value.get(i);if(!y)return;const f={x:0,y:0,w:y.layout.minW,h:y.layout.minH,fullscreen:!1};f.x=(window.innerWidth-f.w)/2,f.y=(window.innerHeight-f.h)/2,Object.assign(y.layout,f),document.dispatchEvent(y.event.resize)}function u(i){const y=n.value.get(i);if(!y||!y.layout.allow_escape)return;n.value.delete(i);let f=-1,b="";return n.value.forEach(C=>{f=C.layout.index,b=C.nid}),f!=-1&&r(b),y}let o={x:0,y:0,d:"",modalX:0,modalY:0,modalW:0,modalH:0,modal:null},v=0;function _(i,y){y.preventDefault(),y.stopPropagation(),y.pointerId&&(v=y.pointerId,y.target.hasPointerCapture(y.pointerId)),o.x=y.clientX,o.y=y.clientY,o.d=y.target.className,n.value.forEach(f=>{f.nid===i&&(o.modal=f)}),o.modal&&(o.modal.layout.fullscreen||(o.modalX=o.modal.layout.x,o.modalY=o.modal.layout.y,o.modalW=o.modal.layout.w,o.modalH=o.modal.layout.h,document.addEventListener("pointerup",l),document.addEventListener("pointermove",g)))}function g(i){if(i.preventDefault(),!o.modal||!i.pointerId||v!=i.pointerId)return;const y={x:i.clientX-o.x,y:i.clientY-o.y},f={x:o.modal.layout.x,y:o.modal.layout.y,w:o.modal.layout.w,h:o.modal.layout.h};switch(o.d){case"c_l":f.x=o.modalX+y.x,f.w=o.modalW-y.x;break;case"c_r":f.x=o.modalX,f.w=o.modalW+y.x;break;case"c_t":f.y=o.modalY+y.y,f.h=o.modalH-y.y;break;case"c_b":f.y=o.modalY,f.h=o.modalH+y.y;break;case"c_lt":f.x=o.modalX+y.x,f.w=o.modalW-y.x,f.y=o.modalY+y.y,f.h=o.modalH-y.y;break;case"c_lb":f.x=o.modalX+y.x,f.w=o.modalW-y.x,f.y=o.modalY,f.h=o.modalH+y.y;break;case"c_rt":f.x=o.modalX,f.w=o.modalW+y.x,f.y=o.modalY+y.y,f.h=o.modalH-y.y;break;case"c_rb":f.x=o.modalX,f.w=o.modalW+y.x,f.y=o.modalY,f.h=o.modalH+y.y;break;case"modal_header":case"modal_title":f.x=o.modalX+y.x,f.y=o.modalY+y.y;break}const b={l:0,r:window.innerWidth,t:0,b:window.innerHeight};f.w<100&&(f.w=100),f.h<80&&(f.h=80),f.y<0&&(f.y=0),f.y>b.b-f.h/2&&(f.y=b.b-f.h/2),f.x<0-f.w/2&&(f.x=0-f.w/2),f.x>b.r-f.w/2&&(f.x=b.r-f.w/2),o.modal.layout.minW&&f.w<o.modal.layout.minW&&(f.w=o.modal.layout.minW),o.modal.layout.minH&&f.h<o.modal.layout.minH&&(f.h=o.modal.layout.minH),Object.assign(o.modal.layout,f),document.dispatchEvent(o.modal.event.resize)}function l(i){i.preventDefault(),i.stopPropagation(),!(!i.pointerId||v!=i.pointerId)&&(document.removeEventListener("pointerup",l),document.removeEventListener("pointermove",g),v=0,o.modal=null)}function p(i,y){const f=n.value.get(i);f&&f.callback.forEach(async b=>{b.key!==y||await b.func(f)||u(i)})}Re(()=>{console.info("Popup mounted"),document.addEventListener("keydown",m)}),Oe(()=>{console.info("unmounted"),document.removeEventListener("keydown",m)});function m(i){switch(i.key){case"Escape":n.value.forEach((f,b)=>{if(f.layout.active){if(!f.layout.allow_escape)return;setTimeout(()=>u(f.nid))}});break;case"NumpadEnter":case"Enter":if(i.target.tagName==="BODY"||i.target.tagName==="BUTTON"||i.isComposing)return;let y=i.target;for(;y.parentElement;){if(y=y.parentElement,!y.classList.contains("modal_dom"))continue;const b=y.getAttribute("data-ref-id");if(!b)break;const C=n.value.get(b);if(!C)break;for(let k=0;k<C.callback.length;k++){const O=C.callback[k].key;return p(b,O)}}break}}function d(i){console.info("processModalFile",i);const y=document.createElement("input");y.type="file",y.onchange=f=>{const b=f.target.files;!b||b.length===0||(i.value=b[0],console.info("processModalFile mod",i,i.value))},y.click()}return(i,y)=>(L(),$("div",Js,[(L(!0),$(K,null,ae(n.value,([f,b])=>{var C;return L(),$("div",{key:`_modal_${f}`,class:ce({modal_dom:!0,active:b.layout.active,resizing:((C=X(o).modal)==null?void 0:C.nid)==b.nid,modal_alpha:b.base.alpha}),"data-ref-id":b.nid,style:jt({zIndex:b.layout.index,width:b.layout.w+"px",height:b.layout.h+"px",left:b.layout.x+"px",top:b.layout.y+"px"}),onClick:Pn(k=>r(b.nid),["stop"])},[A("div",{class:"modal_header",onPointerdown:k=>_(b.nid,k),onDblclick:k=>b.layout.fullscreen?h(b.nid):c(b.nid)},[A("div",to,ne(b.base.title),1),A("div",no,[b.layout.allow_move&&b.layout.allow_fullscreen?(L(),$(K,{key:0},[b.layout.fullscreen?(L(),$("span",{key:1,class:"buttonStyle sysIcon sysIcon_windowize",onClick:k=>h(b.nid)},null,8,so)):(L(),$("span",{key:0,class:"buttonStyle sysIcon sysIcon_maximize",onClick:k=>c(b.nid)},null,8,ao))],64)):ee("",!0),A("span",{class:"buttonStyle sysIcon sysIcon_close",onClick:k=>u(b.nid)},null,8,oo)])],40,eo),A("div",io,[b.content.text&&b.content.text.length?(L(),$("div",{key:0,class:"modal_content_text",innerHTML:b.content.text},null,8,ro)):ee("",!0),b.content.form&&b.content.form.length?(L(),$("div",lo,[(L(!0),$(K,null,ae(b.content.form,(k,O)=>(L(),$("label",{key:`_modal_${f}_form_${O}`},[k.label?(L(),$("span",co,ne(k.label),1)):ee("",!0),y[0]||(y[0]=A("span",null,null,-1)),A("span",null,[k.type==="text"?le((L(),$("input",{key:0,type:"text","onUpdate:modelValue":S=>k.value=S,onChange:S=>k.on_change(S,b,k),disabled:k.disabled},null,40,uo)),[[Me,k.value]]):ee("",!0),k.type==="file"?(L(),$(K,{key:1},[A("button",{onClick:S=>d(k),disabled:k.disabled},"select file",8,fo),k.value?(L(),$("span",ho,ne(k.value.name),1)):ee("",!0)],64)):ee("",!0),k.type==="textarea"?le((L(),$("textarea",{key:2,"onUpdate:modelValue":S=>k.value=S,onChange:S=>k.on_change(S,b,k),disabled:k.disabled},null,40,po)),[[Me,k.value]]):ee("",!0),k.type==="date"?le((L(),$("input",{key:3,type:"date","onUpdate:modelValue":S=>k.value=S,onChange:S=>k.on_change(S,b,k),disabled:k.disabled},null,40,_o)),[[Me,k.value]]):ee("",!0),k.type==="datetime"?le((L(),$("input",{key:4,type:"datetime-local","onUpdate:modelValue":S=>k.value=S,onChange:S=>k.on_change(S,b,k),disabled:k.disabled},null,40,mo)),[[Me,k.value]]):ee("",!0),k.type==="checkbox"?(L(!0),$(K,{key:5},ae(k.options,(S,I)=>(L(),$(K,{key:`P_${f}_C_${O}_CB_${I}`},[le(A("input",{id:`P_${f}_C_${O}_CB_${I}`,name:`P_${f}_C_${O}_CB`,type:"checkbox",value:I,"onUpdate:modelValue":H=>k.value=H,onChange:H=>k.on_change(H,b,k),disabled:k.disabled},null,40,vo),[[Mn,k.value]]),A("label",{for:`P_${f}_C_${O}_CB_${I}`},ne(S),9,yo)],64))),128)):ee("",!0),k.type==="radio"?(L(!0),$(K,{key:6},ae(k.options,(S,I)=>(L(),$(K,{key:`P_${f}_C_${O}_RD_${I}`},[le(A("input",{id:`P_${f}_C_${O}_RD_${I}`,name:`P_${f}_C_${O}_RD`,type:"radio",value:I,"onUpdate:modelValue":H=>k.value=H,onChange:H=>k.on_change(H,b,k),disabled:k.disabled},null,40,go),[[ot,k.value]]),A("label",{for:`P_${f}_C_${O}_RD_${I}`},ne(S),9,wo)],64))),128)):ee("",!0),k.type==="select"?le((L(),$("select",{key:7,"onUpdate:modelValue":S=>k.value=S,multiple:k.multiple,onChange:S=>k.on_change(S,b,k),disabled:k.disabled},[(L(!0),$(K,null,ae(k.options,(S,I)=>(L(),$("option",{key:`P_${f}_C_${O}_SL_${I}`,value:I},ne(S),9,ko))),128))],40,bo)),[[Be,k.value]]):ee("",!0)])]))),128))])):ee("",!0),(L(!0),$(K,null,ae(b.content.component,(k,O)=>(L(),Bt(Ut(e[k.componentName]),{key:`CMP_${f}_${O}`,data:k.data,modalData:b},null,8,["data","modalData"]))),128)),b.callback&&b.callback.length?(L(),$("div",Eo,[(L(!0),$(K,null,ae(b.callback,(k,O)=>(L(),$("button",{key:`BTN_${f}_${O}`,onClick:S=>p(b.nid,k.key)},ne(k.name),9,xo))),128))])):ee("",!0)]),b.layout.allow_resize?(L(),$("div",{key:0,class:"modal_border",onPointerdown:k=>_(b.nid,k)},y[1]||(y[1]=[Wt('<div class="c_l"></div><div class="c_r"></div><div class="c_t"></div><div class="c_b"></div><div class="c_lt"></div><div class="c_lb"></div><div class="c_rt"></div><div class="c_rb"></div>',8)]),40,So)):ee("",!0)],14,Zs)}),128))]))}}),Lo={class:"fr_context"},$o=["onClick"],Ro=["innerHTML"],Oo={key:0,class:"context_menu_sub"},Co=["onClick"],Po=["innerHTML"],Mo=fe({__name:"Context",setup(a){const e=Fe(),t=e?e!=null&&e.group.admin?2:1:0,n=F([]),s=F(null),r=F(!0),c=F({x:-1e3,y:0,w:0,h:0,sx:0,sy:0,direction:"lb"});on(h);function h(p,m){r.value=!1;const d=[];p.forEach(i=>{if(u(i)){if(i.child){let y=[];if(i.child.forEach(f=>{u(f)&&y.push(f)}),!y.length)return;i.child=y}d.push(i)}}),n.value=d,console.info(d),setTimeout(()=>o(m),20)}function u(p){switch(p.auth){case"none":return!1;default:case"guest":return!0;case"user":if(t<1)break;return!0;case"admin":if(t<2)break;return!0}}function o(p){if(!s.value)return;const m=s.value;let d=l();const i={x:p.clientX,y:p.clientY,w:m==null?void 0:m.offsetWidth,h:m==null?void 0:m.offsetHeight,sx:d.scrollTop,sy:d.scrollLeft,direction:"rb"};let y=["r","b"];switch(i.w+i.x>window.innerWidth&&(y[0]="l"),i.h+i.y>window.innerHeight&&(y[1]="t"),i.direction=y.join(""),i.direction){case"rb":break;case"rt":i.y-=i.h;break;case"lb":i.x-=i.w;break;case"lt":i.x-=i.w,i.y-=i.h;break}c.value=i,l().addEventListener("scroll",g),setTimeout(()=>r.value=!0,10)}function v(){l().removeEventListener("scroll",g),r.value=!1,_=null,setTimeout(()=>{n.value=[],c.value={x:-1e3,y:0,w:0,h:0,sx:0,sy:0,direction:"lb"}},10)}Re(()=>{});let _=null;function g(p){const m=l();if(!m)return;let d=c.value,i=m.scrollLeft,y=m.scrollTop,f=i-d.sx,b=y-d.sy;c.value=Object.assign(d,{x:d.x-f,y:d.y-b,sx:i,sy:y})}function l(){return _||(_=document.querySelector(".fr_content"),_)}return addEventListener("contextmenu",p=>{console.info("triggerMenu"),h([],p)}),addEventListener("click",p=>{v()}),(p,m)=>(L(),$("div",Lo,[A("div",{class:ce(["context_menu",r.value?"show":"",c.value.direction]),style:jt({left:c.value.x+"px",top:c.value.y+"px"}),ref_key:"contextDOM",ref:s},[(L(!0),$(K,null,ae(n.value,(d,i)=>{var y;return L(),$("div",{key:`COM_${i}`,class:ce(["context_item",(y=d.child)!=null&&y.length?"has_sub":""]),onClick:d.method},[A("span",{innerHTML:d.title},null,8,Ro),d.child&&d.child.length?(L(),$("div",Oo,[(L(!0),$(K,null,ae(d.child,(f,b)=>(L(),$("div",{key:`COM_${i}_${b}`,class:ce({context_item:!0}),onClick:f.method},[A("span",{innerHTML:f.title},null,8,Po)],8,Co))),128))])):ee("",!0)],10,$o)}),128))],6)]))}}),Ao={class:"fr_body"},Io=fe({__name:"main",setup(a){const e=Fe();e&&(document.cookie=`tosho_token=${e.token}; max-age=31536000`,n());const t=new Event("fe_config_loaded");async function n(){const s=await Q("setting/get_front_conf");s&&(s.onlyoffice_enabled==="true"&&(te.onlyOffice.enabled=!0,te.onlyOffice.jwtSecret=s.onlyoffice_jwt_secret??""),te.navList=[{name:"Nas",meta:{cur:!0},path:"/"}],s.link_nav&&s.link_nav.forEach(r=>{te.navList.push({name:r[0],meta:{cur:!1},path:r[1]})}),document.dispatchEvent(t))}return(s,r)=>{const c=An("router-view");return L(),$(K,null,[Ce(Fn,{class:"fr_header"}),Ce(Do),Ce(Mo),A("div",Ao,[Ce(as,{class:"fr_navi"}),Ce(c)])],64)}}});In();const ht=Tn(Io);ht.use(Hn());ht.use(Za);ht.mount("#app");export{jn as _,zo as a,Ja as b,G as c,No as o,ls as p,Qa as u};

import{d as J,r as m,o as z,H as Q,J as y,q as K,c as i,e as a,n as h,F as _,f as b,U as S,b as u,t as v,D as f,V,aa as D,a3 as A}from"./basic-BtQQXLGp.js";import{a as P,u as T,b as W}from"./index-ByCndOOr.js";import{_ as k}from"./ContentEditable.vue_vue_type_script_setup_true_lang-BY-OO5oB.js";import{H as X}from"./Hinter-OgiWguJS.js";const Y={key:0,class:"list_user_group"},Z={class:"title"},g=["onClick"],ee={class:"operator"},te=["onClick"],se=["onClick"],ae=["onClick"],le=["onClick"],ne={class:"auth"},oe=["onClick"],ie=["onClick"],ue={class:"operator"},de=["onUpdate:modelValue","id"],ce=["for"],_e=["onUpdate:modelValue","id","name"],re=["for"],ye=["onUpdate:modelValue","id","name"],ve=["for"],fe=["onClick"],me={class:"list_user"},ke={class:"title"},pe=["onClick"],he={class:"mail"},Ve={class:"status"},Ue={class:"title"},Ce=["onUpdate:modelValue","id"],be=["for"],$e=["onClick"],De=J({__name:"UserView",setup(we){const q=m(null),O=T(),$=W();let p={id:""};const n=m([]),d=m([]);m(null);const c=m(-1);z(async()=>{Object.assign(p,Q.copyObject($.query)),w()}),P(async t=>{p.id=t.query.id??"",w()});async function w(){if(!n.value||!n.value.length){const s=await y("user_group/get",p);if(!s)return;n.value=s}let t=parseInt(p.id);if(t){let s=!1;for(let e=0;e<n.value.length;e++)t&&t===n.value[e].id&&(s=!0,c.value=e);s||(c.value=-1),x()}}async function x(){if(d.value=[],c.value===-1)return;const s={id_group:n.value[c.value].id},e=await y("user/get",s);e&&(d.value=e)}K(()=>{});async function G(t){var o,l,r,C,B;if(!n.value[t].edit){n.value[t].edit=!0;return}const s={title:n.value[t].title,description:n.value[t].description,admin:(o=n.value[t].admin)==null?void 0:o.toString(),status:(l=n.value[t].status)==null?void 0:l.toString(),auth:JSON.stringify(n.value[t].auth)};(r=n.value[t])!=null&&r.id&&(s.id=(B=(C=n.value[t])==null?void 0:C.id)==null?void 0:B.toString());const e=await y("user_group/mod",s);e&&(n.value[t].edit=!1,n.value[t].id=e.id??0)}async function M(t){const s=n.value.splice(t,1)[0];s.id&&await y("user_group/del",{id:s.id})}async function L(){n.value.unshift({title:"",description:"",auth:{allow:[],deny:[]},admin:0,status:1,edit:!0,ext_key:new Date().valueOf(),user:[]})}async function N(t){console.info("addAuth");const s=n.value[t];s.auth||(s.auth={}),s.auth.deny||(s.auth.deny=[]),s.auth.deny.push({id:0,title:"root",status:1,type:"directory",crumb_node:[]})}async function R(t,s){console.info("delAuth");const e=n.value[t];e.auth||(e.auth={}),e.auth.deny||(e.auth.deny=[]),e.auth.deny.splice(s,1),n.value[t]=e}async function j(t){console.info("node_hint");const e=await y("file/get",{mode:"directory",node_type:"directory",keyword:t,with:"none",limit:"20"});return e?("root".indexOf(t)!==-1&&e.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),e.list):!1}function F(t,s){console.info("node_add",t,s);const e=s[0],o=s[1],l=n.value[e];l.auth.deny[o]=t}function H(t){var e;if(console.info("node_parse"),!t)return"";const s=[];return(e=t.crumb_node)==null||e.forEach(o=>{o.title&&s.push(o.title)}),t.title&&s.push(t.title),`/ ${s.join(" / ")}`}function U(t){let s=0;t!==-1&&(s=n.value[t].id??0),O.push({path:$.path,query:{id:s}})}function E(){if(c.value==-1)return;const t=d.value,s=n.value[c.value];t.unshift({name:"",mail:"",id_group:s.id,password:"",status:1,ext_key:new Date().valueOf(),edit:!0})}async function I(t){if(!d.value[t].edit){d.value[t].edit=!0;return}const s=await y("user/mod",d.value[t]);s&&(d.value[t].edit=!1,d.value[t].id=parseInt(s.id??""))}return(t,s)=>(u(),i("div",{class:"fr_content view_user",ref_key:"contentDOM",ref:q},[n.value&&n.value.length?(u(),i("div",Y,[a("div",{class:h({user_group:!0,user_group_add:!0,active:c.value===-1}),onClick:L},s[0]||(s[0]=[a("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1)]),2),(u(!0),i(_,null,b(n.value,(e,o)=>(u(),i("div",{key:`userView_group_${e.ext_key?e.ext_key:e.id}`,class:h({active:c.value===o,user_group:!0,edit:e.edit})},[e.edit?(u(),i(_,{key:1},[f(k,{class:"title",modelValue:e.title,"onUpdate:modelValue":l=>e.title=l,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),f(k,{class:"description",modelValue:e.description,"onUpdate:modelValue":l=>e.description=l},null,8,["modelValue","onUpdate:modelValue"]),a("dl",ne,[s[1]||(s[1]=a("dt",null,"denyDir",-1)),e.auth?(u(!0),i(_,{key:0},b(e.auth.deny,(l,r)=>(u(),i("dd",{key:`userView_group_${e.ext_key?e.ext_key:e.id}_${r}`},[f(X,{"get-list":j,submit:F,"parse-text":H,"model-value":l,meta:[o,r]},null,8,["model-value","meta"]),a("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:C=>R(o,r)},null,8,oe)]))),128)):S("",!0),a("dd",{class:"pointer add",onClick:l=>N(o)},"+",8,ie)]),a("div",ue,[V(a("input",{type:"checkbox","onUpdate:modelValue":l=>e.status=l,id:`UV_G_CB_S_${e.ext_key?e.ext_key:e.id}`,"true-value":1,"false-value":0},null,8,de),[[D,e.status]]),a("label",{class:"no_bg",for:`UV_G_CB_S_${e.ext_key?e.ext_key:e.id}`},null,8,ce),V(a("input",{type:"radio","onUpdate:modelValue":l=>e.admin=l,id:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_1`,name:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}`,value:1},null,8,_e),[[A,e.admin]]),a("label",{class:"no_bg",for:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_1`}," isAdmin ",8,re),V(a("input",{type:"radio","onUpdate:modelValue":l=>e.admin=l,id:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_0`,name:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}`,value:0},null,8,ye),[[A,e.admin]]),a("label",{class:"no_bg",for:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_0`}," isUser ",8,ve),a("div",null,[a("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:l=>G(o)},null,8,fe)])])],64)):(u(),i(_,{key:0},[a("div",Z,[a("div",{onClick:l=>U(o)},v(e.title),9,g),a("div",ee,[a("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:l=>G(o)},null,8,te),a("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:l=>M(o)},null,8,se)])]),a("div",{onClick:l=>U(o),class:"description"},v(e.description),9,ae),a("div",{onClick:l=>U(o),class:"meta"},[a("span",null,v(e.admin?"admin":"user"),1)],8,le)],64))],2))),128))])):S("",!0),a("div",me,[a("div",{class:h({user:!0,user_add:!0}),onClick:E},s[2]||(s[2]=[a("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1)])),(u(!0),i(_,null,b(d.value,(e,o)=>(u(),i("div",{class:h({user:!0,edit:e.edit}),key:`user_view_${e.ext_key?e.ext_key:e.id}`},[e.edit?(u(),i(_,{key:1},[a("div",Ue,[f(k,{modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),a("div",null,[V(a("input",{type:"checkbox","onUpdate:modelValue":l=>e.status=l,id:`UV_U_CB_${e.ext_key?e.ext_key:e.id}`,"true-value":1,"false-value":0},null,8,Ce),[[D,e.status]]),a("label",{class:"no_bg",for:`UV_U_CB_${e.ext_key?e.ext_key:e.id}`},null,8,be),a("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:l=>I(o)},null,8,$e)])]),f(k,{modelValue:e.mail,"onUpdate:modelValue":l=>e.mail=l,class:"mail"},null,8,["modelValue","onUpdate:modelValue"]),f(k,{modelValue:e.password,"onUpdate:modelValue":l=>e.password=l,class:"password"},null,8,["modelValue","onUpdate:modelValue"]),s[3]||(s[3]=a("label",{class:"status"},null,-1))],64)):(u(),i(_,{key:0},[a("div",ke,[a("div",null,v(e.name),1),a("div",null,[a("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:l=>I(o)},null,8,pe)])]),a("div",he,v(e.mail),1),a("div",Ve,v(e.status?"activate":"inactivate"),1)],64))],2))),128))])],512))}});export{De as default};

import{d as E,u as L,r as k,b as A,G as C,g as O,f as j,q as i,h as u,i as s,F as d,j as p,J as z,s as M,t as U,o as c,n as f,x as B,m as I,z as b,a as r}from"./index-DCw4d_gt.js";import{_ as h}from"./ContentEditable.vue_vue_type_script_setup_true_lang-Ix75xO4-.js";const N={class:"widget_ls"},H=["onClick"],T=E({__name:"SettingView",setup(W){L();const x=k(null);M();const g=U();let y={};const o=k([]);A(async()=>{Object.assign(y,C.copyObject(g.query)),m()}),O(async t=>{console.info(t),m()}),j(()=>{});async function m(){const t=await i("setting/get",y);if(!t)return;const e=[];for(let a=0;a<t.length;a++)e.push(Object.assign(t[a],{edit_key:!1,edit_val:!1,ext_key:`${new Date().valueOf()}_${Math.random()}`,pre_name:t[a].name,pre_value:t[a].value}));o.value=e}function w(){o.value.unshift({name:"new_key",value:'"json format value"',pre_name:"",pre_value:"",edit_key:!1,edit_val:!1,ext_key:`${new Date().valueOf()}_${Math.random()}`})}async function V(t){let e=null;for(let l=0;l<o.value.length;l++){const n=o.value[l];n.ext_key===t&&(e=n)}if(!e||(e==null?void 0:e.pre_name)==(e==null?void 0:e.name)&&(e==null?void 0:e.pre_value)==(e==null?void 0:e.value))return;const a=await i("setting/mod",e);a&&(e.id=parseInt(a.id??""),e.pre_name=e.name,e.pre_value=e.value)}function _(t){const e=t.getAttribute("data-key"),a=t.getAttribute("data-type");o.value.forEach(l=>{if(l.ext_key===e)switch(a){case"key":l.edit_key=!0;break;case"val":l.edit_val=!0;break}})}function v(t){const e=t.getAttribute("data-key"),a=t.getAttribute("data-type");o.value.forEach(l=>{if(l.ext_key===e){switch(a){case"key":l.edit_key=!1;break;case"val":l.edit_val=!1;break}V(l.ext_key)}})}const $=[{type:"button",title:"syncLocalFile",method:S},{type:"button",title:"syncDatabaseFile",method:F},{type:"button",title:"checkLocalFile",method:D},{type:"button",title:"rebuildAllIndex",method:q}];async function S(){await i("setting/sync_local_file",{}),r().set({title:"success",text:"queued",w:320,h:100,minW:320,minH:100,allow_resize:!1,callback:{confirm:async function(e){}}})}async function F(){await i("setting/sync_database_file",{}),r().set({title:"success",text:"queued",w:320,h:100,minW:320,minH:100,allow_resize:!1,callback:{confirm:async function(e){}}})}async function q(){await i("setting/full_rebuild_index",{}),r().set({title:"success",text:"queued",w:320,h:100,minW:320,minH:100,allow_resize:!1,callback:{confirm:async function(e){}}})}async function D(){const t=await i("setting/check_local_file_result",{});console.info(t);const e=r();let a="",l=[];t&&t.value&&(t.value.db&&t.value.db.forEach(n=>l.push(`<tr><td>db</td><td>${n}</td></tr>`)),t.value.raw&&t.value.raw.forEach(n=>l.push(`<tr><td>raw</td><td>${n}</td></tr>`)),t.value.preview&&t.value.preview.forEach(n=>l.push(`<tr><td>preview</td><td>${n}</td></tr>`)),t.value.normal&&t.value.normal.forEach(n=>l.push(`<tr><td>normal</td><td>${n}</td></tr>`)),t.value.cover&&t.value.cover.forEach(n=>l.push(`<tr><td>cover</td><td>${n}</td></tr>`))),a=`<table>${l.join("")}</table>`,console.info(a),e.set({title:"chk result",text:a,w:480,h:360,minW:480,minH:360,allow_resize:!0,callback:{checkNew:async function(n){await i("setting/check_local_file",{})},close:async function(n){}}})}return(t,e)=>(c(),u("div",{class:"fr_content view_setting",ref_key:"contentDOM",ref:x},[s("div",N,[(c(),u(d,null,p($,a=>(c(),u(d,null,[a.type==="button"?(c(),u("div",{key:0,class:f(["widget",a.type])},[s("button",{onClick:a.method},B(a.title),9,H)],2)):I("",!0)],64))),64))]),s("table",null,[s("tbody",null,[e[1]||(e[1]=s("tr",null,[s("th",null,"key"),s("th",null,"value")],-1)),s("tr",null,[s("td",{colspan:"2",class:"add",onClick:w},e[0]||(e[0]=[s("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1),z(" add row ")]))]),(c(!0),u(d,null,p(o.value,a=>(c(),u("tr",{key:`setting_view_${a.ext_key}`},[s("td",{class:f({editing:a.edit_key})},[b(h,{modelValue:a.name,"onUpdate:modelValue":l=>a.name=l,onFocus:_,onBlur:v,"data-key":a.ext_key,"data-type":"key"},null,8,["modelValue","onUpdate:modelValue","data-key"])],2),s("td",{class:f({editing:a.edit_val})},[b(h,{modelValue:a.value,"onUpdate:modelValue":l=>a.value=l,onFocus:_,onBlur:v,"data-key":a.ext_key,"data-type":"val"},null,8,["modelValue","onUpdate:modelValue","data-key"])],2)]))),128))])])],512))}});export{T as default};

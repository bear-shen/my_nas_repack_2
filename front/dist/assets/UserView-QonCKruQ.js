import{a as z,r as m,o as J,G as Q,j as K,c as i,e as a,n as h,F as _,f as b,A as B,b as u,t as y,x as v,D as V,S as A,N as D}from"./basic-BYt0z23_.js";import{u as P,b as T,q as f,c as W,d as X}from"./index-BX9Wb3uo.js";import{_ as k}from"./ContentEditable.vue_vue_type_script_setup_true_lang-BfoL63xV.js";import{H as Y}from"./Hinter-BM1y8Ura.js";const Z={key:0,class:"list_user_group"},g={class:"title"},ee=["onClick"],te={class:"operator"},se=["onClick"],ae=["onClick"],le=["onClick"],ne=["onClick"],oe={class:"auth"},ie=["onClick"],ue=["onClick"],de={class:"operator"},ce=["onUpdate:modelValue","id"],_e=["for"],re=["onUpdate:modelValue","id","name"],ye=["for"],ve=["onUpdate:modelValue","id","name"],fe=["for"],me=["onClick"],ke={class:"list_user"},pe={class:"title"},he=["onClick"],Ve={class:"mail"},Ce={class:"status"},Ue={class:"title"},be=["onUpdate:modelValue","id"],$e=["for"],Ge=["onClick"],De=z({__name:"UserView",setup(we){P();const q=m(null),x=W(),$=X();let p={id:""};const n=m([]),d=m([]);m(null);const c=m(-1);J(async()=>{Object.assign(p,Q.copyObject($.query)),G()}),T(async t=>{p.id=t.query.id??"",G()});async function G(){if(!n.value||!n.value.length){const s=await f("user_group/get",p);if(!s)return;n.value=s}let t=parseInt(p.id);if(t){let s=!1;for(let e=0;e<n.value.length;e++)t&&t===n.value[e].id&&(s=!0,c.value=e);s||(c.value=-1),O()}}async function O(){if(d.value=[],c.value===-1)return;const s={id_group:n.value[c.value].id},e=await f("user/get",s);e&&(d.value=e)}K(()=>{});async function w(t){var o,l,r,U,S;if(!n.value[t].edit){n.value[t].edit=!0;return}const s={title:n.value[t].title,description:n.value[t].description,admin:(o=n.value[t].admin)==null?void 0:o.toString(),status:(l=n.value[t].status)==null?void 0:l.toString(),auth:JSON.stringify(n.value[t].auth)};(r=n.value[t])!=null&&r.id&&(s.id=(S=(U=n.value[t])==null?void 0:U.id)==null?void 0:S.toString());const e=await f("user_group/mod",s);e&&(n.value[t].edit=!1,n.value[t].id=e.id??0)}async function L(t){const s=n.value.splice(t,1)[0];s.id&&await f("user_group/del",{id:s.id})}async function M(){n.value.unshift({title:"",description:"",auth:{allow:[],deny:[]},admin:0,status:1,edit:!0,ext_key:new Date().valueOf(),user:[]})}async function N(t){console.info("addAuth");const s=n.value[t];s.auth||(s.auth={}),s.auth.deny||(s.auth.deny=[]),s.auth.deny.push({id:0,title:"root",status:1,type:"directory",crumb_node:[]})}async function j(t,s){console.info("delAuth");const e=n.value[t];e.auth||(e.auth={}),e.auth.deny||(e.auth.deny=[]),e.auth.deny.splice(s,1),n.value[t]=e}async function R(t){console.info("node_hint");const e=await f("file/get",{mode:"directory",node_type:"directory",keyword:t,with:"none",limit:"20"});return e?("root".indexOf(t)!==-1&&e.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),e.list):!1}function F(t,s){console.info("node_add",t,s);const e=s[0],o=s[1],l=n.value[e];l.auth.deny[o]=t}function E(t){var e;if(console.info("node_parse"),!t)return"";const s=[];return(e=t.crumb_node)==null||e.forEach(o=>{o.title&&s.push(o.title)}),t.title&&s.push(t.title),`/ ${s.join(" / ")}`}function C(t){let s=0;t!==-1&&(s=n.value[t].id??0),x.push({path:$.path,query:{id:s}})}function H(){if(c.value==-1)return;const t=d.value,s=n.value[c.value];t.unshift({name:"",mail:"",id_group:s.id,password:"",status:1,ext_key:new Date().valueOf(),edit:!0})}async function I(t){if(!d.value[t].edit){d.value[t].edit=!0;return}const s=await f("user/mod",d.value[t]);s&&(d.value[t].edit=!1,d.value[t].id=parseInt(s.id??""))}return(t,s)=>(u(),i("div",{class:"fr_content view_user",ref_key:"contentDOM",ref:q},[n.value&&n.value.length?(u(),i("div",Z,[a("div",{class:h({user_group:!0,user_group_add:!0,active:c.value===-1}),onClick:M},s[0]||(s[0]=[a("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1)]),2),(u(!0),i(_,null,b(n.value,(e,o)=>(u(),i("div",{key:`userView_group_${e.ext_key?e.ext_key:e.id}`,class:h({active:c.value===o,user_group:!0,edit:e.edit})},[e.edit?(u(),i(_,{key:1},[v(k,{class:"title",modelValue:e.title,"onUpdate:modelValue":l=>e.title=l,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),v(k,{class:"description",modelValue:e.description,"onUpdate:modelValue":l=>e.description=l},null,8,["modelValue","onUpdate:modelValue"]),a("dl",oe,[s[1]||(s[1]=a("dt",null,"denyDir",-1)),e.auth?(u(!0),i(_,{key:0},b(e.auth.deny,(l,r)=>(u(),i("dd",{key:`userView_group_${e.ext_key?e.ext_key:e.id}_${r}`},[v(Y,{"get-list":R,submit:F,"parse-text":E,"model-value":l,meta:[o,r]},null,8,["model-value","meta"]),a("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:U=>j(o,r)},null,8,ie)]))),128)):B("",!0),a("dd",{class:"pointer add",onClick:l=>N(o)},"+",8,ue)]),a("div",de,[V(a("input",{type:"checkbox","onUpdate:modelValue":l=>e.status=l,id:`UV_G_CB_S_${e.ext_key?e.ext_key:e.id}`,"true-value":1,"false-value":0},null,8,ce),[[A,e.status]]),a("label",{class:"no_bg",for:`UV_G_CB_S_${e.ext_key?e.ext_key:e.id}`},null,8,_e),V(a("input",{type:"radio","onUpdate:modelValue":l=>e.admin=l,id:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_1`,name:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}`,value:1},null,8,re),[[D,e.admin]]),a("label",{class:"no_bg",for:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_1`}," isAdmin ",8,ye),V(a("input",{type:"radio","onUpdate:modelValue":l=>e.admin=l,id:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_0`,name:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}`,value:0},null,8,ve),[[D,e.admin]]),a("label",{class:"no_bg",for:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_0`}," isUser ",8,fe),a("div",null,[a("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:l=>w(o)},null,8,me)])])],64)):(u(),i(_,{key:0},[a("div",g,[a("div",{onClick:l=>C(o)},y(e.title),9,ee),a("div",te,[a("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:l=>w(o)},null,8,se),a("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:l=>L(o)},null,8,ae)])]),a("div",{onClick:l=>C(o),class:"description"},y(e.description),9,le),a("div",{onClick:l=>C(o),class:"meta"},[a("span",null,y(e.admin?"admin":"user"),1)],8,ne)],64))],2))),128))])):B("",!0),a("div",ke,[a("div",{class:h({user:!0,user_add:!0}),onClick:H},s[2]||(s[2]=[a("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1)])),(u(!0),i(_,null,b(d.value,(e,o)=>(u(),i("div",{class:h({user:!0,edit:e.edit}),key:`user_view_${e.ext_key?e.ext_key:e.id}`},[e.edit?(u(),i(_,{key:1},[a("div",Ue,[v(k,{modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),a("div",null,[V(a("input",{type:"checkbox","onUpdate:modelValue":l=>e.status=l,id:`UV_U_CB_${e.ext_key?e.ext_key:e.id}`,"true-value":1,"false-value":0},null,8,be),[[A,e.status]]),a("label",{class:"no_bg",for:`UV_U_CB_${e.ext_key?e.ext_key:e.id}`},null,8,$e),a("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:l=>I(o)},null,8,Ge)])]),v(k,{modelValue:e.mail,"onUpdate:modelValue":l=>e.mail=l,class:"mail"},null,8,["modelValue","onUpdate:modelValue"]),v(k,{modelValue:e.password,"onUpdate:modelValue":l=>e.password=l,class:"password"},null,8,["modelValue","onUpdate:modelValue"]),s[3]||(s[3]=a("label",{class:"status"},null,-1))],64)):(u(),i(_,{key:0},[a("div",pe,[a("div",null,y(e.name),1),a("div",null,[a("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:l=>I(o)},null,8,he)])]),a("div",Ve,y(e.mail),1),a("div",Ce,y(e.status?"activate":"inactivate"),1)],64))],2))),128))])],512))}});export{De as default};

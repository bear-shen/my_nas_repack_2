import{d as L,u as M,r as b,b as O,G as h,g as j,f as q,q as w,h as s,i as l,w as _,v as m,k as i,l as U,F as r,j as x,s as B,t as C,o as a,x as c,L as d,m as E}from"./index-ja85KVwm.js";const H={class:"form"},$=l("span",null,"ID : ",-1),F=l("span",null,"status : ",-1),N=["value"],R=l("span",null,"type : ",-1),S=l("tr",null,[l("th",null,"id"),l("th",null,"type"),l("th",null,"status"),l("th",null,"time_create"),l("th",null,"time_update"),l("th",null,"payload")],-1),I=L({__name:"LogView",setup(T){M();const o=b(null);B();const V=C();let u={id:"",status:"",type:""},D=[[-2,"unknown"],[-1,"failed"],[0,"success"],[1,"new"],[2,"working"]];const g=b([]);O(async()=>{Object.assign(u,h.copyObject(V.query)),y(),o.value&&o.value.addEventListener("scroll",k)}),j(async n=>{console.info(n),y()}),q(()=>{var n;o.value&&((n=o.value)==null||n.removeEventListener("scroll",k))});async function k(n){if(console.info(n),!o.value)return;let e=o.value,t=(e==null?void 0:e.scrollTop)+(e==null?void 0:e.clientHeight)+(e==null?void 0:e.clientHeight);(e==null?void 0:e.scrollHeight)<t&&h.debounce(async()=>{await y()},500,"logViewDebounce")}let p=1,v=!1;async function y(n=!1){if(v)return;v=!0,n&&(p=1);const e=await w("log/get",Object.assign({page:p},u));if(p+=1,v=!1,!e)return;if(!e.length){p--;return}const t=n?[]:g.value;for(let f=0;f<e.length;f++)t.push(Object.assign(e[f],{ext_key:`${new Date().valueOf()}_${Math.random()}`}));g.value=t}return(n,e)=>(a(),s("div",{class:"fr_content view_log",ref_key:"contentDOM",ref:o},[l("div",H,[l("label",null,[$,_(l("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>i(u).id=t)},null,512),[[m,i(u).id]])]),l("label",null,[F,_(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>i(u).status=t)},[(a(!0),s(r,null,x(i(D),(t,f)=>(a(),s("option",{value:t[0]},c(t[1]),9,N))),256))],512),[[U,i(u).status]])]),l("label",null,[R,_(l("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>i(u).type=t)},null,512),[[m,i(u).type]])]),l("label",null,[l("button",{type:"button",onClick:e[3]||(e[3]=t=>y(!0))},"query")])]),l("table",null,[S,(a(!0),s(r,null,x(g.value,t=>(a(),s("tr",{key:`log_view_${t.ext_key}`},[l("td",null,c(t.id),1),l("td",null,c(t.type),1),l("td",null,[t.status===-2?(a(),s(r,{key:1},[d("unknown")],64)):t.status===-1?(a(),s(r,{key:2},[d("failed")],64)):t.status===0?(a(),s(r,{key:3},[d("success")],64)):t.status===1?(a(),s(r,{key:4},[d("waiting")],64)):t.status===2?(a(),s(r,{key:5},[d("working")],64)):E("",!0)]),l("td",null,c(t.time_create),1),l("td",null,c(t.time_update),1),l("td",null,c(t.payload),1)]))),128))])],512))}});export{I as default};

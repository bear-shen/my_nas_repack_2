import{r as O,J as V,d as P,o as q,q as A,K as z,b as s,c as r,e as o,u as a,F as p,f as _,t as C,U as v,V as b,a6 as G,W as L,C as g,aa as J,n as F,R as W,i as K,H as j}from"./basic-rSR_Cw6k.js";import{u as X,b as Y,a as Z,o as Q,p as ee}from"./index-D0Dqpylb.js";import{F as te}from"./FileItem-CmgyWMXq.js";const f=O([]),w=O("copy");async function E(M){if(console.info(f.value),!f.value.length)return;const k=new Set;f.value.forEach($=>{k.add($.id)});const h=Array.from(k),y=new FormData;switch(y.set("id_node",`${h.join(",")}`),y.set("id_target",`${M}`),w.value){case"copy":await V("file/copy",y);break;case"cut":await V("file/mov",y);break}f.value=[]}const le=Object.freeze(Object.defineProperty({__proto__:null,doPaste:E,mode:w,nodeList:f},Symbol.toStringTag,{value:"Module"})),ne={class:"content_meta"},ae={key:0,class:"crumb"},oe=["onClick","title"],se={class:"search"},re=["value","innerHTML"],ie=["value","innerHTML"],ue={class:"display"},de={key:2},ce=["value"],ye=["onClick"],fe={key:1,class:"pastebin"},me=P({__name:"FileView",setup(M){const k=O(null),h=X(),y=Y(),$=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1;let u={mode:"directory",id_dir:"0",id_tag:""},d={keyword:"",node_type:"any",rate:"",cascade_dir:"1"};function T(l){if(l){for(let e in u){if(!Object.prototype.hasOwnProperty.call(u,e))continue;const t=e;switch(t){default:u[t]=l[t]??"";break;case"mode":u[t]=l[t]??"directory";break;case"id_dir":u[t]=l[t]??"0";break}}for(let e in d){if(!Object.prototype.hasOwnProperty.call(d,e))continue;const t=e;switch(t){default:d[t]=l[t]??"";break;case"cascade_dir":d[t]=l[t]??"1";break}}}}Z(async l=>{console.warn("onBeforeRouteUpdate",l,JSON.stringify(l.query)),l.query&&T(l.query),await m()});let c=O([]),n;async function m(l){if(console.info("getList",y.name),n.nodeList.value=[],l)n.nodeList.value=l;else{switch(c.value=[],y.name){default:break;case"Recycle":u.status="deleted";break;case"Favourite":break}let e={};switch(u.mode){case"directory":e=Object.assign(e,u);break;case"search":e=Object.assign(e,u,d);break}const t=await V("file/get",e);if(!t)return;c.value=t.path,n.nodeList.value=n.sortList(t.list,n.sortVal.value)}return n&&n.setList(n.nodeList.value),{crumb:c.value,node:n.nodeList.value}}function N(){let l=0,e="root";if(c.value.length){let t=c.value[c.value.length-1];t&&(l=t.id??0,e=t.title??"root")}K({title:`mkdir | ${e}`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{label:"title",type:"text"}],callback:{submit:async t=>{const S=t.content.form[0].value;if(!S)return!0;const x=await V("file/mkdir",{title:S,pid:`${l}`});m()}}})}function I(){let l=0,e="root";if(c.value.length){let t=c.value[c.value.length-1];t&&(l=t.id??0,e=t.title??"root")}K({title:`upload | ${e}`,alpha:!1,key:`FileView_addFile_${l}`,single:!0,w:400,h:200,minW:400,minH:200,allow_resize:!0,allow_move:!0,allow_fullscreen:!0,auto_focus:!0,component:[{componentName:"uploader",data:{pid:l,emitGo:D}}]})}function R(){var t;const l=j.copyObject(d);u.id_tag&&(l.id_tag=u.id_tag),u.id_dir&&(l.id_dir=u.id_dir);let e=!1;d.rate&&(e=!0),(t=d.keyword)!=null&&t.trim()&&(e=!0),d.node_type&&d.node_type!="any"&&(e=!0),e?l.mode="search":l.mode="directory",n.go(l)}function D(l,e){switch(console.info("emitGo",l,e),l){case"reload":m();break;case"tag":n.go({mode:"directory",id_tag:`${e}`});break;case"node":let t;for(let i=0;i<n.nodeList.value.length;i++)if(n.nodeList.value[i].id===e){t=n.nodeList.value[i];break}if(!t)break;switch(t.type){case"directory":n.go({mode:"directory",id_dir:`${t.id}`});break;default:ee(Object.assign(j.copyObject(u),d),t.id??0);break}break}}q(async()=>{y.query&&T(y.query),n=new Q({route:y,router:h,getList:m,contentDOM:k.value,emitGo:D}),await m()&&(n.reloadScroll(),document.addEventListener("keydown",B))}),A(()=>{n.destructor(),document.removeEventListener("keydown",B)});function B(l){const e=[];switch(l.ctrlKey&&e.push("ctrl"),l.shiftKey&&e.push("shift"),e.push(l.code),e.join("_")){default:return;case"ctrl_KeyU":if(y.name!=="Directory"||!(c.value.length||u.id_dir))return;n&&n.showSelectionOp&&(l.preventDefault(),I());break;case"ctrl_KeyM":if(y.name!=="Directory"||!(c.value.length||u.id_dir))return;n&&n.showSelectionOp&&(l.preventDefault(),N());break;case"ctrl_KeyC":case"ctrl_KeyV":case"ctrl_KeyX":if(y.name!=="Directory"||z(l.target))return;U(e);break;case"Enter":case"NumpadEnter":if(!l.target||l.target.id!=="searchBarInput")return;R();break}}function H(l){(c.value.length||u.id_dir)&&(l.stopPropagation(),l.preventDefault(),I())}async function U(l){console.info(l,c.value,u.id_dir);let e;switch(l.join("_")){case"ctrl_KeyC":if(e=n.getSelected(),!e.nodeLs.length)return;f.value=e.nodeLs,w.value="copy";break;case"ctrl_KeyX":if(e=n.getSelected(),!e.nodeLs.length)return;f.value=e.nodeLs,w.value="cut";break;case"ctrl_KeyV":if(!f.value.length||!u.id_dir)return;await E(u.id_dir),await m();break}}return(l,e)=>(s(),r("div",{class:"fr_content view_file",onDragover:H},[o("div",ne,[a(c).length?(s(),r("div",ae,[(s(!0),r(p,null,_(a(c),(t,i)=>(s(),r("a",{dir:"ltr",class:"item",key:i,onClick:S=>a(n).go({id_dir:`${t==null?void 0:t.id}`,mode:"directory"}),title:t.title},C(t.title),9,oe))),128))])):v("",!0),o("div",se,[o("label",null,[e[13]||(e[13]=o("span",null,"Title : ",-1)),b(o("input",{id:"searchBarInput",type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>a(d).keyword=t)},null,512),[[G,a(d).keyword]])]),o("label",null,[e[14]||(e[14]=o("span",null,"Type : ",-1)),b(o("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>a(d).node_type=t)},[(s(!0),r(p,null,_(a(g).fileType,(t,i)=>(s(),r("option",{key:`FV_SCH_NODE_TYPE_${i}`},C(t),1))),128))],512),[[L,a(d).node_type]])]),o("label",null,[e[15]||(e[15]=o("span",null,"Rate : ",-1)),$?b((s(),r("select",{key:0,class:"sysIcon","onUpdate:modelValue":e[2]||(e[2]=t=>a(d).rate=t)},[(s(!0),r(p,null,_(a(g).rateMobile,(t,i)=>(s(),r("option",{value:i,innerHTML:t,key:`FV_SCH_CON_RATE_${i}`},null,8,re))),128))],512)),[[L,a(d).rate]]):b((s(),r("select",{key:1,class:"sysIcon","onUpdate:modelValue":e[3]||(e[3]=t=>a(d).rate=t)},[(s(!0),r(p,null,_(a(g).rate,(t,i)=>(s(),r("option",{value:i,innerHTML:t,key:`FV_SCH_CON_RATE_${i}`},null,8,ie))),128))],512)),[[L,a(d).rate]])]),o("label",null,[e[16]||(e[16]=o("span",null,"Cascade : ",-1)),b(o("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=t=>a(d).cascade_dir=t),id:"FV_S_CB","true-value":1,"false-value":""},null,512),[[J,a(d).cascade_dir]]),e[17]||(e[17]=o("label",{class:"buttonStyle",for:"FV_S_CB"},null,-1))]),o("label",null,[o("button",{class:"buttonStyle sysIcon sysIcon_search",onClick:R})])]),o("div",ue,[a(n)&&a(n).showSelectionOp?(s(),r(p,{key:0},[o("a",{class:"buttonStyle",onClick:e[5]||(e[5]=t=>a(n).bathOp("browser"))},"OP"),o("a",{class:"buttonStyle",onClick:e[6]||(e[6]=t=>a(n).bathOp("favourite"))},"FAV"),o("a",{class:"buttonStyle",onClick:e[7]||(e[7]=t=>a(n).bathOp("rename"))},"RN"),o("a",{class:"buttonStyle",onClick:e[8]||(e[8]=t=>a(n).bathOp("move"))},"MV"),a(y).name!=="Recycle"?(s(),r("a",{key:0,class:"buttonStyle",onClick:e[9]||(e[9]=t=>a(n).bathOp("delete"))},"DEL")):v("",!0),a(y).name==="Recycle"?(s(),r("a",{key:1,class:"buttonStyle",onClick:e[10]||(e[10]=t=>a(n).bathOp("delete_forever"))},"rDEL")):v("",!0),e[18]||(e[18]=o("a",{class:"sysIcon sysIcon_fengefu"},null,-1))],64)):v("",!0),a(c).length||a(u).id_dir=="0"?(s(),r(p,{key:1},[o("a",{class:"buttonStyle sysIcon sysIcon_addfolder",onClick:N}),o("a",{class:"buttonStyle sysIcon sysIcon_addfile",onClick:I}),e[19]||(e[19]=o("a",{class:"buttonStyle sysIcon sysIcon_fengefu"},null,-1))],64)):v("",!0),a(n)&&a(n).sortVal?(s(),r("label",de,[e[20]||(e[20]=o("span",null,"Sort : ",-1)),b(o("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>a(n).sortVal.value=t),onChange:e[12]||(e[12]=t=>a(n).setSort(a(n).sortVal.value))},[(s(!0),r(p,null,_(a(g).sort,(t,i)=>(s(),r("option",{value:i,key:`FV_SCH_CON_SORT_${i}`},C(t),9,ce))),128))],544),[[L,a(n).sortVal.value]])])):v("",!0),e[21]||(e[21]=o("a",{class:"sysIcon sysIcon_fengefu"},null,-1)),a(n)?(s(!0),r(p,{key:3},_(a(g).listType,(t,i)=>(s(),r("a",{class:F(["buttonStyle","sysIcon",`sysIcon_listType_${t}`,{active:a(n).mode.value===t}]),onClick:S=>a(n).setMode(t),key:`FAV_SCH_BTN_${i}`},null,10,ye))),128)):v("",!0)]),le&&f.value.length?(s(),r("div",fe,[o("span",{class:F(["sysIcon",`sysIcon_${w.value}`])},C(f.value.length),3)])):v("",!0)]),o("div",{class:F(["content_detail",`mode_${a(n)?a(n).mode.value:""}`]),ref_key:"contentDOM",ref:k},[a(n)?(s(!0),r(p,{key:0},_(a(n).nodeList.value,(t,i)=>(s(),W(te,{key:t.id,node:t,index:i,selected:!1,onGo:D},null,8,["node","index"]))),128)):v("",!0)],2)],32))}});export{me as _};

import{d as te,r as G,o as oe,q as le,J as V,c as r,e as l,n as k,F as y,f,V as m,a6 as se,u as i,W as $,U as S,H,b as u,t as C,a9 as q,D as g,C as w,aa as P,R as ne}from"./basic-rSR_Cw6k.js";import{o as ae,a as ie,p as ue,u as re,b as de}from"./index-D0Dqpylb.js";import{_ as x}from"./ContentEditable.vue_vue_type_script_setup_true_lang-BHJBYt10.js";import{R as ce,F as _e}from"./FileItem-CmgyWMXq.js";import{H as z}from"./Hinter-BlfudI7t.js";const ye={class:"fr_content view_fav"},fe={class:"list_fav_group"},ve=["onClick"],pe={class:"title"},ke=["onClick"],me=["onClick"],be={class:"operator"},Ce=["onClick"],Ve=["onClick"],we=["onUpdate:modelValue"],$e=["value"],Se={class:"favTagLs"},ge=["onClick"],Ie=["onUpdate:modelValue","id"],he=["for"],Oe=["onUpdate:modelValue","id"],Le=["for"],Ge=["onClick"],Ue={class:"title"},Ae=["onClick"],De=["onClick"],Te={class:"operator"},Ee=["onClick"],Fe=["onClick"],Me={class:"content_meta"},Re={class:"search"},Ne=["value"],je=["value","innerHTML"],Be={key:0,class:"display"},He={key:2},qe=["value"],Pe=["onClick"],Xe=te({__name:"Favourite",setup(xe){const A=G(null),D=re(),v=de();let p={id:"",keyword:""};const c=G([]),U=G(null),b=G(-1),J=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1;oe(async()=>{p.id=v.query.id??"",await K(),n=new ae({route:v,router:D,getList:O,contentDOM:A.value,emitGo:N}),p.id&&(E(),M(v.query),await O(),await n.reloadScroll()),document.addEventListener("keydown",j)}),le(()=>{n.destructor(),document.removeEventListener("keydown",j)}),ie(async o=>{console.info(o),p.id=o.query.id??"",p.id&&(E(),M(o.query),await O())});async function K(){const o=await V("favourite_group/get",p);o&&(o.forEach(e=>{e.edit=!1,e.ext_key=e.id}),c.value=o||[])}async function I(o){const e=c.value[o];await V("favourite_group/del",e),location.reload()}async function h(o){console.info(c.value[o]);const e=H.copyObject(c.value[o]);if(e.edit){c.value[o].edit=!1,e.meta=JSON.stringify(e.meta);const t=await V("favourite_group/mod",e);if(!t)return;c.value[o].id=parseInt(t.id??"")}else c.value[o].edit=!0}function T(o){c.value.unshift({title:"",status:1,auto:o,meta:{node_type:"any",id_tag:"",rate:"",id_dir:"",cascade_dir:"1",tag_or:"1"},edit:!0,ext_key:new Date().valueOf()})}function E(){if(!p.id)return;let o=parseInt(p.id);c.value.forEach((e,t)=>{o===e.id&&(b.value=t,U.value=e)})}async function F(o){const e=c.value[o];D.push({path:v.path,query:{id:e.id}})}let _={mode:"directory",id_dir:"",id_tag:""},d={keyword:"",node_type:"any",rate:"",cascade_dir:"1"};function M(o){if(o){for(let e in _)if(Object.prototype.hasOwnProperty.call(_,e))switch(e){default:_[e]=o[e]??"";break;case"mode":_[e]=o[e]??"directory";break;case"id_dir":_[e]=o[e]??"";break}for(let e in d)if(Object.prototype.hasOwnProperty.call(d,e))switch(e){default:d[e]=o[e]??"";break;case"cascade_dir":d[e]=o[e]??"1";break}}}let n;function R(){const o=H.copyObject(d);_.id_tag&&(o.id_tag=_.id_tag),_.id_dir&&(o.id_dir=_.id_dir),d.keyword&&(d.keyword=d.keyword.trim()),!d.rate&&!d.node_type&&!d.keyword?o.mode="directory":o.mode="search",n.go(o)}async function O(o){var e,t;if(console.info("getList",v.name),n.nodeList.value=[],o)n.nodeList.value=o;else{switch(v.name){default:break;case"Recycle":_.status="deleted";break;case"Favourite":break}let s={};switch((e=U.value)!=null&&e.id&&(s.id_fav=(t=U.value)==null?void 0:t.id.toString()),_.mode){case"directory":s=Object.assign(s,_);break;case"search":s=Object.assign(s,_,d);break}const a=await V("file/get",s);if(!a)return;n.nodeList.value=n.sortList(a.list,n.sortVal.value)}n&&n.setList(n.nodeList.value)}function N(o,e){switch(o){case"reload":O();break;case"tag":n.go({id_tag:`${e}`,mode:"tag"});break;case"node":let t;for(let s=0;s<n.nodeList.value.length;s++)if(n.nodeList.value[s].id===e){t=n.nodeList.value[s];break}if(!t)break;switch(t.type){case"directory":n.go({id_dir:`${t.id}`,mode:"directory"});break;default:ue({mode:"favourite",id_fav:p.id,with:"file,crumb"},t.id??0);break}break}}function j(o){const e=[];switch(o.ctrlKey&&e.push("ctrl"),o.shiftKey&&e.push("shift"),e.push(o.code),e.join("_")){default:return;case"NumpadEnter":case"Enter":if(!o.target||o.target.id!=="searchBarInput")return;R();break}}async function Q(o){console.info("node_hint");const t=await V("file/get",{mode:"search",node_type:"directory",keyword:o,with:"crumb",limit:"20"});return t?("root".indexOf(o)!==-1&&t.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),t.list):!1}function Y(o,e){console.info("node_add",o,e);const t=c.value[e];t.meta=Object.assign(t.meta??{},{pid:o.id}),c.value[e].node=o}function W(o){var t;if(console.info("node_parse"),!o)return"";const e=[];return(t=o.crumb_node)==null||t.forEach(s=>{s.title&&e.push(s.title)}),o.title&&e.push(o.title),`/ ${e.join(" / ")}`}async function X(o){const e=new FormData;return e.set("keyword",o),e.set("size","20"),await V("tag/get",e)}function Z(o,e){const t=c.value[e];t.tag||(t.tag=[]),t.tag.push(o);const s=[];t.tag.forEach(a=>s.push(a.id??0)),t.meta=Object.assign(t.meta??{},{id_tag:s.join(",")})}function B(o){return o?`${o.group.title} : ${o.title}`:""}function ee(o,e){const t=c.value[o];t.tag||(t.tag=[]),t.tag.splice(e,1);const s=[];t.tag.forEach(a=>s.push(a.id??0)),t.meta=Object.assign(t.meta??{},{id_tag:s.join(",")})}return(o,e)=>(u(),r("div",ye,[l("div",fe,[l("div",{class:k({fav_group:!0,fav_group_add:!0,active:b.value===-1})},[l("span",{class:"buttonStyle sysIcon sysIcon_plus-square-o",onClick:e[0]||(e[0]=t=>T(0))}),l("span",{class:"buttonStyle sysIcon sysIcon_A",onClick:e[1]||(e[1]=t=>T(1))})],2),(u(!0),r(y,null,f(c.value,(t,s)=>(u(),r("div",{key:`favView_group_${t.ext_key?t.ext_key:t.id}`,class:k({active:b.value===s,fav_group:!0,edit:t.edit})},[t.auto?(u(),r(y,{key:0},[t.edit?(u(),r("div",{key:1,class:k({active:b.value==s,auto:!0})},[g(x,{class:"title",modelValue:t.title,"onUpdate:modelValue":a=>t.title=a,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),l("div",be,[l("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:a=>h(s)},null,8,Ce),l("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:a=>I(s)},null,8,Ve)]),l("table",null,[l("tbody",null,[l("tr",null,[e[15]||(e[15]=l("td",null,"nodeType",-1)),l("td",null,[m(l("select",{"onUpdate:modelValue":a=>t.meta.node_type=a},[(u(!0),r(y,null,f(i(w).fileType,(a,L)=>(u(),r("option",{value:a,key:`FAV_G_${t.ext_key}_NODE_TYPE_${L}`},C(a),9,$e))),128))],8,we),[[$,t.meta.node_type]])])]),l("tr",null,[e[16]||(e[16]=l("td",null,"withTag",-1)),l("td",Se,[l("div",null,[(u(!0),r(y,null,f(t.tag,(a,L)=>(u(),r("p",{key:`FAV_G_${t.ext_key}_TAG_BTN_${L}`},[l("span",null,C(B(a)),1),l("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:ze=>ee(s,L)},null,8,ge)]))),128))]),g(z,{"get-list":X,submit:Z,"parse-text":B,meta:s},null,8,["meta"])])]),l("tr",null,[e[17]||(e[17]=l("td",null,"or",-1)),l("td",null,[m(l("input",{type:"checkbox","onUpdate:modelValue":a=>t.meta.tag_or=a,id:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_TAG_OR`,"true-value":"1","false-value":""},null,8,Ie),[[P,t.meta.tag_or]]),l("label",{class:"buttonStyle",for:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_TAG_OR`},null,8,he)])]),l("tr",null,[e[18]||(e[18]=l("td",null,"root",-1)),l("td",null,[g(z,{"get-list":Q,submit:Y,"parse-text":W,modelValue:t.node,"onUpdate:modelValue":a=>t.node=a,meta:s},null,8,["modelValue","onUpdate:modelValue","meta"])])]),l("tr",null,[e[19]||(e[19]=l("td",null,"cascade",-1)),l("td",null,[m(l("input",{type:"checkbox","onUpdate:modelValue":a=>t.meta.cascade_dir=a,id:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_CASCADE`,"true-value":"1","false-value":""},null,8,Oe),[[P,t.meta.cascade_dir]]),l("label",{class:"buttonStyle",for:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_CASCADE`},null,8,Le)])]),l("tr",null,[e[20]||(e[20]=l("td",null,"rate",-1)),l("td",null,[g(ce,{node:null,modelValue:t.meta.rate,"onUpdate:modelValue":a=>t.meta.rate=a},null,8,["modelValue","onUpdate:modelValue"])])])])])],2)):(u(),r("div",{key:0,class:k({active:b.value==s,auto:!0}),onClick:a=>F(s)},[l("div",pe,C(t.title),1),l("div",{class:"operator",onClick:e[2]||(e[2]=q(()=>{},["stop"]))},[l("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:a=>h(s)},null,8,ke),l("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:a=>I(s)},null,8,me)])],10,ve))],64)):(u(),r(y,{key:1},[t.edit?(u(),r("div",{key:1,class:k({active:b.value==s})},[g(x,{class:"title",modelValue:t.title,"onUpdate:modelValue":a=>t.title=a,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),l("div",Te,[l("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:a=>h(s)},null,8,Ee),l("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:a=>I(s)},null,8,Fe)])],2)):(u(),r("div",{key:0,class:k({active:b.value==s}),onClick:a=>F(s)},[l("div",Ue,C(t.title),1),l("div",{class:"operator",onClick:e[3]||(e[3]=q(()=>{},["stop"]))},[l("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:a=>h(s)},null,8,Ae),l("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:a=>I(s)},null,8,De)])],10,Ge))],64))],2))),128))]),l("div",{class:"fav_content",ref_key:"contentDOM",ref:A},[l("div",Me,[l("div",Re,[l("label",null,[e[21]||(e[21]=l("span",null,"Title : ",-1)),m(l("input",{id:"searchBarInput",type:"text","onUpdate:modelValue":e[4]||(e[4]=t=>i(d).keyword=t)},null,512),[[se,i(d).keyword]])]),l("label",null,[e[22]||(e[22]=l("span",null,"Type : ",-1)),m(l("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>i(d).node_type=t)},[(u(!0),r(y,null,f(i(w).fileType,(t,s)=>(u(),r("option",{key:`FAV_SCH_CON_TYPE_${s}`},C(t),1))),128))],512),[[$,i(d).node_type]])]),l("label",null,[e[23]||(e[23]=l("span",null,"Rate : ",-1)),J?m((u(),r("select",{key:0,"onUpdate:modelValue":e[6]||(e[6]=t=>i(d).rate=t)},[(u(!0),r(y,null,f(i(w).rateMobile,(t,s)=>(u(),r("option",{value:s,key:`FAV_SCH_CON_RATE_${s}`},C(t),9,Ne))),128))],512)),[[$,i(d).rate]]):m((u(),r("select",{key:1,class:"sysIcon","onUpdate:modelValue":e[7]||(e[7]=t=>i(d).rate=t)},[(u(!0),r(y,null,f(i(w).rate,(t,s)=>(u(),r("option",{value:s,innerHTML:t,key:`FAV_SCH_CON_RATE_${s}`},null,8,je))),128))],512)),[[$,i(d).rate]])]),l("label",null,[l("button",{class:"buttonStyle sysIcon sysIcon_search",onClick:R})])]),i(n)&&i(n).showSelectionOp?(u(),r("div",Be,[l("a",{class:"buttonStyle",onClick:e[8]||(e[8]=t=>i(n).bathOp("browser"))},"OP"),l("a",{class:"buttonStyle",onClick:e[9]||(e[9]=t=>i(n).bathOp("rename"))},"RN"),l("a",{class:"buttonStyle",onClick:e[10]||(e[10]=t=>i(n).bathOp("move"))},"MV"),i(v).name!=="Recycle"?(u(),r("a",{key:0,class:"buttonStyle",onClick:e[11]||(e[11]=t=>i(n).bathOp("delete"))},"DEL")):S("",!0),i(v).name==="Recycle"?(u(),r("a",{key:1,class:"buttonStyle",onClick:e[12]||(e[12]=t=>i(n).bathOp("delete_forever"))},"rDEL")):S("",!0),e[25]||(e[25]=l("a",{class:"sysIcon sysIcon_fengefu"},null,-1)),i(n)&&i(n).sortVal?(u(),r("label",He,[e[24]||(e[24]=l("span",null,"Sort : ",-1)),m(l("select",{"onUpdate:modelValue":e[13]||(e[13]=t=>i(n).sortVal.value=t),onChange:e[14]||(e[14]=t=>i(n).setSort(i(n).sortVal.value))},[(u(!0),r(y,null,f(i(w).sort,(t,s)=>(u(),r("option",{value:s,key:`FV_SCH_CON_SORT_${s}`},C(t),9,qe))),128))],544),[[$,i(n).sortVal.value]])])):S("",!0),e[26]||(e[26]=l("a",{class:"sysIcon sysIcon_fengefu"},null,-1)),(u(!0),r(y,null,f(i(w).listType,(t,s)=>(u(),r("a",{class:k(["buttonStyle","sysIcon",`sysIcon_listType_${t}`,{active:i(n).mode.value===t}]),onClick:a=>i(n).setMode(t),key:`FAV_SCH_CON_ICON_${s}`},null,10,Pe))),128))])):S("",!0)]),l("div",{class:k(["list_fav",`mode_${i(n)?i(n).mode.value:""}`])},[i(n)?(u(!0),r(y,{key:0},f(i(n).nodeList.value,(t,s)=>(u(),ne(_e,{key:s,node:t,index:s,selected:!1,onGo:N},null,8,["node","index"]))),128)):S("",!0)],2)],512)]))}});export{Xe as default};

import{d as le,u as se,a as oe,r as S,b as ne,e as ae,f as ie,g as ue,q as w,p as re,h as u,i as s,n as m,F as y,j as f,w as b,v as de,k as a,l as g,m as U,s as ce,t as _e,G as H,o as i,x as V,y as P,z as I,C as $,A as z,c as ye}from"./index-DmUXKt8b.js";import{_ as x}from"./ContentEditable.vue_vue_type_script_setup_true_lang-B1EFrrhy.js";import{R as fe,F as ve}from"./FileItem-BKABnNdi.js";import{H as K}from"./Hinter-BaOzUWON.js";const pe={class:"fr_content view_fav"},ke={class:"list_fav_group"},me=["onClick"],be={class:"title"},Ce=["onClick"],Ve=["onClick"],we={class:"operator"},$e=["onClick"],Se=["onClick"],ge=["onUpdate:modelValue"],Ie=["value"],he={class:"favTagLs"},Oe=["onClick"],Ge=["onUpdate:modelValue","id"],Ae=["for"],Ue=["onUpdate:modelValue","id"],Te=["for"],De=["onClick"],Ee={class:"title"},Fe=["onClick"],Me=["onClick"],Le={class:"operator"},Re=["onClick"],je=["onClick"],Ne={class:"content_meta"},Be={class:"search"},qe=["value"],He=["value","innerHTML"],Pe={key:0,class:"display"},ze={key:2},xe=["value"],Ke=["onClick"],et=le({__name:"Favourite",setup(Qe){se(),oe();const T=S(null),D=ce(),v=_e();let p={id:"",keyword:""};const c=S([]),E=S(null),C=S(-1),Q=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1;ne(async()=>{p.id=v.query.id??"",await Y(),r=new ae({route:v,router:D,getList:G,contentDOM:T.value,emitGo:N}),p.id&&(M(),R(v.query),await G(),await r.reloadScroll()),document.addEventListener("keydown",B)}),ie(()=>{r.destructor(),document.removeEventListener("keydown",B)}),ue(async l=>{console.info(l),p.id=l.query.id??"",p.id&&(M(),R(l.query),await G())});async function Y(){const l=await w("favourite_group/get",p);l&&(l.forEach(e=>{e.edit=!1,e.ext_key=e.id}),c.value=l||[])}async function h(l){const e=c.value[l];await w("favourite_group/del",e),location.reload()}async function O(l){console.info(c.value[l]);const e=H.copyObject(c.value[l]);if(e.edit){c.value[l].edit=!1,e.meta=JSON.stringify(e.meta);const t=await w("favourite_group/mod",e);if(!t)return;c.value[l].id=parseInt(t.id??"")}else c.value[l].edit=!0}function F(l){c.value.unshift({title:"",status:1,auto:l,meta:{node_type:"any",id_tag:"",rate:"",id_dir:"",cascade_dir:"1",tag_or:"1"},edit:!0,ext_key:new Date().valueOf()})}function M(){if(!p.id)return;let l=parseInt(p.id);c.value.forEach((e,t)=>{l===e.id&&(C.value=t,E.value=e)})}async function L(l){const e=c.value[l];D.push({path:v.path,query:{id:e.id}})}let _={mode:"directory",id_dir:"",id_tag:""},d={keyword:"",node_type:"",rate:"",cascade_dir:"1"};function R(l){if(l){for(let e in _)if(Object.prototype.hasOwnProperty.call(_,e))switch(e){default:_[e]=l[e]??"";break;case"mode":_[e]=l[e]??"directory";break;case"id_dir":_[e]=l[e]??"";break}for(let e in d)if(Object.prototype.hasOwnProperty.call(d,e))switch(e){default:d[e]=l[e]??"";break;case"cascade_dir":d[e]=l[e]??"1";break}}}const k=S([]);let r;function j(){const l=H.copyObject(d);_.id_tag&&(l.id_tag=_.id_tag),_.id_dir&&(l.id_dir=_.id_dir),!d.rate&&!d.node_type&&!d.keyword.trim()?l.mode="directory":l.mode="search",r.go(l)}async function G(l){var e;if(console.info("getList",v.name),k.value=[],l)k.value=l;else{switch(v.name){default:break;case"Recycle":_.status="deleted";break;case"Favourite":break}let t={id_fav:(e=E.value)==null?void 0:e.id};switch(_.mode){case"directory":t=Object.assign(t,_);break;case"search":t=Object.assign(t,_,d);break}const o=await w("file/get",t);if(!o)return;k.value=r.sortList(o.list,r.sortVal.value)}r&&r.setList(k.value)}function N(l,e){switch(l){case"reload":G();break;case"tag":r.go({id_tag:`${e}`,mode:"tag"});break;case"node":let t;for(let o=0;o<k.value.length;o++)if(k.value[o].id===e){t=k.value[o];break}if(!t)break;switch(t.type){case"directory":r.go({id_dir:`${t.id}`,mode:"directory"});break;default:re({mode:"favourite",id_fav:p.id,with:"file,crumb"},t.id??0);break}break}}function B(l){const e=[];switch(l.ctrlKey&&e.push("ctrl"),l.shiftKey&&e.push("shift"),e.push(l.code),e.join("_")){default:return;case"NumpadEnter":case"Enter":if(!l.target||l.target.id!=="searchBarInput")return;j();break}}async function J(l){console.info("node_hint");const t=await w("file/get",{mode:"search",node_type:"directory",keyword:l,with:"crumb",limit:"20"});return t?("root".indexOf(l)!==-1&&t.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),t.list):!1}function X(l,e){console.info("node_add",l,e);const t=c.value[e];t.meta=Object.assign(t.meta??{},{pid:l.id}),c.value[e].node=l}function Z(l){var t;if(console.info("node_parse"),!l)return"";const e=[];return(t=l.crumb_node)==null||t.forEach(o=>{o.title&&e.push(o.title)}),l.title&&e.push(l.title),`/ ${e.join(" / ")}`}async function W(l){const e=new FormData;return e.set("keyword",l),e.set("size","20"),await w("tag/get",e)}function ee(l,e){const t=c.value[e];t.tag||(t.tag=[]),t.tag.push(l);const o=[];t.tag.forEach(n=>o.push(n.id??0)),t.meta=Object.assign(t.meta??{},{id_tag:o.join(",")})}function q(l){return l?`${l.group.title} : ${l.title}`:""}function te(l,e){const t=c.value[l];t.tag||(t.tag=[]),t.tag.splice(e,1);const o=[];t.tag.forEach(n=>o.push(n.id??0)),t.meta=Object.assign(t.meta??{},{id_tag:o.join(",")})}return(l,e)=>(i(),u("div",pe,[s("div",ke,[s("div",{class:m({fav_group:!0,fav_group_add:!0,active:C.value===-1})},[s("span",{class:"buttonStyle sysIcon sysIcon_plus-square-o",onClick:e[0]||(e[0]=t=>F(0))}),s("span",{class:"buttonStyle sysIcon sysIcon_A",onClick:e[1]||(e[1]=t=>F(1))})],2),(i(!0),u(y,null,f(c.value,(t,o)=>(i(),u("div",{key:`favView_group_${t.ext_key?t.ext_key:t.id}`,class:m({active:C.value===o,fav_group:!0,edit:t.edit})},[t.auto?(i(),u(y,{key:0},[t.edit?(i(),u("div",{key:1,class:m({active:C.value==o,auto:!0})},[I(x,{class:"title",modelValue:t.title,"onUpdate:modelValue":n=>t.title=n,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),s("div",we,[s("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:n=>O(o)},null,8,$e),s("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>h(o)},null,8,Se)]),s("table",null,[s("tbody",null,[s("tr",null,[e[15]||(e[15]=s("td",null,"nodeType",-1)),s("td",null,[b(s("select",{"onUpdate:modelValue":n=>t.meta.node_type=n},[(i(!0),u(y,null,f(a($).fileType,(n,A)=>(i(),u("option",{value:n,key:`FAV_G_${t.ext_key}_NODE_TYPE_${A}`},V(n),9,Ie))),128))],8,ge),[[g,t.meta.node_type]])])]),s("tr",null,[e[16]||(e[16]=s("td",null,"withTag",-1)),s("td",he,[s("div",null,[(i(!0),u(y,null,f(t.tag,(n,A)=>(i(),u("p",{key:`FAV_G_${t.ext_key}_TAG_BTN_${A}`},[s("span",null,V(q(n)),1),s("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:Ye=>te(o,A)},null,8,Oe)]))),128))]),I(K,{"get-list":W,submit:ee,"parse-text":q,meta:o},null,8,["meta"])])]),s("tr",null,[e[17]||(e[17]=s("td",null,"or",-1)),s("td",null,[b(s("input",{type:"checkbox","onUpdate:modelValue":n=>t.meta.tag_or=n,id:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_TAG_OR`,"true-value":"1","false-value":""},null,8,Ge),[[z,t.meta.tag_or]]),s("label",{class:"buttonStyle",for:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_TAG_OR`},null,8,Ae)])]),s("tr",null,[e[18]||(e[18]=s("td",null,"root",-1)),s("td",null,[I(K,{"get-list":J,submit:X,"parse-text":Z,modelValue:t.node,"onUpdate:modelValue":n=>t.node=n,meta:o},null,8,["modelValue","onUpdate:modelValue","meta"])])]),s("tr",null,[e[19]||(e[19]=s("td",null,"cascade",-1)),s("td",null,[b(s("input",{type:"checkbox","onUpdate:modelValue":n=>t.meta.cascade_dir=n,id:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_CASCADE`,"true-value":"1","false-value":""},null,8,Ue),[[z,t.meta.cascade_dir]]),s("label",{class:"buttonStyle",for:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_CASCADE`},null,8,Te)])]),s("tr",null,[e[20]||(e[20]=s("td",null,"rate",-1)),s("td",null,[I(fe,{node:null,modelValue:t.meta.rate,"onUpdate:modelValue":n=>t.meta.rate=n},null,8,["modelValue","onUpdate:modelValue"])])])])])],2)):(i(),u("div",{key:0,class:m({active:C.value==o,auto:!0}),onClick:n=>L(o)},[s("div",be,V(t.title),1),s("div",{class:"operator",onClick:e[2]||(e[2]=P(()=>{},["stop"]))},[s("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:n=>O(o)},null,8,Ce),s("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>h(o)},null,8,Ve)])],10,me))],64)):(i(),u(y,{key:1},[t.edit?(i(),u("div",{key:1,class:m({active:C.value==o})},[I(x,{class:"title",modelValue:t.title,"onUpdate:modelValue":n=>t.title=n,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),s("div",Le,[s("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:n=>O(o)},null,8,Re),s("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>h(o)},null,8,je)])],2)):(i(),u("div",{key:0,class:m({active:C.value==o}),onClick:n=>L(o)},[s("div",Ee,V(t.title),1),s("div",{class:"operator",onClick:e[3]||(e[3]=P(()=>{},["stop"]))},[s("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:n=>O(o)},null,8,Fe),s("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>h(o)},null,8,Me)])],10,De))],64))],2))),128))]),s("div",{class:"fav_content",ref_key:"contentDOM",ref:T},[s("div",Ne,[s("div",Be,[s("label",null,[e[21]||(e[21]=s("span",null,"Title : ",-1)),b(s("input",{id:"searchBarInput",type:"text","onUpdate:modelValue":e[4]||(e[4]=t=>a(d).keyword=t)},null,512),[[de,a(d).keyword]])]),s("label",null,[e[22]||(e[22]=s("span",null,"Type : ",-1)),b(s("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>a(d).node_type=t)},[(i(!0),u(y,null,f(a($).fileType,(t,o)=>(i(),u("option",{key:`FAV_SCH_CON_TYPE_${o}`},V(t),1))),128))],512),[[g,a(d).node_type]])]),s("label",null,[e[23]||(e[23]=s("span",null,"Rate : ",-1)),Q?b((i(),u("select",{key:0,"onUpdate:modelValue":e[6]||(e[6]=t=>a(d).rate=t)},[(i(!0),u(y,null,f(a($).rateMobile,(t,o)=>(i(),u("option",{value:o,key:`FAV_SCH_CON_RATE_${o}`},V(t),9,qe))),128))],512)),[[g,a(d).rate]]):b((i(),u("select",{key:1,class:"sysIcon","onUpdate:modelValue":e[7]||(e[7]=t=>a(d).rate=t)},[(i(!0),u(y,null,f(a($).rate,(t,o)=>(i(),u("option",{value:o,innerHTML:t,key:`FAV_SCH_CON_RATE_${o}`},null,8,He))),128))],512)),[[g,a(d).rate]])]),s("label",null,[s("button",{class:"buttonStyle sysIcon sysIcon_search",onClick:j})])]),a(r)&&a(r).showSelectionOp?(i(),u("div",Pe,[s("a",{class:"buttonStyle",onClick:e[8]||(e[8]=t=>a(r).bathOp("browser"))},"OP"),s("a",{class:"buttonStyle",onClick:e[9]||(e[9]=t=>a(r).bathOp("rename"))},"RN"),s("a",{class:"buttonStyle",onClick:e[10]||(e[10]=t=>a(r).bathOp("move"))},"MV"),a(v).name!=="Recycle"?(i(),u("a",{key:0,class:"buttonStyle",onClick:e[11]||(e[11]=t=>a(r).bathOp("delete"))},"DEL")):U("",!0),a(v).name==="Recycle"?(i(),u("a",{key:1,class:"buttonStyle",onClick:e[12]||(e[12]=t=>a(r).bathOp("delete_forever"))},"rDEL")):U("",!0),e[25]||(e[25]=s("a",{class:"sysIcon sysIcon_fengefu"},null,-1)),a(r)&&a(r).sortVal?(i(),u("label",ze,[e[24]||(e[24]=s("span",null,"Sort : ",-1)),b(s("select",{"onUpdate:modelValue":e[13]||(e[13]=t=>a(r).sortVal.value=t),onChange:e[14]||(e[14]=t=>a(r).setSort(l.sortVal))},[(i(!0),u(y,null,f(a($).sort,(t,o)=>(i(),u("option",{value:o,key:`FV_SCH_CON_SORT_${o}`},V(t),9,xe))),128))],544),[[g,a(r).sortVal.value]])])):U("",!0),e[26]||(e[26]=s("a",{class:"sysIcon sysIcon_fengefu"},null,-1)),(i(!0),u(y,null,f(a($).listType,(t,o)=>(i(),u("a",{class:m(["buttonStyle","sysIcon",`sysIcon_listType_${t}`,{active:a(r).mode.value===t}]),onClick:n=>a(r).setMode(t),key:`FAV_SCH_CON_ICON_${o}`},null,10,Ke))),128))])):U("",!0)]),s("div",{class:m(["list_fav",`mode_${a(r)?a(r).mode.value:""}`])},[(i(!0),u(y,null,f(k.value,(t,o)=>(i(),ye(ve,{key:o,node:t,index:o,selected:!1,onGo:N},null,8,["node","index"]))),128))],2)],512)]))}});export{et as default};

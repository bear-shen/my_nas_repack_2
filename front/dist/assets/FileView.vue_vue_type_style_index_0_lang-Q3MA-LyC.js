import{r as L,B as q,q as $,d as A,a as G,s as z,t as X,g as J,u as W,b as Y,e as Z,f as Q,D as ee,o as s,h as r,i as a,k as o,F as m,j as b,x as h,m as v,w as g,v as te,l as V,C as S,A as ne,n as M,c as oe,G as K,p as le}from"./index-BcAzqJ-k.js";import{F as ae}from"./FileItem-C3HiJxPH.js";const C=L([]),x=L("copy"),se=q("counter",()=>({nodeList:C,mode:x,doPaste:re}));async function re(T){if(console.info(C.value),!C.value.length)return;const w=new Set;C.value.forEach(D=>{w.add(D.id)});const y=Array.from(w),_=new FormData;switch(_.set("id_node",`${y.join(",")}`),_.set("id_target",`${T}`),x.value){case"copy":await $("file/copy",_);break;case"cut":await $("file/mov",_);break}C.value=[]}const ie={class:"content_meta"},ue={key:0,class:"crumb"},de=["onClick","title"],ce={class:"search"},ye=["value","innerHTML"],fe=["value","innerHTML"],pe={class:"display"},me={key:2},ve=["value"],_e=["onClick"],be={key:1,class:"pastebin"},we=A({__name:"FileView",setup(T){const w=G(),y=se(),_=L(null),D=z(),f=X(),H=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1;let u={mode:"directory",id_dir:"0",id_tag:""},d={keyword:"",node_type:"any",rate:"",cascade_dir:"1"};function N(n){if(n){for(let e in u){if(!Object.prototype.hasOwnProperty.call(u,e))continue;const t=e;switch(t){default:u[t]=n[t]??"";break;case"mode":u[t]=n[t]??"directory";break;case"id_dir":u[t]=n[t]??"0";break}}for(let e in d){if(!Object.prototype.hasOwnProperty.call(d,e))continue;const t=e;switch(t){default:d[t]=n[t]??"";break;case"cascade_dir":d[t]=n[t]??"1";break}}}}J(async n=>{console.warn("onBeforeRouteUpdate",n,JSON.stringify(n.query)),n.query&&N(n.query),await k()});let c=L([]),p=L([]),l;async function k(n){if(console.info("getList",f.name),p.value=[],n)p.value=n;else{switch(c.value=[],f.name){default:break;case"Recycle":u.status="deleted";break;case"Favourite":break}let e={};switch(u.mode){case"directory":e=Object.assign(e,u);break;case"search":e=Object.assign(e,u,d);break}const t=await $("file/get",e);if(!t)return;c.value=t.path,p.value=l.sortList(t.list,l.sortVal.value)}return l&&l.setList(p.value),{crumb:c.value,node:p.value}}function B(){let n=0,e="root";if(c.value.length){let t=c.value[c.value.length-1];t&&(n=t.id??0,e=t.title??"root")}w.set({title:`mkdir | ${e}`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{label:"title",type:"text"}],callback:{submit:async t=>{const O=t.content.form[0].value;if(!O)return!0;const P=await $("file/mkdir",{title:O,pid:`${n}`});k()}}})}function I(){let n=0,e="root";if(c.value.length){let t=c.value[c.value.length-1];t&&(n=t.id??0,e=t.title??"root")}w.set({title:`upload | ${e}`,alpha:!1,key:`FileView_addFile_${n}`,single:!0,w:400,h:200,minW:400,minH:200,allow_resize:!0,allow_move:!0,allow_fullscreen:!0,auto_focus:!0,component:[{componentName:"uploader",data:{pid:n,emitGo:F}}]})}W();function R(){var t;const n=K.copyObject(d);u.id_tag&&(n.id_tag=u.id_tag),u.id_dir&&(n.id_dir=u.id_dir);let e=!1;d.rate&&(e=!0),(t=d.keyword)!=null&&t.trim()&&(e=!0),d.node_type&&d.node_type!="any"&&(e=!0),e?n.mode="search":n.mode="directory",l.go(n)}function F(n,e){switch(console.info("emitGo",n,e),n){case"reload":k();break;case"tag":l.go({mode:"directory",id_tag:`${e}`});break;case"node":let t;for(let i=0;i<p.value.length;i++)if(p.value[i].id===e){t=p.value[i];break}if(!t)break;switch(t.type){case"directory":l.go({mode:"directory",id_dir:`${t.id}`});break;default:le(K.copyObject(u),t.id??0);break}break}}Y(async()=>{console.info("onMounted"),f.query&&N(f.query),l=new Z({route:f,router:D,getList:k,contentDOM:_.value,emitGo:F}),await k()&&(l.reloadScroll(),document.addEventListener("keydown",E))}),Q(()=>{l.destructor(),document.removeEventListener("keydown",E)});function E(n){const e=[];switch(n.ctrlKey&&e.push("ctrl"),n.shiftKey&&e.push("shift"),e.push(n.code),e.join("_")){default:return;case"ctrl_KeyU":if(f.name!=="Directory"||!(c.value.length||u.id_dir))return;l&&l.showSelectionOp&&(n.preventDefault(),I());break;case"ctrl_KeyM":if(f.name!=="Directory"||!(c.value.length||u.id_dir))return;l&&l.showSelectionOp&&(n.preventDefault(),B());break;case"ctrl_KeyC":case"ctrl_KeyV":case"ctrl_KeyX":if(f.name!=="Directory"||ee(n.target))return;U(e);break;case"Enter":case"NumpadEnter":if(!n.target||n.target.id!=="searchBarInput")return;R();break}}function j(n){(c.value.length||u.id_dir)&&(n.stopPropagation(),n.preventDefault(),I())}async function U(n){console.info(n,c.value,u.id_dir);let e;switch(n.join("_")){case"ctrl_KeyC":if(e=l.getSelected(),!e.nodeLs.length)return;y.nodeList=e.nodeLs,y.mode="copy";break;case"ctrl_KeyX":if(e=l.getSelected(),!e.nodeLs.length)return;y.nodeList=e.nodeLs,y.mode="cut";break;case"ctrl_KeyV":if(!y.nodeList.length||!u.id_dir)return;await y.doPaste(u.id_dir),await k();break}}return(n,e)=>(s(),r("div",{class:"fr_content view_file",onDragover:j},[a("div",ie,[o(c).length?(s(),r("div",ue,[(s(!0),r(m,null,b(o(c),(t,i)=>(s(),r("a",{dir:"ltr",class:"item",key:i,onClick:O=>o(l).go({id_dir:`${t==null?void 0:t.id}`,mode:"directory"}),title:t.title},h(t.title),9,de))),128))])):v("",!0),a("div",ce,[a("label",null,[e[13]||(e[13]=a("span",null,"Title : ",-1)),g(a("input",{id:"searchBarInput",type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>o(d).keyword=t)},null,512),[[te,o(d).keyword]])]),a("label",null,[e[14]||(e[14]=a("span",null,"Type : ",-1)),g(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>o(d).node_type=t)},[(s(!0),r(m,null,b(o(S).fileType,(t,i)=>(s(),r("option",{key:`FV_SCH_NODE_TYPE_${i}`},h(t),1))),128))],512),[[V,o(d).node_type]])]),a("label",null,[e[15]||(e[15]=a("span",null,"Rate : ",-1)),H?g((s(),r("select",{key:0,class:"sysIcon","onUpdate:modelValue":e[2]||(e[2]=t=>o(d).rate=t)},[(s(!0),r(m,null,b(o(S).rateMobile,(t,i)=>(s(),r("option",{value:i,innerHTML:t,key:`FV_SCH_CON_RATE_${i}`},null,8,ye))),128))],512)),[[V,o(d).rate]]):g((s(),r("select",{key:1,class:"sysIcon","onUpdate:modelValue":e[3]||(e[3]=t=>o(d).rate=t)},[(s(!0),r(m,null,b(o(S).rate,(t,i)=>(s(),r("option",{value:i,innerHTML:t,key:`FV_SCH_CON_RATE_${i}`},null,8,fe))),128))],512)),[[V,o(d).rate]])]),a("label",null,[e[16]||(e[16]=a("span",null,"Cascade : ",-1)),g(a("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=t=>o(d).cascade_dir=t),id:"FV_S_CB","true-value":1,"false-value":""},null,512),[[ne,o(d).cascade_dir]]),e[17]||(e[17]=a("label",{class:"buttonStyle",for:"FV_S_CB"},null,-1))]),a("label",null,[a("button",{class:"buttonStyle sysIcon sysIcon_search",onClick:R})])]),a("div",pe,[o(l)&&o(l).showSelectionOp?(s(),r(m,{key:0},[a("a",{class:"buttonStyle",onClick:e[5]||(e[5]=t=>o(l).bathOp("browser"))},"OP"),a("a",{class:"buttonStyle",onClick:e[6]||(e[6]=t=>o(l).bathOp("favourite"))},"FAV"),a("a",{class:"buttonStyle",onClick:e[7]||(e[7]=t=>o(l).bathOp("rename"))},"RN"),a("a",{class:"buttonStyle",onClick:e[8]||(e[8]=t=>o(l).bathOp("move"))},"MV"),o(f).name!=="Recycle"?(s(),r("a",{key:0,class:"buttonStyle",onClick:e[9]||(e[9]=t=>o(l).bathOp("delete"))},"DEL")):v("",!0),o(f).name==="Recycle"?(s(),r("a",{key:1,class:"buttonStyle",onClick:e[10]||(e[10]=t=>o(l).bathOp("delete_forever"))},"rDEL")):v("",!0),e[18]||(e[18]=a("a",{class:"sysIcon sysIcon_fengefu"},null,-1))],64)):v("",!0),o(c).length||o(u).id_dir=="0"?(s(),r(m,{key:1},[a("a",{class:"buttonStyle sysIcon sysIcon_addfolder",onClick:B}),a("a",{class:"buttonStyle sysIcon sysIcon_addfile",onClick:I}),e[19]||(e[19]=a("a",{class:"buttonStyle sysIcon sysIcon_fengefu"},null,-1))],64)):v("",!0),o(l)&&o(l).sortVal?(s(),r("label",me,[e[20]||(e[20]=a("span",null,"Sort : ",-1)),g(a("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>o(l).sortVal.value=t),onChange:e[12]||(e[12]=t=>o(l).setSort(o(l).sortVal.value))},[(s(!0),r(m,null,b(o(S).sort,(t,i)=>(s(),r("option",{value:i,key:`FV_SCH_CON_SORT_${i}`},h(t),9,ve))),128))],544),[[V,o(l).sortVal.value]])])):v("",!0),e[21]||(e[21]=a("a",{class:"sysIcon sysIcon_fengefu"},null,-1)),o(l)?(s(!0),r(m,{key:3},b(o(S).listType,(t,i)=>(s(),r("a",{class:M(["buttonStyle","sysIcon",`sysIcon_listType_${t}`,{active:o(l).mode.value===t}]),onClick:O=>o(l).setMode(t),key:`FAV_SCH_BTN_${i}`},null,10,_e))),128)):v("",!0)]),o(y)&&o(y).nodeList.length?(s(),r("div",be,[a("span",{class:M(["sysIcon",`sysIcon_${o(y).mode}`])},h(o(y).nodeList.length),3)])):v("",!0)]),a("div",{class:M(["content_detail",`mode_${o(l)?o(l).mode.value:""}`]),ref_key:"contentDOM",ref:_},[(s(!0),r(m,null,b(o(p),(t,i)=>(s(),oe(ae,{key:t.id,node:t,index:i,selected:!1,onGo:F},null,8,["node","index"]))),128))],2)],32))}});export{we as _};

import{d as le,r as S,o as oe,q as se,J as w,c as u,e as o,n as m,F as y,f,V as b,a6 as ne,u as a,W as g,U as A,H as q,b as i,t as V,a9 as P,D as I,C as $,aa as z,R as ae}from"./basic-CIm7r3-8.js";import{o as ie,a as ue,p as re,u as de,b as ce}from"./index-BuoivbTF.js";import{_ as J}from"./ContentEditable.vue_vue_type_script_setup_true_lang-DzChvZgB.js";import{R as _e,F as ye}from"./FileItem-hxmEpS1D.js";import{H as K}from"./Hinter-4wArhNYi.js";const fe={class:"fr_content view_fav"},ve={class:"list_fav_group"},pe=["onClick"],ke={class:"title"},me=["onClick"],be=["onClick"],Ce={class:"operator"},Ve=["onClick"],we=["onClick"],$e=["onUpdate:modelValue"],Se=["value"],ge={class:"favTagLs"},Ie=["onClick"],he=["onUpdate:modelValue","id"],Oe=["for"],Ge=["onUpdate:modelValue","id"],Ue=["for"],Ae=["onClick"],De={class:"title"},Te=["onClick"],Ee=["onClick"],Fe={class:"operator"},Me=["onClick"],Le=["onClick"],Re={class:"content_meta"},Ne={class:"search"},je=["value"],Be=["value","innerHTML"],He={key:0,class:"display"},qe={key:2},Pe=["value"],ze=["onClick"],Ze=le({__name:"Favourite",setup(Je){const D=S(null),T=de(),v=ce();let p={id:"",keyword:""};const c=S([]),E=S(null),C=S(-1),Q=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1;oe(async()=>{p.id=v.query.id??"",await Y(),r=new ie({route:v,router:T,getList:G,contentDOM:D.value,emitGo:j}),p.id&&(M(),R(v.query),await G(),await r.reloadScroll()),document.addEventListener("keydown",B)}),se(()=>{r.destructor(),document.removeEventListener("keydown",B)}),ue(async l=>{console.info(l),p.id=l.query.id??"",p.id&&(M(),R(l.query),await G())});async function Y(){const l=await w("favourite_group/get",p);l&&(l.forEach(e=>{e.edit=!1,e.ext_key=e.id}),c.value=l||[])}async function h(l){const e=c.value[l];await w("favourite_group/del",e),location.reload()}async function O(l){console.info(c.value[l]);const e=q.copyObject(c.value[l]);if(e.edit){c.value[l].edit=!1,e.meta=JSON.stringify(e.meta);const t=await w("favourite_group/mod",e);if(!t)return;c.value[l].id=parseInt(t.id??"")}else c.value[l].edit=!0}function F(l){c.value.unshift({title:"",status:1,auto:l,meta:{node_type:"any",id_tag:"",rate:"",id_dir:"",cascade_dir:"1",tag_or:"1"},edit:!0,ext_key:new Date().valueOf()})}function M(){if(!p.id)return;let l=parseInt(p.id);c.value.forEach((e,t)=>{l===e.id&&(C.value=t,E.value=e)})}async function L(l){const e=c.value[l];T.push({path:v.path,query:{id:e.id}})}let _={mode:"directory",id_dir:"",id_tag:""},d={keyword:"",node_type:"",rate:"",cascade_dir:"1"};function R(l){if(l){for(let e in _)if(Object.prototype.hasOwnProperty.call(_,e))switch(e){default:_[e]=l[e]??"";break;case"mode":_[e]=l[e]??"directory";break;case"id_dir":_[e]=l[e]??"";break}for(let e in d)if(Object.prototype.hasOwnProperty.call(d,e))switch(e){default:d[e]=l[e]??"";break;case"cascade_dir":d[e]=l[e]??"1";break}}}const k=S([]);let r;function N(){const l=q.copyObject(d);_.id_tag&&(l.id_tag=_.id_tag),_.id_dir&&(l.id_dir=_.id_dir),!d.rate&&!d.node_type&&!d.keyword.trim()?l.mode="directory":l.mode="search",r.go(l)}async function G(l){var e;if(console.info("getList",v.name),k.value=[],l)k.value=l;else{switch(v.name){default:break;case"Recycle":_.status="deleted";break;case"Favourite":break}let t={id_fav:(e=E.value)==null?void 0:e.id};switch(_.mode){case"directory":t=Object.assign(t,_);break;case"search":t=Object.assign(t,_,d);break}const s=await w("file/get",t);if(!s)return;k.value=r.sortList(s.list,r.sortVal.value)}r&&r.setList(k.value)}function j(l,e){switch(l){case"reload":G();break;case"tag":r.go({id_tag:`${e}`,mode:"tag"});break;case"node":let t;for(let s=0;s<k.value.length;s++)if(k.value[s].id===e){t=k.value[s];break}if(!t)break;switch(t.type){case"directory":r.go({id_dir:`${t.id}`,mode:"directory"});break;default:re({mode:"favourite",id_fav:p.id,with:"file,crumb"},t.id??0);break}break}}function B(l){const e=[];switch(l.ctrlKey&&e.push("ctrl"),l.shiftKey&&e.push("shift"),e.push(l.code),e.join("_")){default:return;case"NumpadEnter":case"Enter":if(!l.target||l.target.id!=="searchBarInput")return;N();break}}async function x(l){console.info("node_hint");const t=await w("file/get",{mode:"search",node_type:"directory",keyword:l,with:"crumb",limit:"20"});return t?("root".indexOf(l)!==-1&&t.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),t.list):!1}function W(l,e){console.info("node_add",l,e);const t=c.value[e];t.meta=Object.assign(t.meta??{},{pid:l.id}),c.value[e].node=l}function X(l){var t;if(console.info("node_parse"),!l)return"";const e=[];return(t=l.crumb_node)==null||t.forEach(s=>{s.title&&e.push(s.title)}),l.title&&e.push(l.title),`/ ${e.join(" / ")}`}async function Z(l){const e=new FormData;return e.set("keyword",l),e.set("size","20"),await w("tag/get",e)}function ee(l,e){const t=c.value[e];t.tag||(t.tag=[]),t.tag.push(l);const s=[];t.tag.forEach(n=>s.push(n.id??0)),t.meta=Object.assign(t.meta??{},{id_tag:s.join(",")})}function H(l){return l?`${l.group.title} : ${l.title}`:""}function te(l,e){const t=c.value[l];t.tag||(t.tag=[]),t.tag.splice(e,1);const s=[];t.tag.forEach(n=>s.push(n.id??0)),t.meta=Object.assign(t.meta??{},{id_tag:s.join(",")})}return(l,e)=>(i(),u("div",fe,[o("div",ve,[o("div",{class:m({fav_group:!0,fav_group_add:!0,active:C.value===-1})},[o("span",{class:"buttonStyle sysIcon sysIcon_plus-square-o",onClick:e[0]||(e[0]=t=>F(0))}),o("span",{class:"buttonStyle sysIcon sysIcon_A",onClick:e[1]||(e[1]=t=>F(1))})],2),(i(!0),u(y,null,f(c.value,(t,s)=>(i(),u("div",{key:`favView_group_${t.ext_key?t.ext_key:t.id}`,class:m({active:C.value===s,fav_group:!0,edit:t.edit})},[t.auto?(i(),u(y,{key:0},[t.edit?(i(),u("div",{key:1,class:m({active:C.value==s,auto:!0})},[I(J,{class:"title",modelValue:t.title,"onUpdate:modelValue":n=>t.title=n,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),o("div",Ce,[o("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:n=>O(s)},null,8,Ve),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>h(s)},null,8,we)]),o("table",null,[o("tbody",null,[o("tr",null,[e[15]||(e[15]=o("td",null,"nodeType",-1)),o("td",null,[b(o("select",{"onUpdate:modelValue":n=>t.meta.node_type=n},[(i(!0),u(y,null,f(a($).fileType,(n,U)=>(i(),u("option",{value:n,key:`FAV_G_${t.ext_key}_NODE_TYPE_${U}`},V(n),9,Se))),128))],8,$e),[[g,t.meta.node_type]])])]),o("tr",null,[e[16]||(e[16]=o("td",null,"withTag",-1)),o("td",ge,[o("div",null,[(i(!0),u(y,null,f(t.tag,(n,U)=>(i(),u("p",{key:`FAV_G_${t.ext_key}_TAG_BTN_${U}`},[o("span",null,V(H(n)),1),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:Ke=>te(s,U)},null,8,Ie)]))),128))]),I(K,{"get-list":Z,submit:ee,"parse-text":H,meta:s},null,8,["meta"])])]),o("tr",null,[e[17]||(e[17]=o("td",null,"or",-1)),o("td",null,[b(o("input",{type:"checkbox","onUpdate:modelValue":n=>t.meta.tag_or=n,id:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_TAG_OR`,"true-value":"1","false-value":""},null,8,he),[[z,t.meta.tag_or]]),o("label",{class:"buttonStyle",for:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_TAG_OR`},null,8,Oe)])]),o("tr",null,[e[18]||(e[18]=o("td",null,"root",-1)),o("td",null,[I(K,{"get-list":x,submit:W,"parse-text":X,modelValue:t.node,"onUpdate:modelValue":n=>t.node=n,meta:s},null,8,["modelValue","onUpdate:modelValue","meta"])])]),o("tr",null,[e[19]||(e[19]=o("td",null,"cascade",-1)),o("td",null,[b(o("input",{type:"checkbox","onUpdate:modelValue":n=>t.meta.cascade_dir=n,id:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_CASCADE`,"true-value":"1","false-value":""},null,8,Ge),[[z,t.meta.cascade_dir]]),o("label",{class:"buttonStyle",for:`FAV_G_CB_S_${t.ext_key?t.ext_key:t.id}_CASCADE`},null,8,Ue)])]),o("tr",null,[e[20]||(e[20]=o("td",null,"rate",-1)),o("td",null,[I(_e,{node:null,modelValue:t.meta.rate,"onUpdate:modelValue":n=>t.meta.rate=n},null,8,["modelValue","onUpdate:modelValue"])])])])])],2)):(i(),u("div",{key:0,class:m({active:C.value==s,auto:!0}),onClick:n=>L(s)},[o("div",ke,V(t.title),1),o("div",{class:"operator",onClick:e[2]||(e[2]=P(()=>{},["stop"]))},[o("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:n=>O(s)},null,8,me),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>h(s)},null,8,be)])],10,pe))],64)):(i(),u(y,{key:1},[t.edit?(i(),u("div",{key:1,class:m({active:C.value==s})},[I(J,{class:"title",modelValue:t.title,"onUpdate:modelValue":n=>t.title=n,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),o("div",Fe,[o("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:n=>O(s)},null,8,Me),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>h(s)},null,8,Le)])],2)):(i(),u("div",{key:0,class:m({active:C.value==s}),onClick:n=>L(s)},[o("div",De,V(t.title),1),o("div",{class:"operator",onClick:e[3]||(e[3]=P(()=>{},["stop"]))},[o("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:n=>O(s)},null,8,Te),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>h(s)},null,8,Ee)])],10,Ae))],64))],2))),128))]),o("div",{class:"fav_content",ref_key:"contentDOM",ref:D},[o("div",Re,[o("div",Ne,[o("label",null,[e[21]||(e[21]=o("span",null,"Title : ",-1)),b(o("input",{id:"searchBarInput",type:"text","onUpdate:modelValue":e[4]||(e[4]=t=>a(d).keyword=t)},null,512),[[ne,a(d).keyword]])]),o("label",null,[e[22]||(e[22]=o("span",null,"Type : ",-1)),b(o("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>a(d).node_type=t)},[(i(!0),u(y,null,f(a($).fileType,(t,s)=>(i(),u("option",{key:`FAV_SCH_CON_TYPE_${s}`},V(t),1))),128))],512),[[g,a(d).node_type]])]),o("label",null,[e[23]||(e[23]=o("span",null,"Rate : ",-1)),Q?b((i(),u("select",{key:0,"onUpdate:modelValue":e[6]||(e[6]=t=>a(d).rate=t)},[(i(!0),u(y,null,f(a($).rateMobile,(t,s)=>(i(),u("option",{value:s,key:`FAV_SCH_CON_RATE_${s}`},V(t),9,je))),128))],512)),[[g,a(d).rate]]):b((i(),u("select",{key:1,class:"sysIcon","onUpdate:modelValue":e[7]||(e[7]=t=>a(d).rate=t)},[(i(!0),u(y,null,f(a($).rate,(t,s)=>(i(),u("option",{value:s,innerHTML:t,key:`FAV_SCH_CON_RATE_${s}`},null,8,Be))),128))],512)),[[g,a(d).rate]])]),o("label",null,[o("button",{class:"buttonStyle sysIcon sysIcon_search",onClick:N})])]),a(r)&&a(r).showSelectionOp?(i(),u("div",He,[o("a",{class:"buttonStyle",onClick:e[8]||(e[8]=t=>a(r).bathOp("browser"))},"OP"),o("a",{class:"buttonStyle",onClick:e[9]||(e[9]=t=>a(r).bathOp("rename"))},"RN"),o("a",{class:"buttonStyle",onClick:e[10]||(e[10]=t=>a(r).bathOp("move"))},"MV"),a(v).name!=="Recycle"?(i(),u("a",{key:0,class:"buttonStyle",onClick:e[11]||(e[11]=t=>a(r).bathOp("delete"))},"DEL")):A("",!0),a(v).name==="Recycle"?(i(),u("a",{key:1,class:"buttonStyle",onClick:e[12]||(e[12]=t=>a(r).bathOp("delete_forever"))},"rDEL")):A("",!0),e[25]||(e[25]=o("a",{class:"sysIcon sysIcon_fengefu"},null,-1)),a(r)&&a(r).sortVal?(i(),u("label",qe,[e[24]||(e[24]=o("span",null,"Sort : ",-1)),b(o("select",{"onUpdate:modelValue":e[13]||(e[13]=t=>a(r).sortVal.value=t),onChange:e[14]||(e[14]=t=>a(r).setSort(l.sortVal))},[(i(!0),u(y,null,f(a($).sort,(t,s)=>(i(),u("option",{value:s,key:`FV_SCH_CON_SORT_${s}`},V(t),9,Pe))),128))],544),[[g,a(r).sortVal.value]])])):A("",!0),e[26]||(e[26]=o("a",{class:"sysIcon sysIcon_fengefu"},null,-1)),(i(!0),u(y,null,f(a($).listType,(t,s)=>(i(),u("a",{class:m(["buttonStyle","sysIcon",`sysIcon_listType_${t}`,{active:a(r).mode.value===t}]),onClick:n=>a(r).setMode(t),key:`FAV_SCH_CON_ICON_${s}`},null,10,ze))),128))])):A("",!0)]),o("div",{class:m(["list_fav",`mode_${a(r)?a(r).mode.value:""}`])},[(i(!0),u(y,null,f(k.value,(t,s)=>(i(),ae(ye,{key:s,node:t,index:s,selected:!1,onGo:j},null,8,["node","index"]))),128))],2)],512)]))}});export{Ze as default};

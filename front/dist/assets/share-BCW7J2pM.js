import{d as ne,r as d,o as ae,C as W,c as u,e as l,t as w,Q as m,F as b,g as _,n as M,f as X,N as se,O as x,T as le,a2 as ie,D as oe,G,_ as re,U as ue,V as ce,W as de,X as ve,Y as J,b as r,R as pe,a4 as Ae,P as Q,a7 as fe,a8 as we}from"./basic-cwdvCeQw.js";const ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAF1mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0ZURhdGU9IjIwMjUtMDQtMjlUMTk6NTk6MzQrMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDI1LTA1LTI1VDAwOjQ5OjAxKzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI1LTA1LTI1VDAwOjQ5OjAxKzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjVlMmU1MGU4LTg3ZmQtN2M0My04NGE3LTk4NjVkMmExMGY5MiIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmFkYjg3ZWVhLWIyZWYtODA0Ni1hZjE5LTg2ZmI4MDA4ZTFkZiIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjM3NzYzOTg3LTEzNWYtZWU0Ny1iYWNlLTBjZDNiMGNmNGNkOCI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjM3NzYzOTg3LTEzNWYtZWU0Ny1iYWNlLTBjZDNiMGNmNGNkOCIgc3RFdnQ6d2hlbj0iMjAyNS0wNS0yNVQwMDo0OTowMSswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo1ZTJlNTBlOC04N2ZkLTdjNDMtODRhNy05ODY1ZDJhMTBmOTIiIHN0RXZ0OndoZW49IjIwMjUtMDUtMjVUMDA6NDk6MDErMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE4IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6TS4caAAABQklEQVR4nO3d0YnCQBRA0Sj+by/biZXaib1sBbMdJELE88B7fhUyeHmYcRQva60tzlUv4NsVACsAVgCsAFgBsAJgt6Mn/G3b8xMLOeFXL2DPz8HjTQBWAKwAWAGwAmAFwAqAHe4DXjD6Pny6JgArAFYArABYAbACYAXACoAVACsAVgDsHZ8FnXXH13/IizcBWAGwAmAFwAqAFQArADZhH0Dvw7UmACsAVgCsAFgBsAJgBcAm7AM6D4hTAKwA2CvvAX3/f9/R76h3X78mACsAVgBswj6g84A4BcAKgBUAKwBWAKwA2IR9QOcBcQqAFQArAFYArABYAbAJ+4DOA+IUACsAVgCsAFgBsAJgBcAKgBUAKwA24bOgs6b/z9muJgArAFYArABYAbACYAXALmstvYav1gRgBcAKgBUAKwBWAKwA2D94NhAMfrN7rgAAAABJRU5ErkJggg==",he={class:"sh_fr_header"},Ie={class:"operator"},ge={key:0,class:"err_msg"},me={class:"sh_fr_list"},be=["id","value"],ke=["for"],De=["onClick"],Ne={class:"operates"},_e={key:0},Me=["onClick"],Re=["onClick"],Ce=["onClick"],Ge={key:0},Le={class:"preLine"},Oe={class:M({pagination:1,isMobile:!1})},Ze={class:"sh_fr_footer"},Be=ne({__name:"share",setup(Te){const L=d(""),h=d(0);let I="";const p=d([]),O=d(null),Z=d(null),k=d([]),D=d(null);ae(async()=>{const e=new URL(location.href);B(e)});function j(e,n){const t=new URL(location.href);t.searchParams.set("id",e),n?t.searchParams.set("node",n.toString()):t.searchParams.delete("node"),history.pushState(null,"",t),B(t)}addEventListener("popstate",e=>{B(new URL(location.href))});async function B(e){if(I=e.searchParams.get("id")??"",!I)return C("invalid uuid");let n=e.searchParams.get("node");k.value=[];const t=await U(I,n??!1);if(!t)return C("data fetch failed");p.value=t.node??[],Z.value=t.parent??null,O.value=t.cur}const E=d(""),P=d("");async function R(e,n){var t;if(e.type==="directory")j(I,e.id);else{if(!((t=e==null?void 0:e.file_index)!=null&&t.raw))return;switch(n){default:return await T("single",e);case"detail":c.value=e,p.value.forEach((s,a)=>{s.type!="directory"&&s.id==e.id&&(v.value=a)}),V(),h.value=1,setTimeout(()=>{var s,a;z.value={h:((s=D.value)==null?void 0:s.clientHeight)??0,w:((a=D.value)==null?void 0:a.clientWidth)??0}},10);break}}}async function T(e,n){const t=[];switch(e){case"list":k.value.forEach(a=>{p.value.forEach(o=>{o.id===a&&t.push(o)})});break;case"total":p.value.forEach(a=>{t.push(a)});break;case"single":n&&t.push(n);break}if(!t.length)return;console.info(t);const s=new oe(S("",t),async a=>{const o=await U(I,a.id);return o?S(a.path,o.node??[]):[]});await s.prepare(),await s.download((a,o,i,A,f)=>{let N=(a+o)/i;N*=1e4,N=Math.round(N),N/=100,E.value=`${A}/${f} Files, ${N}%, ${G.kmgt(o)} / ${G.kmgt(i)}`,P.value=`width: ${N}%;`}),console.info(t.length===1,t[0].type!=="directory"),t.length===1&&t[0].type!=="directory"?await s.completeFile():(await s.build(),s.complete())}async function U(e,n){return await te("share/node_list",n?{id:e,id_node:n}:{id:e})}function S(e,n){const t=[];return n.forEach(s=>{var o;const a={id:s.id,id_parent:s.id_parent,path:"",url:"",size:0,type:s.type??""};if(a.path=[e??"",s.title??""].join("/"),s.type!=="directory"){const i=(o=s.file_index)==null?void 0:o.raw;if(!i)return;a.url=y(s,"raw"),a.size=i.size??0}t.push(a)}),t}function y(e,n="raw"){if(!e.file_index[n])return"";let t=new URL(location.href).pathname;return t.substring(0,t.lastIndexOf("/"))+e.file_index[n].path+"?shareId="+I+"&filename="+e.title}const Y={audio:re,video:ue,image:ce,pdf:de,text:ve,office:J,base:J};let v=d(-1);const c=d(null),F=d({id:0,title:"",cover:"",preview:"",normal:"",raw:"",sameName:[]}),z=d({w:0,h:0});function $(e){let n=e-v.value;g(v.value,n)}function g(e,n,t=0){let s=p.value.length;if(s<1)return;let a=e;do{for(a=a+n;a<0;)a+=s;for(;a>s-1;)a-=s;if(t||(t=0),t+=1,t>s)return;console.info(a)}while(!p.value[a]||p.value[a].type==="directory");v.value=a,V()}function V(){const e=p.value[v.value];if(c.value=e,!e.file_index.preview&&["audio","video"].indexOf(e.type)!==-1){let s=!1;p.value.forEach(a=>{if(a.id_parent!==e.id_parent||s)return;let o=!1;if(W.coverKeyword.forEach(i=>{W.imgKeyword.forEach(A=>{e.title.toLowerCase().indexOf(i)!==-1&&e.title.toLowerCase().indexOf(A)!==-1&&(o=!0)})}),o){s=!0;let i;i||(i=e.file_index.preview),i||(i=e.file_index.normal),i||(i=e.file_index.raw),e.file_index.preview=i}})}const n={id:e.id,title:e.title,cover:y(e,"cover"),preview:y(e,"preview"),normal:y(e,"normal"),raw:y(e,"raw"),sameName:[]};let t=n.title.lastIndexOf(".");if(t!==-1){let s=n.title.substring(0,t)??"";s&&p.value.forEach(a=>{var i,A;if(a.id==n.id||((i=a.title)==null?void 0:i.indexOf(s))!==0)return;let o=(A=a.title)==null?void 0:A.substring(s.length);n.sameName.push({title:o,type:a.type??"",preview:y(a,"preview"),normal:y(a,"normal"),raw:y(a,"raw")})})}F.value=n,console.warn(n)}function K(){setTimeout(()=>{var e,n;D.value&&(z.value={h:((e=D.value)==null?void 0:e.clientHeight)??0,w:((n=D.value)==null?void 0:n.clientWidth)??0})},10)}window.addEventListener("resize",K);function q(){v.value=-1,c.value=null,h.value=0}async function ee(e){if(c.value)switch(e.key){case"ArrowLeft":if(e.preventDefault(),e.stopPropagation(),["audio","video"].indexOf(c.value.type??"")!==-1)return;g(v.value,-1);break;case"ArrowRight":if(e.preventDefault(),e.stopPropagation(),["audio","video"].indexOf(c.value.type??"")!==-1)return;g(v.value,1);break;case"a":case"PageUp":e.preventDefault(),e.stopPropagation(),g(v.value,-1);break;case"d":case"PageDown":e.preventDefault(),e.stopPropagation(),g(v.value,1);break}}document.addEventListener("keydown",ee);function te(e,n,t){return new Promise((s,a)=>{let o;if(n instanceof FormData)o=n;else{o=new FormData;for(const f in n)Object.prototype.hasOwnProperty.call(n,f)&&o.append(f,n[f])}const i=new XMLHttpRequest;i.withCredentials=!0,i.onreadystatechange=function(){if(i.readyState!==4)return;if(i.status>=400)return C(`${i.status}: ${i.statusText}`);const f=JSON.parse(i.responseText);f.code&&C(f.msg),s(f.data)};let A=new URL(location.href).pathname;i.open("POST",A.substring(0,A.lastIndexOf("/"))+W.apiPath+e),i.send(o)})}function C(e){throw L.value=e,new Error(e)}return(e,n)=>(r(),u(b,null,[l("div",he,[n[7]||(n[7]=l("div",null,[l("img",{src:ye}),l("span",null,"MyNas Share")],-1)),l("div",Ie,[k.value.length?(r(),u("span",{key:0,class:"pointer sysIcon sysIcon_download",onClick:n[0]||(n[0]=t=>T("list"))},w(k.value.length)+" Selected",1)):m("",!0),l("span",{class:"pointer sysIcon sysIcon_download",onClick:n[1]||(n[1]=t=>T("total"))},"Down All"),h.value?(r(),u("span",{key:1,class:"pointer sysIcon sysIcon_forward",onClick:n[2]||(n[2]=t=>q())},"Close")):m("",!0)])]),l("div",{class:M({sh_fr_body:!0,showDetail:h.value})},[L.value.length?(r(),u("p",ge,w(L.value),1)):(r(),u(b,{key:1},[l("ul",me,[O.value&&O.value.id?(r(),u("li",{key:0,class:"pointer",onClick:n[3]||(n[3]=t=>j(_(I),Z.value?Z.value.id:0))},n[8]||(n[8]=[l("p",null,[l("span",{class:M(["thumb","listIcon","listIcon_file_directory"])}),l("span",null,"../")],-1)]))):m("",!0),(r(!0),u(b,null,X(p.value,t=>{var s,a;return r(),u("li",{key:t.id},[l("p",null,[pe(l("input",{type:"checkbox",name:"selector",id:`selector_${t.id}`,value:t.id,"onUpdate:modelValue":n[4]||(n[4]=o=>k.value=o)},null,8,be),[[Ae,k.value]]),l("label",{for:`selector_${t.id}`,class:"pointer"},null,8,ke),l("span",{class:M(["thumb","listIcon",`listIcon_file_${t.type}`])},null,2),l("span",{class:"pointer title",onClick:o=>R(t,"detail")},w(t.title),9,De)]),l("p",Ne,[t.type!=="directory"?(r(),u("span",_e,w(_(G).kmgt(((a=(s=t==null?void 0:t.file_index)==null?void 0:s.raw)==null?void 0:a.size)??0)),1)):m("",!0),t.type==="directory"?(r(),u("span",{key:1,class:"pointer sysIcon sysIcon_folder",onClick:o=>R(t)},null,8,Me)):(r(),u(b,{key:2},[l("span",{class:"pointer sysIcon sysIcon_eye",onClick:o=>R(t,"detail")},null,8,Re),l("span",{class:"pointer sysIcon sysIcon_download",onClick:o=>R(t)},null,8,Ce)],64))])])}),128))]),c.value&&h.value?(r(),u("div",{key:0,class:"sh_fr_detail",ref_key:"detailDOM",ref:D,"data-ref-id":"1"},[(r(),se(le(Y[c.value.type]?Y[c.value.type]:Y.base),{extId:"1",isActive:!0,curIndex:0,file:F.value,dom:z.value,onNav:$},{info:x(()=>{var t,s;return[l("div",{class:M({info:!0,detail:h.value})},[h.value?(r(),u(b,{key:0},[l("p",null,w(c.value.title)+" ("+w(_(G).kmgt(((s=(t=c.value.file_index)==null?void 0:t.raw)==null?void 0:s.size)??0,2))+") ",1),c.value.crumb_node?(r(),u("p",Ge,[n[9]||(n[9]=Q("Dir : ")),(r(!0),u(b,null,X(c.value.crumb_node,a=>(r(),u(b,null,[Q("/"+w(a.title),1)],64))),256))])):m("",!0),l("p",Le,w(c.value.description),1)],64)):m("",!0)],2)]}),btnContainer:x(()=>n[10]||(n[10]=[])),navigator:x(()=>[l("div",Oe,[l("div",{class:"left",onClick:n[5]||(n[5]=t=>g(_(v),-1))},n[11]||(n[11]=[l("span",{class:"sysIcon sysIcon_arrowleft"},null,-1)])),l("div",{class:"right",onClick:n[6]||(n[6]=t=>g(_(v),1))},n[12]||(n[12]=[l("span",{class:"sysIcon sysIcon_arrowright"},null,-1)]))])]),_:1},40,["file","dom"]))],512)):m("",!0)],64))],2),l("div",Ze,[l("div",{class:"process",style:ie(P.value)},w(E.value),5)])],64))}}),H=fe(Be);H.use(we());H.mount("#app");

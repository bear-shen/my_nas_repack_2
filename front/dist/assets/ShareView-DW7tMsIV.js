import{u as $,b as x,q as v,c as L,d as j}from"./index-D3yuVujM.js";import{a as C,r as g,o as M,G as m,j as S,c as l,e as n,F as o,f as k,b as s,t as i,M as h,A as b}from"./basic-BYt0z23_.js";const V=["href"],q={class:"multi"},B=["onClick"],N=C({__name:"ShareView",setup(E){$();const r=g(null);L();const D=j();let y={status:""};const _=g([]);M(async()=>{Object.assign(y,m.copyObject(D.query)),d(),r.value&&r.value.addEventListener("scroll",p)}),x(async a=>{console.info(a),d()}),S(()=>{var a;r.value&&((a=r.value)==null||a.removeEventListener("scroll",p))});async function p(a){if(console.info(a),!r.value)return;let e=r.value,t=(e==null?void 0:e.scrollTop)+(e==null?void 0:e.clientHeight)+(e==null?void 0:e.clientHeight);(e==null?void 0:e.scrollHeight)<t&&m.debounce(async()=>{await d()},500,"logViewDebounce")}let c=1,f=!1;async function d(a=!1){if(f)return;f=!0,a&&(c=1);const e=await v("share/list",Object.assign({page:c},y));if(c+=1,f=!1,!e)return;if(!e.length){c--;return}const t=a?[]:_.value;for(let u=0;u<e.length;u++)t.push(Object.assign(e[u],{ext_key:`${new Date().valueOf()}_${Math.random()}`}));_.value=t}async function O(a){await v("share/del",{id:a}),await d(!0)}return(a,e)=>(s(),l("div",{class:"fr_content view_share",ref_key:"contentDOM",ref:r},[n("table",null,[n("tbody",null,[e[0]||(e[0]=n("tr",null,[n("th",null,"id"),n("th",null,"user"),n("th",null,"path"),n("th",null,"time_to"),n("th",null,"time_create"),n("th",null,"time_update"),n("th",null,"operate")],-1)),(s(!0),l(o,null,k(_.value,t=>(s(),l("tr",{key:`share_view_${t.ext_key}`},[n("td",null,[n("a",{href:`./share.html?id=${t.id}`,target:"_blank"},i(t.id),9,V)]),n("td",null,i(t.user.name),1),n("td",null,[n("div",q,[(s(!0),l(o,null,k(t.node,u=>(s(),l("p",{key:`share_view_${t.ext_key}_${u.id}`},i(u.node_path)+"/"+i(u.title),1))),128))])]),n("td",null,[t.status===0?(s(),l(o,{key:1},[h("Stopped")],64)):t.status===1?(s(),l(o,{key:2},[h(i(t.time_to),1)],64)):t.status===2?(s(),l(o,{key:3},[h("Long")],64)):b("",!0)]),n("td",null,i(t.time_create),1),n("td",null,i(t.time_update),1),n("td",null,[t.status!==0?(s(),l("button",{key:0,class:"sysIcon sysIcon_delete",onClick:u=>O(t.id)},"Delete ",8,B)):b("",!0)])]))),128))])])],512))}});export{N as default};

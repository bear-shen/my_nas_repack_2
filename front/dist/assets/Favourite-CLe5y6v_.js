import{d as se,u as oe,a as ae,r as $,b as le,e as ne,f as ie,g as ue,q as V,p as de,h as u,i as o,n as m,F as y,j as f,w as b,v as re,k as n,l as S,m as U,s as ce,t as _e,G as H,o as i,x as C,y as P,z as g,C as w,A as z,c as ye}from"./index-BZorA4Xi.js";import{_ as x}from"./ContentEditable.vue_vue_type_script_setup_true_lang-DCjKGnf9.js";import{R as fe,F as ve}from"./FileItem-Czx9XAQY.js";import{H as K}from"./Hinter-BJIMERfm.js";const pe={class:"fr_content view_fav"},ke={class:"list_fav_group"},me=["onClick"],be={class:"title"},he=["onClick"],Ce=["onClick"],Ve={class:"operator"},we=["onClick"],$e=["onClick"],Se=o("td",null,"nodeType",-1),ge=["onUpdate:modelValue"],Ie=["value"],Oe=o("td",null,"withTag",-1),Ge={class:"favTagLs"},Ae=["onClick"],Ue=o("td",null,"or",-1),Te=["onUpdate:modelValue","id"],De=["for"],Ee=o("td",null,"root",-1),Fe=o("td",null,"cascade",-1),Me=["onUpdate:modelValue","id"],Le=["for"],Re=o("td",null,"rate",-1),je=["onClick"],Ne={class:"title"},Be=["onClick"],qe=["onClick"],He={class:"operator"},Pe=["onClick"],ze=["onClick"],xe={class:"content_meta"},Ke={class:"search"},Qe=o("span",null,"Title : ",-1),Ye=o("span",null,"Type : ",-1),Je=o("span",null,"Rate : ",-1),Xe=["value"],Ze=["value","innerHTML"],We={key:0,class:"display"},et=o("a",{class:"sysIcon sysIcon_fengefu"},null,-1),tt={key:2},st=o("span",null,"Sort : ",-1),ot=["value"],at=o("a",{class:"sysIcon sysIcon_fengefu"},null,-1),lt=["onClick"],_t=se({__name:"Favourite",setup(nt){oe(),ae();const T=$(null),D=ce(),v=_e();let p={id:"",keyword:""};const c=$([]),E=$(null),h=$(-1),Q=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1;le(async()=>{p.id=v.query.id??"",await Y(),d=new ne({route:v,router:D,getList:G,contentDOM:T.value,emitGo:N}),p.id&&(M(),R(v.query),await G(),await d.reloadScroll()),document.addEventListener("keydown",B)}),ie(()=>{d.destructor(),document.removeEventListener("keydown",B)}),ue(async s=>{console.info(s),p.id=s.query.id??"",p.id&&(M(),R(s.query),await G())});async function Y(){const s=await V("favourite_group/get",p);s&&(s.forEach(t=>{t.edit=!1,t.ext_key=t.id}),c.value=s||[])}async function I(s){const t=c.value[s];await V("favourite_group/del",t),location.reload()}async function O(s){console.info(c.value[s]);const t=H.copyObject(c.value[s]);if(t.edit){c.value[s].edit=!1,t.meta=JSON.stringify(t.meta);const e=await V("favourite_group/mod",t);if(!e)return;c.value[s].id=parseInt(e.id??"")}else c.value[s].edit=!0}function F(s){c.value.unshift({title:"",status:1,auto:s,meta:{node_type:"any",id_tag:"",rate:"",id_dir:"",cascade_dir:"1",tag_or:"1"},edit:!0,ext_key:new Date().valueOf()})}function M(){if(!p.id)return;let s=parseInt(p.id);c.value.forEach((t,e)=>{s===t.id&&(h.value=e,E.value=t)})}async function L(s){const t=c.value[s];D.push({path:v.path,query:{id:t.id}})}let _={mode:"directory",id_dir:"",id_tag:""},r={keyword:"",node_type:"",rate:"",cascade_dir:"1"};function R(s){if(s){for(let t in _)if(Object.prototype.hasOwnProperty.call(_,t))switch(t){default:_[t]=s[t]??"";break;case"mode":_[t]=s[t]??"directory";break;case"id_dir":_[t]=s[t]??"";break}for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))switch(t){default:r[t]=s[t]??"";break;case"cascade_dir":r[t]=s[t]??"1";break}}}const k=$([]);let d;function j(){const s=H.copyObject(r);_.id_tag&&(s.id_tag=_.id_tag),_.id_dir&&(s.id_dir=_.id_dir),!r.rate&&!r.node_type&&!r.keyword.trim()?s.mode="directory":s.mode="search",d.go(s)}async function G(s){var t;if(console.info("getList",v.name),k.value=[],s)k.value=s;else{switch(v.name){default:break;case"Recycle":_.status="deleted";break;case"Favourite":break}let e={id_fav:(t=E.value)==null?void 0:t.id};switch(_.mode){case"directory":e=Object.assign(e,_);break;case"search":e=Object.assign(e,_,r);break}const a=await V("file/get",e);if(!a)return;k.value=d.sortList(a.list,d.sortVal.value)}d&&d.setList(k.value)}function N(s,t){switch(s){case"reload":G();break;case"tag":d.go({id_tag:`${t}`,mode:"tag"});break;case"node":let e;for(let a=0;a<k.value.length;a++)if(k.value[a].id===t){e=k.value[a];break}if(!e)break;switch(e.type){case"directory":d.go({id_dir:`${e.id}`,mode:"directory"});break;default:de({mode:"favourite",id_fav:p.id,with:"file,crumb"},e.id??0);break}break}}function B(s){const t=[];switch(s.ctrlKey&&t.push("ctrl"),s.shiftKey&&t.push("shift"),t.push(s.code),t.join("_")){default:return;case"NumpadEnter":case"Enter":if(!s.target||s.target.id!=="searchBarInput")return;j();break}}async function J(s){console.info("node_hint");const e=await V("file/get",{mode:"search",node_type:"directory",keyword:s,with:"crumb",limit:"20"});return e?("root".indexOf(s)!==-1&&e.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),e.list):!1}function X(s,t){console.info("node_add",s,t);const e=c.value[t];e.meta=Object.assign(e.meta??{},{pid:s.id}),c.value[t].node=s}function Z(s){var e;if(console.info("node_parse"),!s)return"";const t=[];return(e=s.crumb_node)==null||e.forEach(a=>{a.title&&t.push(a.title)}),s.title&&t.push(s.title),`/ ${t.join(" / ")}`}async function W(s){const t=new FormData;return t.set("keyword",s),t.set("size","20"),await V("tag/get",t)}function ee(s,t){const e=c.value[t];e.tag||(e.tag=[]),e.tag.push(s);const a=[];e.tag.forEach(l=>a.push(l.id??0)),e.meta=Object.assign(e.meta??{},{tag_id:a.join(",")})}function q(s){return s?`${s.group.title} : ${s.title}`:""}function te(s,t){const e=c.value[s];e.tag||(e.tag=[]),e.tag.splice(t,1);const a=[];e.tag.forEach(l=>a.push(l.id??0)),e.meta=Object.assign(e.meta??{},{tag_id:a.join(",")})}return(s,t)=>(i(),u("div",pe,[o("div",ke,[o("div",{class:m({fav_group:!0,fav_group_add:!0,active:h.value===-1})},[o("span",{class:"buttonStyle sysIcon sysIcon_plus-square-o",onClick:t[0]||(t[0]=e=>F(0))}),o("span",{class:"buttonStyle sysIcon sysIcon_A",onClick:t[1]||(t[1]=e=>F(1))})],2),(i(!0),u(y,null,f(c.value,(e,a)=>(i(),u("div",{key:`favView_group_${e.ext_key?e.ext_key:e.id}`,class:m({active:h.value===a,fav_group:!0,edit:e.edit})},[e.auto?(i(),u(y,{key:0},[e.edit?(i(),u("div",{key:1,class:m({active:h.value==a,auto:!0})},[g(x,{class:"title",modelValue:e.title,"onUpdate:modelValue":l=>e.title=l,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),o("div",Ve,[o("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:l=>O(a)},null,8,we),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:l=>I(a)},null,8,$e)]),o("table",null,[o("tr",null,[Se,o("td",null,[b(o("select",{"onUpdate:modelValue":l=>e.meta.node_type=l},[(i(!0),u(y,null,f(n(w).fileType,(l,A)=>(i(),u("option",{value:l,key:`FAV_G_${e.ext_key}_NODE_TYPE_${A}`},C(l),9,Ie))),128))],8,ge),[[S,e.meta.node_type]])])]),o("tr",null,[Oe,o("td",Ge,[o("div",null,[(i(!0),u(y,null,f(e.tag,(l,A)=>(i(),u("p",{key:`FAV_G_${e.ext_key}_TAG_BTN_${A}`},[o("span",null,C(q(l)),1),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:it=>te(a,A)},null,8,Ae)]))),128))]),g(K,{"get-list":W,submit:ee,"parse-text":q,meta:a},null,8,["meta"])])]),o("tr",null,[Ue,o("td",null,[b(o("input",{type:"checkbox","onUpdate:modelValue":l=>e.meta.tag_or=l,id:`FAV_G_CB_S_${e.ext_key?e.ext_key:e.id}_TAG_OR`,"true-value":"1","false-value":""},null,8,Te),[[z,e.meta.tag_or]]),o("label",{class:"buttonStyle",for:`FAV_G_CB_S_${e.ext_key?e.ext_key:e.id}_TAG_OR`},null,8,De)])]),o("tr",null,[Ee,o("td",null,[g(K,{"get-list":J,submit:X,"parse-text":Z,modelValue:e.node,"onUpdate:modelValue":l=>e.node=l,meta:a},null,8,["modelValue","onUpdate:modelValue","meta"])])]),o("tr",null,[Fe,o("td",null,[b(o("input",{type:"checkbox","onUpdate:modelValue":l=>e.meta.cascade_dir=l,id:`FAV_G_CB_S_${e.ext_key?e.ext_key:e.id}_CASCADE`,"true-value":"1","false-value":""},null,8,Me),[[z,e.meta.cascade_dir]]),o("label",{class:"buttonStyle",for:`FAV_G_CB_S_${e.ext_key?e.ext_key:e.id}_CASCADE`},null,8,Le)])]),o("tr",null,[Re,o("td",null,[g(fe,{node:null,modelValue:e.meta.rate,"onUpdate:modelValue":l=>e.meta.rate=l},null,8,["modelValue","onUpdate:modelValue"])])])])],2)):(i(),u("div",{key:0,class:m({active:h.value==a,auto:!0}),onClick:l=>L(a)},[o("div",be,C(e.title),1),o("div",{class:"operator",onClick:t[2]||(t[2]=P(()=>{},["stop"]))},[o("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:l=>O(a)},null,8,he),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:l=>I(a)},null,8,Ce)])],10,me))],64)):(i(),u(y,{key:1},[e.edit?(i(),u("div",{key:1,class:m({active:h.value==a})},[g(x,{class:"title",modelValue:e.title,"onUpdate:modelValue":l=>e.title=l,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),o("div",He,[o("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:l=>O(a)},null,8,Pe),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:l=>I(a)},null,8,ze)])],2)):(i(),u("div",{key:0,class:m({active:h.value==a}),onClick:l=>L(a)},[o("div",Ne,C(e.title),1),o("div",{class:"operator",onClick:t[3]||(t[3]=P(()=>{},["stop"]))},[o("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:l=>O(a)},null,8,Be),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:l=>I(a)},null,8,qe)])],10,je))],64))],2))),128))]),o("div",{class:"fav_content",ref_key:"contentDOM",ref:T},[o("div",xe,[o("div",Ke,[o("label",null,[Qe,b(o("input",{id:"searchBarInput",type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>n(r).keyword=e)},null,512),[[re,n(r).keyword]])]),o("label",null,[Ye,b(o("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>n(r).node_type=e)},[(i(!0),u(y,null,f(n(w).fileType,(e,a)=>(i(),u("option",{key:`FAV_SCH_CON_TYPE_${a}`},C(e),1))),128))],512),[[S,n(r).node_type]])]),o("label",null,[Je,Q?b((i(),u("select",{key:0,"onUpdate:modelValue":t[6]||(t[6]=e=>n(r).rate=e)},[(i(!0),u(y,null,f(n(w).rateMobile,(e,a)=>(i(),u("option",{value:a,key:`FAV_SCH_CON_RATE_${a}`},C(e),9,Xe))),128))],512)),[[S,n(r).rate]]):b((i(),u("select",{key:1,class:"sysIcon","onUpdate:modelValue":t[7]||(t[7]=e=>n(r).rate=e)},[(i(!0),u(y,null,f(n(w).rate,(e,a)=>(i(),u("option",{value:a,innerHTML:e,key:`FAV_SCH_CON_RATE_${a}`},null,8,Ze))),128))],512)),[[S,n(r).rate]])]),o("label",null,[o("button",{class:"buttonStyle sysIcon sysIcon_search",onClick:j})])]),n(d)&&n(d).showSelectionOp?(i(),u("div",We,[o("a",{class:"buttonStyle",onClick:t[8]||(t[8]=e=>n(d).bathOp("browser"))},"OP"),o("a",{class:"buttonStyle",onClick:t[9]||(t[9]=e=>n(d).bathOp("rename"))},"RN"),o("a",{class:"buttonStyle",onClick:t[10]||(t[10]=e=>n(d).bathOp("move"))},"MV"),n(v).name!=="Recycle"?(i(),u("a",{key:0,class:"buttonStyle",onClick:t[11]||(t[11]=e=>n(d).bathOp("delete"))},"DEL")):U("",!0),n(v).name==="Recycle"?(i(),u("a",{key:1,class:"buttonStyle",onClick:t[12]||(t[12]=e=>n(d).bathOp("delete_forever"))},"rDEL")):U("",!0),et,n(d)&&n(d).sortVal?(i(),u("label",tt,[st,b(o("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>n(d).sortVal.value=e),onChange:t[14]||(t[14]=e=>n(d).setSort(s.sortVal))},[(i(!0),u(y,null,f(n(w).sort,(e,a)=>(i(),u("option",{value:a,key:`FV_SCH_CON_SORT_${a}`},C(e),9,ot))),128))],544),[[S,n(d).sortVal.value]])])):U("",!0),at,(i(!0),u(y,null,f(n(w).listType,(e,a)=>(i(),u("a",{class:m(["buttonStyle","sysIcon",`sysIcon_listType_${e}`,{active:n(d).mode.value===e}]),onClick:l=>n(d).setMode(e),key:`FAV_SCH_CON_ICON_${a}`},null,10,lt))),128))])):U("",!0)]),o("div",{class:m(["list_fav",`mode_${n(d)?n(d).mode.value:""}`])},[(i(!0),u(y,null,f(k.value,(e,a)=>(i(),ye(ve,{key:a,node:e,index:a,selected:!1,onGo:N},null,8,["node","index"]))),128))],2)],512)]))}});export{_t as default};

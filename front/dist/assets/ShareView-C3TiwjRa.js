import{a as $,u as x,b as H}from"./index-AVzMkwIp.js";import{d as L,r as v,o as V,H as g,q as j,J as k,c as l,e as n,T as i,F as c,f as b,b as a,t as o,U as m}from"./basic-Dyvi3445.js";const q=["href"],B={class:"multi"},C=["onClick"],F=L({__name:"ShareView",setup(E){const r=v(null);x();const D=H();let y={status:""};const _=v([]);V(async()=>{Object.assign(y,g.copyObject(D.query)),d(),r.value&&r.value.addEventListener("scroll",p)}),$(async s=>{console.info(s),d()}),j(()=>{var s;r.value&&((s=r.value)==null||s.removeEventListener("scroll",p))});async function p(s){if(console.info(s),!r.value)return;let e=r.value,t=(e==null?void 0:e.scrollTop)+(e==null?void 0:e.clientHeight)+(e==null?void 0:e.clientHeight);(e==null?void 0:e.scrollHeight)<t&&g.debounce(async()=>{await d()},500,"logViewDebounce")}let f=1,h=!1;async function d(s=!1){if(h)return;h=!0,s&&(f=1);const e=await k("share/list",Object.assign({page:f},y));if(f+=1,h=!1,!e)return;if(!e.length){f--;return}const t=s?[]:_.value;for(let u=0;u<e.length;u++)t.push(Object.assign(e[u],{ext_key:`${new Date().valueOf()}_${Math.random()}`}));_.value=t}async function O(s){await k("share/del",{id:s}),await d(!0)}return(s,e)=>(a(),l("div",{class:"fr_content view_share",ref_key:"contentDOM",ref:r},[n("table",null,[n("tbody",null,[e[1]||(e[1]=n("tr",null,[n("th",null,"id"),n("th",null,"user"),n("th",null,"path"),n("th",null,[i("time_create"),n("br"),i("time_to")]),n("th",null,"operate")],-1)),(a(!0),l(c,null,b(_.value,t=>(a(),l("tr",{key:`share_view_${t.ext_key}`},[n("td",null,[n("a",{href:`./share.html?id=${t.id}`,target:"_blank"},o(t.id),9,q)]),n("td",null,o(t.user.name),1),n("td",null,[n("div",B,[(a(!0),l(c,null,b(t.node,u=>(a(),l("p",{key:`share_view_${t.ext_key}_${u.id}`},o(u.node_path)+"/"+o(u.title),1))),128))])]),n("td",null,[i(o(t.time_create)+" ",1),e[0]||(e[0]=n("br",null,null,-1)),t.status===0?(a(),l(c,{key:1},[i("Stopped")],64)):t.status===1?(a(),l(c,{key:2},[i(o(t.time_to),1)],64)):t.status===2?(a(),l(c,{key:3},[i("Long")],64)):m("",!0)]),n("td",null,[t.status!==0?(a(),l("button",{key:0,class:"sysIcon sysIcon_delete",onClick:u=>O(t.id)},"Delete ",8,C)):m("",!0)])]))),128))])])],512))}});export{F as default};

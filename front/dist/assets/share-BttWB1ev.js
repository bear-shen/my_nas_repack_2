import{d as ne,r as v,o as ae,C as z,c as u,e as l,t as f,Q as g,F as m,g as N,n as _,f as V,N as se,O as W,T as le,a2 as ie,D as oe,G,_ as re,U as ue,V as ce,W as de,X as ve,Y as X,b as r,R as pe,a4 as Ae,P as J,a7 as fe,a8 as we}from"./basic-cwdvCeQw.js";const ye="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAF1mlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1wOkNyZWF0ZURhdGU9IjIwMjUtMDQtMjlUMTk6NTk6MzQrMDg6MDAiIHhtcDpNb2RpZnlEYXRlPSIyMDI1LTA1LTI1VDAwOjQ5OjAxKzA4OjAwIiB4bXA6TWV0YWRhdGFEYXRlPSIyMDI1LTA1LTI1VDAwOjQ5OjAxKzA4OjAwIiBkYzpmb3JtYXQ9ImltYWdlL3BuZyIgcGhvdG9zaG9wOkNvbG9yTW9kZT0iMyIgcGhvdG9zaG9wOklDQ1Byb2ZpbGU9InNSR0IgSUVDNjE5NjYtMi4xIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjVlMmU1MGU4LTg3ZmQtN2M0My04NGE3LTk4NjVkMmExMGY5MiIgeG1wTU06RG9jdW1lbnRJRD0iYWRvYmU6ZG9jaWQ6cGhvdG9zaG9wOmFkYjg3ZWVhLWIyZWYtODA0Ni1hZjE5LTg2ZmI4MDA4ZTFkZiIgeG1wTU06T3JpZ2luYWxEb2N1bWVudElEPSJ4bXAuZGlkOjM3NzYzOTg3LTEzNWYtZWU0Ny1iYWNlLTBjZDNiMGNmNGNkOCI+IDx4bXBNTTpIaXN0b3J5PiA8cmRmOlNlcT4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjM3NzYzOTg3LTEzNWYtZWU0Ny1iYWNlLTBjZDNiMGNmNGNkOCIgc3RFdnQ6d2hlbj0iMjAyNS0wNS0yNVQwMDo0OTowMSswODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo1ZTJlNTBlOC04N2ZkLTdjNDMtODRhNy05ODY1ZDJhMTBmOTIiIHN0RXZ0OndoZW49IjIwMjUtMDUtMjVUMDA6NDk6MDErMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAyMDE4IChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6TS4caAAABQklEQVR4nO3d0YnCQBRA0Sj+by/biZXaib1sBbMdJELE88B7fhUyeHmYcRQva60tzlUv4NsVACsAVgCsAFgBsAJgt6Mn/G3b8xMLOeFXL2DPz8HjTQBWAKwAWAGwAmAFwAqAHe4DXjD6Pny6JgArAFYArABYAbACYAXACoAVACsAVgDsHZ8FnXXH13/IizcBWAGwAmAFwAqAFQArADZhH0Dvw7UmACsAVgCsAFgBsAJgBcAm7AM6D4hTAKwA2CvvAX3/f9/R76h3X78mACsAVgBswj6g84A4BcAKgBUAKwBWAKwA2IR9QOcBcQqAFQArAFYArABYAbAJ+4DOA+IUACsAVgCsAFgBsAJgBcAKgBUAKwA24bOgs6b/z9muJgArAFYArABYAbACYAXALmstvYav1gRgBcAKgBUAKwBWAKwA2D94NhAMfrN7rgAAAABJRU5ErkJggg==",he={class:"sh_fr_header"},Ie={class:"operator"},ge={key:0,class:"err_msg"},me={class:"sh_fr_list"},be=["id","value"],ke=["for"],De=["onClick"],Ne={class:"operates"},_e={key:0},Me=["onClick"],Ce=["onClick"],Ge=["onClick"],Re={key:0},Le={class:"preLine"},Ze={class:_({pagination:1,isMobile:!1})},Be={class:"sh_fr_footer"},Oe=ne({__name:"share",setup(Te){const R=v(""),y=v(0);let h="";const A=v([]),L=v(null),Z=v(null),b=v([]),k=v(null);ae(async()=>{const e=new URL(location.href);B(e)});function j(e,t){const n=new URL(location.href);n.searchParams.set("id",e),t?n.searchParams.set("node",t.toString()):n.searchParams.delete("node"),history.pushState(null,"",n),B(n)}addEventListener("popstate",e=>{B(new URL(location.href))});async function B(e){if(h=e.searchParams.get("id")??"",!h)return C("invalid uuid");let t=e.searchParams.get("node");b.value=[];const n=await P(h,t??!1);if(!n)return C("data fetch failed");A.value=n.node??[],Z.value=n.parent??null,L.value=n.cur}const E=v(""),x=v("");async function M(e,t){var n;if(e.type==="directory")j(h,e.id);else{if(!((n=e==null?void 0:e.file_index)!=null&&n.raw))return;switch(t){default:return await O("single",e);case"detail":c.value=e,A.value.forEach((s,a)=>{s.type!="directory"&&s.id==e.id&&(p.value=a)}),F(),y.value=1,setTimeout(()=>{var s,a;Y.value={h:((s=k.value)==null?void 0:s.clientHeight)??0,w:((a=k.value)==null?void 0:a.clientWidth)??0}},10);break}}}async function O(e,t){const n=[];switch(e){case"list":b.value.forEach(a=>{A.value.forEach(o=>{o.id===a&&n.push(o)})});break;case"total":A.value.forEach(a=>{n.push(a)});break;case"single":t&&n.push(t);break}if(!n.length)return;console.info(n);const s=new oe(S("",n),async a=>{const o=await P(h,a.id);return o?S(a.path,o.node??[]):[]});await s.prepare(),await s.download((a,o,i,d,te)=>{let D=(a+o)/i;D*=1e4,D=Math.round(D),D/=100,E.value=`${d}/${te} Files, ${D}%, ${G.kmgt(o)} / ${G.kmgt(i)}`,x.value=`width: ${D}%;`}),console.info(n.length===1,n[0].type!=="directory"),n.length===1&&n[0].type!=="directory"?await s.completeFile():(await s.build(),s.complete())}async function P(e,t){return await ee("share/node_list",t?{id:e,id_node:t}:{id:e})}function S(e,t){const n=[];return t.forEach(s=>{var o;const a={id:s.id,id_parent:s.id_parent,path:"",url:"",size:0,type:s.type??""};if(a.path=[e??"",s.title??""].join("/"),s.type!=="directory"){const i=(o=s.file_index)==null?void 0:o.raw;if(!i)return;a.url=w(s,"raw"),a.size=i.size??0}n.push(a)}),n}function w(e,t="raw"){return e.file_index[t]?e.file_index[t].path+"?shareId="+h+"&filename="+e.title:""}const T={audio:re,video:ue,image:ce,pdf:de,text:ve,office:X,base:X};let p=v(-1);const c=v(null),U=v({id:0,title:"",cover:"",preview:"",normal:"",raw:"",sameName:[]}),Y=v({w:0,h:0});function H(e){let t=e-p.value;I(p.value,t)}function I(e,t,n=0){let s=A.value.length;if(s<1)return;let a=e;do{for(a=a+t;a<0;)a+=s;for(;a>s-1;)a-=s;if(n||(n=0),n+=1,n>s)return;console.info(a)}while(!A.value[a]||A.value[a].type==="directory");p.value=a,F()}function F(){const e=A.value[p.value];if(c.value=e,!e.file_index.preview&&["audio","video"].indexOf(e.type)!==-1){let s=!1;A.value.forEach(a=>{if(a.id_parent!==e.id_parent||s)return;let o=!1;if(z.coverKeyword.forEach(i=>{z.imgKeyword.forEach(d=>{e.title.toLowerCase().indexOf(i)!==-1&&e.title.toLowerCase().indexOf(d)!==-1&&(o=!0)})}),o){s=!0;let i;i||(i=e.file_index.preview),i||(i=e.file_index.normal),i||(i=e.file_index.raw),e.file_index.preview=i}})}const t={id:e.id,title:e.title,cover:w(e,"cover"),preview:w(e,"preview"),normal:w(e,"normal"),raw:w(e,"raw"),sameName:[]};let n=t.title.lastIndexOf(".");if(n!==-1){let s=t.title.substring(0,n)??"";s&&A.value.forEach(a=>{var i,d;if(a.id==t.id||((i=a.title)==null?void 0:i.indexOf(s))!==0)return;let o=(d=a.title)==null?void 0:d.substring(s.length);t.sameName.push({title:o,type:a.type??"",preview:w(a,"preview"),normal:w(a,"normal"),raw:w(a,"raw")})})}U.value=t,console.warn(t)}function $(){setTimeout(()=>{var e,t;k.value&&(Y.value={h:((e=k.value)==null?void 0:e.clientHeight)??0,w:((t=k.value)==null?void 0:t.clientWidth)??0})},10)}window.addEventListener("resize",$);function K(){p.value=-1,c.value=null,y.value=0}async function q(e){if(c.value)switch(e.key){case"ArrowLeft":if(e.preventDefault(),e.stopPropagation(),["audio","video"].indexOf(c.value.type??"")!==-1)return;I(p.value,-1);break;case"ArrowRight":if(e.preventDefault(),e.stopPropagation(),["audio","video"].indexOf(c.value.type??"")!==-1)return;I(p.value,1);break;case"a":case"PageUp":e.preventDefault(),e.stopPropagation(),I(p.value,-1);break;case"d":case"PageDown":e.preventDefault(),e.stopPropagation(),I(p.value,1);break}}document.addEventListener("keydown",q);function ee(e,t,n){return new Promise((s,a)=>{let o;if(t instanceof FormData)o=t;else{o=new FormData;for(const d in t)Object.prototype.hasOwnProperty.call(t,d)&&o.append(d,t[d])}const i=new XMLHttpRequest;i.withCredentials=!0,i.onreadystatechange=function(){if(i.readyState!==4)return;if(i.status>=400)return C(`${i.status}: ${i.statusText}`);const d=JSON.parse(i.responseText);d.code&&C(d.msg),s(d.data)},i.open("POST",z.apiPath+e),i.send(o)})}function C(e){throw R.value=e,new Error(e)}return(e,t)=>(r(),u(m,null,[l("div",he,[t[7]||(t[7]=l("div",null,[l("img",{src:ye}),l("span",null,"MyNas Share")],-1)),l("div",Ie,[b.value.length?(r(),u("span",{key:0,class:"pointer sysIcon sysIcon_download",onClick:t[0]||(t[0]=n=>O("list"))},f(b.value.length)+" Selected",1)):g("",!0),l("span",{class:"pointer sysIcon sysIcon_download",onClick:t[1]||(t[1]=n=>O("total"))},"Down All"),y.value?(r(),u("span",{key:1,class:"pointer sysIcon sysIcon_forward",onClick:t[2]||(t[2]=n=>K())},"Close")):g("",!0)])]),l("div",{class:_({sh_fr_body:!0,showDetail:y.value})},[R.value.length?(r(),u("p",ge,f(R.value),1)):(r(),u(m,{key:1},[l("ul",me,[L.value&&L.value.id?(r(),u("li",{key:0,class:"pointer",onClick:t[3]||(t[3]=n=>j(N(h),Z.value?Z.value.id:0))},t[8]||(t[8]=[l("p",null,[l("span",{class:_(["thumb","listIcon","listIcon_file_directory"])}),l("span",null,"../")],-1)]))):g("",!0),(r(!0),u(m,null,V(A.value,n=>{var s,a;return r(),u("li",{key:n.id},[l("p",null,[pe(l("input",{type:"checkbox",name:"selector",id:`selector_${n.id}`,value:n.id,"onUpdate:modelValue":t[4]||(t[4]=o=>b.value=o)},null,8,be),[[Ae,b.value]]),l("label",{for:`selector_${n.id}`,class:"pointer"},null,8,ke),l("span",{class:_(["thumb","listIcon",`listIcon_file_${n.type}`])},null,2),l("span",{class:"pointer title",onClick:o=>M(n)},f(n.title),9,De)]),l("p",Ne,[n.type!=="directory"?(r(),u("span",_e,f(N(G).kmgt(((a=(s=n==null?void 0:n.file_index)==null?void 0:s.raw)==null?void 0:a.size)??0)),1)):g("",!0),n.type==="directory"?(r(),u("span",{key:1,class:"pointer sysIcon sysIcon_folder",onClick:o=>M(n)},null,8,Me)):(r(),u(m,{key:2},[l("span",{class:"pointer sysIcon sysIcon_eye",onClick:o=>M(n,"detail")},null,8,Ce),l("span",{class:"pointer sysIcon sysIcon_download",onClick:o=>M(n)},null,8,Ge)],64))])])}),128))]),c.value&&y.value?(r(),u("div",{key:0,class:"sh_fr_detail",ref_key:"detailDOM",ref:k,"data-ref-id":"1"},[(r(),se(le(T[c.value.type]?T[c.value.type]:T.base),{extId:"1",isActive:!0,curIndex:0,file:U.value,dom:Y.value,onNav:H},{info:W(()=>{var n,s;return[l("div",{class:_({info:!0,detail:y.value})},[y.value?(r(),u(m,{key:0},[l("p",null,f(c.value.title)+" ("+f(N(G).kmgt(((s=(n=c.value.file_index)==null?void 0:n.raw)==null?void 0:s.size)??0,2))+") ",1),c.value.crumb_node?(r(),u("p",Re,[t[9]||(t[9]=J("Dir : ")),(r(!0),u(m,null,V(c.value.crumb_node,a=>(r(),u(m,null,[J("/"+f(a.title),1)],64))),256))])):g("",!0),l("p",Le,f(c.value.description),1)],64)):g("",!0)],2)]}),btnContainer:W(()=>t[10]||(t[10]=[])),navigator:W(()=>[l("div",Ze,[l("div",{class:"left",onClick:t[5]||(t[5]=n=>I(N(p),-1))},t[11]||(t[11]=[l("span",{class:"sysIcon sysIcon_arrowleft"},null,-1)])),l("div",{class:"right",onClick:t[6]||(t[6]=n=>I(N(p),1))},t[12]||(t[12]=[l("span",{class:"sysIcon sysIcon_arrowright"},null,-1)]))])]),_:1},40,["file","dom"]))],512)):g("",!0)],64))],2),l("div",Be,[l("div",{class:"process",style:ie(x.value)},f(E.value),5)])],64))}}),Q=fe(Oe);Q.use(we());Q.mount("#app");

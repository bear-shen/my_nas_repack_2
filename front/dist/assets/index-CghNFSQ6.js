const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./FileView_N-BKQ8N6DD.js","./FileView.vue_vue_type_style_index_0_lang-tSec-XZq.js","./basic-DfhHe1pL.js","./basic-Crk0ZqqR.css","./FileItem-DekrVgzV.js","./ContentEditable.vue_vue_type_script_setup_true_lang-DeHVZR6n.js","./Hinter-CTFeFYTW.js","./Hinter-DDs2Yukm.css","./FileItem-DUerVcS4.css","./FileView-BSPtTJMB.css","./Favourite-BdeR0ca2.js","./Favourite-BN5yJjEX.css","./FileView_R-CxpeI5lT.js","./TagView-BI9wEw5I.js","./TagView-BIbJvYcw.css","./ShareView-H7QZqJUG.js","./ShareView-PFMJRU3W.css","./UserView-BUS3eycQ.js","./UserView-CmWqTIhk.css","./LogView-DxNav7oB.js","./LogView-V_AVrbUx.css","./SettingView-CGFh5fi0.js","./SettingView-EQ9DroAn.css"])))=>i.map(i=>d[i]);
var yn=Object.defineProperty;var wn=(o,e,t)=>e in o?yn(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var oe=(o,e,t)=>wn(o,typeof e!="symbol"?e+"":e,t);import{d as Ze,C as de,r as F,a as ve,o as R,c as P,b as $,F as Z,e as pe,n as ue,u as ie,t as re,s as bn,f as kn,i as Re,g as xn,h as Le,j as En,k as Sn,l as Ln,m as xe,p as Gt,q as ot,w as Pe,v as Ne,J as Dn,G as fe,x as me,y as be,z as ye,A as le,B as gt,D as ge,E as ze,H as $n,I as Qt,K as st,L as Jt,M as $t,N as dt,O as Qe,P as Zt,Q as je,R as On,S as Cn,T as Mn,U as In,V as Rn}from"./basic-DfhHe1pL.js";const Ot="tosho_user",Ae=Ze("userStore",()=>{let o=null;function e(){if(o)return o;const n=localStorage.getItem(Ot);if(!n)return null;try{o=JSON.parse(n)}catch{o=null}return o}function t(n){return o=n,localStorage.setItem(Ot,JSON.stringify(n)),n}return{get:e,set:t}});let qe={set:null,close:null};const Te=Ze("modalStore",()=>({set:Pn,close:An,handleEvent:Tn,simpleMsg:Nn}));function Pn(o){return qe.set?qe.set(o):null}function An(o){return qe.close?qe.close(o):null}function Tn(o,e){return qe[o]=e}function Nn(o,e){return{title:o,text:e,w:320,h:100,minW:320,minH:100,allow_resize:!1,callback:{confirm:async function(t){}}}}function se(o,e,t){return new Promise((n,s)=>{let c;if(e instanceof FormData)c=e;else{c=new FormData;for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&c.append(a,e[a])}const r=new XMLHttpRequest;r.withCredentials=!0,r.onreadystatechange=function(){if(r.readyState!==4)return;if(r.status>=400)return ht(`${r.status}:${r.statusText}`);const a=JSON.parse(r.responseText);switch(a.code){case 10:ft(),n(!1);break;case 100:ht(a.msg),n(!1);break;default:n(a.data);break}},t&&t.upload&&(r.upload.onprogress=t.upload),r.open("POST",de.apiPath+o);const u=Ae().get();u&&u.token&&r.setRequestHeader("Auth-Token",u.token),r.send(c)})}function ft(){console.info("throwLogin"),Te().set({title:"login required",alpha:!0,key:"",single:!1,w:360,h:120,minW:360,minH:120,allow_resize:!1,allow_move:!0,allow_escape:!1,allow_fullscreen:!1,auto_focus:!0,form:[{type:"text",label:"username",key:"username"},{type:"text",label:"password",key:"password"}],callback:{login:async function(e){console.info(e);const t=await se("user/login",{username:e.content.form[0].value,password:e.content.form[1].value});if(!t)return!0;Ae().set(t),location.reload()}}})}function ht(o){Te().set({title:"error",alpha:!1,key:"",single:!1,w:360,h:100,minW:360,minH:100,allow_resize:!1,allow_move:!0,allow_escape:!0,allow_fullscreen:!1,auto_focus:!0,text:o,callback:{close:t=>{}}})}function Me(o){if(!o)return!1;let e=o;for(;;){if(e.tagName==="BODY")return!1;if(e.tagName==="HTML")return!1;if(e.tagName==="TEXTAREA")return!0;if(e.tagName==="INPUT")switch(e.type){case"input":case"date":case"datetime":case"datetime-local":case"file":case"number":case"password":case"search":case"text":case"time":case"tel":case"url":return!0}else{if(e.contentEditable&&e.contentEditable.toLowerCase()==="true")return!0;if(!e.parentElement)return!1}e=e.parentElement}return!1}function Fe(o){if(!o)return!1;let e=o;for(;;){if(e.classList.contains("modal_dom"))return!0;if(e.tagName=="BODY")return!1;if(e.tagName=="HTML")return!1;if(!e.parentElement)return!1;e=e.parentElement}return!1}const at="tosho_config_",Ve=Ze("localConfigure",()=>{let o=F({});const e={};function t(r){if(r=at+r,o[r])return o[r];const i=localStorage.getItem(r);if(!i)return null;try{o[r]=JSON.parse(i)}catch{o[r]=null}return o[r]}function n(r,i,u){return r=at+r,u||(u=new Date().valueOf().toString(32)+Math.random().toString(32)),e[r]||(e[r]=new Map),e[r].set(u,i),u}function s(r,i){e[r]&&(e[r].delete(i),e[r].size==0&&delete e[r])}function c(r,i){r=at+r,o[r]=i,e[r]&&e[r].forEach(u=>u(i)),localStorage.setItem(r,JSON.stringify(i))}return{get:t,set:c,listen:n,release:s}}),Hn={class:"fr_header"},zn={class:"navi"},jn=["innerHTML"],Bn={class:"user"},Wn={class:"pointer"},Vn=ve({__name:"Header",setup(o){const e=[{name:"Nas",meta:{cur:!0},path:"/"},{name:"Hyper",meta:{cur:!1},path:""},{name:"Router",meta:{cur:!1},path:""},{name:"Spider",meta:{cur:!1},path:""},{name:"Git",meta:{cur:!1},path:""},{name:"Torrent",meta:{cur:!1},path:""}],t=Ae();let n=t.get();function s(){t.set(null),location.reload()}const c=Ve(),r=de.theme;let i=c.get("theme")??"default";function u(){const d={};r.forEach(g=>{d[g[0]]=g[0]}),Te().set({title:"theme configure",alpha:!0,key:"theme_configure",single:!0,w:360,h:160,minW:360,minH:160,allow_resize:!0,allow_move:!0,allow_escape:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"radio",label:"theme name",key:"theme",options:d,value:i}],callback:{check:async g=>{console.info(g),i=g.content.form[0].value,a(i)}}})}function a(d){r.forEach(p=>{const g=p[0],l=p[1];if(g!==d)return;c.set("theme",g);const w=document.body.className.trim().split(" "),m=[];w.forEach(x=>{x&&x.length&&x.indexOf("theme_")!==0&&m.push(x)}),m.push("theme_"+d);const f=document.createElement("link");f.setAttribute("rel","stylesheet"),f.setAttribute("href",l),document.body.appendChild(f),document.body.className=m.join(" ")})}return a(i),(d,p)=>(R(),P("div",Hn,[p[1]||(p[1]=$("div",{class:"logo"},"Hentai.",-1)),$("div",zn,[(R(),P(Z,null,pe(e,g=>{var l;return $("div",{key:g.name,class:ue({active:(l=g.meta)==null?void 0:l.cur,pointer:1}),innerHTML:g.name},null,10,jn)}),64))]),$("div",Bn,[ie(n)&&ie(n).id?(R(),P(Z,{key:0},[$("div",Wn,re(ie(n).name),1),$("ul",{class:"action pointer"},[$("li",{onClick:u},"theme"),$("li",{onClick:s},"logout")])],64)):(R(),P("div",{key:1,class:"pointer",onClick:p[0]||(p[0]=(...g)=>ie(ft)&&ie(ft)(...g))},"login"))])]))}}),Un=(o,e)=>{const t=o.__vccOpts||o;for(const[n,s]of e)t[n]=s;return t},Fn=Un(Vn,[["__scopeId","data-v-f25df7f8"]]),Xn="modulepreload",Yn=function(o,e){return new URL(o,e).href},Ct={},De=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){const r=document.getElementsByTagName("link"),i=document.querySelector("meta[property=csp-nonce]"),u=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.allSettled(t.map(a=>{if(a=Yn(a,n),a in Ct)return;Ct[a]=!0;const d=a.endsWith(".css"),p=d?'[rel="stylesheet"]':"";if(!!n)for(let w=r.length-1;w>=0;w--){const m=r[w];if(m.href===a&&(!d||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${p}`))return;const l=document.createElement("link");if(l.rel=d?"stylesheet":Xn,d||(l.as="script"),l.crossOrigin="",l.href=a,u&&l.setAttribute("nonce",u),document.head.appendChild(l),d)return new Promise((w,m)=>{l.addEventListener("load",w),l.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${a}`)))})}))}function c(r){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=r,window.dispatchEvent(i),!i.defaultPrevented)throw r}return s.then(r=>{for(const i of r||[])i.status==="rejected"&&c(i.reason);return e().catch(c)})};/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const He=typeof document<"u";function en(o){return typeof o=="object"||"displayName"in o||"props"in o||"__vccOpts"in o}function qn(o){return o.__esModule||o[Symbol.toStringTag]==="Module"||o.default&&en(o.default)}const ae=Object.assign;function rt(o,e){const t={};for(const n in e){const s=e[n];t[n]=ke(s)?s.map(o):o(s)}return t}const Xe=()=>{},ke=Array.isArray,tn=/#/g,Kn=/&/g,Gn=/\//g,Qn=/=/g,Jn=/\?/g,nn=/\+/g,Zn=/%5B/g,eo=/%5D/g,on=/%5E/g,to=/%60/g,sn=/%7B/g,no=/%7C/g,an=/%7D/g,oo=/%20/g;function yt(o){return encodeURI(""+o).replace(no,"|").replace(Zn,"[").replace(eo,"]")}function so(o){return yt(o).replace(sn,"{").replace(an,"}").replace(on,"^")}function pt(o){return yt(o).replace(nn,"%2B").replace(oo,"+").replace(tn,"%23").replace(Kn,"%26").replace(to,"`").replace(sn,"{").replace(an,"}").replace(on,"^")}function ao(o){return pt(o).replace(Qn,"%3D")}function ro(o){return yt(o).replace(tn,"%23").replace(Jn,"%3F")}function io(o){return o==null?"":ro(o).replace(Gn,"%2F")}function Ke(o){try{return decodeURIComponent(""+o)}catch{}return""+o}const lo=/\/$/,co=o=>o.replace(lo,"");function it(o,e,t="/"){let n,s={},c="",r="";const i=e.indexOf("#");let u=e.indexOf("?");return i<u&&i>=0&&(u=-1),u>-1&&(n=e.slice(0,u),c=e.slice(u+1,i>-1?i:e.length),s=o(c)),i>-1&&(n=n||e.slice(0,i),r=e.slice(i,e.length)),n=po(n??e,t),{fullPath:n+(c&&"?")+c+r,path:n,query:s,hash:Ke(r)}}function uo(o,e){const t=e.query?o(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function Mt(o,e){return!e||!o.toLowerCase().startsWith(e.toLowerCase())?o:o.slice(e.length)||"/"}function fo(o,e,t){const n=e.matched.length-1,s=t.matched.length-1;return n>-1&&n===s&&Be(e.matched[n],t.matched[s])&&rn(e.params,t.params)&&o(e.query)===o(t.query)&&e.hash===t.hash}function Be(o,e){return(o.aliasOf||o)===(e.aliasOf||e)}function rn(o,e){if(Object.keys(o).length!==Object.keys(e).length)return!1;for(const t in o)if(!ho(o[t],e[t]))return!1;return!0}function ho(o,e){return ke(o)?It(o,e):ke(e)?It(e,o):o===e}function It(o,e){return ke(e)?o.length===e.length&&o.every((t,n)=>t===e[n]):o.length===1&&o[0]===e}function po(o,e){if(o.startsWith("/"))return o;if(!o)return e;const t=e.split("/"),n=o.split("/"),s=n[n.length-1];(s===".."||s===".")&&n.push("");let c=t.length-1,r,i;for(r=0;r<n.length;r++)if(i=n[r],i!==".")if(i==="..")c>1&&c--;else break;return t.slice(0,c).join("/")+"/"+n.slice(r).join("/")}const $e={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Ge;(function(o){o.pop="pop",o.push="push"})(Ge||(Ge={}));var Ye;(function(o){o.back="back",o.forward="forward",o.unknown=""})(Ye||(Ye={}));function mo(o){if(!o)if(He){const e=document.querySelector("base");o=e&&e.getAttribute("href")||"/",o=o.replace(/^\w+:\/\/[^\/]+/,"")}else o="/";return o[0]!=="/"&&o[0]!=="#"&&(o="/"+o),co(o)}const vo=/^[^#]+#/;function _o(o,e){return o.replace(vo,"#")+e}function go(o,e){const t=document.documentElement.getBoundingClientRect(),n=o.getBoundingClientRect();return{behavior:e.behavior,left:n.left-t.left-(e.left||0),top:n.top-t.top-(e.top||0)}}const et=()=>({left:window.scrollX,top:window.scrollY});function yo(o){let e;if("el"in o){const t=o.el,n=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?n?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=go(s,o)}else e=o;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Rt(o,e){return(history.state?history.state.position-e:-1)+o}const mt=new Map;function wo(o,e){mt.set(o,e)}function bo(o){const e=mt.get(o);return mt.delete(o),e}let ko=()=>location.protocol+"//"+location.host;function ln(o,e){const{pathname:t,search:n,hash:s}=e,c=o.indexOf("#");if(c>-1){let i=s.includes(o.slice(c))?o.slice(c).length:1,u=s.slice(i);return u[0]!=="/"&&(u="/"+u),Mt(u,"")}return Mt(t,o)+n+s}function xo(o,e,t,n){let s=[],c=[],r=null;const i=({state:g})=>{const l=ln(o,location),w=t.value,m=e.value;let f=0;if(g){if(t.value=l,e.value=g,r&&r===w){r=null;return}f=m?g.position-m.position:0}else n(l);s.forEach(x=>{x(t.value,w,{delta:f,type:Ge.pop,direction:f?f>0?Ye.forward:Ye.back:Ye.unknown})})};function u(){r=t.value}function a(g){s.push(g);const l=()=>{const w=s.indexOf(g);w>-1&&s.splice(w,1)};return c.push(l),l}function d(){const{history:g}=window;g.state&&g.replaceState(ae({},g.state,{scroll:et()}),"")}function p(){for(const g of c)g();c=[],window.removeEventListener("popstate",i),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",i),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:u,listen:a,destroy:p}}function Pt(o,e,t,n=!1,s=!1){return{back:o,current:e,forward:t,replaced:n,position:window.history.length,scroll:s?et():null}}function Eo(o){const{history:e,location:t}=window,n={value:ln(o,t)},s={value:e.state};s.value||c(n.value,{back:null,current:n.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function c(u,a,d){const p=o.indexOf("#"),g=p>-1?(t.host&&document.querySelector("base")?o:o.slice(p))+u:ko()+o+u;try{e[d?"replaceState":"pushState"](a,"",g),s.value=a}catch(l){console.error(l),t[d?"replace":"assign"](g)}}function r(u,a){const d=ae({},e.state,Pt(s.value.back,u,s.value.forward,!0),a,{position:s.value.position});c(u,d,!0),n.value=u}function i(u,a){const d=ae({},s.value,e.state,{forward:u,scroll:et()});c(d.current,d,!0);const p=ae({},Pt(n.value,u,null),{position:d.position+1},a);c(u,p,!1),n.value=u}return{location:n,state:s,push:i,replace:r}}function So(o){o=mo(o);const e=Eo(o),t=xo(o,e.state,e.location,e.replace);function n(c,r=!0){r||t.pauseListeners(),history.go(c)}const s=ae({location:"",base:o,go:n,createHref:_o.bind(null,o)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function Lo(o){return typeof o=="string"||o&&typeof o=="object"}function cn(o){return typeof o=="string"||typeof o=="symbol"}const un=Symbol("");var At;(function(o){o[o.aborted=4]="aborted",o[o.cancelled=8]="cancelled",o[o.duplicated=16]="duplicated"})(At||(At={}));function We(o,e){return ae(new Error,{type:o,[un]:!0},e)}function Se(o,e){return o instanceof Error&&un in o&&(e==null||!!(o.type&e))}const Tt="[^/]+?",Do={sensitive:!1,strict:!1,start:!0,end:!0},$o=/[.+*?^${}()[\]/\\]/g;function Oo(o,e){const t=ae({},Do,e),n=[];let s=t.start?"^":"";const c=[];for(const a of o){const d=a.length?[]:[90];t.strict&&!a.length&&(s+="/");for(let p=0;p<a.length;p++){const g=a[p];let l=40+(t.sensitive?.25:0);if(g.type===0)p||(s+="/"),s+=g.value.replace($o,"\\$&"),l+=40;else if(g.type===1){const{value:w,repeatable:m,optional:f,regexp:x}=g;c.push({name:w,repeatable:m,optional:f});const h=x||Tt;if(h!==Tt){l+=10;try{new RegExp(`(${h})`)}catch(v){throw new Error(`Invalid custom RegExp for param "${w}" (${h}): `+v.message)}}let _=m?`((?:${h})(?:/(?:${h}))*)`:`(${h})`;p||(_=f&&a.length<2?`(?:/${_})`:"/"+_),f&&(_+="?"),s+=_,l+=20,f&&(l+=-8),m&&(l+=-20),h===".*"&&(l+=-50)}d.push(l)}n.push(d)}if(t.strict&&t.end){const a=n.length-1;n[a][n[a].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const r=new RegExp(s,t.sensitive?"":"i");function i(a){const d=a.match(r),p={};if(!d)return null;for(let g=1;g<d.length;g++){const l=d[g]||"",w=c[g-1];p[w.name]=l&&w.repeatable?l.split("/"):l}return p}function u(a){let d="",p=!1;for(const g of o){(!p||!d.endsWith("/"))&&(d+="/"),p=!1;for(const l of g)if(l.type===0)d+=l.value;else if(l.type===1){const{value:w,repeatable:m,optional:f}=l,x=w in a?a[w]:"";if(ke(x)&&!m)throw new Error(`Provided param "${w}" is an array but it is not repeatable (* or + modifiers)`);const h=ke(x)?x.join("/"):x;if(!h)if(f)g.length<2&&(d.endsWith("/")?d=d.slice(0,-1):p=!0);else throw new Error(`Missing required param "${w}"`);d+=h}}return d||"/"}return{re:r,score:n,keys:c,parse:i,stringify:u}}function Co(o,e){let t=0;for(;t<o.length&&t<e.length;){const n=e[t]-o[t];if(n)return n;t++}return o.length<e.length?o.length===1&&o[0]===80?-1:1:o.length>e.length?e.length===1&&e[0]===80?1:-1:0}function dn(o,e){let t=0;const n=o.score,s=e.score;for(;t<n.length&&t<s.length;){const c=Co(n[t],s[t]);if(c)return c;t++}if(Math.abs(s.length-n.length)===1){if(Nt(n))return 1;if(Nt(s))return-1}return s.length-n.length}function Nt(o){const e=o[o.length-1];return o.length>0&&e[e.length-1]<0}const Mo={type:0,value:""},Io=/[a-zA-Z0-9_]/;function Ro(o){if(!o)return[[]];if(o==="/")return[[Mo]];if(!o.startsWith("/"))throw new Error(`Invalid path "${o}"`);function e(l){throw new Error(`ERR (${t})/"${a}": ${l}`)}let t=0,n=t;const s=[];let c;function r(){c&&s.push(c),c=[]}let i=0,u,a="",d="";function p(){a&&(t===0?c.push({type:0,value:a}):t===1||t===2||t===3?(c.length>1&&(u==="*"||u==="+")&&e(`A repeatable param (${a}) must be alone in its segment. eg: '/:ids+.`),c.push({type:1,value:a,regexp:d,repeatable:u==="*"||u==="+",optional:u==="*"||u==="?"})):e("Invalid state to consume buffer"),a="")}function g(){a+=u}for(;i<o.length;){if(u=o[i++],u==="\\"&&t!==2){n=t,t=4;continue}switch(t){case 0:u==="/"?(a&&p(),r()):u===":"?(p(),t=1):g();break;case 4:g(),t=n;break;case 1:u==="("?t=2:Io.test(u)?g():(p(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&i--);break;case 2:u===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+u:t=3:d+=u;break;case 3:p(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&i--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${a}"`),p(),r(),s}function Po(o,e,t){const n=Oo(Ro(o.path),t),s=ae(n,{record:o,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function Ao(o,e){const t=[],n=new Map;e=Bt({strict:!1,end:!0,sensitive:!1},e);function s(p){return n.get(p)}function c(p,g,l){const w=!l,m=zt(p);m.aliasOf=l&&l.record;const f=Bt(e,p),x=[m];if("alias"in p){const v=typeof p.alias=="string"?[p.alias]:p.alias;for(const k of v)x.push(zt(ae({},m,{components:l?l.record.components:m.components,path:k,aliasOf:l?l.record:m})))}let h,_;for(const v of x){const{path:k}=v;if(g&&k[0]!=="/"){const M=g.record.path,S=M[M.length-1]==="/"?"":"/";v.path=g.record.path+(k&&S+k)}if(h=Po(v,g,f),l?l.alias.push(h):(_=_||h,_!==h&&_.alias.push(h),w&&p.name&&!jt(h)&&r(p.name)),fn(h)&&u(h),m.children){const M=m.children;for(let S=0;S<M.length;S++)c(M[S],h,l&&l.children[S])}l=l||h}return _?()=>{r(_)}:Xe}function r(p){if(cn(p)){const g=n.get(p);g&&(n.delete(p),t.splice(t.indexOf(g),1),g.children.forEach(r),g.alias.forEach(r))}else{const g=t.indexOf(p);g>-1&&(t.splice(g,1),p.record.name&&n.delete(p.record.name),p.children.forEach(r),p.alias.forEach(r))}}function i(){return t}function u(p){const g=Ho(p,t);t.splice(g,0,p),p.record.name&&!jt(p)&&n.set(p.record.name,p)}function a(p,g){let l,w={},m,f;if("name"in p&&p.name){if(l=n.get(p.name),!l)throw We(1,{location:p});f=l.record.name,w=ae(Ht(g.params,l.keys.filter(_=>!_.optional).concat(l.parent?l.parent.keys.filter(_=>_.optional):[]).map(_=>_.name)),p.params&&Ht(p.params,l.keys.map(_=>_.name))),m=l.stringify(w)}else if(p.path!=null)m=p.path,l=t.find(_=>_.re.test(m)),l&&(w=l.parse(m),f=l.record.name);else{if(l=g.name?n.get(g.name):t.find(_=>_.re.test(g.path)),!l)throw We(1,{location:p,currentLocation:g});f=l.record.name,w=ae({},g.params,p.params),m=l.stringify(w)}const x=[];let h=l;for(;h;)x.unshift(h.record),h=h.parent;return{name:f,path:m,params:w,matched:x,meta:No(x)}}o.forEach(p=>c(p));function d(){t.length=0,n.clear()}return{addRoute:c,resolve:a,removeRoute:r,clearRoutes:d,getRoutes:i,getRecordMatcher:s}}function Ht(o,e){const t={};for(const n of e)n in o&&(t[n]=o[n]);return t}function zt(o){const e={path:o.path,redirect:o.redirect,name:o.name,meta:o.meta||{},aliasOf:o.aliasOf,beforeEnter:o.beforeEnter,props:To(o),children:o.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in o?o.components||null:o.component&&{default:o.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function To(o){const e={},t=o.props||!1;if("component"in o)e.default=t;else for(const n in o.components)e[n]=typeof t=="object"?t[n]:t;return e}function jt(o){for(;o;){if(o.record.aliasOf)return!0;o=o.parent}return!1}function No(o){return o.reduce((e,t)=>ae(e,t.meta),{})}function Bt(o,e){const t={};for(const n in o)t[n]=n in e?e[n]:o[n];return t}function Ho(o,e){let t=0,n=e.length;for(;t!==n;){const c=t+n>>1;dn(o,e[c])<0?n=c:t=c+1}const s=zo(o);return s&&(n=e.lastIndexOf(s,n-1)),n}function zo(o){let e=o;for(;e=e.parent;)if(fn(e)&&dn(o,e)===0)return e}function fn({record:o}){return!!(o.name||o.components&&Object.keys(o.components).length||o.redirect)}function jo(o){const e={};if(o===""||o==="?")return e;const n=(o[0]==="?"?o.slice(1):o).split("&");for(let s=0;s<n.length;++s){const c=n[s].replace(nn," "),r=c.indexOf("="),i=Ke(r<0?c:c.slice(0,r)),u=r<0?null:Ke(c.slice(r+1));if(i in e){let a=e[i];ke(a)||(a=e[i]=[a]),a.push(u)}else e[i]=u}return e}function Wt(o){let e="";for(let t in o){const n=o[t];if(t=ao(t),n==null){n!==void 0&&(e+=(e.length?"&":"")+t);continue}(ke(n)?n.map(c=>c&&pt(c)):[n&&pt(n)]).forEach(c=>{c!==void 0&&(e+=(e.length?"&":"")+t,c!=null&&(e+="="+c))})}return e}function Bo(o){const e={};for(const t in o){const n=o[t];n!==void 0&&(e[t]=ke(n)?n.map(s=>s==null?null:""+s):n==null?n:""+n)}return e}const hn=Symbol(""),Vt=Symbol(""),tt=Symbol(""),wt=Symbol(""),vt=Symbol("");function Ue(){let o=[];function e(n){return o.push(n),()=>{const s=o.indexOf(n);s>-1&&o.splice(s,1)}}function t(){o=[]}return{add:e,list:()=>o.slice(),reset:t}}function Wo(o,e,t){const n=()=>{o[e].delete(t)};Le(n),En(n),Sn(()=>{o[e].add(t)}),o[e].add(t)}function Ar(o){const e=Re(hn,{}).value;e&&Wo(e,"updateGuards",o)}function Ce(o,e,t,n,s,c=r=>r()){const r=n&&(n.enterCallbacks[s]=n.enterCallbacks[s]||[]);return()=>new Promise((i,u)=>{const a=g=>{g===!1?u(We(4,{from:t,to:e})):g instanceof Error?u(g):Lo(g)?u(We(2,{from:e,to:g})):(r&&n.enterCallbacks[s]===r&&typeof g=="function"&&r.push(g),i())},d=c(()=>o.call(n&&n.instances[s],e,t,a));let p=Promise.resolve(d);o.length<3&&(p=p.then(a)),p.catch(g=>u(g))})}function lt(o,e,t,n,s=c=>c()){const c=[];for(const r of o)for(const i in r.components){let u=r.components[i];if(!(e!=="beforeRouteEnter"&&!r.instances[i]))if(en(u)){const d=(u.__vccOpts||u)[e];d&&c.push(Ce(d,t,n,r,i,s))}else{let a=u();c.push(()=>a.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${i}" at "${r.path}"`);const p=qn(d)?d.default:d;r.mods[i]=d,r.components[i]=p;const l=(p.__vccOpts||p)[e];return l&&Ce(l,t,n,r,i,s)()}))}}return c}function Ut(o){const e=Re(tt),t=Re(wt),n=xe(()=>{const u=ie(o.to);return e.resolve(u)}),s=xe(()=>{const{matched:u}=n.value,{length:a}=u,d=u[a-1],p=t.matched;if(!d||!p.length)return-1;const g=p.findIndex(Be.bind(null,d));if(g>-1)return g;const l=Ft(u[a-2]);return a>1&&Ft(d)===l&&p[p.length-1].path!==l?p.findIndex(Be.bind(null,u[a-2])):g}),c=xe(()=>s.value>-1&&Yo(t.params,n.value.params)),r=xe(()=>s.value>-1&&s.value===t.matched.length-1&&rn(t.params,n.value.params));function i(u={}){if(Xo(u)){const a=e[ie(o.replace)?"replace":"push"](ie(o.to)).catch(Xe);return o.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>a),a}return Promise.resolve()}return{route:n,href:xe(()=>n.value.href),isActive:c,isExactActive:r,navigate:i}}function Vo(o){return o.length===1?o[0]:o}const Uo=ve({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Ut,setup(o,{slots:e}){const t=Ln(Ut(o)),{options:n}=Re(tt),s=xe(()=>({[Xt(o.activeClass,n.linkActiveClass,"router-link-active")]:t.isActive,[Xt(o.exactActiveClass,n.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const c=e.default&&Vo(e.default(t));return o.custom?c:Gt("a",{"aria-current":t.isExactActive?o.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},c)}}}),Fo=Uo;function Xo(o){if(!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)&&!o.defaultPrevented&&!(o.button!==void 0&&o.button!==0)){if(o.currentTarget&&o.currentTarget.getAttribute){const e=o.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return o.preventDefault&&o.preventDefault(),!0}}function Yo(o,e){for(const t in e){const n=e[t],s=o[t];if(typeof n=="string"){if(n!==s)return!1}else if(!ke(s)||s.length!==n.length||n.some((c,r)=>c!==s[r]))return!1}return!0}function Ft(o){return o?o.aliasOf?o.aliasOf.path:o.path:""}const Xt=(o,e,t)=>o??e??t,qo=ve({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(o,{attrs:e,slots:t}){const n=Re(vt),s=xe(()=>o.route||n.value),c=Re(Vt,0),r=xe(()=>{let a=ie(c);const{matched:d}=s.value;let p;for(;(p=d[a])&&!p.components;)a++;return a}),i=xe(()=>s.value.matched[r.value]);ot(Vt,xe(()=>r.value+1)),ot(hn,i),ot(vt,s);const u=F();return Pe(()=>[u.value,i.value,o.name],([a,d,p],[g,l,w])=>{d&&(d.instances[p]=a,l&&l!==d&&a&&a===g&&(d.leaveGuards.size||(d.leaveGuards=l.leaveGuards),d.updateGuards.size||(d.updateGuards=l.updateGuards))),a&&d&&(!l||!Be(d,l)||!g)&&(d.enterCallbacks[p]||[]).forEach(m=>m(a))},{flush:"post"}),()=>{const a=s.value,d=o.name,p=i.value,g=p&&p.components[d];if(!g)return Yt(t.default,{Component:g,route:a});const l=p.props[d],w=l?l===!0?a.params:typeof l=="function"?l(a):l:null,f=Gt(g,ae({},w,e,{onVnodeUnmounted:x=>{x.component.isUnmounted&&(p.instances[d]=null)},ref:u}));return Yt(t.default,{Component:f,route:a})||f}}});function Yt(o,e){if(!o)return null;const t=o(e);return t.length===1?t[0]:t}const Ko=qo;function Go(o){const e=Ao(o.routes,o),t=o.parseQuery||jo,n=o.stringifyQuery||Wt,s=o.history,c=Ue(),r=Ue(),i=Ue(),u=bn($e);let a=$e;He&&o.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=rt.bind(null,L=>""+L),p=rt.bind(null,io),g=rt.bind(null,Ke);function l(L,y){let b,C;return cn(L)?(b=e.getRecordMatcher(L),C=y):C=L,e.addRoute(C,b)}function w(L){const y=e.getRecordMatcher(L);y&&e.removeRoute(y)}function m(){return e.getRoutes().map(L=>L.record)}function f(L){return!!e.getRecordMatcher(L)}function x(L,y){if(y=ae({},y||u.value),typeof L=="string"){const W=it(t,L,y.path),ne=e.resolve({path:W.path},y),we=s.createHref(W.fullPath);return ae(W,ne,{params:g(ne.params),hash:Ke(W.hash),redirectedFrom:void 0,href:we})}let b;if(L.path!=null)b=ae({},L,{path:it(t,L.path,y.path).path});else{const W=ae({},L.params);for(const ne in W)W[ne]==null&&delete W[ne];b=ae({},L,{params:p(W)}),y.params=p(y.params)}const C=e.resolve(b,y),H=L.hash||"";C.params=d(g(C.params));const X=uo(n,ae({},L,{hash:so(H),path:C.path})),N=s.createHref(X);return ae({fullPath:X,hash:H,query:n===Wt?Bo(L.query):L.query||{}},C,{redirectedFrom:void 0,href:N})}function h(L){return typeof L=="string"?it(t,L,u.value.path):ae({},L)}function _(L,y){if(a!==L)return We(8,{from:y,to:L})}function v(L){return S(L)}function k(L){return v(ae(h(L),{replace:!0}))}function M(L){const y=L.matched[L.matched.length-1];if(y&&y.redirect){const{redirect:b}=y;let C=typeof b=="function"?b(L):b;return typeof C=="string"&&(C=C.includes("?")||C.includes("#")?C=h(C):{path:C},C.params={}),ae({query:L.query,hash:L.hash,params:C.path!=null?{}:L.params},C)}}function S(L,y){const b=a=x(L),C=u.value,H=L.state,X=L.force,N=L.replace===!0,W=M(b);if(W)return S(ae(h(W),{state:typeof W=="object"?ae({},H,W.state):H,force:X,replace:N}),y||b);const ne=b;ne.redirectedFrom=y;let we;return!X&&fo(n,C,b)&&(we=We(16,{to:ne,from:C}),q(C,C,!0,!1)),(we?Promise.resolve(we):I(ne,C)).catch(_e=>Se(_e)?Se(_e,2)?_e:V(_e):z(_e,ne,C)).then(_e=>{if(_e){if(Se(_e,2))return S(ae({replace:N},h(_e.to),{state:typeof _e.to=="object"?ae({},H,_e.to.state):H,force:X}),y||ne)}else _e=te(ne,C,!0,N,H);return j(ne,C,_e),_e})}function E(L,y){const b=_(L,y);return b?Promise.reject(b):Promise.resolve()}function D(L){const y=T.values().next().value;return y&&typeof y.runWithContext=="function"?y.runWithContext(L):L()}function I(L,y){let b;const[C,H,X]=Qo(L,y);b=lt(C.reverse(),"beforeRouteLeave",L,y);for(const W of C)W.leaveGuards.forEach(ne=>{b.push(Ce(ne,L,y))});const N=E.bind(null,L,y);return b.push(N),K(b).then(()=>{b=[];for(const W of c.list())b.push(Ce(W,L,y));return b.push(N),K(b)}).then(()=>{b=lt(H,"beforeRouteUpdate",L,y);for(const W of H)W.updateGuards.forEach(ne=>{b.push(Ce(ne,L,y))});return b.push(N),K(b)}).then(()=>{b=[];for(const W of X)if(W.beforeEnter)if(ke(W.beforeEnter))for(const ne of W.beforeEnter)b.push(Ce(ne,L,y));else b.push(Ce(W.beforeEnter,L,y));return b.push(N),K(b)}).then(()=>(L.matched.forEach(W=>W.enterCallbacks={}),b=lt(X,"beforeRouteEnter",L,y,D),b.push(N),K(b))).then(()=>{b=[];for(const W of r.list())b.push(Ce(W,L,y));return b.push(N),K(b)}).catch(W=>Se(W,8)?W:Promise.reject(W))}function j(L,y,b){i.list().forEach(C=>D(()=>C(L,y,b)))}function te(L,y,b,C,H){const X=_(L,y);if(X)return X;const N=y===$e,W=He?history.state:{};b&&(C||N?s.replace(L.fullPath,ae({scroll:N&&W&&W.scroll},H)):s.push(L.fullPath,H)),u.value=L,q(L,y,b,N),V()}let U;function J(){U||(U=s.listen((L,y,b)=>{if(!Y.listening)return;const C=x(L),H=M(C);if(H){S(ae(H,{replace:!0,force:!0}),C).catch(Xe);return}a=C;const X=u.value;He&&wo(Rt(X.fullPath,b.delta),et()),I(C,X).catch(N=>Se(N,12)?N:Se(N,2)?(S(ae(h(N.to),{force:!0}),C).then(W=>{Se(W,20)&&!b.delta&&b.type===Ge.pop&&s.go(-1,!1)}).catch(Xe),Promise.reject()):(b.delta&&s.go(-b.delta,!1),z(N,C,X))).then(N=>{N=N||te(C,X,!1),N&&(b.delta&&!Se(N,8)?s.go(-b.delta,!1):b.type===Ge.pop&&Se(N,20)&&s.go(-1,!1)),j(C,X,N)}).catch(Xe)}))}let Q=Ue(),ce=Ue(),he;function z(L,y,b){V(L);const C=ce.list();return C.length?C.forEach(H=>H(L,y,b)):console.error(L),Promise.reject(L)}function A(){return he&&u.value!==$e?Promise.resolve():new Promise((L,y)=>{Q.add([L,y])})}function V(L){return he||(he=!L,J(),Q.list().forEach(([y,b])=>L?b(L):y()),Q.reset()),L}function q(L,y,b,C){const{scrollBehavior:H}=o;if(!He||!H)return Promise.resolve();const X=!b&&bo(Rt(L.fullPath,0))||(C||!b)&&history.state&&history.state.scroll||null;return xn().then(()=>H(L,y,X)).then(N=>N&&yo(N)).catch(N=>z(N,L,y))}const B=L=>s.go(L);let O;const T=new Set,Y={currentRoute:u,listening:!0,addRoute:l,removeRoute:w,clearRoutes:e.clearRoutes,hasRoute:f,getRoutes:m,resolve:x,options:o,push:v,replace:k,go:B,back:()=>B(-1),forward:()=>B(1),beforeEach:c.add,beforeResolve:r.add,afterEach:i.add,onError:ce.add,isReady:A,install(L){const y=this;L.component("RouterLink",Fo),L.component("RouterView",Ko),L.config.globalProperties.$router=y,Object.defineProperty(L.config.globalProperties,"$route",{enumerable:!0,get:()=>ie(u)}),He&&!O&&u.value===$e&&(O=!0,v(s.location).catch(H=>{}));const b={};for(const H in $e)Object.defineProperty(b,H,{get:()=>u.value[H],enumerable:!0});L.provide(tt,y),L.provide(wt,kn(b)),L.provide(vt,u);const C=L.unmount;T.add(L),L.unmount=function(){T.delete(L),T.size<1&&(a=$e,U&&U(),U=null,u.value=$e,O=!1,he=!1),C()}}};function K(L){return L.reduce((y,b)=>y.then(()=>D(b)),Promise.resolve())}return Y}function Qo(o,e){const t=[],n=[],s=[],c=Math.max(e.matched.length,o.matched.length);for(let r=0;r<c;r++){const i=e.matched[r];i&&(o.matched.find(a=>Be(a,i))?n.push(i):t.push(i));const u=o.matched[r];u&&(e.matched.find(a=>Be(a,u))||s.push(u))}return[t,n,s]}function Jo(){return Re(tt)}function Zo(o){return Re(wt)}const pn=[{path:"/",name:"Directory",component:()=>De(()=>import("./FileView_N-BKQ8N6DD.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),meta:{icon:"sysIcon_folderopen",deny_user:!1,deny_guest:!1}},{path:"/favourite",name:"Favourite",component:()=>De(()=>import("./Favourite-BdeR0ca2.js"),__vite__mapDeps([10,2,3,5,4,6,7,8,11]),import.meta.url),meta:{icon:"sysIcon_star-o",deny_user:!1,deny_guest:!0}},{path:"/recycle",name:"Recycle",component:()=>De(()=>import("./FileView_R-CxpeI5lT.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9]),import.meta.url),meta:{icon:"sysIcon_delete",deny_user:!1,deny_guest:!0}},{path:"/tag",name:"Tag",component:()=>De(()=>import("./TagView-BI9wEw5I.js"),__vite__mapDeps([13,2,3,5,6,7,14]),import.meta.url),meta:{icon:"sysIcon_tagso",deny_user:!1,deny_guest:!0}},{path:"/shares",name:"Share",component:()=>De(()=>import("./ShareView-H7QZqJUG.js"),__vite__mapDeps([15,2,3,16]),import.meta.url),meta:{icon:"sysIcon_export",deny_user:!1,deny_guest:!0}},{path:"/group",name:"User",component:()=>De(()=>import("./UserView-BUS3eycQ.js"),__vite__mapDeps([17,2,3,5,6,7,18]),import.meta.url),meta:{icon:"sysIcon_team",deny_user:!0,deny_guest:!0}},{path:"/log",name:"ProcessLog",component:()=>De(()=>import("./LogView-DxNav7oB.js"),__vite__mapDeps([19,2,3,20]),import.meta.url),meta:{icon:"sysIcon_filetext",deny_user:!0,deny_guest:!0}},{path:"/setting",name:"Setting",component:()=>De(()=>import("./SettingView-CGFh5fi0.js"),__vite__mapDeps([21,2,3,5,22]),import.meta.url),meta:{icon:"sysIcon_setting",deny_user:!0,deny_guest:!0}}],es=Go({history:So("./"),routes:pn}),ts=["onClick"],ns={class:"content"},os=ve({__name:"NaviContent",props:{depth:{},records:{}},setup(o){const e=o;e.depth&&e.depth;const t=e.records,n=Jo(),s=Zo();async function c(u){console.info("go",u);const a=await n.push(u.path);console.info(a)}const i=Ae().get();return(u,a)=>(R(!0),P(Z,null,pe(ie(t),(d,p)=>{var g,l,w,m,f,x;return R(),P(Z,{key:p},[(g=d.meta)!=null&&g.hide?(R(),P(Z,{key:0},[],64)):(l=d.meta)!=null&&l.deny_guest&&((w=ie(i))==null?void 0:w.group.title)=="guest"?(R(),P(Z,{key:1},[],64)):(m=d.meta)!=null&&m.deny_user&&!((f=ie(i))!=null&&f.group.admin)?(R(),P(Z,{key:2},[],64)):(R(),P("p",{key:3,onClick:h=>c(d),class:ue({title:!0,active:d.path===ie(s).path})},[$("span",{class:ue(["icon","sysIcon",(x=d.meta)==null?void 0:x.icon])},null,2),$("span",ns,re(d.name),1)],10,ts))],64)}),128))}}),ss=ve({__name:"Navi",setup(o){return(e,t)=>(R(),P("div",{class:ue(["fr_navi",{folded:!1}])},[Ne(os,{records:ie(pn),depth:1},null,8,["records"])]))}});let _t=null;const mn=Ze("useContext",()=>({register:as,trigger:rs}));function as(o){_t=o}function rs(o,e){_t&&_t(o,e)}class is{constructor(e){oe(this,"nodeList");oe(this,"title","");oe(this,"downTotal",0);oe(this,"downFile",0);oe(this,"downCur",0);oe(this,"fileMap",new Map);oe(this,"zipRoot");this.nodeList=e,this.title=this.buildTitle()}async prepare(){this.nodeList=await this.getFullSubList(),console.info(this.nodeList)}buildTitle(){let e="";if(this.nodeList.length==1)e=this.nodeList[0].title??"";else{let t=[];for(let n=0;n<this.nodeList.length&&(t.push(this.nodeList[n].title??""),!(n>3));n++);e=t.join("，")}return e.length>150&&(e=e.substring(0,150)+"…"),e+=".zip",e}async getFullSubList(){const e=new Set;this.nodeList.forEach(n=>{n.type==="directory"&&n.id&&e.add(n.id)});const t=Array.from(e);for(let n=0;n<t.length;n++){const s=t[n],c=await se("file/get",Object.assign({mode:"directory",cascade_dir:"1",id_dir:s.toString(),with:"file"}));c&&this.nodeList.push(...c.list)}return this.nodeList.sort((n,s)=>{let c=n.type==="directory"?"0":"1";n.node_id_list&&n.node_id_list.forEach(i=>c+=i.toString().padStart(15,"0"));let r=s.type==="directory"?"0":"1";return s.node_id_list&&s.node_id_list.forEach(i=>r+=i.toString().padStart(15,"0")),c>r?1:-1}),this.nodeList.forEach(n=>{var s,c;return this.downTotal+=((c=(s=n.file_index)==null?void 0:s.raw)==null?void 0:c.size)??0}),this.nodeList}async download(){var e,t;for(let n=0;n<this.nodeList.length;n++){const s=this.nodeList[n];if(!s.id||s.type==="directory"||(e=s.file_index)!=null&&e.raw)continue;const c=(t=s.file_index)==null?void 0:t.raw;if(!c||!c.path)continue;const r=c.path+"?filename="+s.title,i=await this.downloadFile(r,this.downloadProcess.bind(this));this.fileMap.set(s.id,i),this.downCur=0,this.downFile+=c.size}}downloadProcess(e){this.downCur=e.loaded}downloadFile(e,t){return new Promise(n=>{const s=new XMLHttpRequest;s.withCredentials=!0,s.responseType="arraybuffer",s.onreadystatechange=function(){if(s.readyState===4){if(s.status>=400)return ht(`${s.status}:${s.statusText}`);n(s.response)}},t&&(s.onprogress=t),s.open("GET",e),s.send()})}async build(){this.zipRoot=new Dn;const e=new Map;this.nodeList.forEach(t=>{if(!t.id)return;let n=t.title??"";const s=e.get(t.id_parent??0);if(s&&(n=s[0]+"/"+n),t.type!="directory"){const c=this.fileMap.get(t.id);if(!c)return;e.set(t.id,[n,this.zipRoot.file(n,c)])}else e.set(t.id,[n,this.zipRoot.folder(n)])})}complete(){return new Promise(e=>{var t;(t=this.zipRoot)==null||t.generateAsync({type:"blob"}).then(n=>{let s=document.createElement("a");s.style.display="none",s.href=URL.createObjectURL(n),s.target="_blank",s.setAttribute("download",this.title),s.click(),e(!0)})})}}const ct=["scroll_log","image_rotate"];let Je=null,Ie=null;function ls(){Je=window.indexedDB.open(de.indexedDBName,4),Je.onupgradeneeded=cs,Je.onerror=o=>{},Je.onsuccess=o=>{Ie=o.target.result}}function cs(o){return console.info("onupgradeneeded",o),new Promise(e=>{Ie=o.target.result,us(Ie);let t=0;for(let n=0;n<ct.length;n++){const s=ct[n],c=Ie.createObjectStore(s,{keyPath:"key"});c.transaction.oncomplete=r=>{t+=1,t==ct.length-1&&e()}}})}function us(o){if(!o)return;const e=o==null?void 0:o.objectStoreNames;if(e)for(let t=0;t<e.length;t++)o.deleteObjectStore(e[t])}function bt(o,e){return new Promise(t=>{if(!Ie)return t(null);const n=Ie.transaction([o],"readonly").objectStore(o).get(e);n.onerror=s=>t(null),n.onsuccess=s=>s.target.result?t(s.target.result.val):t(null)})}function kt(o,e,t){return new Promise(n=>{if(!Ie)return n(null);const s=Ie.transaction([o],"readwrite").objectStore(o).put({key:e,val:t});s.onerror=c=>n(null),s.onsuccess=c=>n(null)})}var vn={};Object.defineProperty(vn,"__esModule",{value:!0});function ds(o){o===void 0&&(o={});var e=/^0/,t=/\s+/g,n=/^\s+|\s+$/g,s=/[^\x00-\x80]/,c=/^0x[0-9a-f]+$/i,r=/(0x[\da-fA-F]+|(^[\+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|\d+)/g,i=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,u=String.prototype.toLocaleLowerCase||String.prototype.toLowerCase,a=o.desc?-1:1,d=-a,p=o.insensitive?function(w){return u.call(""+w).replace(n,"")}:function(w){return(""+w).replace(n,"")};function g(w){return w.replace(r,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0")}function l(w,m){return(!w.match(e)||m===1)&&parseFloat(w)||w.replace(t," ").replace(n,"")||0}return function(w,m){var f=p(w),x=p(m);if(!f&&!x)return 0;if(!f&&x)return d;if(f&&!x)return a;var h=g(f),_=g(x),v=f.match(c),k=x.match(c),M=v&&k?parseInt(v[0],16):h.length!==1&&Date.parse(f),S=v&&k?parseInt(k[0],16):M&&x.match(i)&&Date.parse(x)||null;if(S){if(M===S)return 0;if(M<S)return d;if(M>S)return a}for(var E=h.length,D=_.length,I=0,j=Math.max(E,D);I<j;I+=1){var te=l(h[I]||"",E),U=l(_[I]||"",D);if(isNaN(te)!==isNaN(U))return isNaN(te)?a:d;if(s.test(te+U)&&te.localeCompare){var J=te.localeCompare(U);if(J>0)return a;if(J<0)return d;if(I===j-1)return 0}if(te<U)return d;if(te>U)return a;if(""+te<""+U)return d;if(""+te>""+U)return a}return 0}}var fs=vn.default=ds;let G;class Tr{constructor(e){oe(this,"nodeList",F([]));oe(this,"getList");oe(this,"route");oe(this,"router");oe(this,"contentDOM");oe(this,"emitGo");oe(this,"modalStore");oe(this,"localConfigure");oe(this,"contextStore");oe(this,"mode",F(""));oe(this,"modeKey","");oe(this,"sortVal",F(""));oe(this,"selecting",!1);oe(this,"selectingMovEvtCount",0);oe(this,"selectingOffset",[[0,0],[0,0]]);oe(this,"preSelectedNodeIndexSet",new Set);oe(this,"selectingKeyDef","");oe(this,"showSelectionOp",F(!1));oe(this,"lastSelectIndex",-1);oe(this,"reloadOffset_timer",0);oe(this,"reloadOffset_count",0);oe(this,"startScroll",!1);console.info(e),this.contentDOM=e.contentDOM,this.getList=e.getList,this.route=e.route,this.router=e.router,this.emitGo=e.emitGo,this.modalStore=Te(),this.localConfigure=Ve(),this.contextStore=mn(),this.mode.value=this.localConfigure.get("file_view_mode")??"detail",this.modeKey=this.localConfigure.listen("file_view_mode",t=>this.mode.value=t),this.sortVal=F(this.localConfigure.get("file_view_sort")??"name_asc"),this.contextMenuEvt=this.contextMenuEvt.bind(this),this.mouseDownEvt=this.mouseDownEvt.bind(this),this.mouseMoveEvt=this.mouseMoveEvt.bind(this),this.mouseUpEvt=this.mouseUpEvt.bind(this),this.keymap=this.keymap.bind(this),this.reloadOffset=this.reloadOffset.bind(this),this.scrollEvt=this.scrollEvt.bind(this),addEventListener("contextmenu",this.contextMenuEvt),addEventListener("pointerdown",this.mouseDownEvt),addEventListener("pointermove",this.mouseMoveEvt),addEventListener("pointerup",this.mouseUpEvt),addEventListener("keydown",this.keymap),addEventListener("resize",this.reloadOffset),this.contentDOM.addEventListener("scroll",this.scrollEvt),G=this}destructor(){console.info("destructor loaded"),this.localConfigure.release("file_view_mode",this.modeKey),removeEventListener("contextmenu",this.contextMenuEvt),removeEventListener("mousedown",this.mouseDownEvt),removeEventListener("mousemove",this.mouseMoveEvt),removeEventListener("mouseup",this.mouseUpEvt),removeEventListener("keydown",this.keymap),removeEventListener("resize",this.reloadOffset),this.contentDOM&&this.contentDOM.removeEventListener("scroll",this.scrollEvt),G=null}setList(e){this.nodeList.value=e,setTimeout(()=>{console.info("setList",e),this.reloadOffset(void 0)},de.timeouts.offsetDebounce)}deleteFromList(e){const t=[],n=new Set;e.forEach(s=>n.add(s)),this.nodeList.value.forEach(s=>{n.has(s.id)||t.push(s)}),this.getList(t)}inDetailView(e){let t=!1,n=e.target;for(;n;){if(n.contentEditable==="true"){t=!1;break}if(n.classList.contains("rater")){t=!1;break}if(n.classList.contains("list_fav")){t=!0;break}if(n.classList.contains("view_fav")){t=!1;break}if(n.classList.contains("content_meta")){t=!1;break}if(n.classList.contains("fr_content")){t=!0;break}if(!n.parentElement)break;n=n.parentElement}return t}inTaggingDOM(e){let t=!1,n=e.target;for(;n;){if(n.classList.contains("content_detail"))return!1;if(n.classList.contains("tag_list")){t=!0;break}if(!n.parentElement)break;n=n.parentElement}return t}mouseDownEvt(e){var r,i,u,a;if(!this.inDetailView(e)||e.button===1)return;if(this.selectingOffset[0]=[e.x+(((r=this.contentDOM)==null?void 0:r.scrollLeft)??0),e.y+(((i=this.contentDOM)==null?void 0:i.scrollTop)??0)],this.selectingOffset[1]=[e.x+(((u=this.contentDOM)==null?void 0:u.scrollLeft)??0),e.y+(((a=this.contentDOM)==null?void 0:a.scrollTop)??0)],this.preSelectedNodeIndexSet.clear(),e.preventDefault(),e.button!==0)return this.rightMouseDownEvt(e);this.nodeList.value.forEach((d,p)=>{d._selected&&this.preSelectedNodeIndexSet.add(p)}),this.selecting=!0,this.selectingMovEvtCount=0;const t=this.getSelection(this.selectingOffset),n=[];e.ctrlKey&&n.push("ctrl"),e.shiftKey&&n.push("shift"),this.selectingKeyDef=n.join("_");let s=-1;const c=Array.from(t);switch(c.length&&(s=c.pop()??-1),this.selectingKeyDef){case"shift":this.preSelectedNodeIndexSet.clear();case"ctrl_shift":if(s==-1||this.lastSelectIndex==-1)break;const d=Math.min(s,this.lastSelectIndex),p=Math.max(s,this.lastSelectIndex);for(let g=d;g<=p;g++)t.has(g)||this.preSelectedNodeIndexSet.add(g);break;default:this.preSelectedNodeIndexSet.clear();break;case"ctrl":break}this.nodeList.value.forEach((d,p)=>{let g=0;this.preSelectedNodeIndexSet.has(p)&&(g+=1),t.has(p)&&(g+=1),d._selected=g===1}),this.lastSelectIndex=s,this.showSelectionOp.value=this.preSelectedNodeIndexSet.size+t.size>0}rightMouseDownEvt(e){const t=this.getSelection(this.selectingOffset);let n=!1;const s=new Set;this.nodeList.value.forEach((c,r)=>{c._selected&&(s.add(r),t.has(r)&&(n=!0))}),n?this.preSelectedNodeIndexSet=s:this.preSelectedNodeIndexSet=t,this.nodeList.value.forEach((c,r)=>{c._selected=this.preSelectedNodeIndexSet.has(r)})}mouseMoveEvt(e){var s,c;if(!this.selecting||(this.selectingMovEvtCount+=1,this.selectingMovEvtCount<10))return;e.preventDefault(),this.selectingOffset[1]=[e.x+(((s=this.contentDOM)==null?void 0:s.scrollLeft)??0),e.y+(((c=this.contentDOM)==null?void 0:c.scrollTop)??0)];const t=this.getSelection(this.selectingOffset);this.nodeList.value.forEach((r,i)=>{let u=0;this.preSelectedNodeIndexSet.has(i)&&(u+=1),t.has(i)&&(u+=1),r._selected=u===1});const n=this.getSelection([this.selectingOffset[1],this.selectingOffset[1]]);n.size&&(this.lastSelectIndex=Array.from(n).pop()??-1),this.showSelectionOp.value=this.preSelectedNodeIndexSet.size+t.size>0}mouseUpEvt(e){this.selecting&&(e.preventDefault(),setTimeout(()=>{this.selecting=!1,this.selectingMovEvtCount=0,this.selectingOffset=[[0,0],[0,0]],this.preSelectedNodeIndexSet.clear(),this.selectingKeyDef=""},de.timeouts.selectEvt))}async contextMenuEvt(e){if(!this.inDetailView(e))return;let t=this.route.name==="Recycle",n=this.getSelected();if(!n.nodeLs||!n.nodeLs.length)return;let s=n.nodeLs.length!==1;const c=n.nodeLs,r=n.idSet;let i=this.localConfigure.get("file_view_mode")??"detail";this.route.name!=="Directory"&&(i="detail");let u=i==="detail";this.route.name==="Recycle"&&(u=!1),e.preventDefault(),e.stopPropagation(),this.contextStore.trigger([{title:"Open",auth:"guest",method:async a=>{console.info("Open",a),s?await ee.op_bath_browser(r,c):this.emitGo("node",c[0].id)}},{title:"Download",auth:s||c[0].type=="directory"?"none":"guest",method:a=>{var w,m;console.info("Download",a);const d=c[0];let p=(m=(w=d.file_index)==null?void 0:w.raw)==null?void 0:m.path,g=(d==null?void 0:d.title)??"";if(!p)return;let l=document.createElement("a");l.style.display="none",l.href=p+"?filename="+g,l.target="_blank",l.setAttribute("download",g),l.click()}},{title:"Download Selected",auth:s||c[0].type=="directory"?"guest":"none",method:async a=>{if(console.info("DownloadSelected",a),console.info(this,c),!G||!G.modalStore)return;const d=new is(c),p=F("downloading 0/0 (0%)"),g=G.modalStore.set({title:d.title,alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:p});await d.prepare();const l=setInterval(()=>{const w=d.downFile+d.downCur,m=d.downTotal,f=Math.round(1e4*w/m)/100+"%";g.content.text.value=`downloading ${w}/${m} (${f})`},500);await d.download(),await d.build(),await d.complete(),clearInterval(l),G.modalStore.close(g.nid)}},{title:"Rename",auth:u?"user":"none",method:async a=>{console.info("Rename",a),s?await ee.op_bath_rename(r,c):await ee.op_rename(c[0])}},{title:"Move",auth:u?"user":"none",method:async a=>{console.info("Move",a),s?await ee.op_bath_move(r,c):await ee.op_move(c[0])}},{title:"Delete",auth:t?"none":"user",method:async a=>{console.info("Delete",a),s?await ee.op_bath_delete(r,c):await ee.op_delete(c[0])}},{title:"Recover",auth:t?"user":"none",method:async a=>{console.info("Recover",a),s?await ee.op_bath_delete(r,c,!0):await ee.op_delete(c[0],!0)}},{title:"Delete Forever",auth:t?"user":"none",method:async a=>{console.info("Delete Forever",a),s?await ee.op_bath_delete_forever(r,c):await ee.op_delete_forever(c[0])}},{title:"Favourite",auth:u?"user":"none",method:async a=>{console.info("Favourite",a),s?await ee.op_bath_favourite(r,c):await ee.op_toggle_favourite(c[0])}},{title:"Share",auth:"user",method:async a=>{console.info("Share",a),await ee.op_share(r)}},{title:"Extra",auth:"guest",method:a=>{console.info("Extra",a)},child:[{title:"Tagging",auth:u?"user":"none",method:async a=>{console.info("Tagging",a),c.forEach(d=>{ee.op_tag(d)})}},{title:"Set Cover",auth:s?"none":"user",method:async a=>{console.info("Set Cover",a),await ee.op_set_cover(c[0])}},{title:"Import EHT",auth:"admin",method:async a=>{console.info("Import EHT",a),await ee.op_imp_tag_eh(Array.from(r))}},{title:"Cascade Tag",auth:"user",method:async a=>{console.info("Cascade Tag",a),await ee.op_cascade_tag(Array.from(r))}}]},{title:"Admin",auth:"admin",method:a=>{console.info("Extra",a)},child:[{title:"ReBuild",auth:"admin",method:async a=>{console.info("ReBuild",a),await ee.op_rebuild(Array.from(r))}},{title:"ReCheck",auth:s?"none":"admin",method:async a=>{console.info("ReCheck",a),await ee.op_recheck(Array.from(r))}},{title:"RM RAW",auth:"admin",method:async a=>{console.info("RMRAW",a),await ee.op_rm_raw(Array.from(r))}}]}],e)}getSelection(e){let t=e[0][0]>e[1][0]?e[1][0]:e[0][0],n=e[0][1]>e[1][1]?e[1][1]:e[0][1],s=e[0][0]<e[1][0]?e[1][0]:e[0][0],c=e[0][1]<e[1][1]?e[1][1]:e[0][1];const r=new Set;return this.nodeList.value.forEach((i,u)=>{if(!i._offsets)return;let a=i==null?void 0:i._offsets[0],d=i==null?void 0:i._offsets[1],p=i==null?void 0:i._offsets[2],g=i==null?void 0:i._offsets[3],l=a>=t&&a<=s||p>=t&&p<=s||a<=s&&p>=t,w=d>=n&&d<=c||g>=n&&g<=c||d<=c&&g>=n;!l||!w||r.add(u)}),r}clearSelect(e){e.target.classList.contains("content_detail")&&(this.nodeList.value.forEach(t=>{t._selected=!1}),this.showSelectionOp.value=!1)}async bathOp(e){let{idSet:t,nodeLs:n}=this.getSelected();if(t.size)switch(e){case"rename":await ee.op_bath_rename(t,n);break;case"move":await ee.op_bath_move(t,n);break;case"delete":await ee.op_bath_delete(t,n);break;case"delete_forever":await ee.op_bath_delete_forever(t,n);break;case"browser":await ee.op_bath_browser(t,n);break;case"favourite":await ee.op_bath_favourite(t,n);break}}getSelected(){const e=[],t=new Set;return this.nodeList.value.forEach(n=>{n._selected&&(e.push(n),t.add((n==null?void 0:n.id)??0))}),{nodeLs:e,idSet:t}}arrowSelection(e){if(!this.nodeList.value.length)return;let t=this.lastSelectIndex;if(t===-1){const a=this.getSelected();a.idSet.size?t=Array.from(a.idSet).pop()??0:t=0}this.localConfigure.get("file_view_mode"),this.route.name;const n=this.nodeList.value[t];if(!n)return;n._offsets||(n._offsets=[]);const s=n._offsets[2]-n._offsets[0],c=this.contentDOM.offsetWidth,r=Math.floor(c/s);let i=t;switch(e.key){case"ArrowRight":i+=1;break;case"ArrowLeft":i-=1;break;case"ArrowUp":i-=1*r;break;case"ArrowDown":i+=1*r;break}let u=!1;(e.ctrlKey||e.shiftKey)&&(u=!0),i<0&&(i=0),i>this.nodeList.value.length-1&&(i=this.nodeList.value.length-1),this.lastSelectIndex=i,this.nodeList.value.forEach((a,d)=>{if(i===d)return a._selected=!0;a._selected&&!u&&(a._selected=!1)})}setMode(e){this.localConfigure.set("file_view_mode",e),this.setList(this.nodeList.value)}setSort(e){console.info("setSort",e),this.localConfigure.set("file_view_sort",e);const t=this.nodeList.value;this.nodeList.value=[],setTimeout(()=>{this.nodeList.value=this.sortList(t,this.sortVal.value),this.setList(this.nodeList.value)},de.timeouts.sort)}sortList(e,t){return e=_n(e,t),e}async keymap(e){let t;const n=e.target;switch(e.key){case"F2":if(Me(n)||Fe(n))return;t=this.getSelected(),t.nodeLs.length!==1?await ee.op_bath_rename(t.idSet,t.nodeLs):await ee.op_rename(t.nodeLs[0]);break;case"Delete":if(Me(n)||Fe(n))return;t=this.getSelected(),this.route.name==="Recycle"?await ee.op_bath_delete_forever(t.idSet,t.nodeLs):await ee.op_bath_delete(t.idSet,t.nodeLs);break;case"NumpadEnter":case"Enter":if(Me(n)||Fe(n)||(t=this.getSelected(),!t.idSet.size))return;if(console.info(t.idSet.size),e.altKey&&t.idSet.size==1)return this.emitGo("node",Array.from(t.idSet)[0]);await ee.op_bath_browser(t.idSet,t.nodeLs);break;case"ArrowRight":case"ArrowLeft":case"ArrowUp":case"ArrowDown":return Me(n)||Fe(n)?void 0:this.arrowSelection(e)}}reloadOffset(e){if(this.reloadOffset_count>100)return;let t=!0;if(this.nodeList.value.forEach(n=>{n._dom||(t=!1)}),clearTimeout(this.reloadOffset_timer),!t){this.reloadOffset_timer=setTimeout(()=>{this.reloadOffset_count+=1,this.reloadOffset(e)},de.timeouts.offsetDebounce);return}this.nodeList.value.forEach(n=>{if(!n._dom)return;const s=n._dom;let c=0,r=0,i=0,u=0;c=fe.nodeOffsetX(s),r=fe.nodeOffsetY(s),i=c+s.offsetWidth,u=r+s.offsetHeight,n._offsets=[c,r,i,u]}),this.scrollEvt(e)}go(e){const t=Object.assign({id_dir:"",id_tag:""},e);this.router.push({path:"/",query:t})}scrollEvt(e){fe.debounce(()=>{this.saveScroll(),this.reloadLazyLoad()},de.timeouts.scrollEvt,"debounce_scroll_view")}saveScroll(){const e=this.route.query??{},t=[this.route.path,e.mode?e.mode:"",e.pid?e.pid:"",e.id?e.id:"",e.id?e.id:"",e.tag_id?e.tag_id:""].join(":"),n=[this.contentDOM.scrollTop,this.contentDOM.scrollLeft];!n[0]&&!n[1]||fe.debounce(()=>{kt("scroll_log",t,n)},de.timeouts.scrollSave,"debounce_scroll_save")}async reloadScroll(){const e=this.route.query??{},t=[this.route.path,e.mode?e.mode:"",e.pid?e.pid:"",e.id?e.id:"",e.id?e.id:"",e.tag_id?e.tag_id:""].join(":"),n=await bt("scroll_log",t);n&&(this.contentDOM.scrollTop=n[0]??0,this.contentDOM.scrollLeft=n[1]??0)}reloadLazyLoad(){if(!this.contentDOM)return;const e=this.contentDOM,t=fe.nodeOffsetY(e),n=e.scrollTop+t,s=n+e.clientHeight+t;this.nodeList.value.forEach(c=>{let r=!0;if(!c._offsets||!c._offsets.length)return;let i=c._offsets;i[1]>s&&(r=!1),i[3]<n&&(r=!1),c._in_screen=r})}}class ee{static async op_download(e){var n,s;let t=(s=(n=e.file_index)==null?void 0:n.raw)==null?void 0:s.path;t&&window.open(`${t}?filename=${e.title}`)}static async op_rename(e){if(e._renaming){const t=new FormData;t.set("id",`${e.id}`),t.set("title",e.title??""),t.set("description",e.description??""),await se("file/mod",t),G&&G.emitGo("reload")}e._renaming=!e._renaming,setTimeout(()=>{let t=document.body.querySelector('[contenteditable="true"]');t&&t.focus()},50)}static async op_bath_rename(e,t){G&&G.modalStore.set({title:"bath rename",alpha:!1,key:"",single:!1,w:400,h:275,minW:400,minH:275,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"renameUtil",data:{node_list:t,callback:()=>{G&&G.getList()}}}]})}static async op_move(e){G&&G.modalStore.set({title:`locator | move ${e.title} to:`,alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async t=>{const n=new FormData;n.set("id_node",`${e.id}`),n.set("id_target",`${t.id}`),await se("file/mov",n),G&&G.emitGo("reload")}}}]})}static async op_bath_move(e,t){G&&G.modalStore.set({title:`locator | move ${e.size} files to:`,alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async n=>{const s={id_list:Array.from(e).join(","),id_parent:`${n.id}`},c=await se("file/bath_move",s);G&&G.getList()}}}]})}static async op_delete(e,t=!1){const n=new FormData;n.set("id",`${e.id}`);const s=await se("file/delete",n);return console.info(G),G&&e.id&&G.deleteFromList([e.id]),s}static async op_bath_delete(e,t,n=!1,s){G&&G.modalStore.set({title:`confirm to ${n?"recover":"delete"} ${e.size} files`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:"conform to "+(n?"recover":"delete"),callback:{confirm:async c=>{const r=Array.from(e),i={id_list:r.join(",")},u=await se("file/bath_delete",i);G&&G.deleteFromList(r),s&&s()}}})}static async op_delete_forever(e){const t=new FormData;t.set("id",`${e.id}`);const n=await se("file/delete_forever",t);return G&&e.id&&G.deleteFromList([e.id]),n}static async op_bath_delete_forever(e,t){G&&G.modalStore.set({title:`confirm to delete ${e.size} files forever`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:"conform to delete forever",callback:{confirm:async n=>{const s=Array.from(e),c={id_list:s.join(",")},r=await se("file/bath_delete_forever",c);G&&G.deleteFromList(s)}}})}static async op_toggle_favourite(e){const t=await se("favourite_group/get",{}),n={};t&&t.forEach(s=>{s.auto||(n[s.id??0]=s.title??"")}),G&&G.modalStore.set({title:"select fav group:",alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"checkbox",label:"attach to",key:"target_group",value:e.list_fav,options:n}],callback:{submit:async function(s){const r=s.content.form[0].value.join(",");await se("favourite/attach",{id_node:e.id,list_group:r}),location.reload()}}})}static async op_bath_favourite(e,t){const n=await se("favourite_group/get",{}),s={};n&&n.forEach(c=>{c.auto||(s[c.id??0]=c.title??"")}),G&&G.modalStore.set({title:"select fav group:",alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"checkbox",label:"attach to:",key:"target_group",value:[],options:s}],callback:{submit:async function(c){const r=c.content.form[0].value.join(",");await se("favourite/bath_attach",{node_id_list:Array.from(e),list_group:r})}}})}static async op_bath_browser(e,t){let n=Array.from(e),s={};s.with="crumb,file",n.length==1?(s.mode="directory",s.id_dir=`${t[0].type==="directory"?t[0].id:t[0].id_parent}`):(s.mode="id_iterate",s.keyword=n.join(",")),s.cascade_dir="0",hs(s,n[0])}static async op_tag(e){if(e._tagging){const t=new Set;if(e.tag)for(let s=0;s<e.tag.length;s++)for(let c=0;c<e.tag[s].sub.length;c++){const r=e.tag[s].sub[c].id;r&&t.add(r)}const n=new FormData;n.set("id_node",`${e.id}`),n.set("tag_list",Array.from(t).join(",")),await se("tag/attach",n)}e._tagging=!e._tagging}static async op_set_cover(e){const t=new FormData;return t.set("id",`${e.id}`),await se("file/cover",t)}static async op_rebuild(e){const t=new FormData;return t.set("id_list",e.join(",")),await se("file/rebuild",t)}static async op_recheck(e){const t=new FormData;return t.set("id_list",e.join(",")),await se("file/rehash",t)}static async op_cascade_tag(e){const t=new FormData;return t.set("id_list",e.join(",")),await se("file/cascade_tag",t)}static async op_rm_raw(e){const t=new FormData;return t.set("id_list",e.join(",")),await se("file/rm_raw",t)}static async op_imp_tag_eh(e){const t=new FormData;return t.set("id_list",e.join(",")),await se("setting/import_eht_tag",t)}static async op_rate(e,t){if(!G)return;let n=G.getSelected();t&&!n.idSet.size&&(n.idSet.add((t==null?void 0:t.id)??0),n.nodeLs.push(t)),n.nodeLs.forEach(c=>{c.rate=e});const s=new FormData;s.set("node_id_list",Array.from(n.idSet).join(",")),s.set("rate",`${e}`),await se("rate/attach",s)}static async op_share(e){const t={title:"share file",alpha:!1,key:"",single:!1,w:400,h:120,minW:400,minH:120,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:'<a href="./share.html/#id#" target="_blank" style="text-decoration: underline">url generated<br> id: #id#</a>',callback:{submit:async n=>{}}};G.modalStore.set({title:"share file",alpha:!1,key:"",single:!1,w:400,h:160,minW:400,minH:160,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"radio",label:"duration",key:"status",value:"1",options:{1:"long",2:"1 day",3:"7 day",4:"30 day",5:"manual"},on_change:(n,s,c)=>{const r=new Date;switch(c.value){case"1":s.content.form[1].disabled=!0;break;case"2":s.content.form[1].disabled=!0,r.setDate(r.getDate()+1),s.content.form[1].value=r.toISOString().substring(0,16);break;case"3":s.content.form[1].disabled=!0,r.setDate(r.getDate()+7),s.content.form[1].value=r.toISOString().substring(0,16);break;case"4":s.content.form[1].disabled=!0,r.setDate(r.getDate()+30),s.content.form[1].value=r.toISOString().substring(0,16);break;case"5":s.content.form[1].disabled=!1,r.setDate(r.getDate()+30),s.content.form[1].value=r.toISOString().substring(0,16);break}}},{type:"datetime",label:"expire",key:"time_to",value:new Date().toISOString().substring(0,16),disabled:!0}],callback:{submit:async n=>{const s=new FormData;s.set("node_id_list",Array.from(e).join(",")),n.content.form[0].value=="0"?s.set("status",2):(s.set("status",1),s.set("time_to",n.content.form[1].value));const c=await se("share/set",s);c&&(t.text=t.text.replace(/#id#/ig,c.id),G.modalStore.set(t))}}})}}function hs(o,e){if(!G)return;let t=G.localConfigure.get("browser_layout_w"),n=G.localConfigure.get("browser_layout_h");const s=window.innerWidth,c=window.innerHeight;s<t&&(t=0),c<n&&(n=0),G.modalStore.set({title:"file browser",alpha:!1,key:"",single:!1,w:t||400,h:n||400,minW:400>window.innerWidth?window.innerWidth*.9:400,minH:400>window.innerHeight?window.innerHeight*.9:400,allow_resize:!0,allow_move:!0,allow_fullscreen:!0,auto_focus:!1,component:[{componentName:"fileBrowser",data:{query:fe.copyObject(o),curId:e}}]})}function _n(o,e){let t=["id","asc"];switch(e){default:case"id_asc":t=["id","asc"];break;case"id_desc":t=["id","desc"];break;case"name_asc":t=["title","asc"];break;case"name_desc":t=["title","desc"];break;case"crt_asc":t=["time_create","asc"];break;case"crt_desc":t=["time_create","desc"];break;case"upd_asc":t=["time_update","asc"];break;case"upd_desc":t=["time_update","desc"];break;case"rate_asc":t=["rate","asc"];break;case"rate_desc":t=["rate","desc"];break}for(let c=0;c<o.length;c++){const r=o[c];r._sort_index||(r._sort_index=r.node_path+"/"+r.title)}const n=t[1]==="desc",s=n?-1:1;return o.sort((c,r)=>{let i="",u="";switch(t[0]){default:i=c[t[0]],u=r[t[0]];break;case"title":return i=s*(c.type==="directory"?0:1)+(c._sort_index??""),u=s*(r.type==="directory"?0:1)+(r._sort_index??""),fs({desc:n,insensitive:!0})(i,u)}return(i>u?1:-1)*s}),o}const ps={class:"modal_browser base"},ms={class:"base"},vs={class:"l"},_s={class:"r"},gs={class:"content"},qt=ve({__name:"browserBase",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},setup(o){const e=o;return(t,n)=>(R(),P("div",ps,[$("div",ms,[$("div",vs,[me(t.$slots,"info")]),$("div",_s,[me(t.$slots,"btnContainer")])]),me(t.$slots,"navigator"),$("div",gs,[$("span",{class:ue(["listIcon",`listIcon_file_${e.curNode.type}`]),style:be({fontSize:e.modalData.layout.h*.5+"px",lineHeight:e.modalData.layout.h*.8+"px"})},null,6)])]))}}),ys={class:"modal_browser image"},ws={class:"base"},bs={class:"l"},ks={class:"btnContainer"},xs={class:"r"},Es={key:0,class:"loader sysIcon sysIcon_sync"},Ss=["data-ref-node-id","src","data-rotate"],Ls=ve({__name:"browserImage",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},emits:["nav"],setup(o,{emit:e}){const t=Ve(),n=o,s=e,c=[.1,.25,.5,.75,1,1.25,1.5,2],r=F(null),i=F(null),u=F({loaded:0,w:0,h:0,x:0,y:0,rotate:0,orgRatio:0,ratio:0,ratioTxt:"0 %",orgW:0,orgH:0}),a=F();async function d(E){const D=i.value;if(!D)return;if(!D.complete)return setTimeout(d,50);const I=await bt("image_rotate",n.curNode.id);Object.assign(u.value,{loaded:n.curNode.id,orgH:D.naturalHeight,orgW:D.naturalWidth,rotate:I}),await g()}ye(()=>{a.value=p(n.curNode),Object.assign(u.value,{loaded:0,w:0,h:0,x:0,y:0,rotate:0,orgW:0,orgH:0}),document.addEventListener(`modal_resizing_${n.modalData.nid}`,g),document.addEventListener("pointerup",f),document.addEventListener("pointermove",m),document.addEventListener("wheel",v),document.addEventListener("keydown",M),document.addEventListener("pointercancel",f),document.addEventListener("pointerout",f)}),Pe(()=>n.curNode,async E=>{console.info("onMod props.curNode"),u.value.loaded=0;const D=p(E),I=new Image;I.src=D,I.onload=j=>{a.value=D}}),Le(()=>{document.removeEventListener(`modal_resizing_${n.modalData.nid}`,g),document.removeEventListener("pointerup",f),document.removeEventListener("pointermove",m),document.removeEventListener("wheel",v),document.removeEventListener("keydown",M),document.removeEventListener("pointercancel",f),document.removeEventListener("pointerout",f)});function p(E){var D,I;return((I=(D=E.file_index)==null?void 0:D.normal)==null?void 0:I.path)+"?filename="+E.title}async function g(){if(!u.value.loaded)return;const E=n.modalData.layout,D=E.w??0;let I=E.h??0;I-=16;const j=u.value,te=Math.abs(j.rotate%180-90)<45,U=D/(te?j.orgH:j.orgW),J=I/(te?j.orgW:j.orgH),Q={w:0,h:0,x:0,y:0,ratio:0,orgRatio:0,ratioTxt:"0 %"},ce=Math.min(U,J);Q.w=j.orgW*ce,Q.h=j.orgH*ce,Q.x=(D-Q.w)/2,Q.y=(I-Q.h)/2,Q.ratio=ce,Q.orgRatio=ce,Q.ratioTxt=Math.round(ce*1e3)/10+" %",Object.assign(u.value,Q)}const l=new Map;function w(E){if(!n.modalData.layout.active||!E.pointerId)return;E.preventDefault(),E.stopPropagation(),u.value;const D={x:E.clientX,y:E.clientY};l.set(E.pointerId,D)}function m(E){n.modalData.layout.active&&E.pointerId&&(E.preventDefault(),E.stopPropagation(),x(E))}function f(E){l.get(E.pointerId)&&l.delete(E.pointerId)}function x(E){const D=l.get(E.pointerId);if(!D||Math.abs(E.clientX-D.x)<1&&Math.abs(E.clientY-D.y)<1)return;const I=u.value,j=i.value,te=r.value;if(!j||!te)return;if(l.size==1){const C={x:E.clientX-D.x+I.x,y:E.clientY-D.y+I.y};Object.assign(u.value,C),l.set(E.pointerId,{x:E.clientX,y:E.clientY});return}const U={x:0,y:0,pointerCount:0};l.forEach((C,H,X)=>{H!=E.pointerId&&(U.x+=C.x,U.y+=C.y,U.pointerCount+=1)}),U.x=U.x/U.pointerCount,U.y=U.y/U.pointerCount;const J={orgX:D.x-U.x,orgY:D.y-U.y,tgtX:E.clientX-U.x,tgtY:E.clientY-U.y},Q={x:0,y:0,w:0,h:0,ratio:I.ratio*Math.sqrt((J.tgtX*J.tgtX+J.tgtY*J.tgtY)/(J.orgX*J.orgX+J.orgY*J.orgY)),ratioTxt:"0 %"};Q.ratio>5&&(Q.ratio=5),Q.w=I.orgW*Q.ratio,Q.h=I.orgH*Q.ratio;const ce=te.clientWidth??0,he=te.clientHeight??0,{x:z,y:A}=fe.nodeOffsetXY(te),V=j.clientWidth??0,q=j.clientHeight??0,{x:B,y:O}=fe.nodeOffsetXY(j),T=(E.clientX-D.x)/2,Y=(E.clientY-D.y)/2,K=U.x-z-ce/2,L=U.y-A-he/2,y=(U.x-(B+V/2))/I.ratio*Q.ratio,b=(U.y-(O+q/2))/I.ratio*Q.ratio;Q.x=(ce-Q.w)/2+K-y+T,Q.y=(he-Q.h)/2+L-b+Y,Q.ratioTxt=Math.round(Q.ratio*1e4)/100+" %",Object.assign(u.value,Q),l.set(E.pointerId,{x:E.clientX,y:E.clientY})}const h=F(t.get("browser_image_scrollLock")??!1);function _(E){h.value=E,t.set("browser_image_scrollLock",E)}function v(E){let D=E==null?void 0:E.target,I;do if(I=D.getAttribute("data-ref-id"),I||!D.parentElement||(D=D.parentElement,D.tagName==="BODY"))break;while(!0);if(I!==n.modalData.nid)return;const j=E.deltaY<0?1:-1;h.value?s("nav",n.curIndex-j):k(j,E.clientX,E.clientY)}function k(E,D,I){const j=u.value,te=i.value,U=r.value;if(!te||!U)return;let J=[];const Q=j.ratio;J.push(...c,j.ratio,j.orgRatio);const ce=new Set(J);J=Array.from(ce),J.sort();const he=J.indexOf(j.ratio)+E;if(he<0||he>=J.length)return;const z=J[he],A=U.clientWidth??0,V=U.clientHeight??0,{x:q,y:B}=fe.nodeOffsetXY(U);Math.abs(j.rotate%180-90)<45;const O={w:j.orgW*z,h:j.orgH*z,x:0,y:0,ratio:z,ratioTxt:Math.round(z*1e4)/100+" %"};if(D===void 0||I===void 0){O.x=(A-O.w)/2,O.y=(V-O.h)/2,Object.assign(u.value,O);return}const T=te.clientWidth??0,Y=te.clientHeight??0,{x:K,y:L}=fe.nodeOffsetXY(te),y=D-q-A/2,b=I-B-V/2,C=(D-(K+T/2))/Q*O.ratio,H=(I-(L+Y/2))/Q*O.ratio;O.x=(A-O.w)/2+y-C,O.y=(V-O.h)/2+b-H,Object.assign(u.value,O)}function M(E){if(!Me(E.target)&&n.modalData.layout.active)switch(E.code){case"KeyQ":S(-90);break;case"KeyE":S(90);break}}function S(E){let D={rotate:u.value.rotate},I=D.rotate+E;for(;I<0;)I+=360;for(;I>360;)I-=360;D.rotate=I,kt("image_rotate",n.curNode.id,I),Object.assign(u.value,D),g()}return(E,D)=>(R(),P("div",ys,[$("div",ws,[$("div",bs,[me(E.$slots,"info"),$("div",ks,[$("button",{class:ue(["sysIcon","sysIcon_scroll",h.value?"active":""]),onClick:D[0]||(D[0]=I=>_(!h.value))},null,2),$("button",{class:ue(["sysIcon","sysIcon_zoomout"]),onClick:D[1]||(D[1]=I=>k(-1))}),$("button",{onClick:g},re(u.value.ratioTxt),1),$("button",{class:ue(["sysIcon","sysIcon_zoomin"]),onClick:D[2]||(D[2]=I=>k(1))})])]),$("div",xs,[me(E.$slots,"btnContainer")])]),me(E.$slots,"navigator"),$("div",{class:"content",ref_key:"contentDOM",ref:r},[u.value.loaded?le("",!0):(R(),P("span",Es)),$("img",{"data-ref-node-id":n.curNode.id,src:a.value,"data-rotate":u.value.rotate,onPointerdown:w,onDblclick:D[3]||(D[3]=(...I)=>E.resetImgresetImg&&E.resetImgresetImg(...I)),onLoad:d,class:ue({loading:!u.value.loaded}),style:be({width:u.value.w+"px",height:u.value.h+"px",left:u.value.x+"px",top:u.value.y+"px",rotate:u.value.rotate+"deg"}),ref_key:"imgDOM",ref:i},null,46,Ss)],512)]))}}),Ds={class:"modal_browser audio"},$s={class:"base"},Os={class:"l"},Cs={class:"btnContainer"},Ms={class:"r"},Is={key:0,class:"loader sysIcon sysIcon_sync"},Rs=["src"],Ps=["data-item-id","poster"],As=["src"],Ts=ve({__name:"browserAudio",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},emits:["nav"],setup(o,{emit:e}){var ce,he,z,A,V,q,B;const t=Ve(),n=o,s=e,c=F(null),r=F(null),i=F(null),u=F("");(z=(he=(ce=n.curNode)==null?void 0:ce.file_index)==null?void 0:he.normal)!=null&&z.path?u.value=`${(V=(A=n.curNode.file_index)==null?void 0:A.normal)==null?void 0:V.path}?filename=${n.curNode.title}`:u.value=`${(B=(q=n.curNode.file_index)==null?void 0:q.raw)==null?void 0:B.path}?filename=${n.curNode.title}`;const a=F({duration:0,buffered:0,time:0,volume:t.get("browser_play_volume")?t.get("browser_play_volume"):100,brightness:t.get("browser_play_brightness")?t.get("browser_play_brightness"):1,mute:!1,play:!1,loading:!0,loop:t.get("browser_play_mode")==="single"}),d=t.listen("browser_play_mode",O=>Object.assign(a.value,{loop:O==="single"})),p=t.listen("browser_play_volume",O=>Object.assign(a.value,{volume:O})),g=t.listen("browser_play_brightness",O=>Object.assign(a.value,{brightness:O}));function l(){var K;console.info("onInit");const O=i.value;if(!O)return;if(O.readyState!==4)return setTimeout(l,50);const T=a.value,Y={time:0,duration:O.duration};Object.assign(a.value,Y),T.play&&O.play(),O.volume=T.mute?0:T.volume/100,(K=c.value)==null||K.addEventListener("wheel",U)}function w(O){console.info("onCanplay"),i.value&&(document.addEventListener("keydown",J),Object.assign(a.value,{loading:!1}))}function m(O=!0){var T;document.removeEventListener("wheel",U),document.removeEventListener("keydown",J),u.value="",i.value&&((T=i.value)==null||T.load()),O&&Object.assign(a.value,{loading:!0})}function f(){const O=i.value;if(!O)return;const T=a.value;T.play?O.pause():O.play(),Object.assign(a.value,{play:!T.play})}function x(O){console.info("onEnd",O);const T=i.value;if(!T)return;if(a.value.loop){T.currentTime=0,T.play();return}s("nav",n.curIndex+1)}ye(async()=>{var O;i.value&&((O=i.value)==null||O.load()),h=setInterval(_,200)}),Pe(()=>n.curNode,async O=>{var T,Y,K,L,y,b,C,H;m(),(K=(Y=(T=n.curNode)==null?void 0:T.file_index)==null?void 0:Y.normal)!=null&&K.path?u.value=`${(y=(L=O.file_index)==null?void 0:L.normal)==null?void 0:y.path}?filename=${O.title}`:u.value=`${(C=(b=O.file_index)==null?void 0:b.raw)==null?void 0:C.path}?filename=${O.title}`,i.value&&((H=i.value)==null||H.load())}),gt(()=>{m(!1),t.release("browser_play_mode",d),t.release("browser_play_volume",p),t.release("browser_play_brightness",g),clearInterval(h)});let h=0;function _(){if(!i.value||!i.value.buffered||!i.value.buffered.length)return;let O=0;for(let T=0;T<i.value.buffered.length;T++){const Y=i.value.buffered.end(T);if(!(a.value.time>Y)){O=Y;break}}Object.assign(a.value,{buffered:O})}function v(O){const T=i.value;T&&Object.assign(a.value,{time:T.currentTime})}const k={active:!1,x:0,y:0,w:0,h:0,orgX:0,orgY:0,left:0,right:0,t:0};let M=0;function S(O){if(M)return;const T=i.value;if(!T)return;const Y=r.value;if(!Y)return;M=O.pointerId,document.addEventListener("pointermove",E),document.addEventListener("pointerup",D);const K={active:!0,x:O.clientX,w:Y.clientWidth,orgX:fe.nodeOffsetX(Y)};Object.assign(k,K);const L=(K.x-K.orgX)/K.w;T.currentTime=T.duration*L,Object.assign(a.value,{time:T.currentTime})}function E(O){if(O.pointerId!=M||(O.preventDefault(),O.stopPropagation(),!k.active))return;const T=i.value;if(!T)return;Object.assign(k,{x:O.clientX});let Y=(k.x-k.orgX)/k.w;Y>1&&(Y=1),Y<0&&(Y=0),T.currentTime=T.duration*Y,Object.assign(a.value,{time:T.currentTime})}function D(O){O.pointerId==M&&(M=0,Object.assign(k,{active:!1}),document.removeEventListener("pointermove",E),document.removeEventListener("pointerup",D))}function I(O){if(M||!i.value)return;const Y=c.value;if(!Y)return;M=O.pointerId,O.preventDefault(),O.stopPropagation(),document.addEventListener("pointermove",j),document.addEventListener("pointerup",te);const K={active:!0,x:O.clientX,y:O.clientY,w:Y.clientWidth,h:Y.clientHeight,orgX:fe.nodeOffsetX(Y),orgY:fe.nodeOffsetX(Y),left:0,right:0,t:new Date().valueOf()},L=(K.x-K.orgX)/K.w;L>.5&&(K.right=1),L<.5&&(K.left=1),Object.assign(k,K)}function j(O){if(O.pointerId!=M||(O.preventDefault(),O.stopPropagation(),!k.active))return;const T=i.value;if(!T||!c.value)return;const K=(O.clientY-k.y)/k.h;Object.assign(k,{y:O.clientY});const L=a.value;if(k.right){let y=L.volume-K*100*1.5;y<0&&(y=0),y>100&&(y=100),T.volume=y/100,t.set("browser_play_volume",y)}if(k.left){let y=L.brightness-K;y<0&&(y=0),y>1&&(y=1),L.brightness=y,t.set("browser_play_brightness",y)}}function te(O){if(O.pointerId!=M)return;M=0;const T=new Date().valueOf();k.t>T-250&&f(),Object.assign(k,{active:!1}),document.removeEventListener("pointermove",j),document.removeEventListener("pointerup",te)}function U(O){const T=i.value;if(!T)return;let K=a.value.volume+(O.deltaY<0?5:-5);K<0&&(K=0),K>100&&(K=100),T.volume=K/100,t.set("browser_play_volume",K)}function J(O){if(!Me(O.target)&&n.modalData.layout.active)switch(O.key){case" ":f();break;case"ArrowUp":U({deltaY:-1});break;case"ArrowDown":U({deltaY:1});break;case"ArrowLeft":case"ArrowRight":const T=i.value;if(!T)return;T.currentTime+=O.key==="ArrowLeft"?-5:5,Object.assign(a.value,{time:T.currentTime});break}}function Q(O){const T={h:""+Math.floor(O/3600),m:""+Math.floor(O/60%60),s:""+Math.floor(O%60)};T.m.length<2&&(T.m="0"+T.m),T.s.length<2&&(T.s="0"+T.s);let Y=""+T.s;return(T.m||T.h)&&(Y=`${T.m}:${Y}`),T.h!=="0"&&(Y=`${T.h}:${Y}`),Y}return(O,T)=>{var Y,K,L,y,b;return R(),P("div",Ds,[$("div",$s,[$("div",Os,[me(O.$slots,"info"),$("div",Cs,[$("button",{class:ue({sysIcon:!0,sysIcon_volume:!a.value.mute&&a.value.volume,sysIcon_mute:a.value.mute,sysIcon_mutemode:!a.value.mute&&!a.value.volume})},re(Math.round(a.value.volume)),3),$("button",{class:ue({sysIcon:!0,sysIcon_caretright:a.value.play,sysIcon_pause:!a.value.play})},re(Q(a.value.time)),3),$("div",{class:ue(["audio_bar"]),onPointerdown:S,ref_key:"timelineDOM",ref:r},[$("span",{class:"duration",style:be({left:100*a.value.time/a.value.duration+"%"})},null,4),$("span",{class:"buffer",style:be({width:100*a.value.buffered/a.value.duration+"%"})},null,4)],544)])]),$("div",Ms,[me(O.$slots,"btnContainer")])]),me(O.$slots,"navigator"),$("div",{class:"content",ref_key:"contentDOM",ref:c,onPointerdown:I},[a.value.loading?(R(),P("span",Is)):le("",!0),(Y=n.curNode.file_index)!=null&&Y.preview?(R(),P("img",{key:1,src:(L=(K=n.curNode.file_index)==null?void 0:K.preview)==null?void 0:L.path,style:be({filter:`brightness(${a.value.brightness})`})},null,12,Rs)):(R(),P("span",{key:2,class:ue(["listIcon",`listIcon_file_${n.curNode.type}`]),style:be({fontSize:n.modalData.layout.h*.5+"px",lineHeight:n.modalData.layout.h*.8+"px"})},null,6)),$("audio",{ref_key:"mediaDOM",ref:i,preload:"metadata","data-item-id":n.curNode.id,poster:(b=(y=n.curNode.file_index)==null?void 0:y.preview)==null?void 0:b.path,onLoadedmetadata:l,onCanplay:w,onEnded:x,onTimeupdate:v},[$("source",{src:u.value},null,8,As)],40,Ps)],544)])}}}),Ns={class:"modal_browser video"},Hs={class:"base"},zs={class:"l"},js={class:"btnContainer"},Bs=["value"],Ws={class:"r"},Vs={key:0,class:"loader sysIcon sysIcon_sync"},Us=["data-item-id","poster"],Fs=["src"],Xs=["default","src","srclang","label"],Ys=["default","src","srclang","label"],qs=ve({__name:"browserVideo",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},emits:["nav"],setup(o,{emit:e}){var q,B,O,T,Y,K,L;const t=Ve(),n=o,s=e,c=F(null),r=F(null),i=F(null),u=F("");(O=(B=(q=n.curNode)==null?void 0:q.file_index)==null?void 0:B.normal)!=null&&O.path?u.value=`${(Y=(T=n.curNode.file_index)==null?void 0:T.normal)==null?void 0:Y.path}?filename=${n.curNode.title}`:u.value=`${(L=(K=n.curNode.file_index)==null?void 0:K.raw)==null?void 0:L.path}?filename=${n.curNode.title}`;const a=F({duration:0,buffered:0,time:0,volume:t.get("browser_play_volume")?t.get("browser_play_volume"):100,brightness:t.get("browser_play_brightness")?t.get("browser_play_brightness"):1,mute:!1,play:!1,loading:!0,loop:t.get("browser_play_mode")==="single"}),d=t.listen("browser_play_mode",y=>Object.assign(a.value,{loop:y==="single"})),p=t.listen("browser_play_volume",y=>Object.assign(a.value,{volume:y})),g=t.listen("browser_play_brightness",y=>Object.assign(a.value,{brightness:y}));function l(){var H;console.info("onInit");const y=i.value;if(!y)return;if(y.readyState!==4)return setTimeout(l,50);const b=a.value,C={time:0,duration:y.duration};Object.assign(a.value,C),b.play&&y.play(),y.volume=b.mute?0:b.volume/100,(H=c.value)==null||H.addEventListener("wheel",J)}function w(y){console.info("onCanplay"),i.value&&(document.addEventListener("keydown",Q),Object.assign(a.value,{loading:!1}))}function m(y=!0){var b;document.removeEventListener("wheel",J),document.removeEventListener("keydown",Q),u.value="",i.value&&((b=i.value)==null||b.load()),y&&Object.assign(a.value,{loading:!0})}function f(){const y=i.value;if(!y)return;const b=a.value;b.play?y.pause():y.play(),Object.assign(a.value,{play:!b.play})}function x(y){console.info("onEnd",y);const b=i.value;if(!b)return;if(a.value.loop){b.currentTime=0,b.play();return}s("nav",n.curIndex+1)}ye(async()=>{var y;await h(),i.value&&((y=i.value)==null||y.load()),_=setInterval(v,200)});async function h(){z.value=[],A()}Pe(()=>n.curNode,async y=>{var b,C,H,X,N,W,ne,we;m(),h(),(H=(C=(b=n.curNode)==null?void 0:b.file_index)==null?void 0:C.normal)!=null&&H.path?u.value=`${(N=(X=y.file_index)==null?void 0:X.normal)==null?void 0:N.path}?filename=${y.title}`:u.value=`${(ne=(W=y.file_index)==null?void 0:W.raw)==null?void 0:ne.path}?filename=${y.title}`,i.value&&((we=i.value)==null||we.load())}),gt(()=>{m(!1),t.release("browser_play_mode",d),t.release("browser_play_volume",p),t.release("browser_play_brightness",g),clearInterval(_)});let _=0;function v(){if(!i.value||!i.value.buffered||!i.value.buffered.length)return;let y=0;for(let b=0;b<i.value.buffered.length;b++){const C=i.value.buffered.end(b);if(!(a.value.time>C)){y=C;break}}Object.assign(a.value,{buffered:y})}function k(y){const b=i.value;b&&Object.assign(a.value,{time:b.currentTime})}const M={active:!1,x:0,y:0,w:0,h:0,orgX:0,orgY:0,left:0,right:0,t:0};let S=0;function E(y){if(S)return;const b=i.value;if(!b)return;const C=r.value;if(!C)return;S=y.pointerId,document.addEventListener("pointermove",D),document.addEventListener("pointerup",I);const H={active:!0,x:y.clientX,w:C.clientWidth,orgX:fe.nodeOffsetX(C)};Object.assign(M,H);const X=(H.x-H.orgX)/H.w;b.currentTime=b.duration*X,Object.assign(a.value,{time:b.currentTime})}function D(y){if(y.pointerId!=S||(y.preventDefault(),y.stopPropagation(),!M.active))return;const b=i.value;if(!b)return;Object.assign(M,{x:y.clientX});let C=(M.x-M.orgX)/M.w;C>1&&(C=1),C<0&&(C=0),b.currentTime=b.duration*C,Object.assign(a.value,{time:b.currentTime})}function I(y){y.pointerId==S&&(S=0,Object.assign(M,{active:!1}),document.removeEventListener("pointermove",D),document.removeEventListener("pointerup",I))}function j(y){if(S||!i.value)return;const C=c.value;if(!C)return;S=y.pointerId,y.preventDefault(),y.stopPropagation(),document.addEventListener("pointermove",te),document.addEventListener("pointerup",U);const H={active:!0,x:y.clientX,y:y.clientY,w:C.clientWidth,h:C.clientHeight,orgX:fe.nodeOffsetX(C),orgY:fe.nodeOffsetX(C),left:0,right:0,t:new Date().valueOf()},X=(H.x-H.orgX)/H.w;X>.5&&(H.right=1),X<.5&&(H.left=1),Object.assign(M,H)}function te(y){if(y.pointerId!=S||(y.preventDefault(),y.stopPropagation(),!M.active))return;const b=i.value;if(!b||!c.value)return;const H=(y.clientY-M.y)/M.h;Object.assign(M,{y:y.clientY});const X=a.value;if(M.right){let N=X.volume-H*100*1.5;N<0&&(N=0),N>100&&(N=100),b.volume=N/100,t.set("browser_play_volume",N)}if(M.left){let N=X.brightness-H;N<0&&(N=0),N>1&&(N=1),X.brightness=N,t.set("browser_play_brightness",N)}}function U(y){if(y.pointerId!=S)return;S=0;const b=new Date().valueOf();M.t>b-250&&f(),Object.assign(M,{active:!1}),document.removeEventListener("pointermove",te),document.removeEventListener("pointerup",U)}function J(y){const b=i.value;if(!b)return;let H=a.value.volume+(y.deltaY<0?5:-5);H<0&&(H=0),H>100&&(H=100),b.volume=H/100,t.set("browser_play_volume",H)}function Q(y){if(!Me(y.target)&&n.modalData.layout.active)switch(y.key){case" ":f();break;case"ArrowUp":J({deltaY:-1});break;case"ArrowDown":J({deltaY:1});break;case"ArrowLeft":case"ArrowRight":const b=i.value;if(!b)return;b.currentTime+=y.key==="ArrowLeft"?-5:5,Object.assign(a.value,{time:b.currentTime});break}}function ce(y){const b={h:""+Math.floor(y/3600),m:""+Math.floor(y/60%60),s:""+Math.floor(y%60)};b.m.length<2&&(b.m="0"+b.m),b.s.length<2&&(b.s="0"+b.s);let C=""+b.s;return(b.m||b.h)&&(C=`${b.m}:${C}`),b.h!=="0"&&(C=`${b.h}:${C}`),C}const he=F(0),z=F([]);function A(){var H,X;let y=(H=n.curNode.title)==null?void 0:H.lastIndexOf("."),b=((X=n.curNode.title)==null?void 0:X.substring(0,y))??"";if(!b)return z.value=[];const C=[];n.nodeList.forEach(N=>{var ne,we,_e,St,Lt,Dt;if(N.type!=="subtitle"||!((we=(ne=N.file_index)==null?void 0:ne.normal)!=null&&we.path||(St=(_e=N.file_index)==null?void 0:_e.raw)!=null&&St.path))return;let W=(Lt=N.title)==null?void 0:Lt.substring(b.length);((Dt=N.title)==null?void 0:Dt.indexOf(b))===0&&C.push(Object.assign({label:W},N))}),z.value=C}function V(y){var C;const b=(C=i.value)==null?void 0:C.textTracks;if(b)for(let H=0;H<b.length;H++)y==H?b[H].mode="showing":b[H].mode="disabled"}return(y,b)=>{var C,H;return R(),P("div",Ns,[$("div",Hs,[$("div",zs,[me(y.$slots,"info"),$("div",js,[$("button",{class:ue({sysIcon:!0,sysIcon_volume:!a.value.mute&&a.value.volume,sysIcon_mute:a.value.mute,sysIcon_mutemode:!a.value.mute&&!a.value.volume})},re(Math.round(a.value.volume)),3),$("button",{class:ue({sysIcon:!0,sysIcon_caretright:a.value.play,sysIcon_pause:!a.value.play})},re(ce(a.value.time)),3),$("div",{class:ue(["video_bar"]),onPointerdown:E,ref_key:"timelineDOM",ref:r},[$("span",{class:"duration",style:be({left:100*a.value.time/a.value.duration+"%"})},null,4),$("span",{class:"buffer",style:be({width:100*a.value.buffered/a.value.duration+"%"})},null,4)],544),z.value&&z.value.length?ge((R(),P("select",{key:0,"onUpdate:modelValue":b[0]||(b[0]=X=>he.value=X),onChange:b[1]||(b[1]=X=>V(he.value))},[(R(!0),P(Z,null,pe(z.value,(X,N)=>(R(),P("option",{value:N,key:"MO_BS_VDO_"+y.modalData.nid+"_sub_"+N},re(X.label),9,Bs))),128))],544)),[[ze,he.value]]):le("",!0)])]),$("div",Ws,[me(y.$slots,"btnContainer")])]),me(y.$slots,"navigator"),$("div",{class:"content",ref_key:"contentDOM",ref:c,onPointerdown:j},[a.value.loading?(R(),P("span",Vs)):le("",!0),$("video",{ref_key:"mediaDOM",ref:i,preload:"metadata","data-item-id":n.curNode.id,poster:(H=(C=n.curNode.file_index)==null?void 0:C.preview)==null?void 0:H.path,onLoadedmetadata:l,onCanplay:w,onEnded:x,onTimeupdate:k,style:be({filter:`brightness(${a.value.brightness})`})},[$("source",{src:u.value},null,8,Fs),(R(!0),P(Z,null,pe(z.value,(X,N)=>{var W;return R(),P(Z,null,[(W=X.file_index)!=null&&W.normal?(R(),P("track",{key:"MO_BS_VDO_"+y.modalData.nid+"_track_"+N,default:he.value==N,src:X.file_index.normal.path,kind:"subtitles",srclang:X.label,label:X.label},null,8,Xs)):(R(),P("track",{key:"MO_BS_VDO_"+y.modalData.nid+"_track_"+N,default:he.value==N,src:X.file_index.raw.path,kind:"subtitles",srclang:X.label,label:X.label},null,8,Ys))],64)}),256))],44,Us)],544)])}}}),Ks={class:"modal_browser txt"},Gs={class:"base"},Qs={class:"l"},Js={class:"r"},Zs={class:"content"},ea=ve({__name:"browserText",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},setup(o){const e=o,t=F(""),n=F(null);async function s(i){const a=await(await fetch(i.path,{method:"GET",headers:{}})).text();t.value=a,await r()}async function c(i){fe.debounce(()=>{if(!n.value)return;const u=[n.value.scrollTop,n.value.scrollLeft];if(!u[0]&&!u[1])return;const a=`browser:${e.curNode.id}`;fe.debounce(()=>{kt("scroll_log",a,u)},de.timeouts.scrollSave,"debounce_scroll_save")},de.timeouts.scrollEvt,"debounce_scroll_view")}async function r(){if(!n.value)return;n.value.scrollTop=0,n.value.scrollLeft=0;const i=`browser:${e.curNode.id}`,u=await bt("scroll_log",i);u&&(n.value.scrollTop=u[0],n.value.scrollLeft=u[1])}return ye(async()=>{var i;e.curNode&&e.curNode.file_index&&e.curNode.file_index.raw&&await s(e.curNode.file_index.raw),n.value&&((i=n.value)==null||i.addEventListener("scroll",c))}),Pe(()=>e.curNode,async i=>{i.file_index&&i.file_index.raw&&await s(i.file_index.raw)}),gt(()=>{}),(i,u)=>(R(),P("div",Ks,[$("div",Gs,[$("div",Qs,[me(i.$slots,"info")]),$("div",Js,[me(i.$slots,"btnContainer")])]),me(i.$slots,"navigator"),$("div",Zs,[$("div",{class:"textContent",ref_key:"contentDOM",ref:n},re(t.value),513)])]))}}),ta={class:"modal_browser pdf"},na={class:"base"},oa={class:"l"},sa={class:"r"},aa={class:"content"},ra=["src"],ia=ve({__name:"browserPDF",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},setup(o){const e=o;""+e.modalData.nid,F(null);const t=F(null);return ye(()=>{var n,s;console.warn("mounted"),t.value="/pdfjs/web/viewer.html?file="+((s=(n=e.curNode.file_index)==null?void 0:n.raw)==null?void 0:s.path)+"&filename="+e.curNode.title}),Pe(()=>e.curNode,async n=>{var s,c;console.info("onMod props.curNode"),t.value="/pdfjs/web/viewer.html?file="+((c=(s=n.file_index)==null?void 0:s.raw)==null?void 0:c.path)+"&filename="+n.title}),Le(()=>{t.value=null}),(n,s)=>(R(),P("div",ta,[$("div",na,[$("div",oa,[me(n.$slots,"info")]),$("div",sa,[me(n.$slots,"btnContainer")])]),me(n.$slots,"navigator"),$("div",aa,[t.value?(R(),P("iframe",{key:0,src:t.value,allowfullscreen:""},null,8,ra)):le("",!0)])]))}});var nt={},Ee=Ee||function(o,e){var t={},n=t.lib={},s=function(){},c=n.Base={extend:function(l){s.prototype=this;var w=new s;return l&&w.mixIn(l),w.hasOwnProperty("init")||(w.init=function(){w.$super.init.apply(this,arguments)}),w.init.prototype=w,w.$super=this,w},create:function(){var l=this.extend();return l.init.apply(l,arguments),l},init:function(){},mixIn:function(l){for(var w in l)l.hasOwnProperty(w)&&(this[w]=l[w]);l.hasOwnProperty("toString")&&(this.toString=l.toString)},clone:function(){return this.init.prototype.extend(this)}},r=n.WordArray=c.extend({init:function(l,w){l=this.words=l||[],this.sigBytes=w!=e?w:4*l.length},toString:function(l){return(l||u).stringify(this)},concat:function(l){var w=this.words,m=l.words,f=this.sigBytes;if(l=l.sigBytes,this.clamp(),f%4)for(var x=0;x<l;x++)w[f+x>>>2]|=(m[x>>>2]>>>24-8*(x%4)&255)<<24-8*((f+x)%4);else if(65535<m.length)for(x=0;x<l;x+=4)w[f+x>>>2]=m[x>>>2];else w.push.apply(w,m);return this.sigBytes+=l,this},clamp:function(){var l=this.words,w=this.sigBytes;l[w>>>2]&=4294967295<<32-8*(w%4),l.length=o.ceil(w/4)},clone:function(){var l=c.clone.call(this);return l.words=this.words.slice(0),l},random:function(l){for(var w=[],m=0;m<l;m+=4)w.push(4294967296*o.random()|0);return new r.init(w,l)}}),i=t.enc={},u=i.Hex={stringify:function(l){var w=l.words;l=l.sigBytes;for(var m=[],f=0;f<l;f++){var x=w[f>>>2]>>>24-8*(f%4)&255;m.push((x>>>4).toString(16)),m.push((x&15).toString(16))}return m.join("")},parse:function(l){for(var w=l.length,m=[],f=0;f<w;f+=2)m[f>>>3]|=parseInt(l.substr(f,2),16)<<24-4*(f%8);return new r.init(m,w/2)}},a=i.Latin1={stringify:function(l){var w=l.words;l=l.sigBytes;for(var m=[],f=0;f<l;f++)m.push(String.fromCharCode(w[f>>>2]>>>24-8*(f%4)&255));return m.join("")},parse:function(l){for(var w=l.length,m=[],f=0;f<w;f++)m[f>>>2]|=(l.charCodeAt(f)&255)<<24-8*(f%4);return new r.init(m,w)}},d=i.Utf8={stringify:function(l){try{return decodeURIComponent(escape(a.stringify(l)))}catch{throw Error("Malformed UTF-8 data")}},parse:function(l){return a.parse(unescape(encodeURIComponent(l)))}},p=n.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(l){typeof l=="string"&&(l=d.parse(l)),this._data.concat(l),this._nDataBytes+=l.sigBytes},_process:function(l){var w=this._data,m=w.words,f=w.sigBytes,x=this.blockSize,h=f/(4*x),h=l?o.ceil(h):o.max((h|0)-this._minBufferSize,0);if(l=h*x,f=o.min(4*l,f),l){for(var _=0;_<l;_+=x)this._doProcessBlock(m,_);_=m.splice(0,l),w.sigBytes-=f}return new r.init(_,f)},clone:function(){var l=c.clone.call(this);return l._data=this._data.clone(),l},_minBufferSize:0});n.Hasher=p.extend({cfg:c.extend(),init:function(l){this.cfg=this.cfg.extend(l),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(l){return this._append(l),this._process(),this},finalize:function(l){return l&&this._append(l),this._doFinalize()},blockSize:16,_createHelper:function(l){return function(w,m){return new l.init(m).finalize(w)}},_createHmacHelper:function(l){return function(w,m){return new g.HMAC.init(l,m).finalize(w)}}});var g=t.algo={};return t}(Math);(function(o){for(var e=Ee,l=e.lib,t=l.WordArray,n=l.Hasher,l=e.algo,s=[],c=[],r=function(m){return 4294967296*(m-(m|0))|0},i=2,u=0;64>u;){var a;e:{a=i;for(var d=o.sqrt(a),p=2;p<=d;p++)if(!(a%p)){a=!1;break e}a=!0}a&&(8>u&&(s[u]=r(o.pow(i,.5))),c[u]=r(o.pow(i,1/3)),u++),i++}var g=[],l=l.SHA256=n.extend({_doReset:function(){this._hash=new t.init(s.slice(0))},_doProcessBlock:function(w,m){for(var f=this._hash.words,x=f[0],h=f[1],_=f[2],v=f[3],k=f[4],M=f[5],S=f[6],E=f[7],D=0;64>D;D++){if(16>D)g[D]=w[m+D]|0;else{var I=g[D-15],j=g[D-2];g[D]=((I<<25|I>>>7)^(I<<14|I>>>18)^I>>>3)+g[D-7]+((j<<15|j>>>17)^(j<<13|j>>>19)^j>>>10)+g[D-16]}I=E+((k<<26|k>>>6)^(k<<21|k>>>11)^(k<<7|k>>>25))+(k&M^~k&S)+c[D]+g[D],j=((x<<30|x>>>2)^(x<<19|x>>>13)^(x<<10|x>>>22))+(x&h^x&_^h&_),E=S,S=M,M=k,k=v+I|0,v=_,_=h,h=x,x=I+j|0}f[0]=f[0]+x|0,f[1]=f[1]+h|0,f[2]=f[2]+_|0,f[3]=f[3]+v|0,f[4]=f[4]+k|0,f[5]=f[5]+M|0,f[6]=f[6]+S|0,f[7]=f[7]+E|0},_doFinalize:function(){var w=this._data,m=w.words,f=8*this._nDataBytes,x=8*w.sigBytes;return m[x>>>5]|=128<<24-x%32,m[(x+64>>>9<<4)+14]=o.floor(f/4294967296),m[(x+64>>>9<<4)+15]=f,w.sigBytes=4*m.length,this._process(),this._hash},clone:function(){var w=n.clone.call(this);return w._hash=this._hash.clone(),w}});e.SHA256=n._createHelper(l),e.HmacSHA256=n._createHmacHelper(l)})(Math);(function(){var o=Ee,e=o.enc.Utf8;o.algo.HMAC=o.lib.Base.extend({init:function(t,n){t=this._hasher=new t.init,typeof n=="string"&&(n=e.parse(n));var s=t.blockSize,c=4*s;n.sigBytes>c&&(n=t.finalize(n)),n.clamp();for(var r=this._oKey=n.clone(),i=this._iKey=n.clone(),u=r.words,a=i.words,d=0;d<s;d++)u[d]^=1549556828,a[d]^=909522486;r.sigBytes=i.sigBytes=c,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var n=this._hasher;return t=n.finalize(t),n.reset(),n.finalize(this._oKey.clone().concat(t))}})})();(function(){var o=Ee,e=o.lib.WordArray;o.enc.Base64={stringify:function(t){var n=t.words,s=t.sigBytes,c=this._map;t.clamp(),t=[];for(var r=0;r<s;r+=3)for(var i=(n[r>>>2]>>>24-8*(r%4)&255)<<16|(n[r+1>>>2]>>>24-8*((r+1)%4)&255)<<8|n[r+2>>>2]>>>24-8*((r+2)%4)&255,u=0;4>u&&r+.75*u<s;u++)t.push(c.charAt(i>>>6*(3-u)&63));if(n=c.charAt(64))for(;t.length%4;)t.push(n);return t.join("")},parse:function(t){var n=t.length,s=this._map,c=s.charAt(64);c&&(c=t.indexOf(c),c!=-1&&(n=c));for(var c=[],r=0,i=0;i<n;i++)if(i%4){var u=s.indexOf(t.charAt(i-1))<<2*(i%4),a=s.indexOf(t.charAt(i))>>>6-2*(i%4);c[r>>>2]|=(u|a)<<24-8*(r%4),r++}return e.create(c,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(o){for(var e=Ee,l=e.lib,t=l.WordArray,n=l.Hasher,l=e.algo,s=[],c=[],r=function(m){return 4294967296*(m-(m|0))|0},i=2,u=0;64>u;){var a;e:{a=i;for(var d=o.sqrt(a),p=2;p<=d;p++)if(!(a%p)){a=!1;break e}a=!0}a&&(8>u&&(s[u]=r(o.pow(i,.5))),c[u]=r(o.pow(i,1/3)),u++),i++}var g=[],l=l.SHA256=n.extend({_doReset:function(){this._hash=new t.init(s.slice(0))},_doProcessBlock:function(w,m){for(var f=this._hash.words,x=f[0],h=f[1],_=f[2],v=f[3],k=f[4],M=f[5],S=f[6],E=f[7],D=0;64>D;D++){if(16>D)g[D]=w[m+D]|0;else{var I=g[D-15],j=g[D-2];g[D]=((I<<25|I>>>7)^(I<<14|I>>>18)^I>>>3)+g[D-7]+((j<<15|j>>>17)^(j<<13|j>>>19)^j>>>10)+g[D-16]}I=E+((k<<26|k>>>6)^(k<<21|k>>>11)^(k<<7|k>>>25))+(k&M^~k&S)+c[D]+g[D],j=((x<<30|x>>>2)^(x<<19|x>>>13)^(x<<10|x>>>22))+(x&h^x&_^h&_),E=S,S=M,M=k,k=v+I|0,v=_,_=h,h=x,x=I+j|0}f[0]=f[0]+x|0,f[1]=f[1]+h|0,f[2]=f[2]+_|0,f[3]=f[3]+v|0,f[4]=f[4]+k|0,f[5]=f[5]+M|0,f[6]=f[6]+S|0,f[7]=f[7]+E|0},_doFinalize:function(){var w=this._data,m=w.words,f=8*this._nDataBytes,x=8*w.sigBytes;return m[x>>>5]|=128<<24-x%32,m[(x+64>>>9<<4)+14]=o.floor(f/4294967296),m[(x+64>>>9<<4)+15]=f,w.sigBytes=4*m.length,this._process(),this._hash},clone:function(){var w=n.clone.call(this);return w._hash=this._hash.clone(),w}});e.SHA256=n._createHelper(l),e.HmacSHA256=n._createHmacHelper(l)})(Math);nt.enc={Base64:Ee.enc.Base64,Utf8:Ee.enc.Utf8,Latin1:Ee.enc.Latin1};nt.SHA256=Ee.SHA256;nt.HmacSHA256=Ee.HmacSHA256;const xt=nt,la={alg:"HS256",typ:"JWT"};function gn(o){return xt.enc.Base64.stringify(o).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function ca(o,e,t={}){const n=Object.assign(la,t);if(n.alg!=="HS256"&&n.typ!=="JWT")throw new Error("jwt-encode only support the HS256 algorithm and the JWT type of hash");const s=Kt(n),c=Kt(o);let r=`${s}.${c}`;return r=xt.HmacSHA256(r,e),r=gn(r),`${s}.${c}.${r}`}function Kt(o){const e=xt.enc.Utf8.parse(JSON.stringify(o));return gn(e)}var ua=ca;const da=$n(ua),fa={class:"modal_browser office"},ha={class:"base"},pa={class:"l"},ma={class:"r"},va={class:"content"},_a=["id"],ut=100,ga=ve({__name:"browserOffice",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},setup(o){const e=o;""+e.modalData.nid,F(null);let t=null;const s=Ae().get();ye(()=>{console.warn("mounted");const a=new URL(location.href);i(`${a.origin}/onlyoffice_server/web-apps/apps/api/documents/api.js`),setTimeout(()=>c(),ut)});function c(){if(!r)return setTimeout(()=>c(),ut);const a="modal_office_"+e.modalData.nid;if(!document.getElementById(a))return setTimeout(()=>c(),ut);const p=de.onlyOffice.jwtSecret,g=e.curNode,l=g.title.lastIndexOf("."),w=g.title.substring(l+1),m=u(w);if(!m)return;const f=new URL(location.href),x={document:{fileType:w,key:g.id.toString(16)+"_"+parseInt(new Date(g.time_update).valueOf()),title:g.title,url:`${f.origin}${g.file_index.raw.path}?tosho_token=${s==null?void 0:s.token}`},documentType:m,editorConfig:{callbackUrl:`${f.origin}/api/onlyoffice/callback?id=${g.id}&tosho_token=${s==null?void 0:s.token}`}};x.token=da(x,p),console.info(x),t=new DocsAPI.DocEditor(a,x),console.info(t)}Pe(()=>e.curNode,async a=>{console.info("onMod props.curNode")}),Le(()=>{});let r=!1;function i(a){var d=document.createElement("script");d.type="text/javascript",d.src=a,d.onload=p=>{console.info(p),r=!0},document.body.appendChild(d)}function u(a){let d;switch(a){default:break;case"doc":case"docm":case"docx":case"dot":case"dotm":case"dotx":case"epub":case"fb2":case"fodt":case"htm":case"html":case"mht":case"mhtml":case"odt":case"ott":case"rtf":case"stw":case"sxw":case"txt":case"wps":case"wpt":d="word";break;case"csv":case"et":case"ett":case"fods":case"ods":case"ots":case"sxc":case"xls":case"xlsb":case"xlsm":case"xlsx":case"xlt":case"xltm":case"xltx":d="cell";break;case"dps":case"dpt":case"fodp":case"odp":case"otp":case"pot":case"potm":case"potx":case"pps":case"ppsm":case"ppsx":case"ppt":case"pptm":case"pptx":case"sxi":d="slide";break}return d}return(a,d)=>(R(),P("div",fa,[$("div",ha,[$("div",pa,[me(a.$slots,"info")]),$("div",ma,[me(a.$slots,"btnContainer")])]),me(a.$slots,"navigator"),$("div",va,[$("div",{id:"modal_office_"+a.modalData.nid},null,8,_a)])]))}}),ya={key:0},wa={class:"preLine"},ba={class:"btnContainer"},ka=["value"],xa=["value","innerHTML"],Ea=["value"],Sa=["value"],La=ve({__name:"browser",props:{data:{},modalData:{}},setup(o){const e=o,t=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1,n={audio:Ts,video:qs,image:Ls,pdf:ia,text:ea,office:qt,base:qt};de.onlyOffice.enabled&&(n.office=ga);const s=Ve();let c=!1;function r(){if(c&&!e.modalData.layout.fullscreen){let z=s.get("browser_layout_w"),A=s.get("browser_layout_h");e.modalData.layout.w=z,e.modalData.layout.h=A,e.modalData.layout.x=(window.innerWidth-z)/2,e.modalData.layout.y=(window.innerHeight-A)/2}else e.modalData.layout.fullscreen||(s.set("browser_layout_w",e.modalData.layout.w),s.set("browser_layout_h",e.modalData.layout.h));c=e.modalData.layout.fullscreen}const i=F(s.get("browser_play_mode")??"loop");function u(){let z=de.playMode.indexOf(i.value);z+=1,z>de.playMode.length-1&&(z=0),i.value=de.playMode[z],s.set("browser_play_mode",i.value)}const a=F(s.get("browser_show_detail")??!1);function d(){a.value=!a.value,s.set("browser_show_detail",a.value)}ye(()=>{document.addEventListener("keydown",D),document.addEventListener(`modal_resizing_${e.modalData.nid}`,r),setTimeout(()=>{document.activeElement&&document.activeElement.blur()},100)}),Le(()=>{document.removeEventListener("keydown",D),document.removeEventListener(`modal_resizing_${e.modalData.nid}`,r)});const p=F([]),g=F([]),l=F([]);let w=0;const m=F(0),f=F({});async function x(z){const A=await se("file/get",{node_type:"directory",id_dir:`${z}`,with:"none"});return A||{path:[],list:[]}}_();function h(){let z=[];return w=0,g.value.forEach(A=>{if(!M(A))return;const V=A.rate?A.rate+2:2;z.push(Object.assign(A,{_weight_stack:w})),w+=V}),z=U(z,j.value),z}async function _(z={}){z&&(e.data.query=Object.assign(e.data.query,z));let A;if(A=await se("file/get",e.data.query),!A||!A.list.length)return!1;let V=[];if(A.list.forEach(T=>{T.is_file&&V.push(T)}),A.list=V,!A.list.length){if(parseInt(e.data.query.cascade_dir))return!1;const T=fe.copyObject(e.data.query);if(T.cascade_dir=1,A=await se("file/get",T),!A||!A.list.length)return!1;V=[],A.list.forEach(Y=>{Y.is_file&&V.push(Y)}),A.list=V}if(!A.list.length)return!1;let q=0,B=null;for(let T=0;T<A.list.length;T++)if(A.list[T].id===e.data.curId){q=T,B=A.list[T];break}console.info(q,B),p.value=A.path,g.value=A.list;let O=h();return O.length?(l.value=U(O,j.value),B||(B=l.value[0]),m.value=I(l.value,B),console.info(m.value),S(),!0):!1}function v(z,A,V=0){let q=l.value.length;if(q<1)return;let B=0;if(i.value==="shuffle"){let O=Math.random()*w;A=0;for(let T=0;T<q&&(A=T,!(l.value[T]._weight_stack>O));T++);B=A}else B=z+A;for(;B<0;)B+=q;for(;B>q-1;)B-=q;V||(V=0),V+=1,!(V>q)&&(m.value=B,S())}function k(z){let A=z-m.value;v(m.value,A)}function M(z){const A=parseInt(ce.value)??0;if((z.rate??0)<A)return!1;switch(J.value){case"any":case"file":return de.ignoreFileType.indexOf(z.type??"directory")===-1;default:return J.value==z.type}}function S(){l.value.length&&(f.value.type,l.value[m.value].type,f.value=l.value[m.value]),E()}function E(){e.modalData.base.title=m.value+1+"/"+l.value.length+" "+(f.value.title??"")}async function D(z){if(Me(z.target)||!e.modalData.layout.active)return;let A,V,q,B,O,T;switch(z.key){case"ArrowLeft":if(z.preventDefault(),z.stopPropagation(),["audio","video"].indexOf(f.value.type??"")!==-1)return;v(m.value,-1);break;case"ArrowRight":if(z.preventDefault(),z.stopPropagation(),["audio","video"].indexOf(f.value.type??"")!==-1)return;v(m.value,1);break;case"a":case"PageUp":z.preventDefault(),z.stopPropagation(),v(m.value,-1);break;case"d":case"PageDown":z.preventDefault(),z.stopPropagation(),v(m.value,1);break;case"w":case"[":switch(e.data.query.mode){default:const K=p.value.length?p.value[p.value.length-1]:{id:0,id_parent:0,type:"directory",title:"root",description:"",status:1,building:0};if(A=await x(K.id_parent),V=U(A.list,j.value),q=V.length,q<2)return;B=0,V.forEach((N,W)=>{N.id==e.data.query.id_dir&&(B=W)}),T=V.length;do{for(B-=1;B<0;)B+=q;for(;B>q-1;)B-=q;if(O=V[B],e.data.query.id_dir=`${O.id}`,await _())break}while(--T>0);break;case"id_iterate":const L=e.data.query.keyword.split(","),y=[];L.forEach(N=>y.push(parseInt(N)));let b=null;for(let N=0;N<f.value.crumb_node.length;N++){const W=f.value.crumb_node[N];if(y.indexOf(W.id)!==-1){b=W.id;break}}if(!b)break;const C=y.indexOf(b);q=y.length;let H=C-1;for(;H<0;)H+=q;for(;H>q-1;)H-=q;const X=y[H];for(let N=0;N<l.value.length;N++){const W=l.value[N];for(let ne=0;ne<W.crumb_node.length;ne++)if(W.crumb_node[ne].id===X)return v(N,0)}}break;case"s":case"]":switch(e.data.query.mode){default:const K=p.value.length?p.value[p.value.length-1]:{id:0,id_parent:0,type:"directory",title:"root",description:"",status:1,building:0};if(A=await x(K.id_parent),V=U(A.list,j.value),q=V.length,q<2)return;B=0,V.forEach((N,W)=>{N.id==e.data.query.id_dir&&(B=W)}),T=V.length;do{for(B+=1;B<0;)B+=q;for(;B>q-1;)B-=q;if(O=V[B],e.data.query.id_dir=`${O.id}`,await _())break}while(--T>0);break;case"id_iterate":const L=e.data.query.keyword.split(","),y=[];L.forEach(N=>y.push(parseInt(N)));let b=null;for(let N=0;N<f.value.crumb_node.length;N++){const W=f.value.crumb_node[N];if(y.indexOf(W.id)!==-1){b=W.id;break}}if(!b)break;const C=y.indexOf(b);q=y.length;let H=C+1;for(;H<0;)H+=q;for(;H>q-1;)H-=q;const X=y[H];for(let N=0;N<l.value.length;N++){const W=l.value[N];for(let ne=0;ne<W.crumb_node.length;ne++)if(W.crumb_node[ne].id===X)return v(N,0)}break}break;case"NumpadEnter":case"Enter":break;case"Delete":z.preventDefault(),z.stopPropagation();const Y=new Set;f.value&&f.value.id&&Y.add(f.value.id),await ee.op_bath_delete(Y,[],!1,()=>{v(m.value,1)});break}}function I(z,A){let V=0;return z.forEach((q,B)=>{q.id===A.id&&(V=B)}),V}const j=F(s.get("browser_list_sort")??"name_asc");function te(z){var V;console.info("setSort",j.value,z),(V=z.target)==null||V.blur();const A=l.value;l.value=[],U(A,j.value),l.value=A,m.value=I(A,f.value),E()}function U(z,A){return z=_n(z,A),m.value=I(z,f.value),s.set("browser_list_sort",j.value),z}const J=F(s.get("browser_list_filter")??"any");function Q(z){s.set("browser_list_filter",z);let A=l.value[m.value],V=h();l.value=U(V,j.value),m.value=I(l.value,A),console.info(m.value),S()}const ce=F("0");function he(z){let A=l.value[m.value],V=h();l.value=U(V,j.value),m.value=I(l.value,A),console.info(m.value),S()}return(z,A)=>(R(),Qt(Jt(f.value.type&&n[f.value.type]?n[f.value.type]:n.base),{data:e.data,modalData:e.modalData,nodeList:g.value,curNode:f.value,curIndex:m.value,onNav:k},{info:st(()=>{var V,q;return[$("div",{class:ue({info:!0,detail:a.value})},[a.value?(R(),P(Z,{key:0},[$("p",null,re(f.value.title)+" ("+re(ie(fe).kmgt(((q=(V=f.value.file_index)==null?void 0:V.raw)==null?void 0:q.size)??0,2))+") ",1),f.value.crumb_node?(R(),P("p",ya,[A[11]||(A[11]=$t("Dir : ")),(R(!0),P(Z,null,pe(f.value.crumb_node,B=>(R(),P(Z,null,[$t("/"+re(B.title),1)],64))),256))])):le("",!0),$("p",wa,re(f.value.description),1)],64)):le("",!0)],2)]}),btnContainer:st(()=>{var V,q;return[$("div",ba,[a.value?(R(),P(Z,{key:0},[t?ge((R(),P("select",{key:0,"onUpdate:modelValue":A[0]||(A[0]=B=>ce.value=B),onChange:A[1]||(A[1]=B=>he(ce.value))},[(R(!0),P(Z,null,pe(ie(de).rateMobile,(B,O)=>(R(),P("option",{value:O,key:"BROWSER_RATE_"+z.modalData.nid+"_"+O},re(B),9,ka))),128))],544)),[[ze,ce.value]]):ge((R(),P("select",{key:1,class:"sysIcon","onUpdate:modelValue":A[2]||(A[2]=B=>ce.value=B),onChange:A[3]||(A[3]=B=>he(ce.value))},[(R(!0),P(Z,null,pe(ie(de).rate,(B,O)=>(R(),P("option",{class:"sysIcon_A sysIcon",value:O,innerHTML:B,key:"BROWSER_RATE_"+z.modalData.nid+"_"+O},null,8,xa))),128))],544)),[[ze,ce.value]]),ge($("select",{"onUpdate:modelValue":A[4]||(A[4]=B=>J.value=B),onChange:A[5]||(A[5]=B=>Q(J.value))},[(R(!0),P(Z,null,pe(ie(de).fileType,(B,O)=>(R(),P("option",{value:B,key:"BROWSER_TYPE_"+z.modalData.nid+"_"+O},re(B),9,Ea))),128))],544),[[ze,J.value]]),A[12]||(A[12]=$("br",null,null,-1))],64)):le("",!0),ge($("select",{"onUpdate:modelValue":A[6]||(A[6]=B=>j.value=B),onChange:A[7]||(A[7]=B=>te(B))},[(R(!0),P(Z,null,pe(ie(de).sort,(B,O)=>(R(),P("option",{value:O,key:"BROWSER_SORT_"+z.modalData.nid+"_"+O},re(B),9,Sa))),128))],544),[[ze,j.value]]),$("button",{class:ue(["sysIcon",`sysIcon_player_${i.value}`]),onClick:u},null,2),$("button",{class:ue(["sysIcon","sysIcon_info-cirlce-o"]),onClick:d}),(q=(V=f.value.file_index)==null?void 0:V.raw)!=null&&q.path?(R(),P("button",{key:1,class:ue(["sysIcon","sysIcon_download"]),onClick:A[8]||(A[8]=B=>ie(ee).op_download(f.value))})):le("",!0)])]}),navigator:st(()=>[$("div",{class:ue({pagination:1,isMobile:t})},[$("div",{class:"left",onClick:A[9]||(A[9]=V=>v(m.value,-1))},A[13]||(A[13]=[$("span",{class:"sysIcon sysIcon_arrowleft"},null,-1)])),$("div",{class:"right",onClick:A[10]||(A[10]=V=>v(m.value,1))},A[14]||(A[14]=[$("span",{class:"sysIcon sysIcon_arrowright"},null,-1)]))],2)]),_:1},40,["data","modalData","nodeList","curNode","curIndex"]))}}),Da={class:"modal_locator"},$a={class:"locator_list"},Oa=["onClick"],Ca={class:"type"},Ma={class:"tree"},Ia={class:"title"},Ra=ve({__name:"locator",props:{data:{},modalData:{}},setup(o){const e=F(null);let t={mode:"directory",id_dir:"",keyword:"",id_tag:"",cascade_dir:"1",node_type:"directory",with:"crumb",limit:"20"};const n=o,s=F([]);ye(()=>{var a;(a=e.value)==null||a.focus()}),Le(()=>{});async function c(){const a=await se("file/get",t);!a||!a.list||(t.keyword&&"root".indexOf(t.keyword)!==-1&&a.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),s.value=a.list,s.value.length&&(s.value[0]._sel=!0,n.modalData.layout.h<220&&(n.modalData.layout.h=220)))}async function r(a){console.info(a),!await u(a)&&fe.debounce(()=>{var g;let p=(g=e.value)==null?void 0:g.value;if(!p||!p.length){s.value=[];return}console.info(p),console.info(n.modalData),t.keyword=p,c()},200,"locator")}async function i(a){console.info(a);const d=Te();if(!await n.data.call(a))return d.close(n.modalData.nid)}async function u(a){let d,p,g=!1;switch(a.code){case"ArrowDown":if(g=!0,a.stopPropagation(),a.preventDefault(),!s.value.length)break;for(d=-1,s.value.forEach((w,m)=>{w._sel&&(d=m)}),p=d+1;p<0;)p+=s.value.length;for(;p>=s.value.length;)p-=s.value.length;s.value.forEach((w,m)=>{w._sel=m==p});break;case"ArrowUp":if(g=!0,a.stopPropagation(),a.preventDefault(),!s.value.length)break;for(d=0,s.value.forEach((w,m)=>{w._sel&&(d=m)}),p=d-1;p<0;)p+=s.value.length;for(;p>=s.value.length;)p-=s.value.length;s.value.forEach((w,m)=>{w._sel=m==p});break;case"NumpadEnter":case"Enter":if(g=!0,a.stopPropagation(),a.preventDefault(),!s.value.length||(d=-1,s.value.forEach((w,m)=>{w._sel&&(d=m)}),d==-1))break;const l=s.value[d];i(l);break}return g}return(a,d)=>(R(),P("div",Da,[$("input",{type:"text",class:"locator_input",placeholder:"type title/desc here ...",ref_key:"locatorInput",ref:e,onKeydown:r},null,544),$("div",$a,[(R(!0),P(Z,null,pe(s.value,p=>(R(),P("div",{onClick:g=>i(p),class:ue({active:p._sel})},[$("p",Ca,re(p.type),1),$("p",Ma,[$("span",Ia,re(p.title),1),p.crumb_node?(R(!0),P(Z,{key:0},pe(p.crumb_node,g=>(R(),P("span",null,re(g.title),1))),256)):le("",!0)])],10,Oa))),256))])]))}}),Pa={class:"upload_list"},Aa={class:"title"},Ta={class:"meta"},Na={key:0},Ha={key:1},za=["onClick"],ja={class:"upload_menu"},Ba={key:1},Wa=ve({__name:"uploader",props:{data:{},modalData:{}},setup(o){const e=o,t=F([]),n=new Map;ye(()=>{}),Le(()=>{});function s(m){console.info("onSelectFile",m);const f=document.createElement("input");f.type="file",f.setAttribute("multiple",!0),f.onchange=x=>{var h;if((h=f.files)!=null&&h.length)for(let _=0;_<f.files.length;_++){const v=f.files[_];t.value.push({name:"/"+v.name,size:v.size,file:v,isDir:!1,status:"waiting",start:0,loaded:0})}},f.click()}function c(m){var f,x,h;if(console.debug("onDrop",m.type,(f=m.dataTransfer)==null?void 0:f.files,m),m.preventDefault(),m.stopPropagation(),!(!m.dataTransfer||!m.dataTransfer.files.length)){for(let _=0;_<((x=m.dataTransfer)==null?void 0:x.files.length);_++){const v=(h=m.dataTransfer)==null?void 0:h.items[_],k=v.webkitGetAsEntry();if(k.isFile){const M=v.getAsFile();t.value.push({name:k.fullPath,size:M.size,file:M,isDir:!1,status:"waiting",start:0,loaded:0})}else r(k).then(M=>{M.forEach(S=>t.value.push(S))})}console.info(t.value)}}async function r(m){const f=[];f.push({name:m.fullPath,size:0,file:null,isDir:!0,status:"waiting",start:0,loaded:0});const x=m.createReader(),h=await u(x);for(let _=0;_<h.length;_++){const v=h[_];if(v.isFile){const k=await i(v);f.push({name:v.fullPath,size:k.size,file:k,isDir:!1,status:"waiting",start:0,loaded:0})}v.isDirectory&&(await r(v)).forEach(M=>f.push(M))}return f}function i(m){return new Promise(f=>{m.file(x=>f(x))})}function u(m){return new Promise(f=>{m.readEntries(x=>{f(x)})})}function a(m){m.stopPropagation(),m.preventDefault()}let d=F(!1);async function p(){if(t.value.length){d.value=!0;for(let m=0;m<t.value.length;m++)t.value[m].status==="waiting"&&await g(t.value[m]);d.value=!1,e.data.emitGo("reload")}}async function g(m){let f=null,[x,h,_]=l(m.name);if(m.isDir){const v=new FormData;v.set("pid",x),v.set("title",_),m.status="uploading",f=await se("file/mkdir",v),n.set(h+_+"/",f.id)}else{const v=new FormData;v.set("pid",x),v.set("file",m.file),m.status="uploading",f=await se("file/upd",v,{upload:k=>{m.loaded=k.loaded}})}return m.status="complete",f}function l(m){const f=m.replace(/[\\/]+$/i).split(/[\\/]/i),x=f.pop();if(!f.length)return[e.data.pid,"/",x];let h="";for(let v=0;v<f.length;v++)h+=f[v]+"/";return h=="/"?[e.data.pid,h,x]:[n.get(h),h,x]}function w(m){t.value.splice(m,1)}return(m,f)=>(R(),P("div",{class:"modal_uploader",onDrop:c,onDragover:a},[$("div",Pa,[(R(!0),P(Z,null,pe(t.value,(x,h)=>(R(),P("div",{key:`file_upload_${h}`},[$("div",Aa,re(x.name),1),$("div",Ta,[x.status==="uploading"?(R(),P("span",Na,re(Math.round(100*x.loaded/x.size))+" % ",1)):(R(),P("span",Ha,re(x.status),1)),$("span",null,re(ie(fe).kmgt(x.size)),1),x.status==="waiting"?(R(),P("span",{key:2,onClick:_=>w(h),class:"pointer"},"X",8,za)):le("",!0)])]))),128)),$("div",{onClick:s},"drag / drop files here...")]),$("div",ja,[ie(d)?(R(),P("button",Ba,"uploading")):(R(),P("button",{key:0,onClick:p},"upload"))])],32))}}),Va={class:"modal_rename_util"},Ua={class:"mode_selector"},Fa=["id","name"],Xa=["for"],Ya=["id","name"],qa=["for"],Ka=ve({__name:"renameUtil",props:{data:{},modalData:{}},setup(o){F(null);const e=o;let t=F("pattern"),n=F("{index}_{filename}"),s=F("");ye(()=>{const i=[];e.data.node_list.forEach(u=>{i.push((u==null?void 0:u.title)??"")}),s.value=i.join(`\r
`),console.info(s)}),Le(()=>{});function c(i){let u=i.length.toString().length+1,a=0,d="",p=n.value.match(/\{index:(\d+)}/);p&&(a=parseInt(p[1]),d=p[0]);const g=new Map;i.forEach((w,m)=>{const f=w.crumb_node?w.crumb_node[w.crumb_node.length-1]:null,x=f?f.title:"";let h=new Map;h.set("{filename}",w.title??""),h.set("{index}",fe.prefix(m+1,u,"0")),h.set("{directory}",x??""),h.set(`{index:${d}}`,fe.prefix(m+1,a,"0"));let _=n.value;h.forEach((v,k)=>{_=_.replace(k,v)}),g.set(w.id??0,_)});const l=[];return g.forEach((w,m)=>{l.push({id:m,title:w})}),l}async function r(){const i=Te();let u=[];switch(t.value){default:case"pattern":u=c(e.data.node_list);break;case"bath":const p=s.value.split(/[\r\n]+/);u=[],e.data.node_list.forEach((g,l)=>{p[l]&&p[l].trim().length&&u.push({id:g.id??0,title:p[l].trim()})});break}const a={list:JSON.stringify(u)},d=await se("file/bath_rename",a);return console.info(d),e.data.callback(u),i.close(e.modalData.nid)}return(i,u)=>(R(),P("div",Va,[$("div",Ua,[ge($("input",{id:`P_${e.modalData.nid}_MODE_PATTERN`,name:`P_${e.modalData.nid}_MODE`,value:"pattern",type:"radio","onUpdate:modelValue":u[0]||(u[0]=a=>Qe(t)?t.value=a:t=a)},null,8,Fa),[[dt,ie(t)]]),$("label",{for:`P_${e.modalData.nid}_MODE_PATTERN`},"pattern",8,Xa),ge($("input",{id:`P_${e.modalData.nid}_MODE_BATH`,name:`P_${e.modalData.nid}_MODE`,value:"bath",type:"radio","onUpdate:modelValue":u[1]||(u[1]=a=>Qe(t)?t.value=a:t=a)},null,8,Ya),[[dt,ie(t)]]),$("label",{for:`P_${e.modalData.nid}_MODE_BATH`},"bath",8,qa)]),ie(t)=="pattern"?(R(),P(Z,{key:0},[u[5]||(u[5]=Zt("<p>rename pattern:</p><table><tbody><tr><td>code</td><td>description</td></tr><tr><td>{filename}</td><td>file name</td></tr><tr><td>{index}</td><td>index by sort, prefix by max len+1</td></tr><tr><td>{index:n}</td><td>index by sort, prefix len by [n]</td></tr><tr><td>{directory}</td><td>parent directory name</td></tr></tbody></table>",2)),$("label",null,[u[4]||(u[4]=$("span",null,"pattern",-1)),ge($("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=a=>Qe(n)?n.value=a:n=a)},null,512),[[je,ie(n)]])])],64)):le("",!0),ie(t)=="bath"?(R(),P(Z,{key:1},[u[6]||(u[6]=$("p",null,"rename bath:",-1)),ge($("textarea",{"onUpdate:modelValue":u[3]||(u[3]=a=>Qe(s)?s.value=a:s=a)},null,512),[[je,ie(s)]])],64)):le("",!0),$("label",{class:"confirm"},[$("button",{onClick:r},"submit")])]))}}),Ga={class:"fr_popup"},Qa=["data-ref-id","onClick"],Ja=["onPointerdown","onDblclick"],Za={class:"modal_title"},er={class:"modal_menu"},tr=["onClick"],nr=["onClick"],or=["onClick"],sr={class:"modal_content"},ar=["innerHTML"],rr={key:1,class:"modal_content_form"},ir={key:0},lr=["onUpdate:modelValue","onChange","disabled"],cr=["onClick","disabled"],ur={key:0},dr=["onUpdate:modelValue","onChange","disabled"],fr=["onUpdate:modelValue","onChange","disabled"],hr=["onUpdate:modelValue","onChange","disabled"],pr=["id","name","value","onUpdate:modelValue","onChange","disabled"],mr=["for"],vr=["id","name","value","onUpdate:modelValue","onChange","disabled"],_r=["for"],gr=["onUpdate:modelValue","multiple","onChange","disabled"],yr=["value"],wr={key:2,class:"modal_content_callback"},br=["onClick"],kr=["onPointerdown"],Oe=20,xr=ve({__name:"Popup",setup(o){const e={fileBrowser:La,uploader:Wa,locator:Ra,renameUtil:Ka},t=new Date().valueOf(),n=F(new Map);function s(h){const _=Math.floor((new Date().valueOf()-t)/100),v=window.innerWidth,k=window.innerHeight,M={nid:"",base:{title:h.title??"",alpha:h.alpha??!1,key:h.key??"",single:h.single??!1},layout:{w:0,h:0,x:0,y:0,minW:0,minH:0,allow_resize:!1,allow_move:!1,allow_escape:!1,allow_fullscreen:!1,auto_focus:!1,active:!1,index:0,fullscreen:!1},content:{text:F(""),form:[],component:[]},callback:[],closed:!1,event:{}};M.nid=(_+Math.random()).toString(32),M.event.resize=new Event(`modal_resizing_${M.nid}`),console.info(_,M.nid);const S={};if(S.w=h.w??400,S.h=h.h??160,S.x=(v-S.w)/2,S.y=(k-S.h)/2,S.minW=h.minW??400,S.minH=h.minH??160,S.allow_resize=h.allow_resize??!0,S.allow_move=h.allow_move??!0,S.allow_escape=h.allow_escape??!0,S.allow_fullscreen=h.allow_fullscreen??!1,S.auto_focus=h.auto_focus??!0,S.active=!1,S.index=_,S.fullscreen=h.fullscreen??!1,Object.assign(M.layout,S),h.text&&(typeof h.text=="string"?M.content.text.value=h.text:M.content.text=h.text),h.form&&(Array.isArray(h.form)?M.content.form.push(...h.form):M.content.form.push(h.form),M.content.form.forEach(E=>{if(E.value=E.value??null,E.options=E.options??null,E.default=E.default??null,E.multiple=!!E.multiple,E.disabled=!!E.disabled,E.options&&Array.isArray(E.options)){let D={};E.options.forEach(I=>{D[I]=I}),E.options=D}E.on_change||(E.on_change=()=>{})})),h.component&&(Array.isArray(h.component)?h.component.forEach(E=>{let D;typeof E=="string"?D={key:"",componentName:E,data:{}}:D=Object.assign({key:"",componentName:null,data:{}},E),M.content.component.push(D)}):typeof h.component=="string"?M.content.component.push({key:"",componentName:h.component,data:{}}):M.content.component.push(Object.assign({key:"",componentName:null,data:{}},h.component))),h.callback){if(Array.isArray(h.callback))h.callback.forEach((E,D)=>{let I;typeof E=="function"?I={key:"",name:"",func:E}:I=Object.assign({key:"",name:"",func:null},E),M.callback.push(I)});else if(typeof h.callback=="function")M.callback.push({key:"",name:"",func:h.callback});else if(h.callback.func)M.callback.push(Object.assign({key:"",name:"",func:null},h.callback));else for(const E in h.callback){if(!Object.prototype.hasOwnProperty.call(h.callback,E))continue;const D=h.callback[E];M.callback.push(Object.assign({key:E,name:E,func:D}))}M.callback.forEach((E,D)=>{if(E.name&&!E.key)E.key=E.name;else if(!E.name&&E.key)E.name=E.key;else if(!E.name&&!E.key){let I="button";M.callback.length>1&&(I+=" "+D),E.name=I,E.key=I}})}return console.debug(M),M}window.addEventListener("resize",h=>{n.value.forEach(_=>{if(_.layout.fullscreen){const v={x:Oe,y:Oe,w:window.innerWidth-Oe*2,h:window.innerHeight-Oe*2};Object.assign(_.layout,v),document.dispatchEvent(_.event.resize)}})});const c=Te();c.handleEvent("set",h=>{let _=null,v=null;return h.single&&n.value.forEach((k,M,S)=>{k.base.key==h.key&&(_=M,v=k)}),_?setTimeout(()=>{r(_)}):(v=s(h),n.value.set(v.nid,v),setTimeout(()=>{r(v.nid)})),v}),c.handleEvent("close",h=>a(h)),document.body.addEventListener("click",h=>{let _=h.target;Fe(_)||r(0)});function r(h){const _=Math.floor((new Date().valueOf()-t)/100);n.value.forEach(v=>{if(v.nid===h){v.layout.index=_;let k=!v.layout.active;v.layout.active=!0,v.layout.auto_focus&&k&&setTimeout(()=>{const M=document.querySelector(`.modal_dom[data-ref-id="${v.nid}"] input,.modal_dom[data-ref-id="${v.nid}"] button,.modal_dom[data-ref-id="${v.nid}"] textarea`);M&&M.focus()},100)}else v.layout.active=!1})}function i(h){const _=n.value.get(h);if(!_)return;const v={x:Oe,y:Oe,w:window.innerWidth-Oe*2,h:window.innerHeight-Oe*2,fullscreen:!0};Object.assign(_.layout,v),document.dispatchEvent(_.event.resize)}function u(h){const _=n.value.get(h);if(!_)return;const v={x:0,y:0,w:_.layout.minW,h:_.layout.minH,fullscreen:!1};v.x=(window.innerWidth-v.w)/2,v.y=(window.innerHeight-v.h)/2,Object.assign(_.layout,v),document.dispatchEvent(_.event.resize)}function a(h){const _=n.value.get(h);if(!_||!_.layout.allow_escape)return;n.value.delete(h);let v=-1,k=-1;return n.value.forEach(M=>{v>M.layout.index||(v=M.layout.index,k=M.nid)}),k!=-1&&r(k),_}let d={x:0,y:0,d:"",modalX:0,modalY:0,modalW:0,modalH:0,modal:null},p=0;function g(h,_){_.preventDefault(),_.stopPropagation(),_.pointerId&&(p=_.pointerId,_.target.hasPointerCapture(_.pointerId)),d.x=_.clientX,d.y=_.clientY,d.d=_.target.className,n.value.forEach(v=>{v.nid===h&&(d.modal=v)}),d.modal&&(d.modal.layout.fullscreen||(d.modalX=d.modal.layout.x,d.modalY=d.modal.layout.y,d.modalW=d.modal.layout.w,d.modalH=d.modal.layout.h,document.addEventListener("pointerup",w),document.addEventListener("pointermove",l)))}function l(h){if(h.preventDefault(),!d.modal||!h.pointerId||p!=h.pointerId)return;const _={x:h.clientX-d.x,y:h.clientY-d.y},v={x:d.modal.layout.x,y:d.modal.layout.y,w:d.modal.layout.w,h:d.modal.layout.h};switch(d.d){case"c_l":v.x=d.modalX+_.x,v.w=d.modalW-_.x;break;case"c_r":v.x=d.modalX,v.w=d.modalW+_.x;break;case"c_t":v.y=d.modalY+_.y,v.h=d.modalH-_.y;break;case"c_b":v.y=d.modalY,v.h=d.modalH+_.y;break;case"c_lt":v.x=d.modalX+_.x,v.w=d.modalW-_.x,v.y=d.modalY+_.y,v.h=d.modalH-_.y;break;case"c_lb":v.x=d.modalX+_.x,v.w=d.modalW-_.x,v.y=d.modalY,v.h=d.modalH+_.y;break;case"c_rt":v.x=d.modalX,v.w=d.modalW+_.x,v.y=d.modalY+_.y,v.h=d.modalH-_.y;break;case"c_rb":v.x=d.modalX,v.w=d.modalW+_.x,v.y=d.modalY,v.h=d.modalH+_.y;break;case"modal_header":case"modal_title":v.x=d.modalX+_.x,v.y=d.modalY+_.y;break}const k={l:0,r:window.innerWidth,t:0,b:window.innerHeight};v.w<100&&(v.w=100),v.h<80&&(v.h=80),v.y<0&&(v.y=0),v.y>k.b-v.h/2&&(v.y=k.b-v.h/2),v.x<0-v.w/2&&(v.x=0-v.w/2),v.x>k.r-v.w/2&&(v.x=k.r-v.w/2),d.modal.layout.minW&&v.w<d.modal.layout.minW&&(v.w=d.modal.layout.minW),d.modal.layout.minH&&v.h<d.modal.layout.minH&&(v.h=d.modal.layout.minH),Object.assign(d.modal.layout,v),document.dispatchEvent(d.modal.event.resize)}function w(h){h.preventDefault(),h.stopPropagation(),!(!h.pointerId||p!=h.pointerId)&&(document.removeEventListener("pointerup",w),document.removeEventListener("pointermove",l),p=0,d.modal=null)}function m(h,_){const v=n.value.get(h);v&&v.callback.forEach(async k=>{k.key!==_||await k.func(v)||a(h)})}ye(()=>{console.info("Popup mounted"),document.addEventListener("keydown",f)}),Le(()=>{console.info("unmounted"),document.removeEventListener("keydown",f)});function f(h){switch(h.key){case"Escape":n.value.forEach((v,k)=>{if(v.layout.active){if(!v.layout.allow_escape)return;setTimeout(()=>a(v.nid))}});break;case"NumpadEnter":case"Enter":if(h.target.tagName==="BODY"||h.target.tagName==="BUTTON"||h.isComposing)return;let _=h.target;for(;_.parentElement;){if(_=_.parentElement,!_.classList.contains("modal_dom"))continue;const k=_.getAttribute("data-ref-id");if(!k)break;const M=n.value.get(k);if(!M)break;for(let S=0;S<M.callback.length;S++){const E=M.callback[S].key;return m(k,E)}}break}}function x(h){console.info("processModalFile",h);const _=document.createElement("input");_.type="file",_.onchange=v=>{const k=v.target.files;!k||k.length===0||(h.value=k[0],console.info("processModalFile mod",h,h.value))},_.click()}return(h,_)=>(R(),P("div",Ga,[(R(!0),P(Z,null,pe(n.value,([v,k])=>{var M;return R(),P("div",{key:`_modal_${v}`,class:ue({modal_dom:!0,active:k.layout.active,resizing:((M=ie(d).modal)==null?void 0:M.nid)==k.nid,modal_alpha:k.base.alpha}),"data-ref-id":k.nid,style:be({zIndex:k.layout.index,width:k.layout.w+"px",height:k.layout.h+"px",left:k.layout.x+"px",top:k.layout.y+"px"}),onClick:On(S=>r(k.nid),["stop"])},[$("div",{class:"modal_header",onPointerdown:S=>g(k.nid,S),onDblclick:S=>k.layout.fullscreen?u(k.nid):i(k.nid)},[$("div",Za,re(k.base.title),1),$("div",er,[k.layout.allow_move&&k.layout.allow_fullscreen?(R(),P(Z,{key:0},[k.layout.fullscreen?(R(),P("span",{key:1,class:"buttonStyle sysIcon sysIcon_windowize",onClick:S=>u(k.nid)},null,8,nr)):(R(),P("span",{key:0,class:"buttonStyle sysIcon sysIcon_maximize",onClick:S=>i(k.nid)},null,8,tr))],64)):le("",!0),$("span",{class:"buttonStyle sysIcon sysIcon_close",onClick:S=>a(k.nid)},null,8,or)])],40,Ja),$("div",sr,[k.content.text&&k.content.text.length?(R(),P("div",{key:0,class:"modal_content_text",innerHTML:k.content.text},null,8,ar)):le("",!0),k.content.form&&k.content.form.length?(R(),P("div",rr,[(R(!0),P(Z,null,pe(k.content.form,(S,E)=>(R(),P("label",{key:`_modal_${v}_form_${E}`},[S.label?(R(),P("span",ir,re(S.label),1)):le("",!0),_[0]||(_[0]=$("span",null,null,-1)),$("span",null,[S.type==="text"?ge((R(),P("input",{key:0,type:"text","onUpdate:modelValue":D=>S.value=D,onChange:D=>S.on_change(D,k,S),disabled:S.disabled},null,40,lr)),[[je,S.value]]):le("",!0),S.type==="file"?(R(),P(Z,{key:1},[$("button",{onClick:D=>x(S),disabled:S.disabled},"select file",8,cr),S.value?(R(),P("span",ur,re(S.value.name),1)):le("",!0)],64)):le("",!0),S.type==="textarea"?ge((R(),P("textarea",{key:2,"onUpdate:modelValue":D=>S.value=D,onChange:D=>S.on_change(D,k,S),disabled:S.disabled},null,40,dr)),[[je,S.value]]):le("",!0),S.type==="date"?ge((R(),P("input",{key:3,type:"date","onUpdate:modelValue":D=>S.value=D,onChange:D=>S.on_change(D,k,S),disabled:S.disabled},null,40,fr)),[[je,S.value]]):le("",!0),S.type==="datetime"?ge((R(),P("input",{key:4,type:"datetime-local","onUpdate:modelValue":D=>S.value=D,onChange:D=>S.on_change(D,k,S),disabled:S.disabled},null,40,hr)),[[je,S.value]]):le("",!0),S.type==="checkbox"?(R(!0),P(Z,{key:5},pe(S.options,(D,I)=>(R(),P(Z,{key:`P_${v}_C_${E}_CB_${I}`},[ge($("input",{id:`P_${v}_C_${E}_CB_${I}`,name:`P_${v}_C_${E}_CB`,type:"checkbox",value:I,"onUpdate:modelValue":j=>S.value=j,onChange:j=>S.on_change(j,k,S),disabled:S.disabled},null,40,pr),[[Cn,S.value]]),$("label",{for:`P_${v}_C_${E}_CB_${I}`},re(D),9,mr)],64))),128)):le("",!0),S.type==="radio"?(R(!0),P(Z,{key:6},pe(S.options,(D,I)=>(R(),P(Z,{key:`P_${v}_C_${E}_RD_${I}`},[ge($("input",{id:`P_${v}_C_${E}_RD_${I}`,name:`P_${v}_C_${E}_RD`,type:"radio",value:I,"onUpdate:modelValue":j=>S.value=j,onChange:j=>S.on_change(j,k,S),disabled:S.disabled},null,40,vr),[[dt,S.value]]),$("label",{for:`P_${v}_C_${E}_RD_${I}`},re(D),9,_r)],64))),128)):le("",!0),S.type==="select"?ge((R(),P("select",{key:7,"onUpdate:modelValue":D=>S.value=D,multiple:S.multiple,onChange:D=>S.on_change(D,k,S),disabled:S.disabled},[(R(!0),P(Z,null,pe(S.options,(D,I)=>(R(),P("option",{key:`P_${v}_C_${E}_SL_${I}`,value:I},re(D),9,yr))),128))],40,gr)),[[ze,S.value]]):le("",!0)])]))),128))])):le("",!0),(R(!0),P(Z,null,pe(k.content.component,(S,E)=>(R(),Qt(Jt(e[S.componentName]),{key:`CMP_${v}_${E}`,data:S.data,modalData:k},null,8,["data","modalData"]))),128)),k.callback&&k.callback.length?(R(),P("div",wr,[(R(!0),P(Z,null,pe(k.callback,(S,E)=>(R(),P("button",{key:`BTN_${v}_${E}`,onClick:D=>m(k.nid,S.key)},re(S.name),9,br))),128))])):le("",!0)]),k.layout.allow_resize?(R(),P("div",{key:0,class:"modal_border",onPointerdown:S=>g(k.nid,S)},_[1]||(_[1]=[Zt('<div class="c_l"></div><div class="c_r"></div><div class="c_t"></div><div class="c_b"></div><div class="c_lt"></div><div class="c_lb"></div><div class="c_rt"></div><div class="c_rb"></div>',8)]),40,kr)):le("",!0)],14,Qa)}),128))]))}}),Er={class:"fr_context"},Sr=["onClick"],Lr=["innerHTML"],Dr={key:0,class:"context_menu_sub"},$r=["onClick"],Or=["innerHTML"],Cr=ve({__name:"Context",setup(o){const t=Ae().get(),n=t?t!=null&&t.group.admin?2:1:0,s=mn(),c=F([]),r=F(null),i=F(!0),u=F({x:-1e3,y:0,w:0,h:0,sx:0,sy:0,direction:"lb"});s.register(a);function a(f,x){i.value=!1;const h=[];f.forEach(_=>{if(d(_)){if(_.child){let v=[];if(_.child.forEach(k=>{d(k)&&v.push(k)}),!v.length)return;_.child=v}h.push(_)}}),c.value=h,console.info(h),setTimeout(()=>p(x),20)}function d(f){switch(f.auth){case"none":return!1;default:case"guest":return!0;case"user":if(n<1)break;return!0;case"admin":if(n<2)break;return!0}}function p(f){if(!r.value)return;const x=r.value;let h=m();const _={x:f.clientX,y:f.clientY,w:x==null?void 0:x.offsetWidth,h:x==null?void 0:x.offsetHeight,sx:h.scrollTop,sy:h.scrollLeft,direction:"rb"};let v=["r","b"];switch(_.w+_.x>window.innerWidth&&(v[0]="l"),_.h+_.y>window.innerHeight&&(v[1]="t"),_.direction=v.join(""),_.direction){case"rb":break;case"rt":_.y-=_.h;break;case"lb":_.x-=_.w;break;case"lt":_.x-=_.w,_.y-=_.h;break}u.value=_,m().addEventListener("scroll",w),setTimeout(()=>i.value=!0,10)}function g(){m().removeEventListener("scroll",w),i.value=!1,l=null,setTimeout(()=>{c.value=[],u.value={x:-1e3,y:0,w:0,h:0,sx:0,sy:0,direction:"lb"}},10)}ye(()=>{console.info(l)});let l=null;function w(f){const x=m();if(!x)return;let h=u.value,_=x.scrollLeft,v=x.scrollTop,k=_-h.sx,M=v-h.sy;u.value=Object.assign(h,{x:h.x-k,y:h.y-M,sx:_,sy:v})}function m(){return l||(l=document.querySelector(".fr_content"),l)}return addEventListener("contextmenu",f=>{console.info("triggerMenu"),a([],f)}),addEventListener("click",f=>{g()}),(f,x)=>(R(),P("div",Er,[$("div",{class:ue(["context_menu",i.value?"show":"",u.value.direction]),style:be({left:u.value.x+"px",top:u.value.y+"px"}),ref_key:"contextDOM",ref:r},[(R(!0),P(Z,null,pe(c.value,(h,_)=>{var v;return R(),P("div",{key:`COM_${_}`,class:ue(["context_item",(v=h.child)!=null&&v.length?"has_sub":""]),onClick:h.method},[$("span",{innerHTML:h.title},null,8,Lr),h.child&&h.child.length?(R(),P("div",Dr,[(R(!0),P(Z,null,pe(h.child,(k,M)=>(R(),P("div",{key:`COM_${_}_${M}`,class:ue({context_item:!0}),onClick:k.method},[$("span",{innerHTML:k.title},null,8,Or)],8,$r))),128))])):le("",!0)],10,Sr)}),128))],6)]))}}),Mr={class:"fr_body"},Ir=ve({__name:"main",setup(o){const t=Ae().get();t&&(document.cookie=`tosho_token=${t.token}; max-age=31536000`,n());async function n(){const s=await se("setting/get_front_conf");s&&s.onlyoffice_enabled==="true"&&(de.onlyOffice.enabled=!0,de.onlyOffice.onlyofficeOrigin=s.onlyoffice_origin,de.onlyOffice.jwtSecret=s.onlyoffice_jwt_secret)}return(s,c)=>{const r=Mn("router-view");return R(),P(Z,null,[Ne(Fn,{class:"fr_header"}),Ne(xr),Ne(Cr),$("div",Mr,[Ne(ss,{class:"fr_navi"}),Ne(r)])],64)}}});ls();const Et=In(Ir);Et.use(Rn());Et.use(es);Et.mount("#app");export{Un as _,Te as a,Ar as b,Jo as c,Zo as d,ee as e,Me as m,Tr as o,hs as p,se as q,Ve as u};

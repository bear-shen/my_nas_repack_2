import{d as R,u as E,a as F,r as k,b as N,G as H,g as z,q as _,f as A,h as c,i as o,n as h,F as v,j as I,s as V,t as Q,x as J,o as d,y,A as p}from"./index-DbijJgKH.js";import{_ as m}from"./ContentEditable.vue_vue_type_script_setup_true_lang-cSIWpgN4.js";import{H as K}from"./Hinter-CPUJhJzH.js";const P={class:"list_tag_group"},W=o("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1),X=[W],Y={class:"title"},Z=["onClick"],x={class:"operator"},ee=["onClick"],te=["onClick"],se=["onClick"],oe=["onClick"],le={class:"operator"},ne=["onClick"],ae=["onClick"],ie={class:"list_tag"},ue=o("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1),ce=[ue],de={class:"title"},re=["onClick"],_e=["onClick"],ve={key:0,class:"description"},ye={key:1,class:"alt"},pe={class:"title"},fe=["onClick"],me=["onClick"],Ie=R({__name:"TagView",setup(ke){E(),F();const q=k(null),S=Q(),w=J();let f={id:"",keyword:"",is_del:""};const l=k([]),u=k([]);k(null);const r=k(-1);N(async()=>{Object.assign(f,H.copyObject(w.query)),$()}),z(async t=>{console.info(t),f.id=t.query.id??"",f.keyword=t.query.keyword??"",f.is_del=t.query.is_del??"",$()});async function $(){if(!l.value||!l.value.length){const s=await _("tag_group/get",f);if(!s)return;l.value=s}let t=parseInt(f.id);if(t){let s=!1;for(let e=0;e<l.value.length;e++)t&&t===l.value[e].id&&(s=!0,r.value=e);s||(r.value=-1),D()}}async function D(){if(u.value=[],r.value===-1)return;const s={id_group:l.value[r.value].id},e=await _("tag/get",s);e&&(e.forEach(n=>{var i;n.alt_text=(i=n.alt)==null?void 0:i.join(",")}),u.value=e,console.info(u))}A(()=>{});async function b(t){if(!l.value[t].edit){l.value[t].edit=!0;return}const s=await _("tag_group/mod",l.value[t]);s&&(l.value[t].edit=!1,l.value[t].id=parseInt(s.id??""))}async function U(t){console.info(t);const s=l.value.splice(t,1)[0];s.id&&await _("tag_group/del",{id:s.id})}async function L(){l.value.unshift({title:"",description:"",id_node:0,sort:0,status:1,node:{},edit:!0,ext_key:new Date().valueOf()})}async function O(t){console.info("node_hint");const e=await _("file/get",{mode:"search",node_type:"directory",keyword:t,with:"none",limit:"20"});return e?("root".indexOf(t)!==-1&&e.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),e.list):!1}function j(t,s){console.info("node_add",t,s),l.value[s].id_node=t.id,l.value[s].node=t}function M(t){var e;if(console.info("node_parse"),!t)return"";const s=[];return(e=t.crumb_node)==null||e.forEach(n=>{n.title&&s.push(n.title)}),t.title&&s.push(t.title),`/ ${s.join(" / ")}`}function C(t){let s=0;t!==-1&&(s=l.value[t].id??0),S.push({path:w.path,query:{id:s}})}function T(){if(r.value==-1)return;const t=u.value,s=l.value[r.value];t.unshift({title:"",description:"",group:{},id_group:s.id,alt_text:"",ext_key:new Date().valueOf(),edit:!0})}async function g(t){const s=u.value.splice(t,1)[0];s.id&&await _("tag/del",{id:s.id})}async function G(t){var e;if(!u.value[t].edit){u.value[t].edit=!0;return}u.value[t].alt=(e=u.value[t].alt_text)==null?void 0:e.split(/,/m);const s=await _("tag/mod",u.value[t]);s&&(u.value[t].edit=!1,u.value[t].id=parseInt(s.id??""))}return(t,s)=>(d(),c("div",{class:"fr_content view_tag",ref_key:"contentDOM",ref:q},[o("div",P,[o("div",{class:h({tag_group:!0,tag_group_add:!0,active:r.value===-1}),onClick:L},X,2),l.value&&l.value.length?(d(!0),c(v,{key:0},I(l.value,(e,n)=>{var i;return d(),c("div",{key:`tagView_group_${e.ext_key?e.ext_key:e.id}`,class:h({active:r.value===n,tag_group:!0,edit:e.edit})},[e.edit?(d(),c(v,{key:1},[p(m,{class:"title",modelValue:e.title,"onUpdate:modelValue":a=>e.title=a,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),p(m,{class:"description",modelValue:e.description,"onUpdate:modelValue":a=>e.description=a},null,8,["modelValue","onUpdate:modelValue"]),p(K,{class:"node","get-list":O,submit:j,"parse-text":M,modelValue:e.node,"onUpdate:modelValue":a=>e.node=a,meta:n},null,8,["modelValue","onUpdate:modelValue","meta"]),o("div",le,[p(m,{class:"sort",modelValue:e.sort,"onUpdate:modelValue":a=>e.sort=a},null,8,["modelValue","onUpdate:modelValue"]),o("div",null,[o("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:a=>b(n)},null,8,ne),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:a=>U(n)},null,8,ae)])])],64)):(d(),c(v,{key:0},[o("div",Y,[o("div",{onClick:a=>C(n)},y(e.title),9,Z),o("div",x,[o("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:a=>b(n)},null,8,ee),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:a=>U(n)},null,8,te)])]),o("div",{onClick:a=>C(n),class:"description"},y(e.description),9,se),o("div",{onClick:a=>C(n),class:"node"},[e.node&&e.node.crumb_node?(d(!0),c(v,{key:0},I(e.node.crumb_node,(a,B)=>(d(),c("span",{key:`tagView_group_${e.ext_key?e.ext_key:e.id}_CR_${B}`},y(a.title),1))),128)):V("",!0),o("span",null,y((i=e.node)==null?void 0:i.title),1)],8,oe)],64))],2)}),128)):V("",!0)]),o("div",ie,[o("div",{class:h({tag:!0,tag_add:!0}),onClick:T},ce),(d(!0),c(v,null,I(u.value,(e,n)=>(d(),c("div",{class:h({tag:!0,edit:e.edit}),key:`tag_view_${e.ext_key?e.ext_key:e.id}`},[e.edit?(d(),c(v,{key:1},[o("div",pe,[p(m,{modelValue:e.title,"onUpdate:modelValue":i=>e.title=i,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),o("div",null,[o("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:i=>G(n)},null,8,fe),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:i=>g(n)},null,8,me)])]),p(m,{modelValue:e.description,"onUpdate:modelValue":i=>e.description=i,class:"description"},null,8,["modelValue","onUpdate:modelValue"]),p(m,{modelValue:e.alt_text,"onUpdate:modelValue":i=>e.alt_text=i,class:"alt"},null,8,["modelValue","onUpdate:modelValue"])],64)):(d(),c(v,{key:0},[o("div",de,[o("div",null,y(e.title),1),o("div",null,[o("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:i=>G(n)},null,8,re),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:i=>g(n)},null,8,_e)])]),e.description?(d(),c("div",ve,y(e.description),1)):V("",!0),e.alt?(d(),c("div",ye,y(e.alt_text),1)):V("",!0)],64))],2))),128))])],512))}});export{Ie as default};

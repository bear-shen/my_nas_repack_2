import{a as C,u as j,b as A}from"./index-DN6EPjSg.js";import{d as L,a as N,r as v,o as O,G as H,m as R,E as o,c as u,e as l,F as d,f as b,P as T,b as c,n as f,t as U,Q as z,A as k,i}from"./basic-cwdvCeQw.js";import{_ as h}from"./ContentEditable.vue_vue_type_script_setup_true_lang-DcqCX2WK.js";const I={class:"widget_ls"},W=["onClick"],K=L({__name:"SettingView",setup(G){N();const g=v(null);j();const w=A();let m={};const r=v([]);O(async()=>{Object.assign(m,H.copyObject(w.query)),y()}),C(async t=>{console.info(t),y()}),R(()=>{});async function y(){const t=await o("setting/get",m);if(!t)return;const e=[];for(let a=0;a<t.length;a++)e.push(Object.assign(t[a],{edit_key:!1,edit_val:!1,ext_key:`${new Date().valueOf()}_${Math.random()}`,pre_name:t[a].name,pre_value:t[a].value}));r.value=e}function x(){r.value.unshift({name:"new_key",value:'"json format value"',pre_name:"",pre_value:"",edit_key:!1,edit_val:!1,ext_key:`${new Date().valueOf()}_${Math.random()}`})}async function M(t){let e=null;for(let n=0;n<r.value.length;n++){const s=r.value[n];s.ext_key===t&&(e=s)}if(!e||(e==null?void 0:e.pre_name)==(e==null?void 0:e.name)&&(e==null?void 0:e.pre_value)==(e==null?void 0:e.value))return;const a=await o("setting/mod",e);a&&(e.id=parseInt(a.id??""),e.pre_name=e.name,e.pre_value=e.value)}function _(t){const e=t.getAttribute("data-key"),a=t.getAttribute("data-type");r.value.forEach(n=>{if(n.ext_key===e)switch(a){case"key":n.edit_key=!0;break;case"val":n.edit_val=!0;break}})}function p(t){const e=t.getAttribute("data-key"),a=t.getAttribute("data-type");r.value.forEach(n=>{if(n.ext_key===e){switch(a){case"key":n.edit_key=!1;break;case"val":n.edit_val=!1;break}M(n.ext_key)}})}const $=[{type:"button",title:"local -> DB",method:D},{type:"button",title:"DB -> local",method:V},{type:"button",title:"check file",method:B},{type:"button",title:"rebuild all index",method:F},{type:"button",title:"sync bangumi database",method:q},{type:"button",title:"import EHT tags",method:S},{type:"button",title:"sync jRiver rate",method:E}];async function D(){if(await o("setting/sync_local_file",{})===!1)return;const e=i();e.set(e.simpleMsg("success","queued"))}async function V(){if(await o("setting/sync_database_file",{})===!1)return;const e=i();e.set(e.simpleMsg("success","queued"))}async function q(){if(await o("setting/sync_bgm_tag",{})===!1)return;const e=i();e.set(e.simpleMsg("success","queued"))}async function S(){const t=i();t.set({title:"locator | select base dir :",alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async e=>{const a=new FormData;a.set("id_list",`${e.id}`),await o("setting/import_eht_tag",a)!==!1&&t.set(t.simpleMsg("success","queued"))}}}]})}async function E(){const t=i(),e={title:"upload MC Library.xml data",w:400,h:150,minW:400,minH:150,allow_resize:!0,form:[{label:"target node id",type:"text",key:"nodeId",value:""},{label:"xml payload",type:"file",key:"payload"}],callback:{confirm:async function(a){if(!a.content.form[1].value)return;const n=new FormData;n.set("id_node",`${a.content.form[0].value}`),n.set("payload",a.content.form[1].value),await o("setting/sync_jriver_rate",n)!==!1&&t.set(t.simpleMsg("success","queued"))}}};t.set({title:"locator | select music base dir :",alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async a=>{e.form[0].value=a.id,t.set(e)}}}]})}async function F(){if(await o("setting/full_rebuild_index",{})===!1)return;const e=i();e.set(e.simpleMsg("success","queued"))}async function B(){const t=await o("setting/check_local_file_result",{});if(t===!1)return;console.info(t);const e=i();let a="",n=[];t&&t.value&&(t.value.db&&t.value.db.forEach(s=>n.push(`<tr><td>db</td><td>${s}</td></tr>`)),t.value.raw&&t.value.raw.forEach(s=>n.push(`<tr><td>raw</td><td>${s}</td></tr>`)),t.value.preview&&t.value.preview.forEach(s=>n.push(`<tr><td>preview</td><td>${s}</td></tr>`)),t.value.normal&&t.value.normal.forEach(s=>n.push(`<tr><td>normal</td><td>${s}</td></tr>`)),t.value.cover&&t.value.cover.forEach(s=>n.push(`<tr><td>cover</td><td>${s}</td></tr>`))),a=`<table>${n.join("")}</table>`,console.info(a),e.set({title:"chk result",text:a,w:480,h:360,minW:480,minH:360,allow_resize:!0,callback:{checkNew:async function(s){await o("setting/check_local_file",{})},close:async function(s){}}})}return(t,e)=>(c(),u("div",{class:"fr_content view_setting",ref_key:"contentDOM",ref:g},[l("div",I,[(c(),u(d,null,b($,(a,n)=>(c(),u(d,{key:n},[a.type==="button"?(c(),u("div",{key:0,class:f(["widget",a.type,"buttonStyle"])},[l("button",{onClick:a.method},U(a.title),9,W)],2)):z("",!0)],64))),64))]),l("table",null,[l("tbody",null,[e[1]||(e[1]=l("tr",null,[l("th",null,"key"),l("th",null,"value")],-1)),l("tr",null,[l("td",{colspan:"2",class:"add",onClick:x},e[0]||(e[0]=[l("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1),T(" add row ")]))]),(c(!0),u(d,null,b(r.value,a=>(c(),u("tr",{key:`setting_view_${a.ext_key}`},[l("td",{class:f({editing:a.edit_key})},[k(h,{modelValue:a.name,"onUpdate:modelValue":n=>a.name=n,onFocus:_,onBlur:p,"data-key":a.ext_key,"data-type":"key"},null,8,["modelValue","onUpdate:modelValue","data-key"])],2),l("td",{class:f({editing:a.edit_val})},[k(h,{modelValue:a.value,"onUpdate:modelValue":n=>a.value=n,onFocus:_,onBlur:p,"data-key":a.ext_key,"data-type":"val"},null,8,["modelValue","onUpdate:modelValue","data-key"])],2)]))),128))])])],512))}});export{K as default};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./FileView_N-CIvJmnW7.js","./FileView.vue_vue_type_style_index_0_lang-e4j-zWxk.js","./basic-BYt0z23_.js","./basic-Crk0ZqqR.css","./FileItem-57ze1Qo0.js","./ContentEditable.vue_vue_type_script_setup_true_lang-BfoL63xV.js","./Hinter-BL9XPkTY.js","./Hinter-DDs2Yukm.css","./FileItem-DUerVcS4.css","./FileView-BSPtTJMB.css","./Favourite-3oBoRv5P.js","./Favourite-BN5yJjEX.css","./FileView_R-CZJz6yAh.js","./TagView-CaJNT1oh.js","./TagView-BIbJvYcw.css","./ShareView-_yQhIHrt.js","./ShareView-BRPRpGNM.css","./UserView-Ba4ZW0cr.js","./UserView-CmWqTIhk.css","./LogView-PAuEYWoT.js","./LogView-V_AVrbUx.css","./SettingView-CyKYjjcN.js","./SettingView-EQ9DroAn.css"])))=>i.map(i=>d[i]);
var yn=Object.defineProperty;var wn=(o,e,t)=>e in o?yn(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var oe=(o,e,t)=>wn(o,typeof e!="symbol"?e+"":e,t);import{d as Ze,C as ce,r as F,a as ve,o as ye,b as I,c as R,e as $,F as J,f as pe,n as de,u as ie,t as re,s as bn,g as kn,i as Re,h as xn,j as Le,k as En,l as Sn,m as Ln,p as xe,q as Gt,v as ot,w as Pe,x as Ne,J as Dn,G as fe,y as me,z as be,A as le,B as gt,D as ge,E as ze,H as On,I as Qt,K as st,L as Jt,M as Ot,N as dt,O as Qe,P as Zt,Q as je,R as $n,S as Cn,T as Mn,U as In,V as Rn}from"./basic-BYt0z23_.js";const $t="tosho_user",Ae=Ze("userStore",()=>{let o=null;function e(){if(o)return o;const n=localStorage.getItem($t);if(!n)return null;try{o=JSON.parse(n)}catch{o=null}return o}function t(n){return o=n,localStorage.setItem($t,JSON.stringify(n)),n}return{get:e,set:t}});let qe={set:null,close:null};const Te=Ze("modalStore",()=>({set:Pn,close:An,handleEvent:Tn,simpleMsg:Nn}));function Pn(o){return qe.set?qe.set(o):null}function An(o){return qe.close?qe.close(o):null}function Tn(o,e){return qe[o]=e}function Nn(o,e){return{title:o,text:e,w:320,h:100,minW:320,minH:100,allow_resize:!1,callback:{confirm:async function(t){}}}}function se(o,e,t){return new Promise((n,s)=>{let r;if(e instanceof FormData)r=e;else{r=new FormData;for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&r.append(a,e[a])}const i=new XMLHttpRequest;i.withCredentials=!0,i.onreadystatechange=function(){if(i.readyState!==4)return;if(i.status>=400)return ht(`${i.status}:${i.statusText}`);const a=JSON.parse(i.responseText);switch(a.code){case 10:ft(),n(!1);break;case 100:ht(a.msg),n(!1);break;default:n(a.data);break}},t&&t.upload&&(i.upload.onprogress=t.upload),i.open("POST",ce.apiPath+o);const u=Ae().get();u&&u.token&&i.setRequestHeader("Auth-Token",u.token),i.send(r)})}function ft(){console.info("throwLogin"),Te().set({title:"login required",alpha:!0,key:"",single:!1,w:360,h:120,minW:360,minH:120,allow_resize:!1,allow_move:!0,allow_escape:!1,allow_fullscreen:!1,auto_focus:!0,form:[{type:"text",label:"username",key:"username"},{type:"text",label:"password",key:"password"}],callback:{login:async function(e){console.info(e);const t=await se("user/login",{username:e.content.form[0].value,password:e.content.form[1].value});if(!t)return!0;Ae().set(t),location.reload()}}})}function ht(o){Te().set({title:"error",alpha:!1,key:"",single:!1,w:360,h:100,minW:360,minH:100,allow_resize:!1,allow_move:!0,allow_escape:!0,allow_fullscreen:!1,auto_focus:!0,text:o,callback:{close:t=>{}}})}function Me(o){if(!o)return!1;let e=o;for(;;){if(e.tagName==="BODY")return!1;if(e.tagName==="HTML")return!1;if(e.tagName==="TEXTAREA")return!0;if(e.tagName==="INPUT")switch(e.type){case"input":case"date":case"datetime":case"datetime-local":case"file":case"number":case"password":case"search":case"text":case"time":case"tel":case"url":return!0}else{if(e.contentEditable&&e.contentEditable.toLowerCase()==="true")return!0;if(!e.parentElement)return!1}e=e.parentElement}return!1}function Fe(o){if(!o)return!1;let e=o;for(;;){if(e.classList.contains("modal_dom"))return!0;if(e.tagName=="BODY")return!1;if(e.tagName=="HTML")return!1;if(!e.parentElement)return!1;e=e.parentElement}return!1}const at="tosho_config_",Ve=Ze("localConfigure",()=>{let o=F({});const e={};function t(i){if(i=at+i,o[i])return o[i];const l=localStorage.getItem(i);if(!l)return null;try{o[i]=JSON.parse(l)}catch{o[i]=null}return o[i]}function n(i,l,u){return i=at+i,u||(u=new Date().valueOf().toString(32)+Math.random().toString(32)),e[i]||(e[i]=new Map),e[i].set(u,l),u}function s(i,l){e[i]&&(e[i].delete(l),e[i].size==0&&delete e[i])}function r(i,l){i=at+i,o[i]=l,e[i]&&e[i].forEach(u=>u(l)),localStorage.setItem(i,JSON.stringify(l))}return{get:t,set:r,listen:n,release:s}}),Hn={class:"fr_header"},zn={class:"navi"},jn=["innerHTML","href"],Bn={class:"user"},Wn={class:"pointer"},Vn=ve({__name:"Header",setup(o){const e=F([]),t=Ae();let n=t.get();function s(){t.set(null),location.reload()}ye(()=>{document.addEventListener("fe_config_loaded",()=>{e.value=ce.navList})});const r=Ve(),i=ce.theme;let l=r.get("theme")??"warm";function u(){const d={};i.forEach(y=>{d[y[0]]=y[0]}),Te().set({title:"theme configure",alpha:!0,key:"theme_configure",single:!0,w:360,h:160,minW:360,minH:160,allow_resize:!0,allow_move:!0,allow_escape:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"radio",label:"theme name",key:"theme",options:d,value:l}],callback:{check:async y=>{console.info(y),l=y.content.form[0].value,a(l)}}})}function a(d){i.forEach(h=>{const y=h[0],c=h[1];if(y!==d)return;r.set("theme",y);const b=document.body.className.trim().split(" "),m=[];b.forEach(S=>{S&&S.length&&S.indexOf("theme_")!==0&&m.push(S)}),m.push("theme_"+d);const f=document.createElement("link");f.setAttribute("rel","stylesheet"),f.setAttribute("href",c),document.body.appendChild(f),document.body.className=m.join(" ")})}return a(l),(d,h)=>(I(),R("div",Hn,[h[1]||(h[1]=$("div",{class:"logo"},"Hentai.",-1)),$("div",zn,[(I(!0),R(J,null,pe(e.value,y=>{var c;return I(),R("a",{key:y.name,class:de({active:(c=y.meta)==null?void 0:c.cur,pointer:1}),innerHTML:y.name,href:y.path,target:"_blank"},null,10,jn)}),128))]),$("div",Bn,[ie(n)&&ie(n).id?(I(),R(J,{key:0},[$("div",Wn,re(ie(n).name),1),$("ul",{class:"action pointer"},[$("li",{onClick:u},"theme"),$("li",{onClick:s},"logout")])],64)):(I(),R("div",{key:1,class:"pointer",onClick:h[0]||(h[0]=(...y)=>ie(ft)&&ie(ft)(...y))},"login"))])]))}}),Un=(o,e)=>{const t=o.__vccOpts||o;for(const[n,s]of e)t[n]=s;return t},Fn=Un(Vn,[["__scopeId","data-v-047d357a"]]),Xn="modulepreload",Yn=function(o,e){return new URL(o,e).href},Ct={},De=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){const i=document.getElementsByTagName("link"),l=document.querySelector("meta[property=csp-nonce]"),u=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));s=Promise.allSettled(t.map(a=>{if(a=Yn(a,n),a in Ct)return;Ct[a]=!0;const d=a.endsWith(".css"),h=d?'[rel="stylesheet"]':"";if(!!n)for(let b=i.length-1;b>=0;b--){const m=i[b];if(m.href===a&&(!d||m.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${h}`))return;const c=document.createElement("link");if(c.rel=d?"stylesheet":Xn,d||(c.as="script"),c.crossOrigin="",c.href=a,u&&c.setAttribute("nonce",u),document.head.appendChild(c),d)return new Promise((b,m)=>{c.addEventListener("load",b),c.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${a}`)))})}))}function r(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return s.then(i=>{for(const l of i||[])l.status==="rejected"&&r(l.reason);return e().catch(r)})};/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const He=typeof document<"u";function en(o){return typeof o=="object"||"displayName"in o||"props"in o||"__vccOpts"in o}function qn(o){return o.__esModule||o[Symbol.toStringTag]==="Module"||o.default&&en(o.default)}const ae=Object.assign;function rt(o,e){const t={};for(const n in e){const s=e[n];t[n]=ke(s)?s.map(o):o(s)}return t}const Xe=()=>{},ke=Array.isArray,tn=/#/g,Kn=/&/g,Gn=/\//g,Qn=/=/g,Jn=/\?/g,nn=/\+/g,Zn=/%5B/g,eo=/%5D/g,on=/%5E/g,to=/%60/g,sn=/%7B/g,no=/%7C/g,an=/%7D/g,oo=/%20/g;function yt(o){return encodeURI(""+o).replace(no,"|").replace(Zn,"[").replace(eo,"]")}function so(o){return yt(o).replace(sn,"{").replace(an,"}").replace(on,"^")}function pt(o){return yt(o).replace(nn,"%2B").replace(oo,"+").replace(tn,"%23").replace(Kn,"%26").replace(to,"`").replace(sn,"{").replace(an,"}").replace(on,"^")}function ao(o){return pt(o).replace(Qn,"%3D")}function ro(o){return yt(o).replace(tn,"%23").replace(Jn,"%3F")}function io(o){return o==null?"":ro(o).replace(Gn,"%2F")}function Ke(o){try{return decodeURIComponent(""+o)}catch{}return""+o}const lo=/\/$/,co=o=>o.replace(lo,"");function it(o,e,t="/"){let n,s={},r="",i="";const l=e.indexOf("#");let u=e.indexOf("?");return l<u&&l>=0&&(u=-1),u>-1&&(n=e.slice(0,u),r=e.slice(u+1,l>-1?l:e.length),s=o(r)),l>-1&&(n=n||e.slice(0,l),i=e.slice(l,e.length)),n=po(n??e,t),{fullPath:n+(r&&"?")+r+i,path:n,query:s,hash:Ke(i)}}function uo(o,e){const t=e.query?o(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function Mt(o,e){return!e||!o.toLowerCase().startsWith(e.toLowerCase())?o:o.slice(e.length)||"/"}function fo(o,e,t){const n=e.matched.length-1,s=t.matched.length-1;return n>-1&&n===s&&Be(e.matched[n],t.matched[s])&&rn(e.params,t.params)&&o(e.query)===o(t.query)&&e.hash===t.hash}function Be(o,e){return(o.aliasOf||o)===(e.aliasOf||e)}function rn(o,e){if(Object.keys(o).length!==Object.keys(e).length)return!1;for(const t in o)if(!ho(o[t],e[t]))return!1;return!0}function ho(o,e){return ke(o)?It(o,e):ke(e)?It(e,o):o===e}function It(o,e){return ke(e)?o.length===e.length&&o.every((t,n)=>t===e[n]):o.length===1&&o[0]===e}function po(o,e){if(o.startsWith("/"))return o;if(!o)return e;const t=e.split("/"),n=o.split("/"),s=n[n.length-1];(s===".."||s===".")&&n.push("");let r=t.length-1,i,l;for(i=0;i<n.length;i++)if(l=n[i],l!==".")if(l==="..")r>1&&r--;else break;return t.slice(0,r).join("/")+"/"+n.slice(i).join("/")}const Oe={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Ge;(function(o){o.pop="pop",o.push="push"})(Ge||(Ge={}));var Ye;(function(o){o.back="back",o.forward="forward",o.unknown=""})(Ye||(Ye={}));function mo(o){if(!o)if(He){const e=document.querySelector("base");o=e&&e.getAttribute("href")||"/",o=o.replace(/^\w+:\/\/[^\/]+/,"")}else o="/";return o[0]!=="/"&&o[0]!=="#"&&(o="/"+o),co(o)}const vo=/^[^#]+#/;function _o(o,e){return o.replace(vo,"#")+e}function go(o,e){const t=document.documentElement.getBoundingClientRect(),n=o.getBoundingClientRect();return{behavior:e.behavior,left:n.left-t.left-(e.left||0),top:n.top-t.top-(e.top||0)}}const et=()=>({left:window.scrollX,top:window.scrollY});function yo(o){let e;if("el"in o){const t=o.el,n=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?n?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=go(s,o)}else e=o;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function Rt(o,e){return(history.state?history.state.position-e:-1)+o}const mt=new Map;function wo(o,e){mt.set(o,e)}function bo(o){const e=mt.get(o);return mt.delete(o),e}let ko=()=>location.protocol+"//"+location.host;function ln(o,e){const{pathname:t,search:n,hash:s}=e,r=o.indexOf("#");if(r>-1){let l=s.includes(o.slice(r))?o.slice(r).length:1,u=s.slice(l);return u[0]!=="/"&&(u="/"+u),Mt(u,"")}return Mt(t,o)+n+s}function xo(o,e,t,n){let s=[],r=[],i=null;const l=({state:y})=>{const c=ln(o,location),b=t.value,m=e.value;let f=0;if(y){if(t.value=c,e.value=y,i&&i===b){i=null;return}f=m?y.position-m.position:0}else n(c);s.forEach(S=>{S(t.value,b,{delta:f,type:Ge.pop,direction:f?f>0?Ye.forward:Ye.back:Ye.unknown})})};function u(){i=t.value}function a(y){s.push(y);const c=()=>{const b=s.indexOf(y);b>-1&&s.splice(b,1)};return r.push(c),c}function d(){const{history:y}=window;y.state&&y.replaceState(ae({},y.state,{scroll:et()}),"")}function h(){for(const y of r)y();r=[],window.removeEventListener("popstate",l),window.removeEventListener("beforeunload",d)}return window.addEventListener("popstate",l),window.addEventListener("beforeunload",d,{passive:!0}),{pauseListeners:u,listen:a,destroy:h}}function Pt(o,e,t,n=!1,s=!1){return{back:o,current:e,forward:t,replaced:n,position:window.history.length,scroll:s?et():null}}function Eo(o){const{history:e,location:t}=window,n={value:ln(o,t)},s={value:e.state};s.value||r(n.value,{back:null,current:n.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function r(u,a,d){const h=o.indexOf("#"),y=h>-1?(t.host&&document.querySelector("base")?o:o.slice(h))+u:ko()+o+u;try{e[d?"replaceState":"pushState"](a,"",y),s.value=a}catch(c){console.error(c),t[d?"replace":"assign"](y)}}function i(u,a){const d=ae({},e.state,Pt(s.value.back,u,s.value.forward,!0),a,{position:s.value.position});r(u,d,!0),n.value=u}function l(u,a){const d=ae({},s.value,e.state,{forward:u,scroll:et()});r(d.current,d,!0);const h=ae({},Pt(n.value,u,null),{position:d.position+1},a);r(u,h,!1),n.value=u}return{location:n,state:s,push:l,replace:i}}function So(o){o=mo(o);const e=Eo(o),t=xo(o,e.state,e.location,e.replace);function n(r,i=!0){i||t.pauseListeners(),history.go(r)}const s=ae({location:"",base:o,go:n,createHref:_o.bind(null,o)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function Lo(o){return typeof o=="string"||o&&typeof o=="object"}function cn(o){return typeof o=="string"||typeof o=="symbol"}const un=Symbol("");var At;(function(o){o[o.aborted=4]="aborted",o[o.cancelled=8]="cancelled",o[o.duplicated=16]="duplicated"})(At||(At={}));function We(o,e){return ae(new Error,{type:o,[un]:!0},e)}function Se(o,e){return o instanceof Error&&un in o&&(e==null||!!(o.type&e))}const Tt="[^/]+?",Do={sensitive:!1,strict:!1,start:!0,end:!0},Oo=/[.+*?^${}()[\]/\\]/g;function $o(o,e){const t=ae({},Do,e),n=[];let s=t.start?"^":"";const r=[];for(const a of o){const d=a.length?[]:[90];t.strict&&!a.length&&(s+="/");for(let h=0;h<a.length;h++){const y=a[h];let c=40+(t.sensitive?.25:0);if(y.type===0)h||(s+="/"),s+=y.value.replace(Oo,"\\$&"),c+=40;else if(y.type===1){const{value:b,repeatable:m,optional:f,regexp:S}=y;r.push({name:b,repeatable:m,optional:f});const p=S||Tt;if(p!==Tt){c+=10;try{new RegExp(`(${p})`)}catch(v){throw new Error(`Invalid custom RegExp for param "${b}" (${p}): `+v.message)}}let g=m?`((?:${p})(?:/(?:${p}))*)`:`(${p})`;h||(g=f&&a.length<2?`(?:/${g})`:"/"+g),f&&(g+="?"),s+=g,c+=20,f&&(c+=-8),m&&(c+=-20),p===".*"&&(c+=-50)}d.push(c)}n.push(d)}if(t.strict&&t.end){const a=n.length-1;n[a][n[a].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const i=new RegExp(s,t.sensitive?"":"i");function l(a){const d=a.match(i),h={};if(!d)return null;for(let y=1;y<d.length;y++){const c=d[y]||"",b=r[y-1];h[b.name]=c&&b.repeatable?c.split("/"):c}return h}function u(a){let d="",h=!1;for(const y of o){(!h||!d.endsWith("/"))&&(d+="/"),h=!1;for(const c of y)if(c.type===0)d+=c.value;else if(c.type===1){const{value:b,repeatable:m,optional:f}=c,S=b in a?a[b]:"";if(ke(S)&&!m)throw new Error(`Provided param "${b}" is an array but it is not repeatable (* or + modifiers)`);const p=ke(S)?S.join("/"):S;if(!p)if(f)y.length<2&&(d.endsWith("/")?d=d.slice(0,-1):h=!0);else throw new Error(`Missing required param "${b}"`);d+=p}}return d||"/"}return{re:i,score:n,keys:r,parse:l,stringify:u}}function Co(o,e){let t=0;for(;t<o.length&&t<e.length;){const n=e[t]-o[t];if(n)return n;t++}return o.length<e.length?o.length===1&&o[0]===80?-1:1:o.length>e.length?e.length===1&&e[0]===80?1:-1:0}function dn(o,e){let t=0;const n=o.score,s=e.score;for(;t<n.length&&t<s.length;){const r=Co(n[t],s[t]);if(r)return r;t++}if(Math.abs(s.length-n.length)===1){if(Nt(n))return 1;if(Nt(s))return-1}return s.length-n.length}function Nt(o){const e=o[o.length-1];return o.length>0&&e[e.length-1]<0}const Mo={type:0,value:""},Io=/[a-zA-Z0-9_]/;function Ro(o){if(!o)return[[]];if(o==="/")return[[Mo]];if(!o.startsWith("/"))throw new Error(`Invalid path "${o}"`);function e(c){throw new Error(`ERR (${t})/"${a}": ${c}`)}let t=0,n=t;const s=[];let r;function i(){r&&s.push(r),r=[]}let l=0,u,a="",d="";function h(){a&&(t===0?r.push({type:0,value:a}):t===1||t===2||t===3?(r.length>1&&(u==="*"||u==="+")&&e(`A repeatable param (${a}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:a,regexp:d,repeatable:u==="*"||u==="+",optional:u==="*"||u==="?"})):e("Invalid state to consume buffer"),a="")}function y(){a+=u}for(;l<o.length;){if(u=o[l++],u==="\\"&&t!==2){n=t,t=4;continue}switch(t){case 0:u==="/"?(a&&h(),i()):u===":"?(h(),t=1):y();break;case 4:y(),t=n;break;case 1:u==="("?t=2:Io.test(u)?y():(h(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&l--);break;case 2:u===")"?d[d.length-1]=="\\"?d=d.slice(0,-1)+u:t=3:d+=u;break;case 3:h(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&l--,d="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${a}"`),h(),i(),s}function Po(o,e,t){const n=$o(Ro(o.path),t),s=ae(n,{record:o,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function Ao(o,e){const t=[],n=new Map;e=Bt({strict:!1,end:!0,sensitive:!1},e);function s(h){return n.get(h)}function r(h,y,c){const b=!c,m=zt(h);m.aliasOf=c&&c.record;const f=Bt(e,h),S=[m];if("alias"in h){const v=typeof h.alias=="string"?[h.alias]:h.alias;for(const L of v)S.push(zt(ae({},m,{components:c?c.record.components:m.components,path:L,aliasOf:c?c.record:m})))}let p,g;for(const v of S){const{path:L}=v;if(y&&L[0]!=="/"){const A=y.record.path,k=A[A.length-1]==="/"?"":"/";v.path=y.record.path+(L&&k+L)}if(p=Po(v,y,f),c?c.alias.push(p):(g=g||p,g!==p&&g.alias.push(p),b&&h.name&&!jt(p)&&i(h.name)),fn(p)&&u(p),m.children){const A=m.children;for(let k=0;k<A.length;k++)r(A[k],p,c&&c.children[k])}c=c||p}return g?()=>{i(g)}:Xe}function i(h){if(cn(h)){const y=n.get(h);y&&(n.delete(h),t.splice(t.indexOf(y),1),y.children.forEach(i),y.alias.forEach(i))}else{const y=t.indexOf(h);y>-1&&(t.splice(y,1),h.record.name&&n.delete(h.record.name),h.children.forEach(i),h.alias.forEach(i))}}function l(){return t}function u(h){const y=Ho(h,t);t.splice(y,0,h),h.record.name&&!jt(h)&&n.set(h.record.name,h)}function a(h,y){let c,b={},m,f;if("name"in h&&h.name){if(c=n.get(h.name),!c)throw We(1,{location:h});f=c.record.name,b=ae(Ht(y.params,c.keys.filter(g=>!g.optional).concat(c.parent?c.parent.keys.filter(g=>g.optional):[]).map(g=>g.name)),h.params&&Ht(h.params,c.keys.map(g=>g.name))),m=c.stringify(b)}else if(h.path!=null)m=h.path,c=t.find(g=>g.re.test(m)),c&&(b=c.parse(m),f=c.record.name);else{if(c=y.name?n.get(y.name):t.find(g=>g.re.test(y.path)),!c)throw We(1,{location:h,currentLocation:y});f=c.record.name,b=ae({},y.params,h.params),m=c.stringify(b)}const S=[];let p=c;for(;p;)S.unshift(p.record),p=p.parent;return{name:f,path:m,params:b,matched:S,meta:No(S)}}o.forEach(h=>r(h));function d(){t.length=0,n.clear()}return{addRoute:r,resolve:a,removeRoute:i,clearRoutes:d,getRoutes:l,getRecordMatcher:s}}function Ht(o,e){const t={};for(const n of e)n in o&&(t[n]=o[n]);return t}function zt(o){const e={path:o.path,redirect:o.redirect,name:o.name,meta:o.meta||{},aliasOf:o.aliasOf,beforeEnter:o.beforeEnter,props:To(o),children:o.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in o?o.components||null:o.component&&{default:o.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function To(o){const e={},t=o.props||!1;if("component"in o)e.default=t;else for(const n in o.components)e[n]=typeof t=="object"?t[n]:t;return e}function jt(o){for(;o;){if(o.record.aliasOf)return!0;o=o.parent}return!1}function No(o){return o.reduce((e,t)=>ae(e,t.meta),{})}function Bt(o,e){const t={};for(const n in o)t[n]=n in e?e[n]:o[n];return t}function Ho(o,e){let t=0,n=e.length;for(;t!==n;){const r=t+n>>1;dn(o,e[r])<0?n=r:t=r+1}const s=zo(o);return s&&(n=e.lastIndexOf(s,n-1)),n}function zo(o){let e=o;for(;e=e.parent;)if(fn(e)&&dn(o,e)===0)return e}function fn({record:o}){return!!(o.name||o.components&&Object.keys(o.components).length||o.redirect)}function jo(o){const e={};if(o===""||o==="?")return e;const n=(o[0]==="?"?o.slice(1):o).split("&");for(let s=0;s<n.length;++s){const r=n[s].replace(nn," "),i=r.indexOf("="),l=Ke(i<0?r:r.slice(0,i)),u=i<0?null:Ke(r.slice(i+1));if(l in e){let a=e[l];ke(a)||(a=e[l]=[a]),a.push(u)}else e[l]=u}return e}function Wt(o){let e="";for(let t in o){const n=o[t];if(t=ao(t),n==null){n!==void 0&&(e+=(e.length?"&":"")+t);continue}(ke(n)?n.map(r=>r&&pt(r)):[n&&pt(n)]).forEach(r=>{r!==void 0&&(e+=(e.length?"&":"")+t,r!=null&&(e+="="+r))})}return e}function Bo(o){const e={};for(const t in o){const n=o[t];n!==void 0&&(e[t]=ke(n)?n.map(s=>s==null?null:""+s):n==null?n:""+n)}return e}const hn=Symbol(""),Vt=Symbol(""),tt=Symbol(""),wt=Symbol(""),vt=Symbol("");function Ue(){let o=[];function e(n){return o.push(n),()=>{const s=o.indexOf(n);s>-1&&o.splice(s,1)}}function t(){o=[]}return{add:e,list:()=>o.slice(),reset:t}}function Wo(o,e,t){const n=()=>{o[e].delete(t)};Le(n),En(n),Sn(()=>{o[e].add(t)}),o[e].add(t)}function Ar(o){const e=Re(hn,{}).value;e&&Wo(e,"updateGuards",o)}function Ce(o,e,t,n,s,r=i=>i()){const i=n&&(n.enterCallbacks[s]=n.enterCallbacks[s]||[]);return()=>new Promise((l,u)=>{const a=y=>{y===!1?u(We(4,{from:t,to:e})):y instanceof Error?u(y):Lo(y)?u(We(2,{from:e,to:y})):(i&&n.enterCallbacks[s]===i&&typeof y=="function"&&i.push(y),l())},d=r(()=>o.call(n&&n.instances[s],e,t,a));let h=Promise.resolve(d);o.length<3&&(h=h.then(a)),h.catch(y=>u(y))})}function lt(o,e,t,n,s=r=>r()){const r=[];for(const i of o)for(const l in i.components){let u=i.components[l];if(!(e!=="beforeRouteEnter"&&!i.instances[l]))if(en(u)){const d=(u.__vccOpts||u)[e];d&&r.push(Ce(d,t,n,i,l,s))}else{let a=u();r.push(()=>a.then(d=>{if(!d)throw new Error(`Couldn't resolve component "${l}" at "${i.path}"`);const h=qn(d)?d.default:d;i.mods[l]=d,i.components[l]=h;const c=(h.__vccOpts||h)[e];return c&&Ce(c,t,n,i,l,s)()}))}}return r}function Ut(o){const e=Re(tt),t=Re(wt),n=xe(()=>{const u=ie(o.to);return e.resolve(u)}),s=xe(()=>{const{matched:u}=n.value,{length:a}=u,d=u[a-1],h=t.matched;if(!d||!h.length)return-1;const y=h.findIndex(Be.bind(null,d));if(y>-1)return y;const c=Ft(u[a-2]);return a>1&&Ft(d)===c&&h[h.length-1].path!==c?h.findIndex(Be.bind(null,u[a-2])):y}),r=xe(()=>s.value>-1&&Yo(t.params,n.value.params)),i=xe(()=>s.value>-1&&s.value===t.matched.length-1&&rn(t.params,n.value.params));function l(u={}){if(Xo(u)){const a=e[ie(o.replace)?"replace":"push"](ie(o.to)).catch(Xe);return o.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>a),a}return Promise.resolve()}return{route:n,href:xe(()=>n.value.href),isActive:r,isExactActive:i,navigate:l}}function Vo(o){return o.length===1?o[0]:o}const Uo=ve({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Ut,setup(o,{slots:e}){const t=Ln(Ut(o)),{options:n}=Re(tt),s=xe(()=>({[Xt(o.activeClass,n.linkActiveClass,"router-link-active")]:t.isActive,[Xt(o.exactActiveClass,n.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const r=e.default&&Vo(e.default(t));return o.custom?r:Gt("a",{"aria-current":t.isExactActive?o.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},r)}}}),Fo=Uo;function Xo(o){if(!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)&&!o.defaultPrevented&&!(o.button!==void 0&&o.button!==0)){if(o.currentTarget&&o.currentTarget.getAttribute){const e=o.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return o.preventDefault&&o.preventDefault(),!0}}function Yo(o,e){for(const t in e){const n=e[t],s=o[t];if(typeof n=="string"){if(n!==s)return!1}else if(!ke(s)||s.length!==n.length||n.some((r,i)=>r!==s[i]))return!1}return!0}function Ft(o){return o?o.aliasOf?o.aliasOf.path:o.path:""}const Xt=(o,e,t)=>o??e??t,qo=ve({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(o,{attrs:e,slots:t}){const n=Re(vt),s=xe(()=>o.route||n.value),r=Re(Vt,0),i=xe(()=>{let a=ie(r);const{matched:d}=s.value;let h;for(;(h=d[a])&&!h.components;)a++;return a}),l=xe(()=>s.value.matched[i.value]);ot(Vt,xe(()=>i.value+1)),ot(hn,l),ot(vt,s);const u=F();return Pe(()=>[u.value,l.value,o.name],([a,d,h],[y,c,b])=>{d&&(d.instances[h]=a,c&&c!==d&&a&&a===y&&(d.leaveGuards.size||(d.leaveGuards=c.leaveGuards),d.updateGuards.size||(d.updateGuards=c.updateGuards))),a&&d&&(!c||!Be(d,c)||!y)&&(d.enterCallbacks[h]||[]).forEach(m=>m(a))},{flush:"post"}),()=>{const a=s.value,d=o.name,h=l.value,y=h&&h.components[d];if(!y)return Yt(t.default,{Component:y,route:a});const c=h.props[d],b=c?c===!0?a.params:typeof c=="function"?c(a):c:null,f=Gt(y,ae({},b,e,{onVnodeUnmounted:S=>{S.component.isUnmounted&&(h.instances[d]=null)},ref:u}));return Yt(t.default,{Component:f,route:a})||f}}});function Yt(o,e){if(!o)return null;const t=o(e);return t.length===1?t[0]:t}const Ko=qo;function Go(o){const e=Ao(o.routes,o),t=o.parseQuery||jo,n=o.stringifyQuery||Wt,s=o.history,r=Ue(),i=Ue(),l=Ue(),u=bn(Oe);let a=Oe;He&&o.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const d=rt.bind(null,x=>""+x),h=rt.bind(null,io),y=rt.bind(null,Ke);function c(x,_){let w,O;return cn(x)?(w=e.getRecordMatcher(x),O=_):O=x,e.addRoute(O,w)}function b(x){const _=e.getRecordMatcher(x);_&&e.removeRoute(_)}function m(){return e.getRoutes().map(x=>x.record)}function f(x){return!!e.getRecordMatcher(x)}function S(x,_){if(_=ae({},_||u.value),typeof x=="string"){const W=it(t,x,_.path),ee=e.resolve({path:W.path},_),we=s.createHref(W.fullPath);return ae(W,ee,{params:y(ee.params),hash:Ke(W.hash),redirectedFrom:void 0,href:we})}let w;if(x.path!=null)w=ae({},x,{path:it(t,x.path,_.path).path});else{const W=ae({},x.params);for(const ee in W)W[ee]==null&&delete W[ee];w=ae({},x,{params:h(W)}),_.params=h(_.params)}const O=e.resolve(w,_),T=x.hash||"";O.params=d(y(O.params));const V=uo(n,ae({},x,{hash:so(T),path:O.path})),C=s.createHref(V);return ae({fullPath:V,hash:T,query:n===Wt?Bo(x.query):x.query||{}},O,{redirectedFrom:void 0,href:C})}function p(x){return typeof x=="string"?it(t,x,u.value.path):ae({},x)}function g(x,_){if(a!==x)return We(8,{from:_,to:x})}function v(x){return k(x)}function L(x){return v(ae(p(x),{replace:!0}))}function A(x){const _=x.matched[x.matched.length-1];if(_&&_.redirect){const{redirect:w}=_;let O=typeof w=="function"?w(x):w;return typeof O=="string"&&(O=O.includes("?")||O.includes("#")?O=p(O):{path:O},O.params={}),ae({query:x.query,hash:x.hash,params:O.path!=null?{}:x.params},O)}}function k(x,_){const w=a=S(x),O=u.value,T=x.state,V=x.force,C=x.replace===!0,W=A(w);if(W)return k(ae(p(W),{state:typeof W=="object"?ae({},T,W.state):T,force:V,replace:C}),_||w);const ee=w;ee.redirectedFrom=_;let we;return!V&&fo(n,O,w)&&(we=We(16,{to:ee,from:O}),Y(O,O,!0,!1)),(we?Promise.resolve(we):M(ee,O)).catch(_e=>Se(_e)?Se(_e,2)?_e:U(_e):H(_e,ee,O)).then(_e=>{if(_e){if(Se(_e,2))return k(ae({replace:C},p(_e.to),{state:typeof _e.to=="object"?ae({},T,_e.to.state):T,force:V}),_||ee)}else _e=ne(ee,O,!0,C,T);return j(ee,O,_e),_e})}function E(x,_){const w=g(x,_);return w?Promise.reject(w):Promise.resolve()}function D(x){const _=Z.values().next().value;return _&&typeof _.runWithContext=="function"?_.runWithContext(x):x()}function M(x,_){let w;const[O,T,V]=Qo(x,_);w=lt(O.reverse(),"beforeRouteLeave",x,_);for(const W of O)W.leaveGuards.forEach(ee=>{w.push(Ce(ee,x,_))});const C=E.bind(null,x,_);return w.push(C),z(w).then(()=>{w=[];for(const W of r.list())w.push(Ce(W,x,_));return w.push(C),z(w)}).then(()=>{w=lt(T,"beforeRouteUpdate",x,_);for(const W of T)W.updateGuards.forEach(ee=>{w.push(Ce(ee,x,_))});return w.push(C),z(w)}).then(()=>{w=[];for(const W of V)if(W.beforeEnter)if(ke(W.beforeEnter))for(const ee of W.beforeEnter)w.push(Ce(ee,x,_));else w.push(Ce(W.beforeEnter,x,_));return w.push(C),z(w)}).then(()=>(x.matched.forEach(W=>W.enterCallbacks={}),w=lt(V,"beforeRouteEnter",x,_,D),w.push(C),z(w))).then(()=>{w=[];for(const W of i.list())w.push(Ce(W,x,_));return w.push(C),z(w)}).catch(W=>Se(W,8)?W:Promise.reject(W))}function j(x,_,w){l.list().forEach(O=>D(()=>O(x,_,w)))}function ne(x,_,w,O,T){const V=g(x,_);if(V)return V;const C=_===Oe,W=He?history.state:{};w&&(O||C?s.replace(x.fullPath,ae({scroll:C&&W&&W.scroll},T)):s.push(x.fullPath,T)),u.value=x,Y(x,_,w,C),U()}let X;function Q(){X||(X=s.listen((x,_,w)=>{if(!N.listening)return;const O=S(x),T=A(O);if(T){k(ae(T,{replace:!0,force:!0}),O).catch(Xe);return}a=O;const V=u.value;He&&wo(Rt(V.fullPath,w.delta),et()),M(O,V).catch(C=>Se(C,12)?C:Se(C,2)?(k(ae(p(C.to),{force:!0}),O).then(W=>{Se(W,20)&&!w.delta&&w.type===Ge.pop&&s.go(-1,!1)}).catch(Xe),Promise.reject()):(w.delta&&s.go(-w.delta,!1),H(C,O,V))).then(C=>{C=C||ne(O,V,!1),C&&(w.delta&&!Se(C,8)?s.go(-w.delta,!1):w.type===Ge.pop&&Se(C,20)&&s.go(-1,!1)),j(O,V,C)}).catch(Xe)}))}let G=Ue(),ue=Ue(),he;function H(x,_,w){U(x);const O=ue.list();return O.length?O.forEach(T=>T(x,_,w)):console.error(x),Promise.reject(x)}function P(){return he&&u.value!==Oe?Promise.resolve():new Promise((x,_)=>{G.add([x,_])})}function U(x){return he||(he=!x,Q(),G.list().forEach(([_,w])=>x?w(x):_()),G.reset()),x}function Y(x,_,w,O){const{scrollBehavior:T}=o;if(!He||!T)return Promise.resolve();const V=!w&&bo(Rt(x.fullPath,0))||(O||!w)&&history.state&&history.state.scroll||null;return xn().then(()=>T(x,_,V)).then(C=>C&&yo(C)).catch(C=>H(C,x,_))}const B=x=>s.go(x);let q;const Z=new Set,N={currentRoute:u,listening:!0,addRoute:c,removeRoute:b,clearRoutes:e.clearRoutes,hasRoute:f,getRoutes:m,resolve:S,options:o,push:v,replace:L,go:B,back:()=>B(-1),forward:()=>B(1),beforeEach:r.add,beforeResolve:i.add,afterEach:l.add,onError:ue.add,isReady:P,install(x){const _=this;x.component("RouterLink",Fo),x.component("RouterView",Ko),x.config.globalProperties.$router=_,Object.defineProperty(x.config.globalProperties,"$route",{enumerable:!0,get:()=>ie(u)}),He&&!q&&u.value===Oe&&(q=!0,v(s.location).catch(T=>{}));const w={};for(const T in Oe)Object.defineProperty(w,T,{get:()=>u.value[T],enumerable:!0});x.provide(tt,_),x.provide(wt,kn(w)),x.provide(vt,u);const O=x.unmount;Z.add(x),x.unmount=function(){Z.delete(x),Z.size<1&&(a=Oe,X&&X(),X=null,u.value=Oe,q=!1,he=!1),O()}}};function z(x){return x.reduce((_,w)=>_.then(()=>D(w)),Promise.resolve())}return N}function Qo(o,e){const t=[],n=[],s=[],r=Math.max(e.matched.length,o.matched.length);for(let i=0;i<r;i++){const l=e.matched[i];l&&(o.matched.find(a=>Be(a,l))?n.push(l):t.push(l));const u=o.matched[i];u&&(e.matched.find(a=>Be(a,u))||s.push(u))}return[t,n,s]}function Jo(){return Re(tt)}function Zo(o){return Re(wt)}const pn=[{path:"/",name:"Directory",component:()=>De(()=>import("./FileView_N-CIvJmnW7.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),meta:{icon:"sysIcon_folderopen",deny_user:!1,deny_guest:!1}},{path:"/favourite",name:"Favourite",component:()=>De(()=>import("./Favourite-3oBoRv5P.js"),__vite__mapDeps([10,2,3,5,4,6,7,8,11]),import.meta.url),meta:{icon:"sysIcon_star-o",deny_user:!1,deny_guest:!0}},{path:"/recycle",name:"Recycle",component:()=>De(()=>import("./FileView_R-CZJz6yAh.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9]),import.meta.url),meta:{icon:"sysIcon_delete",deny_user:!1,deny_guest:!0}},{path:"/tag",name:"Tag",component:()=>De(()=>import("./TagView-CaJNT1oh.js"),__vite__mapDeps([13,2,3,5,6,7,14]),import.meta.url),meta:{icon:"sysIcon_tagso",deny_user:!1,deny_guest:!0}},{path:"/shares",name:"Share",component:()=>De(()=>import("./ShareView-_yQhIHrt.js"),__vite__mapDeps([15,2,3,16]),import.meta.url),meta:{icon:"sysIcon_export",deny_user:!1,deny_guest:!0}},{path:"/group",name:"User",component:()=>De(()=>import("./UserView-Ba4ZW0cr.js"),__vite__mapDeps([17,2,3,5,6,7,18]),import.meta.url),meta:{icon:"sysIcon_team",deny_user:!0,deny_guest:!0}},{path:"/log",name:"ProcessLog",component:()=>De(()=>import("./LogView-PAuEYWoT.js"),__vite__mapDeps([19,2,3,20]),import.meta.url),meta:{icon:"sysIcon_filetext",deny_user:!0,deny_guest:!0}},{path:"/setting",name:"Setting",component:()=>De(()=>import("./SettingView-CyKYjjcN.js"),__vite__mapDeps([21,2,3,5,22]),import.meta.url),meta:{icon:"sysIcon_setting",deny_user:!0,deny_guest:!0}}],es=Go({history:So("./"),routes:pn}),ts=["onClick"],ns={class:"content"},os=ve({__name:"NaviContent",props:{depth:{},records:{}},setup(o){const e=o;e.depth&&e.depth;const t=e.records,n=Jo(),s=Zo();async function r(u){console.info("go",u);const a=await n.push(u.path);console.info(a)}const l=Ae().get();return(u,a)=>(I(!0),R(J,null,pe(ie(t),(d,h)=>{var y,c,b,m,f,S;return I(),R(J,{key:h},[(y=d.meta)!=null&&y.hide?(I(),R(J,{key:0},[],64)):(c=d.meta)!=null&&c.deny_guest&&((b=ie(l))==null?void 0:b.group.title)=="guest"?(I(),R(J,{key:1},[],64)):(m=d.meta)!=null&&m.deny_user&&!((f=ie(l))!=null&&f.group.admin)?(I(),R(J,{key:2},[],64)):(I(),R("p",{key:3,onClick:p=>r(d),class:de({title:!0,active:d.path===ie(s).path})},[$("span",{class:de(["icon","sysIcon",(S=d.meta)==null?void 0:S.icon])},null,2),$("span",ns,re(d.name),1)],10,ts))],64)}),128))}}),ss=ve({__name:"Navi",setup(o){return(e,t)=>(I(),R("div",{class:de(["fr_navi",{folded:!1}])},[Ne(os,{records:ie(pn),depth:1},null,8,["records"])]))}});let _t=null;const mn=Ze("useContext",()=>({register:as,trigger:rs}));function as(o){_t=o}function rs(o,e){_t&&_t(o,e)}class is{constructor(e){oe(this,"nodeList");oe(this,"title","");oe(this,"downTotal",0);oe(this,"downFile",0);oe(this,"downCur",0);oe(this,"fileMap",new Map);oe(this,"zipRoot");this.nodeList=e,this.title=this.buildTitle()}async prepare(){this.nodeList=await this.getFullSubList(),console.info(this.nodeList)}buildTitle(){let e="";if(this.nodeList.length==1)e=this.nodeList[0].title??"";else{let t=[];for(let n=0;n<this.nodeList.length&&(t.push(this.nodeList[n].title??""),!(n>3));n++);e=t.join("，")}return e.length>150&&(e=e.substring(0,150)+"…"),e+=".zip",e}async getFullSubList(){const e=new Set;this.nodeList.forEach(n=>{n.type==="directory"&&n.id&&e.add(n.id)});const t=Array.from(e);for(let n=0;n<t.length;n++){const s=t[n],r=await se("file/get",Object.assign({mode:"directory",cascade_dir:"1",id_dir:s.toString(),with:"file"}));r&&this.nodeList.push(...r.list)}return this.nodeList.sort((n,s)=>{let r=n.type==="directory"?"0":"1";n.node_id_list&&n.node_id_list.forEach(l=>r+=l.toString().padStart(15,"0"));let i=s.type==="directory"?"0":"1";return s.node_id_list&&s.node_id_list.forEach(l=>i+=l.toString().padStart(15,"0")),r>i?1:-1}),this.nodeList.forEach(n=>{var s,r;return this.downTotal+=((r=(s=n.file_index)==null?void 0:s.raw)==null?void 0:r.size)??0}),this.nodeList}async download(){var e,t;for(let n=0;n<this.nodeList.length;n++){const s=this.nodeList[n];if(!s.id||s.type==="directory"||(e=s.file_index)!=null&&e.raw)continue;const r=(t=s.file_index)==null?void 0:t.raw;if(!r||!r.path)continue;const i=r.path+"?filename="+s.title,l=await this.downloadFile(i,this.downloadProcess.bind(this));this.fileMap.set(s.id,l),this.downCur=0,this.downFile+=r.size}}downloadProcess(e){this.downCur=e.loaded}downloadFile(e,t){return new Promise(n=>{const s=new XMLHttpRequest;s.withCredentials=!0,s.responseType="arraybuffer",s.onreadystatechange=function(){if(s.readyState===4){if(s.status>=400)return ht(`${s.status}:${s.statusText}`);n(s.response)}},t&&(s.onprogress=t),s.open("GET",e),s.send()})}async build(){this.zipRoot=new Dn;const e=new Map;this.nodeList.forEach(t=>{if(!t.id)return;let n=t.title??"";const s=e.get(t.id_parent??0);if(s&&(n=s[0]+"/"+n),t.type!="directory"){const r=this.fileMap.get(t.id);if(!r)return;e.set(t.id,[n,this.zipRoot.file(n,r)])}else e.set(t.id,[n,this.zipRoot.folder(n)])})}complete(){return new Promise(e=>{var t;(t=this.zipRoot)==null||t.generateAsync({type:"blob"}).then(n=>{let s=document.createElement("a");s.style.display="none",s.href=URL.createObjectURL(n),s.target="_blank",s.setAttribute("download",this.title),s.click(),e(!0)})})}}const ct=["scroll_log","image_rotate"];let Je=null,Ie=null;function ls(){Je=window.indexedDB.open(ce.indexedDBName,4),Je.onupgradeneeded=cs,Je.onerror=o=>{},Je.onsuccess=o=>{Ie=o.target.result}}function cs(o){return console.info("onupgradeneeded",o),new Promise(e=>{Ie=o.target.result,us(Ie);let t=0;for(let n=0;n<ct.length;n++){const s=ct[n],r=Ie.createObjectStore(s,{keyPath:"key"});r.transaction.oncomplete=i=>{t+=1,t==ct.length-1&&e()}}})}function us(o){if(!o)return;const e=o==null?void 0:o.objectStoreNames;if(e)for(let t=0;t<e.length;t++)o.deleteObjectStore(e[t])}function bt(o,e){return new Promise(t=>{if(!Ie)return t(null);const n=Ie.transaction([o],"readonly").objectStore(o).get(e);n.onerror=s=>t(null),n.onsuccess=s=>s.target.result?t(s.target.result.val):t(null)})}function kt(o,e,t){return new Promise(n=>{if(!Ie)return n(null);const s=Ie.transaction([o],"readwrite").objectStore(o).put({key:e,val:t});s.onerror=r=>n(null),s.onsuccess=r=>n(null)})}var vn={};Object.defineProperty(vn,"__esModule",{value:!0});function ds(o){o===void 0&&(o={});var e=/^0/,t=/\s+/g,n=/^\s+|\s+$/g,s=/[^\x00-\x80]/,r=/^0x[0-9a-f]+$/i,i=/(0x[\da-fA-F]+|(^[\+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|\d+)/g,l=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,u=String.prototype.toLocaleLowerCase||String.prototype.toLowerCase,a=o.desc?-1:1,d=-a,h=o.insensitive?function(b){return u.call(""+b).replace(n,"")}:function(b){return(""+b).replace(n,"")};function y(b){return b.replace(i,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0")}function c(b,m){return(!b.match(e)||m===1)&&parseFloat(b)||b.replace(t," ").replace(n,"")||0}return function(b,m){var f=h(b),S=h(m);if(!f&&!S)return 0;if(!f&&S)return d;if(f&&!S)return a;var p=y(f),g=y(S),v=f.match(r),L=S.match(r),A=v&&L?parseInt(v[0],16):p.length!==1&&Date.parse(f),k=v&&L?parseInt(L[0],16):A&&S.match(l)&&Date.parse(S)||null;if(k){if(A===k)return 0;if(A<k)return d;if(A>k)return a}for(var E=p.length,D=g.length,M=0,j=Math.max(E,D);M<j;M+=1){var ne=c(p[M]||"",E),X=c(g[M]||"",D);if(isNaN(ne)!==isNaN(X))return isNaN(ne)?a:d;if(s.test(ne+X)&&ne.localeCompare){var Q=ne.localeCompare(X);if(Q>0)return a;if(Q<0)return d;if(M===j-1)return 0}if(ne<X)return d;if(ne>X)return a;if(""+ne<""+X)return d;if(""+ne>""+X)return a}return 0}}var fs=vn.default=ds;let K;class Tr{constructor(e){oe(this,"nodeList",F([]));oe(this,"getList");oe(this,"route");oe(this,"router");oe(this,"contentDOM");oe(this,"emitGo");oe(this,"modalStore");oe(this,"localConfigure");oe(this,"contextStore");oe(this,"mode",F(""));oe(this,"modeKey","");oe(this,"sortVal",F(""));oe(this,"selecting",!1);oe(this,"selectingMovEvtCount",0);oe(this,"selectingOffset",[[0,0],[0,0]]);oe(this,"preSelectedNodeIndexSet",new Set);oe(this,"selectingKeyDef","");oe(this,"showSelectionOp",F(!1));oe(this,"lastSelectIndex",-1);oe(this,"reloadOffset_timer",0);oe(this,"reloadOffset_count",0);oe(this,"startScroll",!1);this.contentDOM=e.contentDOM,this.getList=e.getList,this.route=e.route,this.router=e.router,this.emitGo=e.emitGo,this.modalStore=Te(),this.localConfigure=Ve(),this.contextStore=mn(),this.mode.value=this.localConfigure.get("file_view_mode")??"detail",this.modeKey=this.localConfigure.listen("file_view_mode",t=>this.mode.value=t),this.sortVal=F(this.localConfigure.get("file_view_sort")??"name_asc"),this.contextMenuEvt=this.contextMenuEvt.bind(this),this.mouseDownEvt=this.mouseDownEvt.bind(this),this.mouseMoveEvt=this.mouseMoveEvt.bind(this),this.mouseUpEvt=this.mouseUpEvt.bind(this),this.keymap=this.keymap.bind(this),this.reloadOffset=this.reloadOffset.bind(this),this.scrollEvt=this.scrollEvt.bind(this),addEventListener("contextmenu",this.contextMenuEvt),addEventListener("pointerdown",this.mouseDownEvt),addEventListener("pointermove",this.mouseMoveEvt),addEventListener("pointerup",this.mouseUpEvt),addEventListener("keydown",this.keymap),addEventListener("resize",this.reloadOffset),this.contentDOM.addEventListener("scroll",this.scrollEvt),K=this}destructor(){console.info("destructor loaded"),this.localConfigure.release("file_view_mode",this.modeKey),removeEventListener("contextmenu",this.contextMenuEvt),removeEventListener("mousedown",this.mouseDownEvt),removeEventListener("mousemove",this.mouseMoveEvt),removeEventListener("mouseup",this.mouseUpEvt),removeEventListener("keydown",this.keymap),removeEventListener("resize",this.reloadOffset),this.contentDOM&&this.contentDOM.removeEventListener("scroll",this.scrollEvt),K=null}setList(e){this.nodeList.value=e,setTimeout(()=>{this.reloadOffset(void 0)},ce.timeouts.offsetDebounce)}deleteFromList(e){const t=[],n=new Set;e.forEach(s=>n.add(s)),this.nodeList.value.forEach(s=>{n.has(s.id)||t.push(s)}),this.getList(t)}inDetailView(e){let t=!1,n=e.target;for(;n;){if(n.contentEditable==="true"){t=!1;break}if(n.classList.contains("rater")){t=!1;break}if(n.classList.contains("list_fav")){t=!0;break}if(n.classList.contains("view_fav")){t=!1;break}if(n.classList.contains("content_meta")){t=!1;break}if(n.classList.contains("fr_content")){t=!0;break}if(!n.parentElement)break;n=n.parentElement}return t}inTaggingDOM(e){let t=!1,n=e.target;for(;n;){if(n.classList.contains("content_detail"))return!1;if(n.classList.contains("tag_list")){t=!0;break}if(!n.parentElement)break;n=n.parentElement}return t}mouseDownEvt(e){var i,l,u,a;if(!this.inDetailView(e)||e.button===1)return;if(this.selectingOffset[0]=[e.x+(((i=this.contentDOM)==null?void 0:i.scrollLeft)??0),e.y+(((l=this.contentDOM)==null?void 0:l.scrollTop)??0)],this.selectingOffset[1]=[e.x+(((u=this.contentDOM)==null?void 0:u.scrollLeft)??0),e.y+(((a=this.contentDOM)==null?void 0:a.scrollTop)??0)],this.preSelectedNodeIndexSet.clear(),e.preventDefault(),e.button!==0)return this.rightMouseDownEvt(e);this.nodeList.value.forEach((d,h)=>{d._selected&&this.preSelectedNodeIndexSet.add(h)}),this.selecting=!0,this.selectingMovEvtCount=0;const t=this.getSelection(this.selectingOffset),n=[];e.ctrlKey&&n.push("ctrl"),e.shiftKey&&n.push("shift"),this.selectingKeyDef=n.join("_");let s=-1;const r=Array.from(t);switch(r.length&&(s=r.pop()??-1),this.selectingKeyDef){case"shift":this.preSelectedNodeIndexSet.clear();case"ctrl_shift":if(s==-1||this.lastSelectIndex==-1)break;const d=Math.min(s,this.lastSelectIndex),h=Math.max(s,this.lastSelectIndex);for(let y=d;y<=h;y++)t.has(y)||this.preSelectedNodeIndexSet.add(y);break;default:this.preSelectedNodeIndexSet.clear();break;case"ctrl":break}this.nodeList.value.forEach((d,h)=>{let y=0;this.preSelectedNodeIndexSet.has(h)&&(y+=1),t.has(h)&&(y+=1),d._selected=y===1}),this.lastSelectIndex=s,this.showSelectionOp.value=this.preSelectedNodeIndexSet.size+t.size>0}rightMouseDownEvt(e){const t=this.getSelection(this.selectingOffset);let n=!1;const s=new Set;this.nodeList.value.forEach((r,i)=>{r._selected&&(s.add(i),t.has(i)&&(n=!0))}),n?this.preSelectedNodeIndexSet=s:this.preSelectedNodeIndexSet=t,this.nodeList.value.forEach((r,i)=>{r._selected=this.preSelectedNodeIndexSet.has(i)})}mouseMoveEvt(e){var s,r;if(!this.selecting||(this.selectingMovEvtCount+=1,this.selectingMovEvtCount<10))return;e.preventDefault(),this.selectingOffset[1]=[e.x+(((s=this.contentDOM)==null?void 0:s.scrollLeft)??0),e.y+(((r=this.contentDOM)==null?void 0:r.scrollTop)??0)];const t=this.getSelection(this.selectingOffset);this.nodeList.value.forEach((i,l)=>{let u=0;this.preSelectedNodeIndexSet.has(l)&&(u+=1),t.has(l)&&(u+=1),i._selected=u===1});const n=this.getSelection([this.selectingOffset[1],this.selectingOffset[1]]);n.size&&(this.lastSelectIndex=Array.from(n).pop()??-1),this.showSelectionOp.value=this.preSelectedNodeIndexSet.size+t.size>0}mouseUpEvt(e){this.selecting&&(e.preventDefault(),setTimeout(()=>{this.selecting=!1,this.selectingMovEvtCount=0,this.selectingOffset=[[0,0],[0,0]],this.preSelectedNodeIndexSet.clear(),this.selectingKeyDef=""},ce.timeouts.selectEvt))}async contextMenuEvt(e){if(!this.inDetailView(e))return;let t=this.route.name==="Recycle",n=this.getSelected();if(!n.nodeLs||!n.nodeLs.length)return;let s=n.nodeLs.length!==1;const r=n.nodeLs,i=n.idSet;let l=this.localConfigure.get("file_view_mode")??"detail";this.route.name!=="Directory"&&(l="detail");let u=l==="detail";this.route.name==="Recycle"&&(u=!1),e.preventDefault(),e.stopPropagation(),this.contextStore.trigger([{title:"Open",auth:"guest",method:async a=>{console.info("Open",a),s?await te.op_bath_browser(i,r):this.emitGo("node",r[0].id)}},{title:"Open New Tab",auth:"guest",method:async a=>{console.info("Open",a,this.route,this.router);let d;s||r.length&&r[0].type==="directory"&&(d=r[0]),fe.copyObject(this.route.query);let h=new URL(location.href);d&&h.searchParams.set("id_dir",d.id),window.open(h,"_blank").focus()}},{title:"Download",auth:s||r[0].type=="directory"?"none":"guest",method:a=>{var b,m;console.info("Download",a);const d=r[0];let h=(m=(b=d.file_index)==null?void 0:b.raw)==null?void 0:m.path,y=(d==null?void 0:d.title)??"";if(!h)return;let c=document.createElement("a");c.style.display="none",c.href=h+"?filename="+y,c.target="_blank",c.setAttribute("download",y),c.click()}},{title:"Download Selected",auth:s||r[0].type=="directory"?"guest":"none",method:async a=>{if(console.info("DownloadSelected",a),console.info(this,r),!K||!K.modalStore)return;const d=new is(r),h=F("downloading 0/0 (0%)"),y=K.modalStore.set({title:d.title,alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:h});await d.prepare();const c=setInterval(()=>{const b=d.downFile+d.downCur,m=d.downTotal,f=Math.round(1e4*b/m)/100+"%";y.content.text.value=`downloading ${b}/${m} (${f})`},500);await d.download(),await d.build(),await d.complete(),clearInterval(c),K.modalStore.close(y.nid)}},{title:"Rename",auth:u?"user":"none",method:async a=>{console.info("Rename",a),s?await te.op_bath_rename(i,r):await te.op_rename(r[0])}},{title:"Move",auth:u?"user":"none",method:async a=>{console.info("Move",a),s?await te.op_bath_move(i,r):await te.op_move(r[0])}},{title:"Delete",auth:t?"none":"user",method:async a=>{console.info("Delete",a),s?await te.op_bath_delete(i,r):await te.op_delete(r[0])}},{title:"Recover",auth:t?"user":"none",method:async a=>{console.info("Recover",a),s?await te.op_bath_delete(i,r,!0):await te.op_delete(r[0],!0)}},{title:"Delete Forever",auth:t?"user":"none",method:async a=>{console.info("Delete Forever",a),s?await te.op_bath_delete_forever(i,r):await te.op_delete_forever(r[0])}},{title:"Favourite",auth:u?"user":"none",method:async a=>{console.info("Favourite",a),s?await te.op_bath_favourite(i,r):await te.op_toggle_favourite(r[0])}},{title:"Share",auth:"user",method:async a=>{console.info("Share",a),await te.op_share(i)}},{title:"Extra",auth:"guest",method:a=>{console.info("Extra",a)},child:[{title:"Tagging",auth:u?"user":"none",method:async a=>{console.info("Tagging",a),r.forEach(d=>{te.op_tag(d)})}},{title:"Set Cover",auth:s?"none":"user",method:async a=>{console.info("Set Cover",a),await te.op_set_cover(r[0])}},{title:"Import EHT",auth:"admin",method:async a=>{console.info("Import EHT",a),await te.op_imp_tag_eh(Array.from(i))}},{title:"Cascade Tag",auth:"user",method:async a=>{console.info("Cascade Tag",a),await te.op_cascade_tag(Array.from(i))}}]},{title:"Admin",auth:"admin",method:a=>{console.info("Extra",a)},child:[{title:"ReBuild",auth:"admin",method:async a=>{console.info("ReBuild",a),await te.op_rebuild(Array.from(i))}},{title:"ReHash",auth:s?"none":"admin",method:async a=>{console.info("ReHash",a),await te.op_rehash(Array.from(i))}},{title:"RM RAW",auth:"admin",method:async a=>{console.info("RMRAW",a),await te.op_rm_raw(Array.from(i))}}]}],e)}getSelection(e){let t=e[0][0]>e[1][0]?e[1][0]:e[0][0],n=e[0][1]>e[1][1]?e[1][1]:e[0][1],s=e[0][0]<e[1][0]?e[1][0]:e[0][0],r=e[0][1]<e[1][1]?e[1][1]:e[0][1];const i=new Set;return this.nodeList.value.forEach((l,u)=>{if(!l._offsets)return;let a=l==null?void 0:l._offsets[0],d=l==null?void 0:l._offsets[1],h=l==null?void 0:l._offsets[2],y=l==null?void 0:l._offsets[3],c=a>=t&&a<=s||h>=t&&h<=s||a<=s&&h>=t,b=d>=n&&d<=r||y>=n&&y<=r||d<=r&&y>=n;!c||!b||i.add(u)}),i}clearSelect(e){e.target.classList.contains("content_detail")&&(this.nodeList.value.forEach(t=>{t._selected=!1}),this.showSelectionOp.value=!1)}async bathOp(e){let{idSet:t,nodeLs:n}=this.getSelected();if(t.size)switch(e){case"rename":await te.op_bath_rename(t,n);break;case"move":await te.op_bath_move(t,n);break;case"delete":await te.op_bath_delete(t,n);break;case"delete_forever":await te.op_bath_delete_forever(t,n);break;case"browser":await te.op_bath_browser(t,n);break;case"favourite":await te.op_bath_favourite(t,n);break}}getSelected(){const e=[],t=new Set;return this.nodeList.value.forEach(n=>{n._selected&&(e.push(n),t.add((n==null?void 0:n.id)??0))}),{nodeLs:e,idSet:t}}arrowSelection(e){if(!this.nodeList.value.length)return;let t=this.lastSelectIndex;if(t===-1){const a=this.getSelected();a.idSet.size?t=Array.from(a.idSet).pop()??0:t=0}this.localConfigure.get("file_view_mode"),this.route.name;const n=this.nodeList.value[t];if(!n)return;n._offsets||(n._offsets=[]);const s=n._offsets[2]-n._offsets[0],r=this.contentDOM.offsetWidth,i=Math.floor(r/s);let l=t;switch(e.key){case"ArrowRight":l+=1;break;case"ArrowLeft":l-=1;break;case"ArrowUp":l-=1*i;break;case"ArrowDown":l+=1*i;break}let u=!1;(e.ctrlKey||e.shiftKey)&&(u=!0),l<0&&(l=0),l>this.nodeList.value.length-1&&(l=this.nodeList.value.length-1),this.lastSelectIndex=l,this.nodeList.value.forEach((a,d)=>{if(l===d)return a._selected=!0;a._selected&&!u&&(a._selected=!1)})}setMode(e){this.localConfigure.set("file_view_mode",e),this.setList(this.nodeList.value)}setSort(e){console.info("setSort",e),this.localConfigure.set("file_view_sort",e);const t=this.nodeList.value;this.nodeList.value=[],setTimeout(()=>{this.nodeList.value=this.sortList(t,this.sortVal.value),this.setList(this.nodeList.value)},ce.timeouts.sort)}sortList(e,t){return e=_n(e,t),e}async keymap(e){let t;const n=e.target;switch(e.key){case"F2":if(Me(n)||Fe(n))return;t=this.getSelected(),t.nodeLs.length!==1?await te.op_bath_rename(t.idSet,t.nodeLs):await te.op_rename(t.nodeLs[0]);break;case"Delete":if(Me(n)||Fe(n))return;t=this.getSelected(),this.route.name==="Recycle"?await te.op_bath_delete_forever(t.idSet,t.nodeLs):await te.op_bath_delete(t.idSet,t.nodeLs);break;case"NumpadEnter":case"Enter":if(Me(n)||Fe(n)||(t=this.getSelected(),!t.idSet.size))return;if(console.info(t.idSet.size),e.altKey&&t.idSet.size==1)return this.emitGo("node",Array.from(t.idSet)[0]);await te.op_bath_browser(t.idSet,t.nodeLs);break;case"ArrowRight":case"ArrowLeft":case"ArrowUp":case"ArrowDown":return Me(n)||Fe(n)?void 0:this.arrowSelection(e)}}reloadOffset(e){if(this.reloadOffset_count>100)return;let t=!0;if(this.nodeList.value.forEach(n=>{n._dom||(t=!1)}),clearTimeout(this.reloadOffset_timer),!t){this.reloadOffset_timer=setTimeout(()=>{this.reloadOffset_count+=1,this.reloadOffset(e)},ce.timeouts.offsetDebounce);return}this.nodeList.value.forEach(n=>{if(!n._dom)return;const s=n._dom;let r=0,i=0,l=0,u=0;r=fe.nodeOffsetX(s),i=fe.nodeOffsetY(s),l=r+s.offsetWidth,u=i+s.offsetHeight,n._offsets=[r,i,l,u]}),this.scrollEvt(e)}go(e){const t=Object.assign({id_dir:"",id_tag:""},e);this.router.push({path:"/",query:t})}scrollEvt(e){fe.debounce(()=>{this.saveScroll(),this.reloadLazyLoad()},ce.timeouts.scrollEvt,"debounce_scroll_view")}saveScroll(){const e=this.route.query??{},t=[this.route.path,e.mode?e.mode:"",e.pid?e.pid:"",e.id?e.id:"",e.id?e.id:"",e.tag_id?e.tag_id:""].join(":"),n=[this.contentDOM.scrollTop,this.contentDOM.scrollLeft];!n[0]&&!n[1]||fe.debounce(()=>{kt("scroll_log",t,n)},ce.timeouts.scrollSave,"debounce_scroll_save")}async reloadScroll(){const e=this.route.query??{},t=[this.route.path,e.mode?e.mode:"",e.pid?e.pid:"",e.id?e.id:"",e.id?e.id:"",e.tag_id?e.tag_id:""].join(":"),n=await bt("scroll_log",t);n&&(this.contentDOM.scrollTop=n[0]??0,this.contentDOM.scrollLeft=n[1]??0)}reloadLazyLoad(){if(!this.contentDOM)return;const e=this.contentDOM,t=fe.nodeOffsetY(e),n=e.scrollTop+t,s=n+e.clientHeight+t;this.nodeList.value.forEach(r=>{let i=!0;if(!r._offsets||!r._offsets.length)return;let l=r._offsets;l[1]>s&&(i=!1),l[3]<n&&(i=!1),r._in_screen=i})}}class te{static async op_download(e){var n,s;let t=(s=(n=e.file_index)==null?void 0:n.raw)==null?void 0:s.path;t&&window.open(`${t}?filename=${e.title}`)}static async op_rename(e){if(e._renaming){const t=new FormData;t.set("id",`${e.id}`),t.set("title",e.title??""),t.set("description",e.description??""),await se("file/mod",t),K&&K.emitGo("reload")}e._renaming=!e._renaming,setTimeout(()=>{let t=document.body.querySelector('[contenteditable="true"]');t&&t.focus()},50)}static async op_bath_rename(e,t){K&&K.modalStore.set({title:"bath rename",alpha:!1,key:"",single:!1,w:400,h:275,minW:400,minH:275,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"renameUtil",data:{node_list:t,callback:()=>{K&&K.getList()}}}]})}static async op_move(e){K&&K.modalStore.set({title:`locator | move ${e.title} to:`,alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async t=>{const n=new FormData;n.set("id_node",`${e.id}`),n.set("id_target",`${t.id}`),await se("file/mov",n),K&&K.emitGo("reload")}}}]})}static async op_bath_move(e,t){K&&K.modalStore.set({title:`locator | move ${e.size} files to:`,alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async n=>{const s={id_list:Array.from(e).join(","),id_parent:`${n.id}`},r=await se("file/bath_move",s);K&&K.getList()}}}]})}static async op_delete(e,t=!1){const n=new FormData;n.set("id",`${e.id}`);const s=await se("file/delete",n);return console.info(K),K&&e.id&&K.deleteFromList([e.id]),s}static async op_bath_delete(e,t,n=!1,s){K&&K.modalStore.set({title:`confirm to ${n?"recover":"delete"} ${e.size} files`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:"conform to "+(n?"recover":"delete"),callback:{confirm:async r=>{const i=Array.from(e),l={id_list:i.join(",")},u=await se("file/bath_delete",l);K&&K.deleteFromList(i),s&&s()}}})}static async op_delete_forever(e){const t=new FormData;t.set("id",`${e.id}`);const n=await se("file/delete_forever",t);return K&&e.id&&K.deleteFromList([e.id]),n}static async op_bath_delete_forever(e,t){K&&K.modalStore.set({title:`confirm to delete ${e.size} files forever`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:"conform to delete forever",callback:{confirm:async n=>{const s=Array.from(e),r={id_list:s.join(",")},i=await se("file/bath_delete_forever",r);K&&K.deleteFromList(s)}}})}static async op_toggle_favourite(e){const t=await se("favourite_group/get",{}),n={};t&&t.forEach(s=>{s.auto||(n[s.id??0]=s.title??"")}),K&&K.modalStore.set({title:"select fav group:",alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"checkbox",label:"attach to",key:"target_group",value:e.list_fav,options:n}],callback:{submit:async function(s){const i=s.content.form[0].value.join(",");await se("favourite/attach",{id_node:e.id,list_group:i}),location.reload()}}})}static async op_bath_favourite(e,t){const n=await se("favourite_group/get",{}),s={};n&&n.forEach(r=>{r.auto||(s[r.id??0]=r.title??"")}),K&&K.modalStore.set({title:"select fav group:",alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"checkbox",label:"attach to:",key:"target_group",value:[],options:s}],callback:{submit:async function(r){const i=r.content.form[0].value.join(",");await se("favourite/bath_attach",{node_id_list:Array.from(e),list_group:i})}}})}static async op_bath_browser(e,t){let n=Array.from(e),s={};s.with="crumb,file",n.length==1?(s.mode="directory",s.id_dir=`${t[0].type==="directory"?t[0].id:t[0].id_parent}`):(s.mode="id_iterate",s.keyword=n.join(",")),s.cascade_dir="0",hs(s,n[0])}static async op_tag(e){if(e._tagging){const t=new Set;if(e.tag)for(let s=0;s<e.tag.length;s++)for(let r=0;r<e.tag[s].sub.length;r++){const i=e.tag[s].sub[r].id;i&&t.add(i)}const n=new FormData;n.set("id_node",`${e.id}`),n.set("tag_list",Array.from(t).join(",")),await se("tag/attach",n)}e._tagging=!e._tagging}static async op_set_cover(e){const t=new FormData;return t.set("id",`${e.id}`),await se("file/cover",t)}static async op_rebuild(e){const t=new FormData;return t.set("id_list",e.join(",")),await se("file/rebuild",t)}static async op_rehash(e){const t=new FormData;return t.set("id_list",e.join(",")),await se("file/rehash",t)}static async op_cascade_tag(e){const t=new FormData;return t.set("id_list",e.join(",")),await se("file/cascade_tag",t)}static async op_rm_raw(e){const t=new FormData;return t.set("id_list",e.join(",")),await se("file/rm_raw",t)}static async op_imp_tag_eh(e){const t=new FormData;return t.set("id_list",e.join(",")),await se("setting/import_eht_tag",t)}static async op_rate(e,t){if(!K)return;let n=K.getSelected();t&&!n.idSet.size&&(n.idSet.add((t==null?void 0:t.id)??0),n.nodeLs.push(t)),n.nodeLs.forEach(r=>{r.rate=e});const s=new FormData;s.set("node_id_list",Array.from(n.idSet).join(",")),s.set("rate",`${e}`),await se("rate/attach",s)}static async op_share(e){const t={title:"share file",alpha:!1,key:"",single:!1,w:400,h:120,minW:400,minH:120,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:'<a href="./share.html?id=#id#" target="_blank" style="text-decoration: underline">url generated<br> id: #id#</a>',callback:{submit:async n=>{}}};K.modalStore.set({title:"share file",alpha:!1,key:"",single:!1,w:400,h:160,minW:400,minH:160,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"radio",label:"duration",key:"status",value:"1",options:{1:"long",2:"1 day",3:"7 day",4:"30 day",5:"manual"},on_change:(n,s,r)=>{const i=new Date;switch(r.value){case"1":s.content.form[1].disabled=!0;break;case"2":s.content.form[1].disabled=!0,i.setDate(i.getDate()+1),s.content.form[1].value=i.toISOString().substring(0,16);break;case"3":s.content.form[1].disabled=!0,i.setDate(i.getDate()+7),s.content.form[1].value=i.toISOString().substring(0,16);break;case"4":s.content.form[1].disabled=!0,i.setDate(i.getDate()+30),s.content.form[1].value=i.toISOString().substring(0,16);break;case"5":s.content.form[1].disabled=!1,i.setDate(i.getDate()+30),s.content.form[1].value=i.toISOString().substring(0,16);break}}},{type:"datetime",label:"expire",key:"time_to",value:new Date().toISOString().substring(0,16),disabled:!0}],callback:{submit:async n=>{const s=new FormData;s.set("node_id_list",Array.from(e).join(",")),n.content.form[0].value=="1"?s.set("status",2):(s.set("status",1),s.set("time_to",n.content.form[1].value));const r=await se("share/set",s);r&&(t.text=t.text.replace(/#id#/ig,r.id),K.modalStore.set(t))}}})}}function hs(o,e){if(!K)return;let t=K.localConfigure.get("browser_layout_w"),n=K.localConfigure.get("browser_layout_h");const s=window.innerWidth,r=window.innerHeight;s<t&&(t=0),r<n&&(n=0),K.modalStore.set({title:"file browser",alpha:!1,key:"",single:!1,w:t||400,h:n||400,minW:400>window.innerWidth?window.innerWidth*.9:400,minH:400>window.innerHeight?window.innerHeight*.9:400,allow_resize:!0,allow_move:!0,allow_fullscreen:!0,auto_focus:!1,component:[{componentName:"fileBrowser",data:{query:fe.copyObject(o),curId:e}}]})}function _n(o,e){let t=["id","asc"];switch(e){default:case"id_asc":t=["id","asc"];break;case"id_desc":t=["id","desc"];break;case"name_asc":t=["title","asc"];break;case"name_desc":t=["title","desc"];break;case"crt_asc":t=["time_create","asc"];break;case"crt_desc":t=["time_create","desc"];break;case"upd_asc":t=["time_update","asc"];break;case"upd_desc":t=["time_update","desc"];break;case"rate_asc":t=["rate","asc"];break;case"rate_desc":t=["rate","desc"];break}for(let r=0;r<o.length;r++){const i=o[r];i._sort_index||(i._sort_index=i.node_path+"/"+i.title)}const n=t[1]==="desc",s=n?-1:1;return o.sort((r,i)=>{let l="",u="";switch(t[0]){default:l=r[t[0]],u=i[t[0]];break;case"title":return l=s*(r.type==="directory"?0:1)+(r._sort_index??""),u=s*(i.type==="directory"?0:1)+(i._sort_index??""),fs({desc:n,insensitive:!0})(l,u)}return(l>u?1:-1)*s}),o}const ps={class:"modal_browser base"},ms={class:"base"},vs={class:"l"},_s={class:"r"},gs={class:"content"},qt=ve({__name:"browserBase",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},setup(o){const e=o;return(t,n)=>(I(),R("div",ps,[$("div",ms,[$("div",vs,[me(t.$slots,"info")]),$("div",_s,[me(t.$slots,"btnContainer")])]),me(t.$slots,"navigator"),$("div",gs,[$("span",{class:de(["listIcon",`listIcon_file_${e.curNode.type}`]),style:be({fontSize:e.modalData.layout.h*.5+"px",lineHeight:e.modalData.layout.h*.8+"px"})},null,6)])]))}}),ys={class:"modal_browser image"},ws={class:"base"},bs={class:"l"},ks={class:"btnContainer"},xs={class:"r"},Es={key:0,class:"loader sysIcon sysIcon_sync"},Ss=["data-ref-node-id","src","data-rotate"],Ls=ve({__name:"browserImage",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},emits:["nav"],setup(o,{emit:e}){const t=Ve(),n=o,s=e,r=[.1,.25,.5,.75,1,1.25,1.5,2],i=F(null),l=F(null),u=F({loaded:0,w:0,h:0,x:0,y:0,rotate:0,orgRatio:0,ratio:0,ratioTxt:"0 %",orgW:0,orgH:0}),a=F();async function d(E){const D=l.value;if(!D)return;if(!D.complete)return setTimeout(d,50);const M=await bt("image_rotate",n.curNode.id);Object.assign(u.value,{loaded:n.curNode.id,orgH:D.naturalHeight,orgW:D.naturalWidth,rotate:M}),await y()}ye(()=>{a.value=h(n.curNode),Object.assign(u.value,{loaded:0,w:0,h:0,x:0,y:0,rotate:0,orgW:0,orgH:0}),document.addEventListener(`modal_resizing_${n.modalData.nid}`,y),document.addEventListener("pointerup",f),document.addEventListener("pointermove",m),document.addEventListener("wheel",v),document.addEventListener("keydown",A),document.addEventListener("pointercancel",f),document.addEventListener("pointerout",f)}),Pe(()=>n.curNode,async E=>{console.info("onMod props.curNode"),u.value.loaded=0;const D=h(E),M=new Image;M.src=D,M.onload=j=>{a.value=D}}),Le(()=>{document.removeEventListener(`modal_resizing_${n.modalData.nid}`,y),document.removeEventListener("pointerup",f),document.removeEventListener("pointermove",m),document.removeEventListener("wheel",v),document.removeEventListener("keydown",A),document.removeEventListener("pointercancel",f),document.removeEventListener("pointerout",f)});function h(E){var D,M;return((M=(D=E.file_index)==null?void 0:D.normal)==null?void 0:M.path)+"?filename="+E.title}async function y(){if(!u.value.loaded)return;const E=n.modalData.layout,D=E.w??0;let M=E.h??0;M-=16;const j=u.value,ne=Math.abs(j.rotate%180-90)<45,X=D/(ne?j.orgH:j.orgW),Q=M/(ne?j.orgW:j.orgH),G={w:0,h:0,x:0,y:0,ratio:0,orgRatio:0,ratioTxt:"0 %"},ue=Math.min(X,Q);G.w=j.orgW*ue,G.h=j.orgH*ue,G.x=(D-G.w)/2,G.y=(M-G.h)/2,G.ratio=ue,G.orgRatio=ue,G.ratioTxt=Math.round(ue*1e3)/10+" %",Object.assign(u.value,G)}const c=new Map;function b(E){if(!n.modalData.layout.active||!E.pointerId)return;E.preventDefault(),E.stopPropagation(),u.value;const D={x:E.clientX,y:E.clientY};c.set(E.pointerId,D)}function m(E){n.modalData.layout.active&&E.pointerId&&(E.preventDefault(),E.stopPropagation(),S(E))}function f(E){c.get(E.pointerId)&&c.delete(E.pointerId)}function S(E){const D=c.get(E.pointerId);if(!D||Math.abs(E.clientX-D.x)<1&&Math.abs(E.clientY-D.y)<1)return;const M=u.value,j=l.value,ne=i.value;if(!j||!ne)return;if(c.size==1){const O={x:E.clientX-D.x+M.x,y:E.clientY-D.y+M.y};Object.assign(u.value,O),c.set(E.pointerId,{x:E.clientX,y:E.clientY});return}const X={x:0,y:0,pointerCount:0};c.forEach((O,T,V)=>{T!=E.pointerId&&(X.x+=O.x,X.y+=O.y,X.pointerCount+=1)}),X.x=X.x/X.pointerCount,X.y=X.y/X.pointerCount;const Q={orgX:D.x-X.x,orgY:D.y-X.y,tgtX:E.clientX-X.x,tgtY:E.clientY-X.y},G={x:0,y:0,w:0,h:0,ratio:M.ratio*Math.sqrt((Q.tgtX*Q.tgtX+Q.tgtY*Q.tgtY)/(Q.orgX*Q.orgX+Q.orgY*Q.orgY)),ratioTxt:"0 %"};G.ratio>5&&(G.ratio=5),G.w=M.orgW*G.ratio,G.h=M.orgH*G.ratio;const ue=ne.clientWidth??0,he=ne.clientHeight??0,{x:H,y:P}=fe.nodeOffsetXY(ne),U=j.clientWidth??0,Y=j.clientHeight??0,{x:B,y:q}=fe.nodeOffsetXY(j),Z=(E.clientX-D.x)/2,N=(E.clientY-D.y)/2,z=X.x-H-ue/2,x=X.y-P-he/2,_=(X.x-(B+U/2))/M.ratio*G.ratio,w=(X.y-(q+Y/2))/M.ratio*G.ratio;G.x=(ue-G.w)/2+z-_+Z,G.y=(he-G.h)/2+x-w+N,G.ratioTxt=Math.round(G.ratio*1e4)/100+" %",Object.assign(u.value,G),c.set(E.pointerId,{x:E.clientX,y:E.clientY})}const p=F(t.get("browser_image_scrollLock")??!1);function g(E){p.value=E,t.set("browser_image_scrollLock",E)}function v(E){let D=E==null?void 0:E.target,M;do if(M=D.getAttribute("data-ref-id"),M||!D.parentElement||(D=D.parentElement,D.tagName==="BODY"))break;while(!0);if(M!==n.modalData.nid)return;const j=E.deltaY<0?1:-1;p.value?s("nav",n.curIndex-j):L(j,E.clientX,E.clientY)}function L(E,D,M){const j=u.value,ne=l.value,X=i.value;if(!ne||!X)return;let Q=[];const G=j.ratio;Q.push(...r,j.ratio,j.orgRatio);const ue=new Set(Q);Q=Array.from(ue),Q.sort();const he=Q.indexOf(j.ratio)+E;if(he<0||he>=Q.length)return;const H=Q[he],P=X.clientWidth??0,U=X.clientHeight??0,{x:Y,y:B}=fe.nodeOffsetXY(X);Math.abs(j.rotate%180-90)<45;const q={w:j.orgW*H,h:j.orgH*H,x:0,y:0,ratio:H,ratioTxt:Math.round(H*1e4)/100+" %"};if(D===void 0||M===void 0){q.x=(P-q.w)/2,q.y=(U-q.h)/2,Object.assign(u.value,q);return}const Z=ne.clientWidth??0,N=ne.clientHeight??0,{x:z,y:x}=fe.nodeOffsetXY(ne),_=D-Y-P/2,w=M-B-U/2,O=(D-(z+Z/2))/G*q.ratio,T=(M-(x+N/2))/G*q.ratio;q.x=(P-q.w)/2+_-O,q.y=(U-q.h)/2+w-T,Object.assign(u.value,q)}function A(E){if(!Me(E.target)&&n.modalData.layout.active)switch(E.code){case"KeyQ":k(-90);break;case"KeyE":k(90);break}}function k(E){let D={rotate:u.value.rotate},M=D.rotate+E;for(;M<0;)M+=360;for(;M>360;)M-=360;D.rotate=M,kt("image_rotate",n.curNode.id,M),Object.assign(u.value,D),y()}return(E,D)=>(I(),R("div",ys,[$("div",ws,[$("div",bs,[me(E.$slots,"info"),$("div",ks,[$("button",{class:de(["sysIcon","sysIcon_scroll",p.value?"active":""]),onClick:D[0]||(D[0]=M=>g(!p.value))},null,2),$("button",{class:de(["sysIcon","sysIcon_zoomout"]),onClick:D[1]||(D[1]=M=>L(-1))}),$("button",{onClick:y},re(u.value.ratioTxt),1),$("button",{class:de(["sysIcon","sysIcon_zoomin"]),onClick:D[2]||(D[2]=M=>L(1))})])]),$("div",xs,[me(E.$slots,"btnContainer")])]),me(E.$slots,"navigator"),$("div",{class:"content",ref_key:"contentDOM",ref:i},[u.value.loaded?le("",!0):(I(),R("span",Es)),$("img",{"data-ref-node-id":n.curNode.id,src:a.value,"data-rotate":u.value.rotate,onPointerdown:b,onDblclick:D[3]||(D[3]=(...M)=>E.resetImgresetImg&&E.resetImgresetImg(...M)),onLoad:d,class:de({loading:!u.value.loaded}),style:be({width:u.value.w+"px",height:u.value.h+"px",left:u.value.x+"px",top:u.value.y+"px",rotate:u.value.rotate+"deg"}),ref_key:"imgDOM",ref:l},null,46,Ss)],512)]))}}),Ds={class:"modal_browser audio"},Os={class:"base"},$s={class:"l"},Cs={class:"btnContainer"},Ms={class:"r"},Is={key:0,class:"loader sysIcon sysIcon_sync"},Rs=["src"],Ps=["data-item-id","poster"],As=["src"],Ts=ve({__name:"browserAudio",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},emits:["nav"],setup(o,{emit:e}){var H,P,U,Y,B,q,Z;const t=Ve(),n=o,s=e,r=F(null),i=F(null),l=F(null),u=F("");(U=(P=(H=n.curNode)==null?void 0:H.file_index)==null?void 0:P.normal)!=null&&U.path?u.value=`${(B=(Y=n.curNode.file_index)==null?void 0:Y.normal)==null?void 0:B.path}?filename=${n.curNode.title}`:u.value=`${(Z=(q=n.curNode.file_index)==null?void 0:q.raw)==null?void 0:Z.path}?filename=${n.curNode.title}`;const a=F({duration:0,buffered:0,time:0,volume:t.get("browser_play_volume")?t.get("browser_play_volume"):100,brightness:t.get("browser_play_brightness")?t.get("browser_play_brightness"):1,mute:!1,play:!1,loading:!0,loop:t.get("browser_play_mode")==="single"}),d=t.listen("browser_play_mode",N=>Object.assign(a.value,{loop:N==="single"})),h=t.listen("browser_play_volume",N=>Object.assign(a.value,{volume:N})),y=t.listen("browser_play_brightness",N=>Object.assign(a.value,{brightness:N})),c=["cover","album","bk","cd"],b=["jpg","png","webp"];function m(){var _,w;console.info("onInit"),console.info(n.nodeList);const N=l.value;if(!N)return;if(N.readyState!==4)return setTimeout(m,50);const z=a.value,x={time:0,duration:N.duration};if(Object.assign(a.value,x),z.play&&N.play(),N.volume=z.mute?0:z.volume/100,(_=r.value)==null||_.addEventListener("wheel",G),!((w=n.curNode.file_index)!=null&&w.preview)){let O=!1;n.nodeList.forEach(T=>{if(T.id_parent!==n.curNode.id_parent||O)return;let V=!1;if(c.forEach(W=>{b.forEach(ee=>{T.title.toLowerCase().indexOf(W)!==-1&&T.title.toLowerCase().indexOf(ee)!==-1&&(V=!0)})}),!V)return;O=!0;let C;C||(C=T.file_index.preview),C||(C=T.file_index.normal),C||(C=T.file_index.raw),n.curNode.file_index.preview=C})}}function f(N){console.info("onCanplay"),l.value&&(document.addEventListener("keydown",ue),Object.assign(a.value,{loading:!1}))}function S(N=!0){var z;document.removeEventListener("wheel",G),document.removeEventListener("keydown",ue),u.value="",l.value&&((z=l.value)==null||z.load()),N&&Object.assign(a.value,{loading:!0})}function p(){const N=l.value;if(!N)return;const z=a.value;z.play?N.pause():N.play(),Object.assign(a.value,{play:!z.play})}function g(N){console.info("onEnd",N);const z=l.value;if(!z)return;if(a.value.loop){z.currentTime=0,z.play();return}s("nav",n.curIndex+1)}ye(async()=>{var N;l.value&&((N=l.value)==null||N.load()),v=setInterval(L,200)}),Pe(()=>n.curNode,async N=>{var z,x,_,w,O,T,V,C;S(),(_=(x=(z=n.curNode)==null?void 0:z.file_index)==null?void 0:x.normal)!=null&&_.path?u.value=`${(O=(w=N.file_index)==null?void 0:w.normal)==null?void 0:O.path}?filename=${N.title}`:u.value=`${(V=(T=N.file_index)==null?void 0:T.raw)==null?void 0:V.path}?filename=${N.title}`,l.value&&((C=l.value)==null||C.load())}),gt(()=>{S(!1),t.release("browser_play_mode",d),t.release("browser_play_volume",h),t.release("browser_play_brightness",y),clearInterval(v)});let v=0;function L(){if(!l.value||!l.value.buffered||!l.value.buffered.length)return;let N=0;for(let z=0;z<l.value.buffered.length;z++){const x=l.value.buffered.end(z);if(!(a.value.time>x)){N=x;break}}Object.assign(a.value,{buffered:N})}function A(N){const z=l.value;z&&Object.assign(a.value,{time:z.currentTime})}const k={active:!1,x:0,y:0,w:0,h:0,orgX:0,orgY:0,left:0,right:0,t:0};let E=0;function D(N){if(E)return;const z=l.value;if(!z)return;const x=i.value;if(!x)return;E=N.pointerId,document.addEventListener("pointermove",M),document.addEventListener("pointerup",j);const _={active:!0,x:N.clientX,w:x.clientWidth,orgX:fe.nodeOffsetX(x)};Object.assign(k,_);const w=(_.x-_.orgX)/_.w;z.currentTime=z.duration*w,Object.assign(a.value,{time:z.currentTime})}function M(N){if(N.pointerId!=E||(N.preventDefault(),N.stopPropagation(),!k.active))return;const z=l.value;if(!z)return;Object.assign(k,{x:N.clientX});let x=(k.x-k.orgX)/k.w;x>1&&(x=1),x<0&&(x=0),z.currentTime=z.duration*x,Object.assign(a.value,{time:z.currentTime})}function j(N){N.pointerId==E&&(E=0,Object.assign(k,{active:!1}),document.removeEventListener("pointermove",M),document.removeEventListener("pointerup",j))}function ne(N){if(E||!l.value)return;const x=r.value;if(!x)return;E=N.pointerId,N.preventDefault(),N.stopPropagation(),document.addEventListener("pointermove",X),document.addEventListener("pointerup",Q);const _={active:!0,x:N.clientX,y:N.clientY,w:x.clientWidth,h:x.clientHeight,orgX:fe.nodeOffsetX(x),orgY:fe.nodeOffsetX(x),left:0,right:0,t:new Date().valueOf()},w=(_.x-_.orgX)/_.w;w>.5&&(_.right=1),w<.5&&(_.left=1),Object.assign(k,_)}function X(N){if(N.pointerId!=E||(N.preventDefault(),N.stopPropagation(),!k.active))return;const z=l.value;if(!z||!r.value)return;const _=(N.clientY-k.y)/k.h;Object.assign(k,{y:N.clientY});const w=a.value;if(k.right){let O=w.volume-_*100*1.5;O<0&&(O=0),O>100&&(O=100),z.volume=O/100,t.set("browser_play_volume",O)}if(k.left){let O=w.brightness-_;O<0&&(O=0),O>1&&(O=1),w.brightness=O,t.set("browser_play_brightness",O)}}function Q(N){if(N.pointerId!=E)return;E=0;const z=new Date().valueOf();k.t>z-250&&p(),Object.assign(k,{active:!1}),document.removeEventListener("pointermove",X),document.removeEventListener("pointerup",Q)}function G(N){const z=l.value;if(!z)return;let _=a.value.volume+(N.deltaY<0?5:-5);_<0&&(_=0),_>100&&(_=100),z.volume=_/100,t.set("browser_play_volume",_)}function ue(N){if(!Me(N.target)&&n.modalData.layout.active)switch(N.key){case" ":p();break;case"ArrowUp":G({deltaY:-1});break;case"ArrowDown":G({deltaY:1});break;case"ArrowLeft":case"ArrowRight":const z=l.value;if(!z)return;z.currentTime+=N.key==="ArrowLeft"?-5:5,Object.assign(a.value,{time:z.currentTime});break}}function he(N){const z={h:""+Math.floor(N/3600),m:""+Math.floor(N/60%60),s:""+Math.floor(N%60)};z.m.length<2&&(z.m="0"+z.m),z.s.length<2&&(z.s="0"+z.s);let x=""+z.s;return(z.m||z.h)&&(x=`${z.m}:${x}`),z.h!=="0"&&(x=`${z.h}:${x}`),x}return(N,z)=>{var x,_,w,O,T;return I(),R("div",Ds,[$("div",Os,[$("div",$s,[me(N.$slots,"info"),$("div",Cs,[$("button",{class:de({sysIcon:!0,sysIcon_volume:!a.value.mute&&a.value.volume,sysIcon_mute:a.value.mute,sysIcon_mutemode:!a.value.mute&&!a.value.volume})},re(Math.round(a.value.volume)),3),$("button",{class:de({sysIcon:!0,sysIcon_caretright:a.value.play,sysIcon_pause:!a.value.play})},re(he(a.value.time)),3),$("div",{class:de(["audio_bar"]),onPointerdown:D,ref_key:"timelineDOM",ref:i},[$("span",{class:"duration",style:be({left:100*a.value.time/a.value.duration+"%"})},null,4),$("span",{class:"buffer",style:be({width:100*a.value.buffered/a.value.duration+"%"})},null,4)],544)])]),$("div",Ms,[me(N.$slots,"btnContainer")])]),me(N.$slots,"navigator"),$("div",{class:"content",ref_key:"contentDOM",ref:r,onPointerdown:ne},[a.value.loading?(I(),R("span",Is)):le("",!0),(x=n.curNode.file_index)!=null&&x.preview?(I(),R("img",{key:1,src:(w=(_=n.curNode.file_index)==null?void 0:_.preview)==null?void 0:w.path,style:be({filter:`brightness(${a.value.brightness})`})},null,12,Rs)):(I(),R("span",{key:2,class:de(["listIcon",`listIcon_file_${n.curNode.type}`]),style:be({fontSize:n.modalData.layout.h*.5+"px",lineHeight:n.modalData.layout.h*.8+"px"})},null,6)),$("audio",{ref_key:"mediaDOM",ref:l,preload:"metadata","data-item-id":n.curNode.id,poster:(T=(O=n.curNode.file_index)==null?void 0:O.preview)==null?void 0:T.path,onLoadedmetadata:m,onCanplay:f,onEnded:g,onTimeupdate:A},[$("source",{src:u.value},null,8,As)],40,Ps)],544)])}}}),Ns={class:"modal_browser video"},Hs={class:"base"},zs={class:"l"},js={class:"btnContainer"},Bs=["value"],Ws={class:"r"},Vs={key:0,class:"loader sysIcon sysIcon_sync"},Us=["data-item-id","poster"],Fs=["src"],Xs=["default","src","srclang","label"],Ys=["default","src","srclang","label"],qs=ve({__name:"browserVideo",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},emits:["nav"],setup(o,{emit:e}){var Y,B,q,Z,N,z,x;const t=Ve(),n=o,s=e,r=F(null),i=F(null),l=F(null),u=F("");(q=(B=(Y=n.curNode)==null?void 0:Y.file_index)==null?void 0:B.normal)!=null&&q.path?u.value=`${(N=(Z=n.curNode.file_index)==null?void 0:Z.normal)==null?void 0:N.path}?filename=${n.curNode.title}`:u.value=`${(x=(z=n.curNode.file_index)==null?void 0:z.raw)==null?void 0:x.path}?filename=${n.curNode.title}`;const a=F({duration:0,buffered:0,time:0,volume:t.get("browser_play_volume")?t.get("browser_play_volume"):100,brightness:t.get("browser_play_brightness")?t.get("browser_play_brightness"):1,mute:!1,play:!1,loading:!0,loop:t.get("browser_play_mode")==="single"}),d=t.listen("browser_play_mode",_=>Object.assign(a.value,{loop:_==="single"})),h=t.listen("browser_play_volume",_=>Object.assign(a.value,{volume:_})),y=t.listen("browser_play_brightness",_=>Object.assign(a.value,{brightness:_}));function c(){var T;console.info("onInit");const _=l.value;if(!_)return;if(_.readyState!==4)return setTimeout(c,50);const w=a.value,O={time:0,duration:_.duration};Object.assign(a.value,O),w.play&&_.play(),_.volume=w.mute?0:w.volume/100,(T=r.value)==null||T.addEventListener("wheel",Q)}function b(_){console.info("onCanplay"),l.value&&(document.addEventListener("keydown",G),Object.assign(a.value,{loading:!1}))}function m(_=!0){var w;document.removeEventListener("wheel",Q),document.removeEventListener("keydown",G),u.value="",l.value&&((w=l.value)==null||w.load()),_&&Object.assign(a.value,{loading:!0})}function f(){const _=l.value;if(!_)return;const w=a.value;w.play?_.pause():_.play(),Object.assign(a.value,{play:!w.play})}function S(_){console.info("onEnd",_);const w=l.value;if(!w)return;if(a.value.loop){w.currentTime=0,w.play();return}s("nav",n.curIndex+1)}ye(async()=>{var _;await p(),l.value&&((_=l.value)==null||_.load()),g=setInterval(v,200)});async function p(){H.value=[],P()}Pe(()=>n.curNode,async _=>{var w,O,T,V,C,W,ee,we;m(),p(),(T=(O=(w=n.curNode)==null?void 0:w.file_index)==null?void 0:O.normal)!=null&&T.path?u.value=`${(C=(V=_.file_index)==null?void 0:V.normal)==null?void 0:C.path}?filename=${_.title}`:u.value=`${(ee=(W=_.file_index)==null?void 0:W.raw)==null?void 0:ee.path}?filename=${_.title}`,l.value&&((we=l.value)==null||we.load())}),gt(()=>{m(!1),t.release("browser_play_mode",d),t.release("browser_play_volume",h),t.release("browser_play_brightness",y),clearInterval(g)});let g=0;function v(){if(!l.value||!l.value.buffered||!l.value.buffered.length)return;let _=0;for(let w=0;w<l.value.buffered.length;w++){const O=l.value.buffered.end(w);if(!(a.value.time>O)){_=O;break}}Object.assign(a.value,{buffered:_})}function L(_){const w=l.value;w&&Object.assign(a.value,{time:w.currentTime})}const A={active:!1,x:0,y:0,w:0,h:0,orgX:0,orgY:0,left:0,right:0,t:0};let k=0;function E(_){if(k)return;const w=l.value;if(!w)return;const O=i.value;if(!O)return;k=_.pointerId,document.addEventListener("pointermove",D),document.addEventListener("pointerup",M);const T={active:!0,x:_.clientX,w:O.clientWidth,orgX:fe.nodeOffsetX(O)};Object.assign(A,T);const V=(T.x-T.orgX)/T.w;w.currentTime=w.duration*V,Object.assign(a.value,{time:w.currentTime})}function D(_){if(_.pointerId!=k||(_.preventDefault(),_.stopPropagation(),!A.active))return;const w=l.value;if(!w)return;Object.assign(A,{x:_.clientX});let O=(A.x-A.orgX)/A.w;O>1&&(O=1),O<0&&(O=0),w.currentTime=w.duration*O,Object.assign(a.value,{time:w.currentTime})}function M(_){_.pointerId==k&&(k=0,Object.assign(A,{active:!1}),document.removeEventListener("pointermove",D),document.removeEventListener("pointerup",M))}function j(_){if(k||!l.value)return;const O=r.value;if(!O)return;k=_.pointerId,_.preventDefault(),_.stopPropagation(),document.addEventListener("pointermove",ne),document.addEventListener("pointerup",X);const T={active:!0,x:_.clientX,y:_.clientY,w:O.clientWidth,h:O.clientHeight,orgX:fe.nodeOffsetX(O),orgY:fe.nodeOffsetX(O),left:0,right:0,t:new Date().valueOf()},V=(T.x-T.orgX)/T.w;V>.5&&(T.right=1),V<.5&&(T.left=1),Object.assign(A,T)}function ne(_){if(_.pointerId!=k||(_.preventDefault(),_.stopPropagation(),!A.active))return;const w=l.value;if(!w||!r.value)return;const T=(_.clientY-A.y)/A.h;Object.assign(A,{y:_.clientY});const V=a.value;if(A.right){let C=V.volume-T*100*1.5;C<0&&(C=0),C>100&&(C=100),w.volume=C/100,t.set("browser_play_volume",C)}if(A.left){let C=V.brightness-T;C<0&&(C=0),C>1&&(C=1),V.brightness=C,t.set("browser_play_brightness",C)}}function X(_){if(_.pointerId!=k)return;k=0;const w=new Date().valueOf();A.t>w-250&&f(),Object.assign(A,{active:!1}),document.removeEventListener("pointermove",ne),document.removeEventListener("pointerup",X)}function Q(_){const w=l.value;if(!w)return;let T=a.value.volume+(_.deltaY<0?5:-5);T<0&&(T=0),T>100&&(T=100),w.volume=T/100,t.set("browser_play_volume",T)}function G(_){if(!Me(_.target)&&n.modalData.layout.active)switch(_.key){case" ":f();break;case"ArrowUp":Q({deltaY:-1});break;case"ArrowDown":Q({deltaY:1});break;case"ArrowLeft":case"ArrowRight":const w=l.value;if(!w)return;w.currentTime+=_.key==="ArrowLeft"?-5:5,Object.assign(a.value,{time:w.currentTime});break}}function ue(_){const w={h:""+Math.floor(_/3600),m:""+Math.floor(_/60%60),s:""+Math.floor(_%60)};w.m.length<2&&(w.m="0"+w.m),w.s.length<2&&(w.s="0"+w.s);let O=""+w.s;return(w.m||w.h)&&(O=`${w.m}:${O}`),w.h!=="0"&&(O=`${w.h}:${O}`),O}const he=F(0),H=F([]);function P(){var T,V;let _=(T=n.curNode.title)==null?void 0:T.lastIndexOf("."),w=((V=n.curNode.title)==null?void 0:V.substring(0,_))??"";if(!w)return H.value=[];const O=[];n.nodeList.forEach(C=>{var ee,we,_e,St,Lt,Dt;if(C.type!=="subtitle"||!((we=(ee=C.file_index)==null?void 0:ee.normal)!=null&&we.path||(St=(_e=C.file_index)==null?void 0:_e.raw)!=null&&St.path))return;let W=(Lt=C.title)==null?void 0:Lt.substring(w.length);((Dt=C.title)==null?void 0:Dt.indexOf(w))===0&&O.push(Object.assign({label:W},C))}),H.value=O}function U(_){var O;const w=(O=l.value)==null?void 0:O.textTracks;if(w)for(let T=0;T<w.length;T++)_==T?w[T].mode="showing":w[T].mode="disabled"}return(_,w)=>{var O,T;return I(),R("div",Ns,[$("div",Hs,[$("div",zs,[me(_.$slots,"info"),$("div",js,[$("button",{class:de({sysIcon:!0,sysIcon_volume:!a.value.mute&&a.value.volume,sysIcon_mute:a.value.mute,sysIcon_mutemode:!a.value.mute&&!a.value.volume})},re(Math.round(a.value.volume)),3),$("button",{class:de({sysIcon:!0,sysIcon_caretright:a.value.play,sysIcon_pause:!a.value.play})},re(ue(a.value.time)),3),$("div",{class:de(["video_bar"]),onPointerdown:E,ref_key:"timelineDOM",ref:i},[$("span",{class:"duration",style:be({left:100*a.value.time/a.value.duration+"%"})},null,4),$("span",{class:"buffer",style:be({width:100*a.value.buffered/a.value.duration+"%"})},null,4)],544),H.value&&H.value.length?ge((I(),R("select",{key:0,"onUpdate:modelValue":w[0]||(w[0]=V=>he.value=V),onChange:w[1]||(w[1]=V=>U(he.value))},[(I(!0),R(J,null,pe(H.value,(V,C)=>(I(),R("option",{value:C,key:"MO_BS_VDO_"+_.modalData.nid+"_sub_"+C},re(V.label),9,Bs))),128))],544)),[[ze,he.value]]):le("",!0)])]),$("div",Ws,[me(_.$slots,"btnContainer")])]),me(_.$slots,"navigator"),$("div",{class:"content",ref_key:"contentDOM",ref:r,onPointerdown:j},[a.value.loading?(I(),R("span",Vs)):le("",!0),$("video",{ref_key:"mediaDOM",ref:l,preload:"metadata","data-item-id":n.curNode.id,poster:(T=(O=n.curNode.file_index)==null?void 0:O.preview)==null?void 0:T.path,onLoadedmetadata:c,onCanplay:b,onEnded:S,onTimeupdate:L,style:be({filter:`brightness(${a.value.brightness})`})},[$("source",{src:u.value},null,8,Fs),(I(!0),R(J,null,pe(H.value,(V,C)=>{var W;return I(),R(J,null,[(W=V.file_index)!=null&&W.normal?(I(),R("track",{key:"MO_BS_VDO_"+_.modalData.nid+"_track_"+C,default:he.value==C,src:V.file_index.normal.path,kind:"subtitles",srclang:V.label,label:V.label},null,8,Xs)):(I(),R("track",{key:"MO_BS_VDO_"+_.modalData.nid+"_track_"+C,default:he.value==C,src:V.file_index.raw.path,kind:"subtitles",srclang:V.label,label:V.label},null,8,Ys))],64)}),256))],44,Us)],544)])}}}),Ks={class:"modal_browser txt"},Gs={class:"base"},Qs={class:"l"},Js={class:"r"},Zs={class:"content"},ea=ve({__name:"browserText",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},setup(o){const e=o,t=F(""),n=F(null);async function s(l){const a=await(await fetch(l.path,{method:"GET",headers:{}})).text();t.value=a,await i()}async function r(l){fe.debounce(()=>{if(!n.value)return;const u=[n.value.scrollTop,n.value.scrollLeft];if(!u[0]&&!u[1])return;const a=`browser:${e.curNode.id}`;fe.debounce(()=>{kt("scroll_log",a,u)},ce.timeouts.scrollSave,"debounce_scroll_save")},ce.timeouts.scrollEvt,"debounce_scroll_view")}async function i(){if(!n.value)return;n.value.scrollTop=0,n.value.scrollLeft=0;const l=`browser:${e.curNode.id}`,u=await bt("scroll_log",l);u&&(n.value.scrollTop=u[0],n.value.scrollLeft=u[1])}return ye(async()=>{var l;e.curNode&&e.curNode.file_index&&e.curNode.file_index.raw&&await s(e.curNode.file_index.raw),n.value&&((l=n.value)==null||l.addEventListener("scroll",r))}),Pe(()=>e.curNode,async l=>{l.file_index&&l.file_index.raw&&await s(l.file_index.raw)}),gt(()=>{}),(l,u)=>(I(),R("div",Ks,[$("div",Gs,[$("div",Qs,[me(l.$slots,"info")]),$("div",Js,[me(l.$slots,"btnContainer")])]),me(l.$slots,"navigator"),$("div",Zs,[$("div",{class:"textContent",ref_key:"contentDOM",ref:n},re(t.value),513)])]))}}),ta={class:"modal_browser pdf"},na={class:"base"},oa={class:"l"},sa={class:"r"},aa={class:"content"},ra=["src"],ia=ve({__name:"browserPDF",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},setup(o){const e=o;""+e.modalData.nid,F(null);const t=F(null);return ye(()=>{var n,s;console.warn("mounted"),t.value="/pdfjs/web/viewer.html?file="+((s=(n=e.curNode.file_index)==null?void 0:n.raw)==null?void 0:s.path)+"&filename="+e.curNode.title}),Pe(()=>e.curNode,async n=>{var s,r;console.info("onMod props.curNode"),t.value="/pdfjs/web/viewer.html?file="+((r=(s=n.file_index)==null?void 0:s.raw)==null?void 0:r.path)+"&filename="+n.title}),Le(()=>{t.value=null}),(n,s)=>(I(),R("div",ta,[$("div",na,[$("div",oa,[me(n.$slots,"info")]),$("div",sa,[me(n.$slots,"btnContainer")])]),me(n.$slots,"navigator"),$("div",aa,[t.value?(I(),R("iframe",{key:0,src:t.value,allowfullscreen:""},null,8,ra)):le("",!0)])]))}});var nt={},Ee=Ee||function(o,e){var t={},n=t.lib={},s=function(){},r=n.Base={extend:function(c){s.prototype=this;var b=new s;return c&&b.mixIn(c),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var c=this.extend();return c.init.apply(c,arguments),c},init:function(){},mixIn:function(c){for(var b in c)c.hasOwnProperty(b)&&(this[b]=c[b]);c.hasOwnProperty("toString")&&(this.toString=c.toString)},clone:function(){return this.init.prototype.extend(this)}},i=n.WordArray=r.extend({init:function(c,b){c=this.words=c||[],this.sigBytes=b!=e?b:4*c.length},toString:function(c){return(c||u).stringify(this)},concat:function(c){var b=this.words,m=c.words,f=this.sigBytes;if(c=c.sigBytes,this.clamp(),f%4)for(var S=0;S<c;S++)b[f+S>>>2]|=(m[S>>>2]>>>24-8*(S%4)&255)<<24-8*((f+S)%4);else if(65535<m.length)for(S=0;S<c;S+=4)b[f+S>>>2]=m[S>>>2];else b.push.apply(b,m);return this.sigBytes+=c,this},clamp:function(){var c=this.words,b=this.sigBytes;c[b>>>2]&=4294967295<<32-8*(b%4),c.length=o.ceil(b/4)},clone:function(){var c=r.clone.call(this);return c.words=this.words.slice(0),c},random:function(c){for(var b=[],m=0;m<c;m+=4)b.push(4294967296*o.random()|0);return new i.init(b,c)}}),l=t.enc={},u=l.Hex={stringify:function(c){var b=c.words;c=c.sigBytes;for(var m=[],f=0;f<c;f++){var S=b[f>>>2]>>>24-8*(f%4)&255;m.push((S>>>4).toString(16)),m.push((S&15).toString(16))}return m.join("")},parse:function(c){for(var b=c.length,m=[],f=0;f<b;f+=2)m[f>>>3]|=parseInt(c.substr(f,2),16)<<24-4*(f%8);return new i.init(m,b/2)}},a=l.Latin1={stringify:function(c){var b=c.words;c=c.sigBytes;for(var m=[],f=0;f<c;f++)m.push(String.fromCharCode(b[f>>>2]>>>24-8*(f%4)&255));return m.join("")},parse:function(c){for(var b=c.length,m=[],f=0;f<b;f++)m[f>>>2]|=(c.charCodeAt(f)&255)<<24-8*(f%4);return new i.init(m,b)}},d=l.Utf8={stringify:function(c){try{return decodeURIComponent(escape(a.stringify(c)))}catch{throw Error("Malformed UTF-8 data")}},parse:function(c){return a.parse(unescape(encodeURIComponent(c)))}},h=n.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new i.init,this._nDataBytes=0},_append:function(c){typeof c=="string"&&(c=d.parse(c)),this._data.concat(c),this._nDataBytes+=c.sigBytes},_process:function(c){var b=this._data,m=b.words,f=b.sigBytes,S=this.blockSize,p=f/(4*S),p=c?o.ceil(p):o.max((p|0)-this._minBufferSize,0);if(c=p*S,f=o.min(4*c,f),c){for(var g=0;g<c;g+=S)this._doProcessBlock(m,g);g=m.splice(0,c),b.sigBytes-=f}return new i.init(g,f)},clone:function(){var c=r.clone.call(this);return c._data=this._data.clone(),c},_minBufferSize:0});n.Hasher=h.extend({cfg:r.extend(),init:function(c){this.cfg=this.cfg.extend(c),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(c){return this._append(c),this._process(),this},finalize:function(c){return c&&this._append(c),this._doFinalize()},blockSize:16,_createHelper:function(c){return function(b,m){return new c.init(m).finalize(b)}},_createHmacHelper:function(c){return function(b,m){return new y.HMAC.init(c,m).finalize(b)}}});var y=t.algo={};return t}(Math);(function(o){for(var e=Ee,c=e.lib,t=c.WordArray,n=c.Hasher,c=e.algo,s=[],r=[],i=function(m){return 4294967296*(m-(m|0))|0},l=2,u=0;64>u;){var a;e:{a=l;for(var d=o.sqrt(a),h=2;h<=d;h++)if(!(a%h)){a=!1;break e}a=!0}a&&(8>u&&(s[u]=i(o.pow(l,.5))),r[u]=i(o.pow(l,1/3)),u++),l++}var y=[],c=c.SHA256=n.extend({_doReset:function(){this._hash=new t.init(s.slice(0))},_doProcessBlock:function(b,m){for(var f=this._hash.words,S=f[0],p=f[1],g=f[2],v=f[3],L=f[4],A=f[5],k=f[6],E=f[7],D=0;64>D;D++){if(16>D)y[D]=b[m+D]|0;else{var M=y[D-15],j=y[D-2];y[D]=((M<<25|M>>>7)^(M<<14|M>>>18)^M>>>3)+y[D-7]+((j<<15|j>>>17)^(j<<13|j>>>19)^j>>>10)+y[D-16]}M=E+((L<<26|L>>>6)^(L<<21|L>>>11)^(L<<7|L>>>25))+(L&A^~L&k)+r[D]+y[D],j=((S<<30|S>>>2)^(S<<19|S>>>13)^(S<<10|S>>>22))+(S&p^S&g^p&g),E=k,k=A,A=L,L=v+M|0,v=g,g=p,p=S,S=M+j|0}f[0]=f[0]+S|0,f[1]=f[1]+p|0,f[2]=f[2]+g|0,f[3]=f[3]+v|0,f[4]=f[4]+L|0,f[5]=f[5]+A|0,f[6]=f[6]+k|0,f[7]=f[7]+E|0},_doFinalize:function(){var b=this._data,m=b.words,f=8*this._nDataBytes,S=8*b.sigBytes;return m[S>>>5]|=128<<24-S%32,m[(S+64>>>9<<4)+14]=o.floor(f/4294967296),m[(S+64>>>9<<4)+15]=f,b.sigBytes=4*m.length,this._process(),this._hash},clone:function(){var b=n.clone.call(this);return b._hash=this._hash.clone(),b}});e.SHA256=n._createHelper(c),e.HmacSHA256=n._createHmacHelper(c)})(Math);(function(){var o=Ee,e=o.enc.Utf8;o.algo.HMAC=o.lib.Base.extend({init:function(t,n){t=this._hasher=new t.init,typeof n=="string"&&(n=e.parse(n));var s=t.blockSize,r=4*s;n.sigBytes>r&&(n=t.finalize(n)),n.clamp();for(var i=this._oKey=n.clone(),l=this._iKey=n.clone(),u=i.words,a=l.words,d=0;d<s;d++)u[d]^=1549556828,a[d]^=909522486;i.sigBytes=l.sigBytes=r,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var n=this._hasher;return t=n.finalize(t),n.reset(),n.finalize(this._oKey.clone().concat(t))}})})();(function(){var o=Ee,e=o.lib.WordArray;o.enc.Base64={stringify:function(t){var n=t.words,s=t.sigBytes,r=this._map;t.clamp(),t=[];for(var i=0;i<s;i+=3)for(var l=(n[i>>>2]>>>24-8*(i%4)&255)<<16|(n[i+1>>>2]>>>24-8*((i+1)%4)&255)<<8|n[i+2>>>2]>>>24-8*((i+2)%4)&255,u=0;4>u&&i+.75*u<s;u++)t.push(r.charAt(l>>>6*(3-u)&63));if(n=r.charAt(64))for(;t.length%4;)t.push(n);return t.join("")},parse:function(t){var n=t.length,s=this._map,r=s.charAt(64);r&&(r=t.indexOf(r),r!=-1&&(n=r));for(var r=[],i=0,l=0;l<n;l++)if(l%4){var u=s.indexOf(t.charAt(l-1))<<2*(l%4),a=s.indexOf(t.charAt(l))>>>6-2*(l%4);r[i>>>2]|=(u|a)<<24-8*(i%4),i++}return e.create(r,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(o){for(var e=Ee,c=e.lib,t=c.WordArray,n=c.Hasher,c=e.algo,s=[],r=[],i=function(m){return 4294967296*(m-(m|0))|0},l=2,u=0;64>u;){var a;e:{a=l;for(var d=o.sqrt(a),h=2;h<=d;h++)if(!(a%h)){a=!1;break e}a=!0}a&&(8>u&&(s[u]=i(o.pow(l,.5))),r[u]=i(o.pow(l,1/3)),u++),l++}var y=[],c=c.SHA256=n.extend({_doReset:function(){this._hash=new t.init(s.slice(0))},_doProcessBlock:function(b,m){for(var f=this._hash.words,S=f[0],p=f[1],g=f[2],v=f[3],L=f[4],A=f[5],k=f[6],E=f[7],D=0;64>D;D++){if(16>D)y[D]=b[m+D]|0;else{var M=y[D-15],j=y[D-2];y[D]=((M<<25|M>>>7)^(M<<14|M>>>18)^M>>>3)+y[D-7]+((j<<15|j>>>17)^(j<<13|j>>>19)^j>>>10)+y[D-16]}M=E+((L<<26|L>>>6)^(L<<21|L>>>11)^(L<<7|L>>>25))+(L&A^~L&k)+r[D]+y[D],j=((S<<30|S>>>2)^(S<<19|S>>>13)^(S<<10|S>>>22))+(S&p^S&g^p&g),E=k,k=A,A=L,L=v+M|0,v=g,g=p,p=S,S=M+j|0}f[0]=f[0]+S|0,f[1]=f[1]+p|0,f[2]=f[2]+g|0,f[3]=f[3]+v|0,f[4]=f[4]+L|0,f[5]=f[5]+A|0,f[6]=f[6]+k|0,f[7]=f[7]+E|0},_doFinalize:function(){var b=this._data,m=b.words,f=8*this._nDataBytes,S=8*b.sigBytes;return m[S>>>5]|=128<<24-S%32,m[(S+64>>>9<<4)+14]=o.floor(f/4294967296),m[(S+64>>>9<<4)+15]=f,b.sigBytes=4*m.length,this._process(),this._hash},clone:function(){var b=n.clone.call(this);return b._hash=this._hash.clone(),b}});e.SHA256=n._createHelper(c),e.HmacSHA256=n._createHmacHelper(c)})(Math);nt.enc={Base64:Ee.enc.Base64,Utf8:Ee.enc.Utf8,Latin1:Ee.enc.Latin1};nt.SHA256=Ee.SHA256;nt.HmacSHA256=Ee.HmacSHA256;const xt=nt,la={alg:"HS256",typ:"JWT"};function gn(o){return xt.enc.Base64.stringify(o).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function ca(o,e,t={}){const n=Object.assign(la,t);if(n.alg!=="HS256"&&n.typ!=="JWT")throw new Error("jwt-encode only support the HS256 algorithm and the JWT type of hash");const s=Kt(n),r=Kt(o);let i=`${s}.${r}`;return i=xt.HmacSHA256(i,e),i=gn(i),`${s}.${r}.${i}`}function Kt(o){const e=xt.enc.Utf8.parse(JSON.stringify(o));return gn(e)}var ua=ca;const da=On(ua),fa={class:"modal_browser office"},ha={class:"base"},pa={class:"l"},ma={class:"r"},va={class:"content"},_a=["id"],ut=100,ga=ve({__name:"browserOffice",props:{data:{},modalData:{},nodeList:{},curIndex:{},curNode:{}},setup(o){const e=o;""+e.modalData.nid,F(null);let t=null;const s=Ae().get();ye(()=>{console.warn("mounted");const a=new URL(location.href);l(`${a.origin}/onlyoffice_server/web-apps/apps/api/documents/api.js`),setTimeout(()=>r(),ut)});function r(){if(!i)return setTimeout(()=>r(),ut);const a="modal_office_"+e.modalData.nid;if(!document.getElementById(a))return setTimeout(()=>r(),ut);const h=ce.onlyOffice.jwtSecret,y=e.curNode,c=y.title.lastIndexOf("."),b=y.title.substring(c+1),m=u(b);if(!m)return;const f=new URL(location.href),S={document:{fileType:b,key:y.id.toString(16)+"_"+parseInt(new Date(y.time_update).valueOf()),title:y.title,url:`${f.origin}${y.file_index.raw.path}?tosho_token=${s==null?void 0:s.token}`},documentType:m,editorConfig:{callbackUrl:`${f.origin}/api/onlyoffice/callback?id=${y.id}&tosho_token=${s==null?void 0:s.token}`}};S.token=da(S,h),console.info(S),t=new DocsAPI.DocEditor(a,S),console.info(t)}Pe(()=>e.curNode,async a=>{console.info("onMod props.curNode")}),Le(()=>{});let i=!1;function l(a){var d=document.createElement("script");d.type="text/javascript",d.src=a,d.onload=h=>{console.info(h),i=!0},document.body.appendChild(d)}function u(a){let d;switch(a){default:break;case"doc":case"docm":case"docx":case"dot":case"dotm":case"dotx":case"epub":case"fb2":case"fodt":case"htm":case"html":case"mht":case"mhtml":case"odt":case"ott":case"rtf":case"stw":case"sxw":case"txt":case"wps":case"wpt":d="word";break;case"csv":case"et":case"ett":case"fods":case"ods":case"ots":case"sxc":case"xls":case"xlsb":case"xlsm":case"xlsx":case"xlt":case"xltm":case"xltx":d="cell";break;case"dps":case"dpt":case"fodp":case"odp":case"otp":case"pot":case"potm":case"potx":case"pps":case"ppsm":case"ppsx":case"ppt":case"pptm":case"pptx":case"sxi":d="slide";break}return d}return(a,d)=>(I(),R("div",fa,[$("div",ha,[$("div",pa,[me(a.$slots,"info")]),$("div",ma,[me(a.$slots,"btnContainer")])]),me(a.$slots,"navigator"),$("div",va,[$("div",{id:"modal_office_"+a.modalData.nid},null,8,_a)])]))}}),ya={key:0},wa={class:"preLine"},ba={class:"btnContainer"},ka=["value"],xa=["value","innerHTML"],Ea=["value"],Sa=["value"],La=ve({__name:"browser",props:{data:{},modalData:{}},setup(o){const e=o,t=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1,n={audio:Ts,video:qs,image:Ls,pdf:ia,text:ea,office:qt,base:qt};ce.onlyOffice.enabled&&(n.office=ga);const s=Ve();let r=!1;function i(){if(r&&!e.modalData.layout.fullscreen){let H=s.get("browser_layout_w"),P=s.get("browser_layout_h");e.modalData.layout.w=H,e.modalData.layout.h=P,e.modalData.layout.x=(window.innerWidth-H)/2,e.modalData.layout.y=(window.innerHeight-P)/2}else e.modalData.layout.fullscreen||(s.set("browser_layout_w",e.modalData.layout.w),s.set("browser_layout_h",e.modalData.layout.h));r=e.modalData.layout.fullscreen}const l=F(s.get("browser_play_mode")??"loop");function u(){let H=ce.playMode.indexOf(l.value);H+=1,H>ce.playMode.length-1&&(H=0),l.value=ce.playMode[H],s.set("browser_play_mode",l.value)}const a=F(s.get("browser_show_detail")??!1);function d(){a.value=!a.value,s.set("browser_show_detail",a.value)}ye(()=>{document.addEventListener("keydown",D),document.addEventListener(`modal_resizing_${e.modalData.nid}`,i),setTimeout(()=>{document.activeElement&&document.activeElement.blur()},100)}),Le(()=>{document.removeEventListener("keydown",D),document.removeEventListener(`modal_resizing_${e.modalData.nid}`,i)});const h=F([]),y=F([]),c=F([]);let b=0;const m=F(0),f=F({});async function S(H){const P=await se("file/get",{node_type:"directory",id_dir:`${H}`,with:"none"});return P||{path:[],list:[]}}g();function p(){let H=[];return b=0,y.value.forEach(P=>{if(!A(P))return;const U=P.rate?P.rate+2:2;H.push(Object.assign(P,{_weight_stack:b})),b+=U}),H=X(H,j.value),H}async function g(H={}){H&&(e.data.query=Object.assign(e.data.query,H));let P;if(P=await se("file/get",e.data.query),!P||!P.list.length)return!1;let U=[];if(P.list.forEach(Z=>{Z.is_file&&U.push(Z)}),P.list=U,!P.list.length){if(parseInt(e.data.query.cascade_dir))return!1;const Z=fe.copyObject(e.data.query);if(Z.cascade_dir=1,P=await se("file/get",Z),!P||!P.list.length)return!1;U=[],P.list.forEach(N=>{N.is_file&&U.push(N)}),P.list=U}if(!P.list.length)return!1;let Y=0,B=null;for(let Z=0;Z<P.list.length;Z++)if(P.list[Z].id===e.data.curId){Y=Z,B=P.list[Z];break}console.info(Y,B),h.value=P.path,y.value=P.list;let q=p();return q.length?(c.value=X(q,j.value),B||(B=c.value[0]),m.value=M(c.value,B),console.info(m.value),k(),!0):!1}function v(H,P,U=0){let Y=c.value.length;if(Y<1)return;let B=0;if(l.value==="shuffle"){let q=Math.random()*b;P=0;for(let Z=0;Z<Y&&(P=Z,!(c.value[Z]._weight_stack>q));Z++);B=P}else B=H+P;for(;B<0;)B+=Y;for(;B>Y-1;)B-=Y;U||(U=0),U+=1,!(U>Y)&&(m.value=B,k())}function L(H){let P=H-m.value;v(m.value,P)}function A(H){const P=parseInt(ue.value)??0;if((H.rate??0)<P)return!1;switch(Q.value){case"any":case"file":return ce.ignoreFileType.indexOf(H.type??"directory")===-1;default:return Q.value==H.type}}function k(){c.value.length&&(f.value.type,c.value[m.value].type,f.value=c.value[m.value]),E()}function E(){e.modalData.base.title=m.value+1+"/"+c.value.length+" "+(f.value.title??"")}async function D(H){if(Me(H.target)||!e.modalData.layout.active)return;let P,U,Y,B,q,Z;switch(H.key){case"ArrowLeft":if(H.preventDefault(),H.stopPropagation(),["audio","video"].indexOf(f.value.type??"")!==-1)return;v(m.value,-1);break;case"ArrowRight":if(H.preventDefault(),H.stopPropagation(),["audio","video"].indexOf(f.value.type??"")!==-1)return;v(m.value,1);break;case"a":case"PageUp":H.preventDefault(),H.stopPropagation(),v(m.value,-1);break;case"d":case"PageDown":H.preventDefault(),H.stopPropagation(),v(m.value,1);break;case"w":case"[":switch(e.data.query.mode){default:const z=h.value.length?h.value[h.value.length-1]:{id:0,id_parent:0,type:"directory",title:"root",description:"",status:1,building:0};if(P=await S(z.id_parent),U=X(P.list,j.value),Y=U.length,Y<2)return;B=0,U.forEach((C,W)=>{C.id==e.data.query.id_dir&&(B=W)}),Z=U.length;do{for(B-=1;B<0;)B+=Y;for(;B>Y-1;)B-=Y;if(q=U[B],e.data.query.id_dir=`${q.id}`,await g())break}while(--Z>0);break;case"id_iterate":const x=e.data.query.keyword.split(","),_=[];x.forEach(C=>_.push(parseInt(C)));let w=null;for(let C=0;C<f.value.crumb_node.length;C++){const W=f.value.crumb_node[C];if(_.indexOf(W.id)!==-1){w=W.id;break}}if(!w)break;const O=_.indexOf(w);Y=_.length;let T=O-1;for(;T<0;)T+=Y;for(;T>Y-1;)T-=Y;const V=_[T];for(let C=0;C<c.value.length;C++){const W=c.value[C];for(let ee=0;ee<W.crumb_node.length;ee++)if(W.crumb_node[ee].id===V)return v(C,0)}}break;case"s":case"]":switch(e.data.query.mode){default:const z=h.value.length?h.value[h.value.length-1]:{id:0,id_parent:0,type:"directory",title:"root",description:"",status:1,building:0};if(P=await S(z.id_parent),U=X(P.list,j.value),Y=U.length,Y<2)return;B=0,U.forEach((C,W)=>{C.id==e.data.query.id_dir&&(B=W)}),Z=U.length;do{for(B+=1;B<0;)B+=Y;for(;B>Y-1;)B-=Y;if(q=U[B],e.data.query.id_dir=`${q.id}`,await g())break}while(--Z>0);break;case"id_iterate":const x=e.data.query.keyword.split(","),_=[];x.forEach(C=>_.push(parseInt(C)));let w=null;for(let C=0;C<f.value.crumb_node.length;C++){const W=f.value.crumb_node[C];if(_.indexOf(W.id)!==-1){w=W.id;break}}if(!w)break;const O=_.indexOf(w);Y=_.length;let T=O+1;for(;T<0;)T+=Y;for(;T>Y-1;)T-=Y;const V=_[T];for(let C=0;C<c.value.length;C++){const W=c.value[C];for(let ee=0;ee<W.crumb_node.length;ee++)if(W.crumb_node[ee].id===V)return v(C,0)}break}break;case"NumpadEnter":case"Enter":break;case"Delete":H.preventDefault(),H.stopPropagation();const N=new Set;f.value&&f.value.id&&N.add(f.value.id),await te.op_bath_delete(N,[],!1,()=>{v(m.value,1)});break}}function M(H,P){let U=0;return H.forEach((Y,B)=>{Y.id===P.id&&(U=B)}),U}const j=F(s.get("browser_list_sort")??"name_asc");function ne(H){var U;console.info("setSort",j.value,H),(U=H.target)==null||U.blur();const P=c.value;c.value=[],X(P,j.value),c.value=P,m.value=M(P,f.value),E()}function X(H,P){return H=_n(H,P),m.value=M(H,f.value),s.set("browser_list_sort",j.value),H}const Q=F(s.get("browser_list_filter")??"any");function G(H){s.set("browser_list_filter",H);let P=c.value[m.value],U=p();c.value=X(U,j.value),m.value=M(c.value,P),console.info(m.value),k()}const ue=F("0");function he(H){let P=c.value[m.value],U=p();c.value=X(U,j.value),m.value=M(c.value,P),console.info(m.value),k()}return(H,P)=>(I(),Qt(Jt(f.value.type&&n[f.value.type]?n[f.value.type]:n.base),{data:e.data,modalData:e.modalData,nodeList:y.value,curNode:f.value,curIndex:m.value,onNav:L},{info:st(()=>{var U,Y;return[$("div",{class:de({info:!0,detail:a.value})},[a.value?(I(),R(J,{key:0},[$("p",null,re(f.value.title)+" ("+re(ie(fe).kmgt(((Y=(U=f.value.file_index)==null?void 0:U.raw)==null?void 0:Y.size)??0,2))+") ",1),f.value.crumb_node?(I(),R("p",ya,[P[11]||(P[11]=Ot("Dir : ")),(I(!0),R(J,null,pe(f.value.crumb_node,B=>(I(),R(J,null,[Ot("/"+re(B.title),1)],64))),256))])):le("",!0),$("p",wa,re(f.value.description),1)],64)):le("",!0)],2)]}),btnContainer:st(()=>{var U,Y;return[$("div",ba,[a.value?(I(),R(J,{key:0},[t?ge((I(),R("select",{key:0,"onUpdate:modelValue":P[0]||(P[0]=B=>ue.value=B),onChange:P[1]||(P[1]=B=>he(ue.value))},[(I(!0),R(J,null,pe(ie(ce).rateMobile,(B,q)=>(I(),R("option",{value:q,key:"BROWSER_RATE_"+H.modalData.nid+"_"+q},re(B),9,ka))),128))],544)),[[ze,ue.value]]):ge((I(),R("select",{key:1,class:"sysIcon","onUpdate:modelValue":P[2]||(P[2]=B=>ue.value=B),onChange:P[3]||(P[3]=B=>he(ue.value))},[(I(!0),R(J,null,pe(ie(ce).rate,(B,q)=>(I(),R("option",{class:"sysIcon_A sysIcon",value:q,innerHTML:B,key:"BROWSER_RATE_"+H.modalData.nid+"_"+q},null,8,xa))),128))],544)),[[ze,ue.value]]),ge($("select",{"onUpdate:modelValue":P[4]||(P[4]=B=>Q.value=B),onChange:P[5]||(P[5]=B=>G(Q.value))},[(I(!0),R(J,null,pe(ie(ce).fileType,(B,q)=>(I(),R("option",{value:B,key:"BROWSER_TYPE_"+H.modalData.nid+"_"+q},re(B),9,Ea))),128))],544),[[ze,Q.value]]),P[12]||(P[12]=$("br",null,null,-1))],64)):le("",!0),ge($("select",{"onUpdate:modelValue":P[6]||(P[6]=B=>j.value=B),onChange:P[7]||(P[7]=B=>ne(B))},[(I(!0),R(J,null,pe(ie(ce).sort,(B,q)=>(I(),R("option",{value:q,key:"BROWSER_SORT_"+H.modalData.nid+"_"+q},re(B),9,Sa))),128))],544),[[ze,j.value]]),$("button",{class:de(["sysIcon",`sysIcon_player_${l.value}`]),onClick:u},null,2),$("button",{class:de(["sysIcon","sysIcon_info-cirlce-o"]),onClick:d}),(Y=(U=f.value.file_index)==null?void 0:U.raw)!=null&&Y.path?(I(),R("button",{key:1,class:de(["sysIcon","sysIcon_download"]),onClick:P[8]||(P[8]=B=>ie(te).op_download(f.value))})):le("",!0)])]}),navigator:st(()=>[$("div",{class:de({pagination:1,isMobile:t})},[$("div",{class:"left",onClick:P[9]||(P[9]=U=>v(m.value,-1))},P[13]||(P[13]=[$("span",{class:"sysIcon sysIcon_arrowleft"},null,-1)])),$("div",{class:"right",onClick:P[10]||(P[10]=U=>v(m.value,1))},P[14]||(P[14]=[$("span",{class:"sysIcon sysIcon_arrowright"},null,-1)]))],2)]),_:1},40,["data","modalData","nodeList","curNode","curIndex"]))}}),Da={class:"modal_locator"},Oa={class:"locator_list"},$a=["onClick"],Ca={class:"type"},Ma={class:"tree"},Ia={class:"title"},Ra=ve({__name:"locator",props:{data:{},modalData:{}},setup(o){const e=F(null);let t={mode:"directory",id_dir:"",keyword:"",id_tag:"",cascade_dir:"1",node_type:"directory",with:"crumb",limit:"20"};const n=o,s=F([]);ye(()=>{var a;(a=e.value)==null||a.focus()}),Le(()=>{});async function r(){const a=await se("file/get",t);!a||!a.list||(t.keyword&&"root".indexOf(t.keyword)!==-1&&a.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),s.value=a.list,s.value.length&&(s.value[0]._sel=!0,n.modalData.layout.h<220&&(n.modalData.layout.h=220)))}async function i(a){console.info(a),!await u(a)&&fe.debounce(()=>{var y;let h=(y=e.value)==null?void 0:y.value;if(!h||!h.length){s.value=[];return}console.info(h),console.info(n.modalData),t.keyword=h,r()},200,"locator")}async function l(a){console.info(a);const d=Te();if(!await n.data.call(a))return d.close(n.modalData.nid)}async function u(a){let d,h,y=!1;switch(a.code){case"ArrowDown":if(y=!0,a.stopPropagation(),a.preventDefault(),!s.value.length)break;for(d=-1,s.value.forEach((b,m)=>{b._sel&&(d=m)}),h=d+1;h<0;)h+=s.value.length;for(;h>=s.value.length;)h-=s.value.length;s.value.forEach((b,m)=>{b._sel=m==h});break;case"ArrowUp":if(y=!0,a.stopPropagation(),a.preventDefault(),!s.value.length)break;for(d=0,s.value.forEach((b,m)=>{b._sel&&(d=m)}),h=d-1;h<0;)h+=s.value.length;for(;h>=s.value.length;)h-=s.value.length;s.value.forEach((b,m)=>{b._sel=m==h});break;case"NumpadEnter":case"Enter":if(y=!0,a.stopPropagation(),a.preventDefault(),!s.value.length||(d=-1,s.value.forEach((b,m)=>{b._sel&&(d=m)}),d==-1))break;const c=s.value[d];l(c);break}return y}return(a,d)=>(I(),R("div",Da,[$("input",{type:"text",class:"locator_input",placeholder:"type title/desc here ...",ref_key:"locatorInput",ref:e,onKeydown:i},null,544),$("div",Oa,[(I(!0),R(J,null,pe(s.value,h=>(I(),R("div",{onClick:y=>l(h),class:de({active:h._sel})},[$("p",Ca,re(h.type),1),$("p",Ma,[$("span",Ia,re(h.title),1),h.crumb_node?(I(!0),R(J,{key:0},pe(h.crumb_node,y=>(I(),R("span",null,re(y.title),1))),256)):le("",!0)])],10,$a))),256))])]))}}),Pa={class:"upload_list"},Aa={class:"title"},Ta={class:"meta"},Na={key:0},Ha={key:1},za=["onClick"],ja={class:"upload_menu"},Ba={key:1},Wa=ve({__name:"uploader",props:{data:{},modalData:{}},setup(o){const e=o,t=F([]),n=new Map;ye(()=>{}),Le(()=>{});function s(m){console.info("onSelectFile",m);const f=document.createElement("input");f.type="file",f.setAttribute("multiple",!0),f.onchange=S=>{var p;if((p=f.files)!=null&&p.length)for(let g=0;g<f.files.length;g++){const v=f.files[g];t.value.push({name:"/"+v.name,size:v.size,file:v,isDir:!1,status:"waiting",start:0,loaded:0})}},f.click()}function r(m){var f,S,p;if(console.debug("onDrop",m.type,(f=m.dataTransfer)==null?void 0:f.files,m),m.preventDefault(),m.stopPropagation(),!(!m.dataTransfer||!m.dataTransfer.files.length)){for(let g=0;g<((S=m.dataTransfer)==null?void 0:S.files.length);g++){const v=(p=m.dataTransfer)==null?void 0:p.items[g],L=v.webkitGetAsEntry();if(L.isFile){const A=v.getAsFile();t.value.push({name:L.fullPath,size:A.size,file:A,isDir:!1,status:"waiting",start:0,loaded:0})}else i(L).then(A=>{A.forEach(k=>t.value.push(k))})}console.info(t.value)}}async function i(m){const f=[];f.push({name:m.fullPath,size:0,file:null,isDir:!0,status:"waiting",start:0,loaded:0});const S=m.createReader(),p=await u(S);for(let g=0;g<p.length;g++){const v=p[g];if(v.isFile){const L=await l(v);f.push({name:v.fullPath,size:L.size,file:L,isDir:!1,status:"waiting",start:0,loaded:0})}v.isDirectory&&(await i(v)).forEach(A=>f.push(A))}return f}function l(m){return new Promise(f=>{m.file(S=>f(S))})}function u(m){return new Promise(f=>{m.readEntries(S=>{f(S)})})}function a(m){m.stopPropagation(),m.preventDefault()}let d=F(!1);async function h(){if(t.value.length){d.value=!0;for(let m=0;m<t.value.length;m++)t.value[m].status==="waiting"&&await y(t.value[m]);d.value=!1,e.data.emitGo("reload")}}async function y(m){let f=null,[S,p,g]=c(m.name);if(m.isDir){const v=new FormData;v.set("pid",S),v.set("title",g),m.status="uploading",f=await se("file/mkdir",v),n.set(p+g+"/",f.id)}else{const v=new FormData;v.set("pid",S),v.set("file",m.file),m.status="uploading",f=await se("file/upd",v,{upload:L=>{m.loaded=L.loaded}})}return m.status="complete",f}function c(m){const f=m.replace(/[\\/]+$/i).split(/[\\/]/i),S=f.pop();if(!f.length)return[e.data.pid,"/",S];let p="";for(let v=0;v<f.length;v++)p+=f[v]+"/";return p=="/"?[e.data.pid,p,S]:[n.get(p),p,S]}function b(m){t.value.splice(m,1)}return(m,f)=>(I(),R("div",{class:"modal_uploader",onDrop:r,onDragover:a},[$("div",Pa,[(I(!0),R(J,null,pe(t.value,(S,p)=>(I(),R("div",{key:`file_upload_${p}`},[$("div",Aa,re(S.name),1),$("div",Ta,[S.status==="uploading"?(I(),R("span",Na,re(Math.round(100*S.loaded/S.size))+" % ",1)):(I(),R("span",Ha,re(S.status),1)),$("span",null,re(ie(fe).kmgt(S.size)),1),S.status==="waiting"?(I(),R("span",{key:2,onClick:g=>b(p),class:"pointer"},"X",8,za)):le("",!0)])]))),128)),$("div",{onClick:s},"drag / drop files here...")]),$("div",ja,[ie(d)?(I(),R("button",Ba,"uploading")):(I(),R("button",{key:0,onClick:h},"upload"))])],32))}}),Va={class:"modal_rename_util"},Ua={class:"mode_selector"},Fa=["id","name"],Xa=["for"],Ya=["id","name"],qa=["for"],Ka=ve({__name:"renameUtil",props:{data:{},modalData:{}},setup(o){F(null);const e=o;let t=F("pattern"),n=F("{index}_{filename}"),s=F("");ye(()=>{const l=[];e.data.node_list.forEach(u=>{l.push((u==null?void 0:u.title)??"")}),s.value=l.join(`\r
`),console.info(s)}),Le(()=>{});function r(l){let u=l.length.toString().length+1,a=0,d="",h=n.value.match(/\{index:(\d+)}/);h&&(a=parseInt(h[1]),d=h[0]);const y=new Map;l.forEach((b,m)=>{const f=b.crumb_node?b.crumb_node[b.crumb_node.length-1]:null,S=f?f.title:"";let p=new Map;p.set("{filename}",b.title??""),p.set("{index}",fe.prefix(m+1,u,"0")),p.set("{directory}",S??""),p.set(`{index:${d}}`,fe.prefix(m+1,a,"0"));let g=n.value;p.forEach((v,L)=>{g=g.replace(L,v)}),y.set(b.id??0,g)});const c=[];return y.forEach((b,m)=>{c.push({id:m,title:b})}),c}async function i(){const l=Te();let u=[];switch(t.value){default:case"pattern":u=r(e.data.node_list);break;case"bath":const h=s.value.split(/[\r\n]+/);u=[],e.data.node_list.forEach((y,c)=>{h[c]&&h[c].trim().length&&u.push({id:y.id??0,title:h[c].trim()})});break}const a={list:JSON.stringify(u)},d=await se("file/bath_rename",a);return console.info(d),e.data.callback(u),l.close(e.modalData.nid)}return(l,u)=>(I(),R("div",Va,[$("div",Ua,[ge($("input",{id:`P_${e.modalData.nid}_MODE_PATTERN`,name:`P_${e.modalData.nid}_MODE`,value:"pattern",type:"radio","onUpdate:modelValue":u[0]||(u[0]=a=>Qe(t)?t.value=a:t=a)},null,8,Fa),[[dt,ie(t)]]),$("label",{for:`P_${e.modalData.nid}_MODE_PATTERN`},"pattern",8,Xa),ge($("input",{id:`P_${e.modalData.nid}_MODE_BATH`,name:`P_${e.modalData.nid}_MODE`,value:"bath",type:"radio","onUpdate:modelValue":u[1]||(u[1]=a=>Qe(t)?t.value=a:t=a)},null,8,Ya),[[dt,ie(t)]]),$("label",{for:`P_${e.modalData.nid}_MODE_BATH`},"bath",8,qa)]),ie(t)=="pattern"?(I(),R(J,{key:0},[u[5]||(u[5]=Zt("<p>rename pattern:</p><table><tbody><tr><td>code</td><td>description</td></tr><tr><td>{filename}</td><td>file name</td></tr><tr><td>{index}</td><td>index by sort, prefix by max len+1</td></tr><tr><td>{index:n}</td><td>index by sort, prefix len by [n]</td></tr><tr><td>{directory}</td><td>parent directory name</td></tr></tbody></table>",2)),$("label",null,[u[4]||(u[4]=$("span",null,"pattern",-1)),ge($("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=a=>Qe(n)?n.value=a:n=a)},null,512),[[je,ie(n)]])])],64)):le("",!0),ie(t)=="bath"?(I(),R(J,{key:1},[u[6]||(u[6]=$("p",null,"rename bath:",-1)),ge($("textarea",{"onUpdate:modelValue":u[3]||(u[3]=a=>Qe(s)?s.value=a:s=a)},null,512),[[je,ie(s)]])],64)):le("",!0),$("label",{class:"confirm"},[$("button",{onClick:i},"submit")])]))}}),Ga={class:"fr_popup"},Qa=["data-ref-id","onClick"],Ja=["onPointerdown","onDblclick"],Za={class:"modal_title"},er={class:"modal_menu"},tr=["onClick"],nr=["onClick"],or=["onClick"],sr={class:"modal_content"},ar=["innerHTML"],rr={key:1,class:"modal_content_form"},ir={key:0},lr=["onUpdate:modelValue","onChange","disabled"],cr=["onClick","disabled"],ur={key:0},dr=["onUpdate:modelValue","onChange","disabled"],fr=["onUpdate:modelValue","onChange","disabled"],hr=["onUpdate:modelValue","onChange","disabled"],pr=["id","name","value","onUpdate:modelValue","onChange","disabled"],mr=["for"],vr=["id","name","value","onUpdate:modelValue","onChange","disabled"],_r=["for"],gr=["onUpdate:modelValue","multiple","onChange","disabled"],yr=["value"],wr={key:2,class:"modal_content_callback"},br=["onClick"],kr=["onPointerdown"],$e=20,xr=ve({__name:"Popup",setup(o){const e={fileBrowser:La,uploader:Wa,locator:Ra,renameUtil:Ka},t=new Date().valueOf(),n=F(new Map);function s(p){const g=Math.floor((new Date().valueOf()-t)/100),v=window.innerWidth,L=window.innerHeight,A={nid:"",base:{title:p.title??"",alpha:p.alpha??!1,key:p.key??"",single:p.single??!1},layout:{w:0,h:0,x:0,y:0,minW:0,minH:0,allow_resize:!1,allow_move:!1,allow_escape:!1,allow_fullscreen:!1,auto_focus:!1,active:!1,index:0,fullscreen:!1},content:{text:F(""),form:[],component:[]},callback:[],closed:!1,event:{}};A.nid=(g+Math.random()).toString(32),A.event.resize=new Event(`modal_resizing_${A.nid}`),console.info(g,A.nid);const k={};if(k.w=p.w??400,k.h=p.h??160,k.x=(v-k.w)/2,k.y=(L-k.h)/2,k.minW=p.minW??400,k.minH=p.minH??160,k.allow_resize=p.allow_resize??!0,k.allow_move=p.allow_move??!0,k.allow_escape=p.allow_escape??!0,k.allow_fullscreen=p.allow_fullscreen??!1,k.auto_focus=p.auto_focus??!0,k.active=!1,k.index=g,k.fullscreen=p.fullscreen??!1,Object.assign(A.layout,k),p.text&&(typeof p.text=="string"?A.content.text.value=p.text:A.content.text=p.text),p.form&&(Array.isArray(p.form)?A.content.form.push(...p.form):A.content.form.push(p.form),A.content.form.forEach(E=>{if(E.value=E.value??null,E.options=E.options??null,E.default=E.default??null,E.multiple=!!E.multiple,E.disabled=!!E.disabled,E.options&&Array.isArray(E.options)){let D={};E.options.forEach(M=>{D[M]=M}),E.options=D}E.on_change||(E.on_change=()=>{})})),p.component&&(Array.isArray(p.component)?p.component.forEach(E=>{let D;typeof E=="string"?D={key:"",componentName:E,data:{}}:D=Object.assign({key:"",componentName:null,data:{}},E),A.content.component.push(D)}):typeof p.component=="string"?A.content.component.push({key:"",componentName:p.component,data:{}}):A.content.component.push(Object.assign({key:"",componentName:null,data:{}},p.component))),p.callback){if(Array.isArray(p.callback))p.callback.forEach((E,D)=>{let M;typeof E=="function"?M={key:"",name:"",func:E}:M=Object.assign({key:"",name:"",func:null},E),A.callback.push(M)});else if(typeof p.callback=="function")A.callback.push({key:"",name:"",func:p.callback});else if(p.callback.func)A.callback.push(Object.assign({key:"",name:"",func:null},p.callback));else for(const E in p.callback){if(!Object.prototype.hasOwnProperty.call(p.callback,E))continue;const D=p.callback[E];A.callback.push(Object.assign({key:E,name:E,func:D}))}A.callback.forEach((E,D)=>{if(E.name&&!E.key)E.key=E.name;else if(!E.name&&E.key)E.name=E.key;else if(!E.name&&!E.key){let M="button";A.callback.length>1&&(M+=" "+D),E.name=M,E.key=M}})}return console.debug(A),A}window.addEventListener("resize",p=>{n.value.forEach(g=>{if(g.layout.fullscreen){const v={x:$e,y:$e,w:window.innerWidth-$e*2,h:window.innerHeight-$e*2};Object.assign(g.layout,v),document.dispatchEvent(g.event.resize)}})});const r=Te();r.handleEvent("set",p=>{let g=null,v=null;return p.single&&n.value.forEach((L,A,k)=>{L.base.key==p.key&&(g=A,v=L)}),g?setTimeout(()=>{i(g)}):(v=s(p),n.value.set(v.nid,v),setTimeout(()=>{i(v.nid)})),v}),r.handleEvent("close",p=>a(p)),document.body.addEventListener("click",p=>{let g=p.target;Fe(g)||i(0)});function i(p){const g=Math.floor((new Date().valueOf()-t)/100);n.value.forEach(v=>{if(v.nid===p){v.layout.index=g;let L=!v.layout.active;v.layout.active=!0,v.layout.auto_focus&&L&&setTimeout(()=>{const A=document.querySelector(`.modal_dom[data-ref-id="${v.nid}"] input,.modal_dom[data-ref-id="${v.nid}"] button,.modal_dom[data-ref-id="${v.nid}"] textarea`);A&&A.focus()},100)}else v.layout.active=!1})}function l(p){const g=n.value.get(p);if(!g)return;const v={x:$e,y:$e,w:window.innerWidth-$e*2,h:window.innerHeight-$e*2,fullscreen:!0};Object.assign(g.layout,v),document.dispatchEvent(g.event.resize)}function u(p){const g=n.value.get(p);if(!g)return;const v={x:0,y:0,w:g.layout.minW,h:g.layout.minH,fullscreen:!1};v.x=(window.innerWidth-v.w)/2,v.y=(window.innerHeight-v.h)/2,Object.assign(g.layout,v),document.dispatchEvent(g.event.resize)}function a(p){const g=n.value.get(p);if(!g||!g.layout.allow_escape)return;n.value.delete(p);let v=-1,L=-1;return n.value.forEach(A=>{v>A.layout.index||(v=A.layout.index,L=A.nid)}),L!=-1&&i(L),g}let d={x:0,y:0,d:"",modalX:0,modalY:0,modalW:0,modalH:0,modal:null},h=0;function y(p,g){g.preventDefault(),g.stopPropagation(),g.pointerId&&(h=g.pointerId,g.target.hasPointerCapture(g.pointerId)),d.x=g.clientX,d.y=g.clientY,d.d=g.target.className,n.value.forEach(v=>{v.nid===p&&(d.modal=v)}),d.modal&&(d.modal.layout.fullscreen||(d.modalX=d.modal.layout.x,d.modalY=d.modal.layout.y,d.modalW=d.modal.layout.w,d.modalH=d.modal.layout.h,document.addEventListener("pointerup",b),document.addEventListener("pointermove",c)))}function c(p){if(p.preventDefault(),!d.modal||!p.pointerId||h!=p.pointerId)return;const g={x:p.clientX-d.x,y:p.clientY-d.y},v={x:d.modal.layout.x,y:d.modal.layout.y,w:d.modal.layout.w,h:d.modal.layout.h};switch(d.d){case"c_l":v.x=d.modalX+g.x,v.w=d.modalW-g.x;break;case"c_r":v.x=d.modalX,v.w=d.modalW+g.x;break;case"c_t":v.y=d.modalY+g.y,v.h=d.modalH-g.y;break;case"c_b":v.y=d.modalY,v.h=d.modalH+g.y;break;case"c_lt":v.x=d.modalX+g.x,v.w=d.modalW-g.x,v.y=d.modalY+g.y,v.h=d.modalH-g.y;break;case"c_lb":v.x=d.modalX+g.x,v.w=d.modalW-g.x,v.y=d.modalY,v.h=d.modalH+g.y;break;case"c_rt":v.x=d.modalX,v.w=d.modalW+g.x,v.y=d.modalY+g.y,v.h=d.modalH-g.y;break;case"c_rb":v.x=d.modalX,v.w=d.modalW+g.x,v.y=d.modalY,v.h=d.modalH+g.y;break;case"modal_header":case"modal_title":v.x=d.modalX+g.x,v.y=d.modalY+g.y;break}const L={l:0,r:window.innerWidth,t:0,b:window.innerHeight};v.w<100&&(v.w=100),v.h<80&&(v.h=80),v.y<0&&(v.y=0),v.y>L.b-v.h/2&&(v.y=L.b-v.h/2),v.x<0-v.w/2&&(v.x=0-v.w/2),v.x>L.r-v.w/2&&(v.x=L.r-v.w/2),d.modal.layout.minW&&v.w<d.modal.layout.minW&&(v.w=d.modal.layout.minW),d.modal.layout.minH&&v.h<d.modal.layout.minH&&(v.h=d.modal.layout.minH),Object.assign(d.modal.layout,v),document.dispatchEvent(d.modal.event.resize)}function b(p){p.preventDefault(),p.stopPropagation(),!(!p.pointerId||h!=p.pointerId)&&(document.removeEventListener("pointerup",b),document.removeEventListener("pointermove",c),h=0,d.modal=null)}function m(p,g){const v=n.value.get(p);v&&v.callback.forEach(async L=>{L.key!==g||await L.func(v)||a(p)})}ye(()=>{console.info("Popup mounted"),document.addEventListener("keydown",f)}),Le(()=>{console.info("unmounted"),document.removeEventListener("keydown",f)});function f(p){switch(p.key){case"Escape":n.value.forEach((v,L)=>{if(v.layout.active){if(!v.layout.allow_escape)return;setTimeout(()=>a(v.nid))}});break;case"NumpadEnter":case"Enter":if(p.target.tagName==="BODY"||p.target.tagName==="BUTTON"||p.isComposing)return;let g=p.target;for(;g.parentElement;){if(g=g.parentElement,!g.classList.contains("modal_dom"))continue;const L=g.getAttribute("data-ref-id");if(!L)break;const A=n.value.get(L);if(!A)break;for(let k=0;k<A.callback.length;k++){const E=A.callback[k].key;return m(L,E)}}break}}function S(p){console.info("processModalFile",p);const g=document.createElement("input");g.type="file",g.onchange=v=>{const L=v.target.files;!L||L.length===0||(p.value=L[0],console.info("processModalFile mod",p,p.value))},g.click()}return(p,g)=>(I(),R("div",Ga,[(I(!0),R(J,null,pe(n.value,([v,L])=>{var A;return I(),R("div",{key:`_modal_${v}`,class:de({modal_dom:!0,active:L.layout.active,resizing:((A=ie(d).modal)==null?void 0:A.nid)==L.nid,modal_alpha:L.base.alpha}),"data-ref-id":L.nid,style:be({zIndex:L.layout.index,width:L.layout.w+"px",height:L.layout.h+"px",left:L.layout.x+"px",top:L.layout.y+"px"}),onClick:$n(k=>i(L.nid),["stop"])},[$("div",{class:"modal_header",onPointerdown:k=>y(L.nid,k),onDblclick:k=>L.layout.fullscreen?u(L.nid):l(L.nid)},[$("div",Za,re(L.base.title),1),$("div",er,[L.layout.allow_move&&L.layout.allow_fullscreen?(I(),R(J,{key:0},[L.layout.fullscreen?(I(),R("span",{key:1,class:"buttonStyle sysIcon sysIcon_windowize",onClick:k=>u(L.nid)},null,8,nr)):(I(),R("span",{key:0,class:"buttonStyle sysIcon sysIcon_maximize",onClick:k=>l(L.nid)},null,8,tr))],64)):le("",!0),$("span",{class:"buttonStyle sysIcon sysIcon_close",onClick:k=>a(L.nid)},null,8,or)])],40,Ja),$("div",sr,[L.content.text&&L.content.text.length?(I(),R("div",{key:0,class:"modal_content_text",innerHTML:L.content.text},null,8,ar)):le("",!0),L.content.form&&L.content.form.length?(I(),R("div",rr,[(I(!0),R(J,null,pe(L.content.form,(k,E)=>(I(),R("label",{key:`_modal_${v}_form_${E}`},[k.label?(I(),R("span",ir,re(k.label),1)):le("",!0),g[0]||(g[0]=$("span",null,null,-1)),$("span",null,[k.type==="text"?ge((I(),R("input",{key:0,type:"text","onUpdate:modelValue":D=>k.value=D,onChange:D=>k.on_change(D,L,k),disabled:k.disabled},null,40,lr)),[[je,k.value]]):le("",!0),k.type==="file"?(I(),R(J,{key:1},[$("button",{onClick:D=>S(k),disabled:k.disabled},"select file",8,cr),k.value?(I(),R("span",ur,re(k.value.name),1)):le("",!0)],64)):le("",!0),k.type==="textarea"?ge((I(),R("textarea",{key:2,"onUpdate:modelValue":D=>k.value=D,onChange:D=>k.on_change(D,L,k),disabled:k.disabled},null,40,dr)),[[je,k.value]]):le("",!0),k.type==="date"?ge((I(),R("input",{key:3,type:"date","onUpdate:modelValue":D=>k.value=D,onChange:D=>k.on_change(D,L,k),disabled:k.disabled},null,40,fr)),[[je,k.value]]):le("",!0),k.type==="datetime"?ge((I(),R("input",{key:4,type:"datetime-local","onUpdate:modelValue":D=>k.value=D,onChange:D=>k.on_change(D,L,k),disabled:k.disabled},null,40,hr)),[[je,k.value]]):le("",!0),k.type==="checkbox"?(I(!0),R(J,{key:5},pe(k.options,(D,M)=>(I(),R(J,{key:`P_${v}_C_${E}_CB_${M}`},[ge($("input",{id:`P_${v}_C_${E}_CB_${M}`,name:`P_${v}_C_${E}_CB`,type:"checkbox",value:M,"onUpdate:modelValue":j=>k.value=j,onChange:j=>k.on_change(j,L,k),disabled:k.disabled},null,40,pr),[[Cn,k.value]]),$("label",{for:`P_${v}_C_${E}_CB_${M}`},re(D),9,mr)],64))),128)):le("",!0),k.type==="radio"?(I(!0),R(J,{key:6},pe(k.options,(D,M)=>(I(),R(J,{key:`P_${v}_C_${E}_RD_${M}`},[ge($("input",{id:`P_${v}_C_${E}_RD_${M}`,name:`P_${v}_C_${E}_RD`,type:"radio",value:M,"onUpdate:modelValue":j=>k.value=j,onChange:j=>k.on_change(j,L,k),disabled:k.disabled},null,40,vr),[[dt,k.value]]),$("label",{for:`P_${v}_C_${E}_RD_${M}`},re(D),9,_r)],64))),128)):le("",!0),k.type==="select"?ge((I(),R("select",{key:7,"onUpdate:modelValue":D=>k.value=D,multiple:k.multiple,onChange:D=>k.on_change(D,L,k),disabled:k.disabled},[(I(!0),R(J,null,pe(k.options,(D,M)=>(I(),R("option",{key:`P_${v}_C_${E}_SL_${M}`,value:M},re(D),9,yr))),128))],40,gr)),[[ze,k.value]]):le("",!0)])]))),128))])):le("",!0),(I(!0),R(J,null,pe(L.content.component,(k,E)=>(I(),Qt(Jt(e[k.componentName]),{key:`CMP_${v}_${E}`,data:k.data,modalData:L},null,8,["data","modalData"]))),128)),L.callback&&L.callback.length?(I(),R("div",wr,[(I(!0),R(J,null,pe(L.callback,(k,E)=>(I(),R("button",{key:`BTN_${v}_${E}`,onClick:D=>m(L.nid,k.key)},re(k.name),9,br))),128))])):le("",!0)]),L.layout.allow_resize?(I(),R("div",{key:0,class:"modal_border",onPointerdown:k=>y(L.nid,k)},g[1]||(g[1]=[Zt('<div class="c_l"></div><div class="c_r"></div><div class="c_t"></div><div class="c_b"></div><div class="c_lt"></div><div class="c_lb"></div><div class="c_rt"></div><div class="c_rb"></div>',8)]),40,kr)):le("",!0)],14,Qa)}),128))]))}}),Er={class:"fr_context"},Sr=["onClick"],Lr=["innerHTML"],Dr={key:0,class:"context_menu_sub"},Or=["onClick"],$r=["innerHTML"],Cr=ve({__name:"Context",setup(o){const t=Ae().get(),n=t?t!=null&&t.group.admin?2:1:0,s=mn(),r=F([]),i=F(null),l=F(!0),u=F({x:-1e3,y:0,w:0,h:0,sx:0,sy:0,direction:"lb"});s.register(a);function a(f,S){l.value=!1;const p=[];f.forEach(g=>{if(d(g)){if(g.child){let v=[];if(g.child.forEach(L=>{d(L)&&v.push(L)}),!v.length)return;g.child=v}p.push(g)}}),r.value=p,console.info(p),setTimeout(()=>h(S),20)}function d(f){switch(f.auth){case"none":return!1;default:case"guest":return!0;case"user":if(n<1)break;return!0;case"admin":if(n<2)break;return!0}}function h(f){if(!i.value)return;const S=i.value;let p=m();const g={x:f.clientX,y:f.clientY,w:S==null?void 0:S.offsetWidth,h:S==null?void 0:S.offsetHeight,sx:p.scrollTop,sy:p.scrollLeft,direction:"rb"};let v=["r","b"];switch(g.w+g.x>window.innerWidth&&(v[0]="l"),g.h+g.y>window.innerHeight&&(v[1]="t"),g.direction=v.join(""),g.direction){case"rb":break;case"rt":g.y-=g.h;break;case"lb":g.x-=g.w;break;case"lt":g.x-=g.w,g.y-=g.h;break}u.value=g,m().addEventListener("scroll",b),setTimeout(()=>l.value=!0,10)}function y(){m().removeEventListener("scroll",b),l.value=!1,c=null,setTimeout(()=>{r.value=[],u.value={x:-1e3,y:0,w:0,h:0,sx:0,sy:0,direction:"lb"}},10)}ye(()=>{});let c=null;function b(f){const S=m();if(!S)return;let p=u.value,g=S.scrollLeft,v=S.scrollTop,L=g-p.sx,A=v-p.sy;u.value=Object.assign(p,{x:p.x-L,y:p.y-A,sx:g,sy:v})}function m(){return c||(c=document.querySelector(".fr_content"),c)}return addEventListener("contextmenu",f=>{console.info("triggerMenu"),a([],f)}),addEventListener("click",f=>{y()}),(f,S)=>(I(),R("div",Er,[$("div",{class:de(["context_menu",l.value?"show":"",u.value.direction]),style:be({left:u.value.x+"px",top:u.value.y+"px"}),ref_key:"contextDOM",ref:i},[(I(!0),R(J,null,pe(r.value,(p,g)=>{var v;return I(),R("div",{key:`COM_${g}`,class:de(["context_item",(v=p.child)!=null&&v.length?"has_sub":""]),onClick:p.method},[$("span",{innerHTML:p.title},null,8,Lr),p.child&&p.child.length?(I(),R("div",Dr,[(I(!0),R(J,null,pe(p.child,(L,A)=>(I(),R("div",{key:`COM_${g}_${A}`,class:de({context_item:!0}),onClick:L.method},[$("span",{innerHTML:L.title},null,8,$r)],8,Or))),128))])):le("",!0)],10,Sr)}),128))],6)]))}}),Mr={class:"fr_body"},Ir=ve({__name:"main",setup(o){const t=Ae().get();t&&(document.cookie=`tosho_token=${t.token}; max-age=31536000`,s());const n=new Event("fe_config_loaded");async function s(){const r=await se("setting/get_front_conf");r&&(r.onlyoffice_enabled==="true"&&(ce.onlyOffice.enabled=!0,ce.onlyOffice.onlyofficeOrigin=r.onlyoffice_origin,ce.onlyOffice.jwtSecret=r.onlyoffice_jwt_secret),ce.navList=[{name:"Nas",meta:{cur:!0},path:"/"}],r.link_nav&&r.link_nav.forEach(i=>{ce.navList.push({name:i[0],meta:{cur:!1},path:i[1]})}),document.dispatchEvent(n))}return(r,i)=>{const l=Mn("router-view");return I(),R(J,null,[Ne(Fn,{class:"fr_header"}),Ne(xr),Ne(Cr),$("div",Mr,[Ne(ss,{class:"fr_navi"}),Ne(l)])],64)}}});ls();const Et=In(Ir);Et.use(Rn());Et.use(es);Et.mount("#app");export{Un as _,Te as a,Ar as b,Jo as c,Zo as d,te as e,Me as m,Tr as o,hs as p,se as q,Ve as u};

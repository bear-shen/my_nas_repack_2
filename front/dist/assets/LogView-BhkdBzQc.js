import{d as O,u as L,r as m,b as j,G as x,g as q,f as w,q as U,h as s,i as l,w as k,v as V,k as i,l as B,F as r,j as _,s as C,t as E,o as u,x as d,J as p,m as H}from"./index-B2OjhRKb.js";const $={class:"form"},F=["value"],S=O({__name:"LogView",setup(N){L();const o=m(null);C();const D=E();let a={id:"",status:"",type:""},M=[[-2,"unknown"],[-1,"failed"],[0,"success"],[1,"new"],[2,"working"]];const g=m([]);j(async()=>{Object.assign(a,x.copyObject(D.query)),f(),o.value&&o.value.addEventListener("scroll",b)}),q(async n=>{console.info(n),f()}),w(()=>{var n;o.value&&((n=o.value)==null||n.removeEventListener("scroll",b))});async function b(n){if(console.info(n),!o.value)return;let e=o.value,t=(e==null?void 0:e.scrollTop)+(e==null?void 0:e.clientHeight)+(e==null?void 0:e.clientHeight);(e==null?void 0:e.scrollHeight)<t&&x.debounce(async()=>{await f()},500,"logViewDebounce")}let y=1,v=!1;async function f(n=!1){if(v)return;v=!0,n&&(y=1);const e=await U("log/get",Object.assign({page:y},a));if(y+=1,v=!1,!e)return;if(!e.length){y--;return}const t=n?[]:g.value;for(let c=0;c<e.length;c++)t.push(Object.assign(e[c],{ext_key:`${new Date().valueOf()}_${Math.random()}`}));g.value=t}return(n,e)=>(u(),s("div",{class:"fr_content view_log",ref_key:"contentDOM",ref:o},[l("div",$,[l("label",null,[e[4]||(e[4]=l("span",null,"ID : ",-1)),k(l("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>i(a).id=t)},null,512),[[V,i(a).id]])]),l("label",null,[e[5]||(e[5]=l("span",null,"status : ",-1)),k(l("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>i(a).status=t)},[(u(!0),s(r,null,_(i(M),(t,c)=>(u(),s("option",{value:t[0]},d(t[1]),9,F))),256))],512),[[B,i(a).status]])]),l("label",null,[e[6]||(e[6]=l("span",null,"type : ",-1)),k(l("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>i(a).type=t)},null,512),[[V,i(a).type]])]),l("label",null,[l("button",{type:"button",onClick:e[3]||(e[3]=t=>f(!0))},"query")])]),l("table",null,[e[7]||(e[7]=l("tr",null,[l("th",null,"id"),l("th",null,"type"),l("th",null,"status"),l("th",null,"time_create"),l("th",null,"time_update"),l("th",null,"payload")],-1)),(u(!0),s(r,null,_(g.value,t=>(u(),s("tr",{key:`log_view_${t.ext_key}`},[l("td",null,d(t.id),1),l("td",null,d(t.type),1),l("td",null,[t.status===-2?(u(),s(r,{key:1},[p("unknown")],64)):t.status===-1?(u(),s(r,{key:2},[p("failed")],64)):t.status===0?(u(),s(r,{key:3},[p("success")],64)):t.status===1?(u(),s(r,{key:4},[p("waiting")],64)):t.status===2?(u(),s(r,{key:5},[p("working")],64)):H("",!0)]),l("td",null,d(t.time_create),1),l("td",null,d(t.time_update),1),l("td",null,d(t.payload),1)]))),128))])],512))}});export{S as default};

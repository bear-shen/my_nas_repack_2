import{d as K,r as M,D as x,b as Q,E as L,o as n,h as o,F as d,j as F,s as S,_ as Y,a as ee,u as ne,f as oe,k as h,i as l,n as r,A as E,z as D,y as s,G as X,q as te,H as se,I as le}from"./index-DbijJgKH.js";import{_ as J}from"./ContentEditable.vue_vue_type_script_setup_true_lang-cSIWpgN4.js";import{H as ie}from"./Hinter-CPUJhJzH.js";const de={key:0,class:"sysIcon sysIcon_cc-star"},ae={key:1,class:"sysIcon sysIcon_cc-star-half"},re={key:2,class:"sysIcon sysIcon_c-cstar-o"},ue=K({__name:"Rater",props:{node:{},modelValue:{}},emits:["update:modelValue"],setup(b,{emit:G}){const p=G,I=b,k=M(null),_=M(I.modelValue),y=M(I.modelValue);x(()=>I.modelValue,async f=>{_.value=f,y.value=f,g()}),Q(()=>{g(),k.value&&(k.value.addEventListener("mousemove",f=>{var v;let m=Math.round(10*f.offsetX/(((v=k.value)==null?void 0:v.offsetWidth)??1));m<0&&(m=0),m>10&&(m=10),y.value=m,g()}),k.value.addEventListener("mouseleave",f=>{y.value=_.value,g()}),k.value.addEventListener("click",async f=>{_.value=y.value,g(),I.node?await L.op_rate(_.value,I.node):p("update:modelValue",_.value)}))});const u=M([]);function g(){switch(y.value){default:case 0:u.value=[0,0,0,0,0];break;case 1:u.value=[1,0,0,0,0];break;case 2:u.value=[2,0,0,0,0];break;case 3:u.value=[2,1,0,0,0];break;case 4:u.value=[2,2,0,0,0];break;case 5:u.value=[2,2,1,0,0];break;case 6:u.value=[2,2,2,0,0];break;case 7:u.value=[2,2,2,1,0];break;case 8:u.value=[2,2,2,2,0];break;case 9:u.value=[2,2,2,2,1];break;case 10:u.value=[2,2,2,2,2];break}}return(f,m)=>(n(),o("span",{class:"rater",ref_key:"rater",ref:k},[(n(!0),o(d,null,F(u.value,v=>(n(),o(d,null,[v==2?(n(),o("span",de)):S("",!0),v==1?(n(),o("span",ae)):S("",!0),v==0?(n(),o("span",re)):S("",!0)],64))),256))],512))}}),ce=Y(ue,[["__scopeId","data-v-27d1130a"]]),pe=b=>(se("data-v-1fd73a96"),b=b(),le(),b),_e=["data-index","data-id"],ke={class:"content"},ye=["src"],fe={key:0,class:"thumb"},me=["src"],ve={class:"meta"},he=["title"],be=["title"],Ie={class:"time"},ge=["title"],we={key:2},$e={key:3},Ve=["title"],Ce=["title"],De={key:2},Fe={key:3},Me={key:0,class:"tag_list"},Se=["onClick"],Ee={key:1,class:"tag_list editing"},Ge=["onClick"],Le=pe(()=>l("span",{class:"sysIcon sysIcon_delete"},null,-1)),ze={class:"tag_hinter_bar"},Be=["src"],Te=["title"],Ue=["title"],Ne={key:0,class:"thumb"},Oe=["src"],Re=["title"],Ae=["title"],He=["title"],Pe={class:"time"},qe=K({__name:"FileItem",props:{node:{},index:{}},emits:["go","onSelect"],setup(b,{emit:G}){ee();const p=b,I=G,k=ne();let _=M(k.get("file_view_mode")??"detail");k.listen("file_view_mode",e=>{_.value=e});const y=M(null);Q(()=>{y.value&&(p.node._dom=y.value)}),oe(()=>{});function u(e,t){console.info("go",e,t),t&&I("go",e,t)}function g(e){if(e&&p.node.tag){for(let t=0;t<p.node.tag.length;t++)for(let a=0;a<p.node.tag[t].sub.length;a++)if(p.node.tag[t].sub[a].id===e){p.node.tag[t].sub.splice(a,1);return}}}async function f(e){const t=new FormData;return t.set("keyword",e),t.set("size","20"),await te("tag/get",t)}function m(e){const t=p.node;t.tag||(t.tag=[]);let a=null;for(let $=0;$<t.tag.length;$++)if(t.tag[$].id===e.id_group){a=t.tag[$];break}a||(a=e.group,a.sub=[],t.tag.push(a)),a.sub.push(e)}function v(e){return e?`${e.group.title} : ${e.title}`:""}async function w(e){console.info("op_dblclick",p.node.id,e),u("node",p.node.id)}let z=new Date().valueOf();async function V(e){const t=new Date().valueOf(),a=t-z;switch(z=t,e==null?void 0:e.pointerType){default:case"mouse":case"pen":break;case"touch":a<300&&await w(e);break}}function C(e){}return(e,t)=>{var a,$,B,T,U,N,O,R,A,H,P,q,j,W;return n(),o("div",{class:r(["node_node",`mode_${h(_)}`,{select:e.node._selected}]),"data-index":e.index,"data-id":e.node.id,ref_key:"curDOM",ref:y},[h(_)==="detail"?(n(),o(d,{key:0},[l("div",ke,[e.node.status?(n(),o(d,{key:0},[(a=e.node.file_index)!=null&&a.cover&&e.node._in_screen?(n(),o("div",{key:0,class:"thumb",onDblclick:w,onClick:V},[l("img",{src:($=e.node.file_index)==null?void 0:$.cover.path},null,8,ye)],32)):(n(),o("div",{key:1,onDblclick:w,onClick:V,class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`])},null,34))],64)):(n(),o(d,{key:1},[(B=e.node.file_index)!=null&&B.cover&&e.node._in_screen?(n(),o("div",fe,[l("img",{src:(T=e.node.file_index)==null?void 0:T.cover.path},null,8,me)])):(n(),o("div",{key:1,class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`])},null,2))],64)),l("div",ve,[e.node.status?(n(),o(d,{key:0},[e.node._renaming?(n(),o(d,{key:0},[E(J,{modelValue:e.node.title,"onUpdate:modelValue":t[0]||(t[0]=i=>e.node.title=i),class:"title editing","auto-focus":!0,onMousedown:D(C,["stop"]),onPointerdown:D(C,["stop"])},null,8,["modelValue"]),E(J,{modelValue:e.node.description,"onUpdate:modelValue":t[1]||(t[1]=i=>e.node.description=i),class:"editing",onMousedown:D(C,["stop"]),onPointerdown:D(C,["stop"])},null,8,["modelValue"]),l("button",{class:r(["active","sysIcon","sysIcon_save"]),onClick:t[2]||(t[2]=i=>h(L).op_rename(e.node))},"SAVE")],64)):(n(),o(d,{key:1},[e.node.type==="directory"?(n(),o("p",{key:0,class:r(["title","listIcon",`listIcon_file_${e.node.type}`]),title:e.node.title},s(e.node.title),11,he)):(n(),o("p",{key:1,class:r(["title"]),title:e.node.title},s(e.node.title),9,be)),l("p",Ie,[E(ce,{node:e.node,modelValue:e.node.rate,"onUpdate:modelValue":t[3]||(t[3]=i=>e.node.rate=i)},null,8,["node","modelValue"]),l("span",{title:`C:${e.node.time_create}\r
U:${e.node.time_update}`},s((e.node.time_create??"").substring(0,10)),9,ge)]),e.node.is_file?(n(),o("p",we,s(h(X).kmgt(((O=(N=(U=e.node)==null?void 0:U.file_index)==null?void 0:N.raw)==null?void 0:O.size)??0,2))+"B "+s(e.node.description),1)):(n(),o("p",$e,s(e.node.description),1))],64))],64)):(n(),o(d,{key:1},[e.node.type==="directory"?(n(),o("p",{key:0,class:r(["title","listIcon","listIcon_file_directory"]),title:e.node.title},s(e.node.title),9,Ve)):(n(),o("p",{key:1,class:r(["title"]),title:e.node.title},s(e.node.title),9,Ce)),l("p",null,[(n(!0),o(d,null,F(e.node.crumb_node,(i,c)=>(n(),o("span",{key:"FI_CR_"+e.node.id+"_"+c}," / "+s(i.title),1))),128))]),l("p",null,s(e.node.time_create),1),e.node.is_file?(n(),o("p",De,s(h(X).kmgt(((H=(A=(R=e.node)==null?void 0:R.file_index)==null?void 0:A.raw)==null?void 0:H.size)??0,2))+"B "+s(e.node.description),1)):(n(),o("p",Fe,s(e.node.description),1))],64))])]),!e.node._tagging&&e.node.tag?(n(),o("div",Me,[(n(!0),o(d,null,F(e.node.tag,i=>(n(),o("dl",{key:"FI_TG_"+e.node.id+"_"+i.id},[l("dt",null,s(i.title),1),(n(!0),o(d,null,F(i.sub,c=>(n(),o("dd",{key:"FI_TG_"+e.node.id+"_"+i.id+"_"+c.id,onClick:Z=>u("tag",(c==null?void 0:c.id)??0)},s(c.title),9,Se))),128))]))),128))])):S("",!0),e.node._tagging?(n(),o("div",Ee,[(n(!0),o(d,null,F(e.node.tag,i=>(n(),o("dl",{key:"FI_TG_"+e.node.id+"_"+i.id},[l("dt",null,s(i.title),1),(n(!0),o(d,null,F(i.sub,c=>(n(),o("dd",{key:"FI_TG_"+e.node.id+"_"+i.id+"_"+c.id,onClick:Z=>g((c==null?void 0:c.id)??0)},[l("span",null,s(c.title),1),Le],8,Ge))),128))]))),128)),l("div",ze,[E(ie,{"get-list":f,submit:m,"parse-text":v,onMousedown:D(C,["stop"]),onPointerdown:D(C,["stop"])}),l("button",{class:r(["active","sysIcon","sysIcon_save"]),onClick:t[4]||(t[4]=i=>h(L).op_tag(e.node))},"SAVE")])])):S("",!0)],64)):h(_)==="img"?(n(),o(d,{key:1},[e.node.status?(n(),o(d,{key:0},[(P=e.node.file_index)!=null&&P.cover&&e.node._in_screen?(n(),o("div",{key:0,class:"thumb",onDblclick:w,onClick:V},[l("img",{src:(q=e.node.file_index)==null?void 0:q.cover.path},null,8,Be)],32)):(n(),o("div",{key:1,class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`]),onDblclick:w,onClick:V},null,34)),e.node.type==="directory"?(n(),o("p",{key:2,class:r(["title","listIcon",`listIcon_file_${e.node.type}`]),title:e.node.title},s(e.node.title),11,Te)):(n(),o("p",{key:3,class:r(["title"]),title:e.node.title},s(e.node.title),9,Ue))],64)):(n(),o(d,{key:1},[(j=e.node.file_index)!=null&&j.cover&&e.node._in_screen?(n(),o("div",Ne,[l("img",{src:(W=e.node.file_index)==null?void 0:W.cover.path},null,8,Oe)])):(n(),o("div",{key:1,class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`])},null,2)),e.node.type==="directory"?(n(),o("p",{key:2,class:r(["title","listIcon",`listIcon_file_${e.node.type}`]),title:e.node.title},s(e.node.title),11,Re)):(n(),o("p",{key:3,class:r(["title"]),title:e.node.title},s(e.node.title),9,Ae))],64))],64)):h(_)==="text"?(n(),o(d,{key:2},[l("p",{class:"type",onDblclick:w,onClick:V},[l("span",{class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`])},null,2),l("span",null,s(e.node.type),1)],32),l("p",{class:"title",onDblclick:w,onClick:V,title:e.node.title},s(e.node.title),41,He),l("p",Pe,s(e.node.time_create),1)],64)):S("",!0)],10,_e)}}}),Je=Y(qe,[["__scopeId","data-v-1fd73a96"]]);export{Je as F,ce as R};

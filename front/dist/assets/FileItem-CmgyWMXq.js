import{d as j,r as D,B as Z,o as K,b as n,c as o,F as d,f as C,U as F,a as x,E as ee,q as ne,u as h,e as l,n as r,D as M,a9 as V,t as s,H as W,J as oe}from"./basic-rSR_Cw6k.js";import{_ as X}from"./ContentEditable.vue_vue_type_script_setup_true_lang-BHJBYt10.js";import{H as te}from"./Hinter-BlfudI7t.js";import{c as G,_ as Q}from"./index-D0Dqpylb.js";const se={key:0,class:"sysIcon sysIcon_cc-star"},le={key:1,class:"sysIcon sysIcon_cc-star-half"},ie={key:2,class:"sysIcon sysIcon_c-cstar-o"},de=j({__name:"Rater",props:{node:{},modelValue:{}},emits:["update:modelValue"],setup(E,{emit:B}){const k=B,b=E,_=D(null),y=D(b.modelValue),m=D(b.modelValue);Z(()=>b.modelValue,async f=>{y.value=f,m.value=f,g()}),K(()=>{g(),_.value&&(_.value.addEventListener("mousemove",f=>{var c;let v=Math.round(10*f.offsetX/(((c=_.value)==null?void 0:c.offsetWidth)??1));v<0&&(v=0),v>10&&(v=10),m.value=v,g()}),_.value.addEventListener("mouseleave",f=>{m.value=y.value,g()}),_.value.addEventListener("click",async f=>{y.value=m.value,g(),b.node?await G.op_rate(y.value,b.node):k("update:modelValue",y.value)}))});const u=D([]);function g(){switch(m.value){default:case 0:u.value=[0,0,0,0,0];break;case 1:u.value=[1,0,0,0,0];break;case 2:u.value=[2,0,0,0,0];break;case 3:u.value=[2,1,0,0,0];break;case 4:u.value=[2,2,0,0,0];break;case 5:u.value=[2,2,1,0,0];break;case 6:u.value=[2,2,2,0,0];break;case 7:u.value=[2,2,2,1,0];break;case 8:u.value=[2,2,2,2,0];break;case 9:u.value=[2,2,2,2,1];break;case 10:u.value=[2,2,2,2,2];break}}return(f,v)=>(n(),o("span",{class:"rater",ref_key:"rater",ref:_},[(n(!0),o(d,null,C(u.value,c=>(n(),o(d,null,[c==2?(n(),o("span",se)):F("",!0),c==1?(n(),o("span",le)):F("",!0),c==0?(n(),o("span",ie)):F("",!0)],64))),256))],512))}}),ae=Q(de,[["__scopeId","data-v-c1d6ecd8"]]),re=["data-index","data-id"],ue={class:"content"},ce=["src"],pe={key:0,class:"thumb"},_e=["src"],ke={class:"meta"},ye=["title"],fe=["title"],me={class:"time"},ve=["title"],he={key:2},be={key:3},ge=["title"],Ie=["title"],we={key:2},$e={key:3},Ve={key:0,class:"tag_list"},Ce=["onClick"],De={key:1,class:"tag_list editing"},Fe=["onClick"],Me={class:"tag_hinter_bar"},Ee=["src"],Be=["title"],Ge=["title"],Ue={key:0,class:"thumb"},Le=["src"],Se=["title"],Te=["title"],ze=["title"],Ne={class:"time"},Oe=j({__name:"FileItem",props:{node:{},index:{}},emits:["go","onSelect"],setup(E,{emit:B}){const k=E,b=B;let _=D(x("file_view_mode")??"detail");ee("file_view_mode",e=>{_.value=e});const y=D(null);K(()=>{y.value&&(k.node._dom=y.value)}),ne(()=>{});function m(e,t){console.info("go",e,t),t&&b("go",e,t)}function u(e){if(e&&k.node.tag){for(let t=0;t<k.node.tag.length;t++)for(let a=0;a<k.node.tag[t].sub.length;a++)if(k.node.tag[t].sub[a].id===e){k.node.tag[t].sub.splice(a,1);return}}}async function g(e){const t=new FormData;return t.set("keyword",e),t.set("size","20"),await oe("tag/get",t)}function f(e){const t=k.node;t.tag||(t.tag=[]);let a=null;for(let I=0;I<t.tag.length;I++)if(t.tag[I].id===e.id_group){a=t.tag[I];break}a||(a=e.group,a.sub=[],t.tag.push(a)),a.sub.push(e)}function v(e){return e?`${e.group.title} : ${e.title}`:""}async function c(e){console.info("op_dblclick",k.node.id,e),m("node",k.node.id)}let U=new Date().valueOf();async function w(e){const t=new Date().valueOf(),a=t-U;switch(U=t,e==null?void 0:e.pointerType){default:case"mouse":case"pen":break;case"touch":a<300&&await c(e);break}}function $(e){}return(e,t)=>{var a,I,L,S,T,z,N,O,R,H,P,q,A,J;return n(),o("div",{class:r(["node_node",`mode_${h(_)}`,{select:e.node._selected}]),"data-index":e.index,"data-id":e.node.id,ref_key:"curDOM",ref:y},[h(_)==="detail"?(n(),o(d,{key:0},[l("div",ue,[e.node.status?(n(),o(d,{key:0},[(a=e.node.file_index)!=null&&a.cover&&e.node._in_screen?(n(),o("div",{key:0,class:"thumb",onDblclick:c,onClick:w},[l("img",{src:(I=e.node.file_index)==null?void 0:I.cover.path},null,8,ce)],32)):(n(),o("div",{key:1,onDblclick:c,onClick:w,class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`])},null,34))],64)):(n(),o(d,{key:1},[(L=e.node.file_index)!=null&&L.cover&&e.node._in_screen?(n(),o("div",pe,[l("img",{src:(S=e.node.file_index)==null?void 0:S.cover.path},null,8,_e)])):(n(),o("div",{key:1,class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`])},null,2))],64)),l("div",ke,[e.node.status?(n(),o(d,{key:0},[e.node._renaming?(n(),o(d,{key:0},[M(X,{modelValue:e.node.title,"onUpdate:modelValue":t[0]||(t[0]=i=>e.node.title=i),class:"title editing","auto-focus":!0,onMousedown:V($,["stop"]),onPointerdown:V($,["stop"])},null,8,["modelValue"]),M(X,{modelValue:e.node.description,"onUpdate:modelValue":t[1]||(t[1]=i=>e.node.description=i),class:"editing",onMousedown:V($,["stop"]),onPointerdown:V($,["stop"])},null,8,["modelValue"]),l("button",{class:r(["active","sysIcon","sysIcon_save"]),onClick:t[2]||(t[2]=i=>h(G).op_rename(e.node))},"SAVE")],64)):(n(),o(d,{key:1},[e.node.type==="directory"?(n(),o("p",{key:0,class:r(["title","listIcon",`listIcon_file_${e.node.type}`]),title:e.node.title},s(e.node.title),11,ye)):(n(),o("p",{key:1,class:r(["title"]),title:e.node.title},s(e.node.title),9,fe)),l("p",me,[M(ae,{node:e.node,modelValue:e.node.rate,"onUpdate:modelValue":t[3]||(t[3]=i=>e.node.rate=i)},null,8,["node","modelValue"]),l("span",{title:`C:${e.node.time_create}\r
U:${e.node.time_update}`},s((e.node.time_create??"").substring(0,10)),9,ve)]),e.node.is_file?(n(),o("p",he,s(h(W).kmgt(((N=(z=(T=e.node)==null?void 0:T.file_index)==null?void 0:z.raw)==null?void 0:N.size)??0,2))+"B "+s(e.node.description),1)):(n(),o("p",be,s(e.node.description),1))],64))],64)):(n(),o(d,{key:1},[e.node.type==="directory"?(n(),o("p",{key:0,class:r(["title","listIcon","listIcon_file_directory"]),title:e.node.title},s(e.node.title),9,ge)):(n(),o("p",{key:1,class:r(["title"]),title:e.node.title},s(e.node.title),9,Ie)),l("p",null,[(n(!0),o(d,null,C(e.node.crumb_node,(i,p)=>(n(),o("span",{key:"FI_CR_"+e.node.id+"_"+p}," / "+s(i.title),1))),128))]),l("p",null,s(e.node.time_create),1),e.node.is_file?(n(),o("p",we,s(h(W).kmgt(((H=(R=(O=e.node)==null?void 0:O.file_index)==null?void 0:R.raw)==null?void 0:H.size)??0,2))+"B "+s(e.node.description),1)):(n(),o("p",$e,s(e.node.description),1))],64))])]),!e.node._tagging&&e.node.tag?(n(),o("div",Ve,[(n(!0),o(d,null,C(e.node.tag,i=>(n(),o("dl",{key:"FI_TG_"+e.node.id+"_"+i.id},[l("dt",null,s(i.title),1),(n(!0),o(d,null,C(i.sub,p=>(n(),o("dd",{key:"FI_TG_"+e.node.id+"_"+i.id+"_"+p.id,onClick:Y=>m("tag",(p==null?void 0:p.id)??0)},s(p.title),9,Ce))),128))]))),128))])):F("",!0),e.node._tagging?(n(),o("div",De,[(n(!0),o(d,null,C(e.node.tag,i=>(n(),o("dl",{key:"FI_TG_"+e.node.id+"_"+i.id},[l("dt",null,s(i.title),1),(n(!0),o(d,null,C(i.sub,p=>(n(),o("dd",{key:"FI_TG_"+e.node.id+"_"+i.id+"_"+p.id,onClick:Y=>u((p==null?void 0:p.id)??0)},[l("span",null,s(p.title),1),t[5]||(t[5]=l("span",{class:"sysIcon sysIcon_delete"},null,-1))],8,Fe))),128))]))),128)),l("div",Me,[M(te,{"get-list":g,submit:f,"parse-text":v,onMousedown:V($,["stop"]),onPointerdown:V($,["stop"])}),l("button",{class:r(["active","sysIcon","sysIcon_save"]),onClick:t[4]||(t[4]=i=>h(G).op_tag(e.node))},"SAVE")])])):F("",!0)],64)):h(_)==="img"?(n(),o(d,{key:1},[e.node.status?(n(),o(d,{key:0},[(P=e.node.file_index)!=null&&P.cover&&e.node._in_screen?(n(),o("div",{key:0,class:"thumb",onDblclick:c,onClick:w},[l("img",{src:(q=e.node.file_index)==null?void 0:q.cover.path},null,8,Ee)],32)):(n(),o("div",{key:1,class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`]),onDblclick:c,onClick:w},null,34)),e.node.type==="directory"?(n(),o("p",{key:2,class:r(["title","listIcon",`listIcon_file_${e.node.type}`]),title:e.node.title},s(e.node.title),11,Be)):(n(),o("p",{key:3,class:r(["title"]),title:e.node.title},s(e.node.title),9,Ge))],64)):(n(),o(d,{key:1},[(A=e.node.file_index)!=null&&A.cover&&e.node._in_screen?(n(),o("div",Ue,[l("img",{src:(J=e.node.file_index)==null?void 0:J.cover.path},null,8,Le)])):(n(),o("div",{key:1,class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`])},null,2)),e.node.type==="directory"?(n(),o("p",{key:2,class:r(["title","listIcon",`listIcon_file_${e.node.type}`]),title:e.node.title},s(e.node.title),11,Se)):(n(),o("p",{key:3,class:r(["title"]),title:e.node.title},s(e.node.title),9,Te))],64))],64)):h(_)==="text"?(n(),o(d,{key:2},[l("p",{class:"type",onDblclick:c,onClick:w},[l("span",{class:r(["thumb","listIcon",`listIcon_file_${e.node.type}`])},null,2),l("span",null,s(e.node.type),1)],32),l("p",{class:"title",onDblclick:c,onClick:w,title:e.node.title},s(e.node.title),41,ze),l("p",Ne,s(e.node.time_create),1)],64)):F("",!0)],10,re)}}}),Ae=Q(Oe,[["__scopeId","data-v-5caadcd6"]]);export{Ae as F,ae as R};

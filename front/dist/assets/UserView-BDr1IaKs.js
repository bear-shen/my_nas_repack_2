import{d as J,u as z,r as m,b as Q,G as K,g as P,q as y,f as T,h as i,i as a,n as p,F as _,j as $,s as S,t as W,x as X,o as u,y as v,A as f,w as V,B as A,J as D}from"./index-DbijJgKH.js";import{_ as h}from"./ContentEditable.vue_vue_type_script_setup_true_lang-cSIWpgN4.js";import{H as Y}from"./Hinter-CPUJhJzH.js";const Z={key:0,class:"list_user_group"},g=a("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1),ee=[g],te={class:"title"},se=["onClick"],ae={class:"operator"},le=["onClick"],ne=["onClick"],oe=["onClick"],ie=["onClick"],ue={class:"auth"},de=a("dt",null,"denyDir",-1),ce=["onClick"],_e=["onClick"],re={class:"operator"},ye=["onUpdate:modelValue","id"],ve=["for"],fe=["onUpdate:modelValue","id","name"],me=["for"],he=["onUpdate:modelValue","id","name"],ke=["for"],pe=["onClick"],Ve={class:"list_user"},Ce=a("span",{class:"sysIcon sysIcon_plus-square-o"},null,-1),Ue=[Ce],$e={class:"title"},be=["onClick"],we={class:"mail"},Ge={class:"status"},Ie={class:"title"},Be=["onUpdate:modelValue","id"],Se=["for"],Ae=["onClick"],De=a("label",{class:"status"},null,-1),Me=J({__name:"UserView",setup(qe){z();const q=m(null),x=W(),b=X();let k={id:""};const n=m([]),d=m([]);m(null);const c=m(-1);Q(async()=>{Object.assign(k,K.copyObject(b.query)),w()}),P(async t=>{k.id=t.query.id??"",w()});async function w(){if(!n.value||!n.value.length){const s=await y("user_group/get",k);if(!s)return;n.value=s}let t=parseInt(k.id);if(t){let s=!1;for(let e=0;e<n.value.length;e++)t&&t===n.value[e].id&&(s=!0,c.value=e);s||(c.value=-1),O()}}async function O(){if(d.value=[],c.value===-1)return;const s={id_group:n.value[c.value].id},e=await y("user/get",s);e&&(d.value=e)}T(()=>{});async function G(t){var o,l,r,U,B;if(!n.value[t].edit){n.value[t].edit=!0;return}const s={title:n.value[t].title,description:n.value[t].description,admin:(o=n.value[t].admin)==null?void 0:o.toString(),status:(l=n.value[t].status)==null?void 0:l.toString(),auth:JSON.stringify(n.value[t].auth)};(r=n.value[t])!=null&&r.id&&(s.id=(B=(U=n.value[t])==null?void 0:U.id)==null?void 0:B.toString());const e=await y("user_group/mod",s);e&&(n.value[t].edit=!1,n.value[t].id=e.id??0)}async function L(t){const s=n.value.splice(t,1)[0];s.id&&await y("user_group/del",{id:s.id})}async function M(){n.value.unshift({title:"",description:"",auth:{allow:[],deny:[]},admin:0,status:1,edit:!0,ext_key:new Date().valueOf(),user:[]})}async function j(t){console.info("addAuth");const s=n.value[t];s.auth||(s.auth={}),s.auth.deny||(s.auth.deny=[]),s.auth.deny.push({id:0,title:"root",status:1,type:"directory",crumb_node:[]})}async function N(t,s){console.info("delAuth");const e=n.value[t];e.auth||(e.auth={}),e.auth.deny||(e.auth.deny=[]),e.auth.deny.splice(s,1),n.value[t]=e}async function R(t){console.info("node_hint");const e=await y("file/get",{mode:"search",node_type:"directory",keyword:t,with:"none",limit:"20"});return e?("root".indexOf(t)!==-1&&e.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),e.list):!1}function F(t,s){console.info("node_add",t,s);const e=s[0],o=s[1],l=n.value[e];l.auth.deny[o]=t}function E(t){var e;if(console.info("node_parse"),!t)return"";const s=[];return(e=t.crumb_node)==null||e.forEach(o=>{o.title&&s.push(o.title)}),t.title&&s.push(t.title),`/ ${s.join(" / ")}`}function C(t){let s=0;t!==-1&&(s=n.value[t].id??0),x.push({path:b.path,query:{id:s}})}function H(){if(c.value==-1)return;const t=d.value,s=n.value[c.value];t.unshift({name:"",mail:"",id_group:s.id,password:"",status:1,ext_key:new Date().valueOf(),edit:!0})}async function I(t){if(!d.value[t].edit){d.value[t].edit=!0;return}const s=await y("user/mod",d.value[t]);s&&(d.value[t].edit=!1,d.value[t].id=parseInt(s.id??""))}return(t,s)=>(u(),i("div",{class:"fr_content view_user",ref_key:"contentDOM",ref:q},[n.value&&n.value.length?(u(),i("div",Z,[a("div",{class:p({user_group:!0,user_group_add:!0,active:c.value===-1}),onClick:M},ee,2),(u(!0),i(_,null,$(n.value,(e,o)=>(u(),i("div",{key:`userView_group_${e.ext_key?e.ext_key:e.id}`,class:p({active:c.value===o,user_group:!0,edit:e.edit})},[e.edit?(u(),i(_,{key:1},[f(h,{class:"title",modelValue:e.title,"onUpdate:modelValue":l=>e.title=l,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),f(h,{class:"description",modelValue:e.description,"onUpdate:modelValue":l=>e.description=l},null,8,["modelValue","onUpdate:modelValue"]),a("dl",ue,[de,e.auth?(u(!0),i(_,{key:0},$(e.auth.deny,(l,r)=>(u(),i("dd",{key:`userView_group_${e.ext_key?e.ext_key:e.id}_${r}`},[f(Y,{"get-list":R,submit:F,"parse-text":E,"model-value":l,meta:[o,r]},null,8,["model-value","meta"]),a("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:U=>N(o,r)},null,8,ce)]))),128)):S("",!0),a("dd",{class:"pointer add",onClick:l=>j(o)},"+",8,_e)]),a("div",re,[V(a("input",{type:"checkbox","onUpdate:modelValue":l=>e.status=l,id:`UV_G_CB_S_${e.ext_key?e.ext_key:e.id}`,"true-value":1,"false-value":0},null,8,ye),[[A,e.status]]),a("label",{class:"no_bg",for:`UV_G_CB_S_${e.ext_key?e.ext_key:e.id}`},null,8,ve),V(a("input",{type:"radio","onUpdate:modelValue":l=>e.admin=l,id:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_1`,name:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}`,value:1},null,8,fe),[[D,e.admin]]),a("label",{class:"no_bg",for:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_1`}," isAdmin ",8,me),V(a("input",{type:"radio","onUpdate:modelValue":l=>e.admin=l,id:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_0`,name:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}`,value:0},null,8,he),[[D,e.admin]]),a("label",{class:"no_bg",for:`UV_G_CB_A_${e.ext_key?e.ext_key:e.id}_0`}," isUser ",8,ke),a("div",null,[a("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:l=>G(o)},null,8,pe)])])],64)):(u(),i(_,{key:0},[a("div",te,[a("div",{onClick:l=>C(o)},v(e.title),9,se),a("div",ae,[a("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:l=>G(o)},null,8,le),a("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:l=>L(o)},null,8,ne)])]),a("div",{onClick:l=>C(o),class:"description"},v(e.description),9,oe),a("div",{onClick:l=>C(o),class:"meta"},[a("span",null,v(e.admin?"admin":"user"),1)],8,ie)],64))],2))),128))])):S("",!0),a("div",Ve,[a("div",{class:p({user:!0,user_add:!0}),onClick:H},Ue),(u(!0),i(_,null,$(d.value,(e,o)=>(u(),i("div",{class:p({user:!0,edit:e.edit}),key:`user_view_${e.ext_key?e.ext_key:e.id}`},[e.edit?(u(),i(_,{key:1},[a("div",Ie,[f(h,{modelValue:e.name,"onUpdate:modelValue":l=>e.name=l,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),a("div",null,[V(a("input",{type:"checkbox","onUpdate:modelValue":l=>e.status=l,id:`UV_U_CB_${e.ext_key?e.ext_key:e.id}`,"true-value":1,"false-value":0},null,8,Be),[[A,e.status]]),a("label",{class:"no_bg",for:`UV_U_CB_${e.ext_key?e.ext_key:e.id}`},null,8,Se),a("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:l=>I(o)},null,8,Ae)])]),f(h,{modelValue:e.mail,"onUpdate:modelValue":l=>e.mail=l,class:"mail"},null,8,["modelValue","onUpdate:modelValue"]),f(h,{modelValue:e.password,"onUpdate:modelValue":l=>e.password=l,class:"password"},null,8,["modelValue","onUpdate:modelValue"]),De],64)):(u(),i(_,{key:0},[a("div",$e,[a("div",null,v(e.name),1),a("div",null,[a("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:l=>I(o)},null,8,be)])]),a("div",we,v(e.mail),1),a("div",Ge,v(e.status?"activate":"inactivate"),1)],64))],2))),128))])],512))}});export{Me as default};

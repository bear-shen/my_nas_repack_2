const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./FileView_N-H4xLkUSB.js","./FileView.vue_vue_type_style_index_0_lang-BR4fbGV1.js","./basic-CIm7r3-8.js","./basic-D5EgENoc.css","./FileItem-B3Wk4FfO.js","./ContentEditable.vue_vue_type_script_setup_true_lang-DzChvZgB.js","./Hinter-BvA4fZLK.js","./Hinter-BlWHVohS.css","./FileItem-DlBSMwIz.css","./FileView-BSPtTJMB.css","./Favourite-CpGSoyb6.js","./Favourite-BN5yJjEX.css","./FileView_R-CDi8d82d.js","./TagView-Br2YFzA4.js","./TagView-BIbJvYcw.css","./ShareView-OlBoNzxG.js","./ShareView-BRPRpGNM.css","./UserView-CJQI27_N.js","./UserView-CmWqTIhk.css","./LogView-DwLa1FPl.js","./LogView-V_AVrbUx.css","./SettingView-BQRAIId0.js","./SettingView-EQ9DroAn.css"])))=>i.map(i=>d[i]);
var ln=Object.defineProperty;var cn=(a,e,t)=>e in a?ln(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var se=(a,e,t)=>cn(a,typeof e!="symbol"?e+"":e,t);import{d as pe,r as j,g as je,o as $e,C as ne,a as fe,b as D,c as L,e as P,F as q,f as oe,n as de,u as Y,t as ae,h as ft,s as un,i as dn,j as ke,k as fn,l as hn,m as Le,p as pn,q as Re,v as _n,w as mn,x as vn,y as ye,z as Tt,A as Xe,B as Ht,D as Oe,M as yn,E as gn,G as wn,H as he,I as bn,J as X,K as He,L as ze,N as kn,O as En,P as xn,Q as Qe,R as zt,S as Je,T as ht,U as ee,V as ce,W as Ne,X as Nt,_ as Sn,Y as Dn,Z as Ln,$ as $n,a0 as Rn,a1 as pt,a2 as Bt,a3 as at,a4 as qe,a5 as Vt,a6 as Ae,a7 as _t,a8 as Ut,a9 as Cn,aa as On,ab as Pn,ac as An,ad as Mn,ae as In}from"./basic-CIm7r3-8.js";const Tn={class:"fr_header"},Hn={class:"navi"},zn=["innerHTML","href"],Nn={class:"user"},Bn={class:"pointer"},Vn=pe({__name:"Header",setup(a){const e=j([]);let t=je();function n(){un(null),location.reload()}$e(()=>{document.addEventListener("fe_config_loaded",()=>{e.value=ne.navList})});const s=ne.theme;let i=fe("theme")??"warm";function c(){const u={};s.forEach(o=>{u[o[0]]=o[0]}),dn({title:"theme configure",alpha:!0,key:"theme_configure",single:!0,w:360,h:160,minW:360,minH:160,allow_resize:!0,allow_move:!0,allow_escape:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"radio",label:"theme name",key:"theme",options:u,value:i}],callback:{check:async o=>{console.info(o),i=o.content.form[0].value,h(i)}}})}function h(u){s.forEach(o=>{const v=o[0],_=o[1];if(v!==u)return;ke("theme",v);const y=document.body.className.trim().split(" "),r=[];y.forEach(d=>{d&&d.length&&d.indexOf("theme_")!==0&&r.push(d)}),r.push("theme_"+u);const p=document.createElement("link");p.setAttribute("rel","stylesheet"),p.setAttribute("href",_),document.body.appendChild(p),document.body.className=r.join(" ")})}return h(i),(u,o)=>(D(),L("div",Tn,[o[1]||(o[1]=P("div",{class:"logo"},"Hentai.",-1)),P("div",Hn,[(D(!0),L(q,null,oe(e.value,v=>{var _;return D(),L("a",{key:v.name,class:de({active:(_=v.meta)==null?void 0:_.cur,pointer:1}),innerHTML:v.name,href:v.path,target:"_blank"},null,10,zn)}),128))]),P("div",Nn,[Y(t)&&Y(t).id?(D(),L(q,{key:0},[P("div",Bn,ae(Y(t).name),1),P("ul",{class:"action pointer"},[P("li",{onClick:c},"theme"),P("li",{onClick:n},"logout")])],64)):(D(),L("div",{key:1,class:"pointer",onClick:o[0]||(o[0]=(...v)=>Y(ft)&&Y(ft)(...v))},"login"))])]))}}),Un=(a,e)=>{const t=a.__vccOpts||a;for(const[n,s]of e)t[n]=s;return t},Wn=Un(Vn,[["__scopeId","data-v-1c0c27ef"]]),jn="modulepreload",Fn=function(a,e){return new URL(a,e).href},mt={},Ee=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){const c=document.getElementsByTagName("link"),h=document.querySelector("meta[property=csp-nonce]"),u=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));s=Promise.allSettled(t.map(o=>{if(o=Fn(o,n),o in mt)return;mt[o]=!0;const v=o.endsWith(".css"),_=v?'[rel="stylesheet"]':"";if(!!n)for(let p=c.length-1;p>=0;p--){const d=c[p];if(d.href===o&&(!v||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${_}`))return;const r=document.createElement("link");if(r.rel=v?"stylesheet":jn,v||(r.as="script"),r.crossOrigin="",r.href=o,u&&r.setAttribute("nonce",u),document.head.appendChild(r),v)return new Promise((p,d)=>{r.addEventListener("load",p),r.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${o}`)))})}))}function i(c){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=c,window.dispatchEvent(h),!h.defaultPrevented)throw c}return s.then(c=>{for(const h of c||[])h.status==="rejected"&&i(h.reason);return e().catch(i)})};/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Pe=typeof document<"u";function Wt(a){return typeof a=="object"||"displayName"in a||"props"in a||"__vccOpts"in a}function qn(a){return a.__esModule||a[Symbol.toStringTag]==="Module"||a.default&&Wt(a.default)}const K=Object.assign;function Ze(a,e){const t={};for(const n in e){const s=e[n];t[n]=ve(s)?s.map(a):a(s)}return t}const Be=()=>{},ve=Array.isArray,jt=/#/g,Gn=/&/g,Kn=/\//g,Yn=/=/g,Xn=/\?/g,Ft=/\+/g,Qn=/%5B/g,Jn=/%5D/g,qt=/%5E/g,Zn=/%60/g,Gt=/%7B/g,ea=/%7C/g,Kt=/%7D/g,ta=/%20/g;function lt(a){return encodeURI(""+a).replace(ea,"|").replace(Qn,"[").replace(Jn,"]")}function na(a){return lt(a).replace(Gt,"{").replace(Kt,"}").replace(qt,"^")}function st(a){return lt(a).replace(Ft,"%2B").replace(ta,"+").replace(jt,"%23").replace(Gn,"%26").replace(Zn,"`").replace(Gt,"{").replace(Kt,"}").replace(qt,"^")}function aa(a){return st(a).replace(Yn,"%3D")}function sa(a){return lt(a).replace(jt,"%23").replace(Xn,"%3F")}function oa(a){return a==null?"":sa(a).replace(Kn,"%2F")}function Ue(a){try{return decodeURIComponent(""+a)}catch{}return""+a}const ia=/\/$/,ra=a=>a.replace(ia,"");function et(a,e,t="/"){let n,s={},i="",c="";const h=e.indexOf("#");let u=e.indexOf("?");return h<u&&h>=0&&(u=-1),u>-1&&(n=e.slice(0,u),i=e.slice(u+1,h>-1?h:e.length),s=a(i)),h>-1&&(n=n||e.slice(0,h),c=e.slice(h,e.length)),n=da(n??e,t),{fullPath:n+(i&&"?")+i+c,path:n,query:s,hash:Ue(c)}}function la(a,e){const t=e.query?a(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function vt(a,e){return!e||!a.toLowerCase().startsWith(e.toLowerCase())?a:a.slice(e.length)||"/"}function ca(a,e,t){const n=e.matched.length-1,s=t.matched.length-1;return n>-1&&n===s&&Me(e.matched[n],t.matched[s])&&Yt(e.params,t.params)&&a(e.query)===a(t.query)&&e.hash===t.hash}function Me(a,e){return(a.aliasOf||a)===(e.aliasOf||e)}function Yt(a,e){if(Object.keys(a).length!==Object.keys(e).length)return!1;for(const t in a)if(!ua(a[t],e[t]))return!1;return!0}function ua(a,e){return ve(a)?yt(a,e):ve(e)?yt(e,a):a===e}function yt(a,e){return ve(e)?a.length===e.length&&a.every((t,n)=>t===e[n]):a.length===1&&a[0]===e}function da(a,e){if(a.startsWith("/"))return a;if(!a)return e;const t=e.split("/"),n=a.split("/"),s=n[n.length-1];(s===".."||s===".")&&n.push("");let i=t.length-1,c,h;for(c=0;c<n.length;c++)if(h=n[c],h!==".")if(h==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+n.slice(c).join("/")}const xe={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var We;(function(a){a.pop="pop",a.push="push"})(We||(We={}));var Ve;(function(a){a.back="back",a.forward="forward",a.unknown=""})(Ve||(Ve={}));function fa(a){if(!a)if(Pe){const e=document.querySelector("base");a=e&&e.getAttribute("href")||"/",a=a.replace(/^\w+:\/\/[^\/]+/,"")}else a="/";return a[0]!=="/"&&a[0]!=="#"&&(a="/"+a),ra(a)}const ha=/^[^#]+#/;function pa(a,e){return a.replace(ha,"#")+e}function _a(a,e){const t=document.documentElement.getBoundingClientRect(),n=a.getBoundingClientRect();return{behavior:e.behavior,left:n.left-t.left-(e.left||0),top:n.top-t.top-(e.top||0)}}const Ge=()=>({left:window.scrollX,top:window.scrollY});function ma(a){let e;if("el"in a){const t=a.el,n=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?n?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=_a(s,a)}else e=a;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function gt(a,e){return(history.state?history.state.position-e:-1)+a}const ot=new Map;function va(a,e){ot.set(a,e)}function ya(a){const e=ot.get(a);return ot.delete(a),e}let ga=()=>location.protocol+"//"+location.host;function Xt(a,e){const{pathname:t,search:n,hash:s}=e,i=a.indexOf("#");if(i>-1){let h=s.includes(a.slice(i))?a.slice(i).length:1,u=s.slice(h);return u[0]!=="/"&&(u="/"+u),vt(u,"")}return vt(t,a)+n+s}function wa(a,e,t,n){let s=[],i=[],c=null;const h=({state:y})=>{const r=Xt(a,location),p=t.value,d=e.value;let m=0;if(y){if(t.value=r,e.value=y,c&&c===p){c=null;return}m=d?y.position-d.position:0}else n(r);s.forEach(l=>{l(t.value,p,{delta:m,type:We.pop,direction:m?m>0?Ve.forward:Ve.back:Ve.unknown})})};function u(){c=t.value}function o(y){s.push(y);const r=()=>{const p=s.indexOf(y);p>-1&&s.splice(p,1)};return i.push(r),r}function v(){const{history:y}=window;y.state&&y.replaceState(K({},y.state,{scroll:Ge()}),"")}function _(){for(const y of i)y();i=[],window.removeEventListener("popstate",h),window.removeEventListener("beforeunload",v)}return window.addEventListener("popstate",h),window.addEventListener("beforeunload",v,{passive:!0}),{pauseListeners:u,listen:o,destroy:_}}function wt(a,e,t,n=!1,s=!1){return{back:a,current:e,forward:t,replaced:n,position:window.history.length,scroll:s?Ge():null}}function ba(a){const{history:e,location:t}=window,n={value:Xt(a,t)},s={value:e.state};s.value||i(n.value,{back:null,current:n.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(u,o,v){const _=a.indexOf("#"),y=_>-1?(t.host&&document.querySelector("base")?a:a.slice(_))+u:ga()+a+u;try{e[v?"replaceState":"pushState"](o,"",y),s.value=o}catch(r){console.error(r),t[v?"replace":"assign"](y)}}function c(u,o){const v=K({},e.state,wt(s.value.back,u,s.value.forward,!0),o,{position:s.value.position});i(u,v,!0),n.value=u}function h(u,o){const v=K({},s.value,e.state,{forward:u,scroll:Ge()});i(v.current,v,!0);const _=K({},wt(n.value,u,null),{position:v.position+1},o);i(u,_,!1),n.value=u}return{location:n,state:s,push:h,replace:c}}function ka(a){a=fa(a);const e=ba(a),t=wa(a,e.state,e.location,e.replace);function n(i,c=!0){c||t.pauseListeners(),history.go(i)}const s=K({location:"",base:a,go:n,createHref:pa.bind(null,a)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function Ea(a){return typeof a=="string"||a&&typeof a=="object"}function Qt(a){return typeof a=="string"||typeof a=="symbol"}const Jt=Symbol("");var bt;(function(a){a[a.aborted=4]="aborted",a[a.cancelled=8]="cancelled",a[a.duplicated=16]="duplicated"})(bt||(bt={}));function Ie(a,e){return K(new Error,{type:a,[Jt]:!0},e)}function be(a,e){return a instanceof Error&&Jt in a&&(e==null||!!(a.type&e))}const kt="[^/]+?",xa={sensitive:!1,strict:!1,start:!0,end:!0},Sa=/[.+*?^${}()[\]/\\]/g;function Da(a,e){const t=K({},xa,e),n=[];let s=t.start?"^":"";const i=[];for(const o of a){const v=o.length?[]:[90];t.strict&&!o.length&&(s+="/");for(let _=0;_<o.length;_++){const y=o[_];let r=40+(t.sensitive?.25:0);if(y.type===0)_||(s+="/"),s+=y.value.replace(Sa,"\\$&"),r+=40;else if(y.type===1){const{value:p,repeatable:d,optional:m,regexp:l}=y;i.push({name:p,repeatable:d,optional:m});const g=l||kt;if(g!==kt){r+=10;try{new RegExp(`(${g})`)}catch(w){throw new Error(`Invalid custom RegExp for param "${p}" (${g}): `+w.message)}}let f=d?`((?:${g})(?:/(?:${g}))*)`:`(${g})`;_||(f=m&&o.length<2?`(?:/${f})`:"/"+f),m&&(f+="?"),s+=f,r+=20,m&&(r+=-8),d&&(r+=-20),g===".*"&&(r+=-50)}v.push(r)}n.push(v)}if(t.strict&&t.end){const o=n.length-1;n[o][n[o].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const c=new RegExp(s,t.sensitive?"":"i");function h(o){const v=o.match(c),_={};if(!v)return null;for(let y=1;y<v.length;y++){const r=v[y]||"",p=i[y-1];_[p.name]=r&&p.repeatable?r.split("/"):r}return _}function u(o){let v="",_=!1;for(const y of a){(!_||!v.endsWith("/"))&&(v+="/"),_=!1;for(const r of y)if(r.type===0)v+=r.value;else if(r.type===1){const{value:p,repeatable:d,optional:m}=r,l=p in o?o[p]:"";if(ve(l)&&!d)throw new Error(`Provided param "${p}" is an array but it is not repeatable (* or + modifiers)`);const g=ve(l)?l.join("/"):l;if(!g)if(m)y.length<2&&(v.endsWith("/")?v=v.slice(0,-1):_=!0);else throw new Error(`Missing required param "${p}"`);v+=g}}return v||"/"}return{re:c,score:n,keys:i,parse:h,stringify:u}}function La(a,e){let t=0;for(;t<a.length&&t<e.length;){const n=e[t]-a[t];if(n)return n;t++}return a.length<e.length?a.length===1&&a[0]===80?-1:1:a.length>e.length?e.length===1&&e[0]===80?1:-1:0}function Zt(a,e){let t=0;const n=a.score,s=e.score;for(;t<n.length&&t<s.length;){const i=La(n[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-n.length)===1){if(Et(n))return 1;if(Et(s))return-1}return s.length-n.length}function Et(a){const e=a[a.length-1];return a.length>0&&e[e.length-1]<0}const $a={type:0,value:""},Ra=/[a-zA-Z0-9_]/;function Ca(a){if(!a)return[[]];if(a==="/")return[[$a]];if(!a.startsWith("/"))throw new Error(`Invalid path "${a}"`);function e(r){throw new Error(`ERR (${t})/"${o}": ${r}`)}let t=0,n=t;const s=[];let i;function c(){i&&s.push(i),i=[]}let h=0,u,o="",v="";function _(){o&&(t===0?i.push({type:0,value:o}):t===1||t===2||t===3?(i.length>1&&(u==="*"||u==="+")&&e(`A repeatable param (${o}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:o,regexp:v,repeatable:u==="*"||u==="+",optional:u==="*"||u==="?"})):e("Invalid state to consume buffer"),o="")}function y(){o+=u}for(;h<a.length;){if(u=a[h++],u==="\\"&&t!==2){n=t,t=4;continue}switch(t){case 0:u==="/"?(o&&_(),c()):u===":"?(_(),t=1):y();break;case 4:y(),t=n;break;case 1:u==="("?t=2:Ra.test(u)?y():(_(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&h--);break;case 2:u===")"?v[v.length-1]=="\\"?v=v.slice(0,-1)+u:t=3:v+=u;break;case 3:_(),t=0,u!=="*"&&u!=="?"&&u!=="+"&&h--,v="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${o}"`),_(),c(),s}function Oa(a,e,t){const n=Da(Ca(a.path),t),s=K(n,{record:a,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function Pa(a,e){const t=[],n=new Map;e=Lt({strict:!1,end:!0,sensitive:!1},e);function s(_){return n.get(_)}function i(_,y,r){const p=!r,d=St(_);d.aliasOf=r&&r.record;const m=Lt(e,_),l=[d];if("alias"in _){const w=typeof _.alias=="string"?[_.alias]:_.alias;for(const $ of w)l.push(St(K({},d,{components:r?r.record.components:d.components,path:$,aliasOf:r?r.record:d})))}let g,f;for(const w of l){const{path:$}=w;if(y&&$[0]!=="/"){const b=y.record.path,A=b[b.length-1]==="/"?"":"/";w.path=y.record.path+($&&A+$)}if(g=Oa(w,y,m),r?r.alias.push(g):(f=f||g,f!==g&&f.alias.push(g),p&&_.name&&!Dt(g)&&c(_.name)),en(g)&&u(g),d.children){const b=d.children;for(let A=0;A<b.length;A++)i(b[A],g,r&&r.children[A])}r=r||g}return f?()=>{c(f)}:Be}function c(_){if(Qt(_)){const y=n.get(_);y&&(n.delete(_),t.splice(t.indexOf(y),1),y.children.forEach(c),y.alias.forEach(c))}else{const y=t.indexOf(_);y>-1&&(t.splice(y,1),_.record.name&&n.delete(_.record.name),_.children.forEach(c),_.alias.forEach(c))}}function h(){return t}function u(_){const y=Ia(_,t);t.splice(y,0,_),_.record.name&&!Dt(_)&&n.set(_.record.name,_)}function o(_,y){let r,p={},d,m;if("name"in _&&_.name){if(r=n.get(_.name),!r)throw Ie(1,{location:_});m=r.record.name,p=K(xt(y.params,r.keys.filter(f=>!f.optional).concat(r.parent?r.parent.keys.filter(f=>f.optional):[]).map(f=>f.name)),_.params&&xt(_.params,r.keys.map(f=>f.name))),d=r.stringify(p)}else if(_.path!=null)d=_.path,r=t.find(f=>f.re.test(d)),r&&(p=r.parse(d),m=r.record.name);else{if(r=y.name?n.get(y.name):t.find(f=>f.re.test(y.path)),!r)throw Ie(1,{location:_,currentLocation:y});m=r.record.name,p=K({},y.params,_.params),d=r.stringify(p)}const l=[];let g=r;for(;g;)l.unshift(g.record),g=g.parent;return{name:m,path:d,params:p,matched:l,meta:Ma(l)}}a.forEach(_=>i(_));function v(){t.length=0,n.clear()}return{addRoute:i,resolve:o,removeRoute:c,clearRoutes:v,getRoutes:h,getRecordMatcher:s}}function xt(a,e){const t={};for(const n of e)n in a&&(t[n]=a[n]);return t}function St(a){const e={path:a.path,redirect:a.redirect,name:a.name,meta:a.meta||{},aliasOf:a.aliasOf,beforeEnter:a.beforeEnter,props:Aa(a),children:a.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in a?a.components||null:a.component&&{default:a.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function Aa(a){const e={},t=a.props||!1;if("component"in a)e.default=t;else for(const n in a.components)e[n]=typeof t=="object"?t[n]:t;return e}function Dt(a){for(;a;){if(a.record.aliasOf)return!0;a=a.parent}return!1}function Ma(a){return a.reduce((e,t)=>K(e,t.meta),{})}function Lt(a,e){const t={};for(const n in a)t[n]=n in e?e[n]:a[n];return t}function Ia(a,e){let t=0,n=e.length;for(;t!==n;){const i=t+n>>1;Zt(a,e[i])<0?n=i:t=i+1}const s=Ta(a);return s&&(n=e.lastIndexOf(s,n-1)),n}function Ta(a){let e=a;for(;e=e.parent;)if(en(e)&&Zt(a,e)===0)return e}function en({record:a}){return!!(a.name||a.components&&Object.keys(a.components).length||a.redirect)}function Ha(a){const e={};if(a===""||a==="?")return e;const n=(a[0]==="?"?a.slice(1):a).split("&");for(let s=0;s<n.length;++s){const i=n[s].replace(Ft," "),c=i.indexOf("="),h=Ue(c<0?i:i.slice(0,c)),u=c<0?null:Ue(i.slice(c+1));if(h in e){let o=e[h];ve(o)||(o=e[h]=[o]),o.push(u)}else e[h]=u}return e}function $t(a){let e="";for(let t in a){const n=a[t];if(t=aa(t),n==null){n!==void 0&&(e+=(e.length?"&":"")+t);continue}(ve(n)?n.map(i=>i&&st(i)):[n&&st(n)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function za(a){const e={};for(const t in a){const n=a[t];n!==void 0&&(e[t]=ve(n)?n.map(s=>s==null?null:""+s):n==null?n:""+n)}return e}const tn=Symbol(""),Rt=Symbol(""),Ke=Symbol(""),ct=Symbol(""),it=Symbol("");function Te(){let a=[];function e(n){return a.push(n),()=>{const s=a.indexOf(n);s>-1&&a.splice(s,1)}}function t(){a=[]}return{add:e,list:()=>a.slice(),reset:t}}function Na(a,e,t){const n=()=>{a[e].delete(t)};Re(n),_n(n),mn(()=>{a[e].add(t)}),a[e].add(t)}function Io(a){const e=Le(tn,{}).value;e&&Na(e,"updateGuards",a)}function De(a,e,t,n,s,i=c=>c()){const c=n&&(n.enterCallbacks[s]=n.enterCallbacks[s]||[]);return()=>new Promise((h,u)=>{const o=y=>{y===!1?u(Ie(4,{from:t,to:e})):y instanceof Error?u(y):Ea(y)?u(Ie(2,{from:e,to:y})):(c&&n.enterCallbacks[s]===c&&typeof y=="function"&&c.push(y),h())},v=i(()=>a.call(n&&n.instances[s],e,t,o));let _=Promise.resolve(v);a.length<3&&(_=_.then(o)),_.catch(y=>u(y))})}function tt(a,e,t,n,s=i=>i()){const i=[];for(const c of a)for(const h in c.components){let u=c.components[h];if(!(e!=="beforeRouteEnter"&&!c.instances[h]))if(Wt(u)){const v=(u.__vccOpts||u)[e];v&&i.push(De(v,t,n,c,h,s))}else{let o=u();i.push(()=>o.then(v=>{if(!v)throw new Error(`Couldn't resolve component "${h}" at "${c.path}"`);const _=qn(v)?v.default:v;c.mods[h]=v,c.components[h]=_;const r=(_.__vccOpts||_)[e];return r&&De(r,t,n,c,h,s)()}))}}return i}function Ct(a){const e=Le(Ke),t=Le(ct),n=ye(()=>{const u=Y(a.to);return e.resolve(u)}),s=ye(()=>{const{matched:u}=n.value,{length:o}=u,v=u[o-1],_=t.matched;if(!v||!_.length)return-1;const y=_.findIndex(Me.bind(null,v));if(y>-1)return y;const r=Ot(u[o-2]);return o>1&&Ot(v)===r&&_[_.length-1].path!==r?_.findIndex(Me.bind(null,u[o-2])):y}),i=ye(()=>s.value>-1&&ja(t.params,n.value.params)),c=ye(()=>s.value>-1&&s.value===t.matched.length-1&&Yt(t.params,n.value.params));function h(u={}){if(Wa(u)){const o=e[Y(a.replace)?"replace":"push"](Y(a.to)).catch(Be);return a.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>o),o}return Promise.resolve()}return{route:n,href:ye(()=>n.value.href),isActive:i,isExactActive:c,navigate:h}}function Ba(a){return a.length===1?a[0]:a}const Va=pe({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Ct,setup(a,{slots:e}){const t=vn(Ct(a)),{options:n}=Le(Ke),s=ye(()=>({[Pt(a.activeClass,n.linkActiveClass,"router-link-active")]:t.isActive,[Pt(a.exactActiveClass,n.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&Ba(e.default(t));return a.custom?i:Tt("a",{"aria-current":t.isExactActive?a.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),Ua=Va;function Wa(a){if(!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)&&!a.defaultPrevented&&!(a.button!==void 0&&a.button!==0)){if(a.currentTarget&&a.currentTarget.getAttribute){const e=a.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return a.preventDefault&&a.preventDefault(),!0}}function ja(a,e){for(const t in e){const n=e[t],s=a[t];if(typeof n=="string"){if(n!==s)return!1}else if(!ve(s)||s.length!==n.length||n.some((i,c)=>i!==s[c]))return!1}return!0}function Ot(a){return a?a.aliasOf?a.aliasOf.path:a.path:""}const Pt=(a,e,t)=>a??e??t,Fa=pe({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(a,{attrs:e,slots:t}){const n=Le(it),s=ye(()=>a.route||n.value),i=Le(Rt,0),c=ye(()=>{let o=Y(i);const{matched:v}=s.value;let _;for(;(_=v[o])&&!_.components;)o++;return o}),h=ye(()=>s.value.matched[c.value]);Xe(Rt,ye(()=>c.value+1)),Xe(tn,h),Xe(it,s);const u=j();return Ht(()=>[u.value,h.value,a.name],([o,v,_],[y,r,p])=>{v&&(v.instances[_]=o,r&&r!==v&&o&&o===y&&(v.leaveGuards.size||(v.leaveGuards=r.leaveGuards),v.updateGuards.size||(v.updateGuards=r.updateGuards))),o&&v&&(!r||!Me(v,r)||!y)&&(v.enterCallbacks[_]||[]).forEach(d=>d(o))},{flush:"post"}),()=>{const o=s.value,v=a.name,_=h.value,y=_&&_.components[v];if(!y)return At(t.default,{Component:y,route:o});const r=_.props[v],p=r?r===!0?o.params:typeof r=="function"?r(o):r:null,m=Tt(y,K({},p,e,{onVnodeUnmounted:l=>{l.component.isUnmounted&&(_.instances[v]=null)},ref:u}));return At(t.default,{Component:m,route:o})||m}}});function At(a,e){if(!a)return null;const t=a(e);return t.length===1?t[0]:t}const qa=Fa;function Ga(a){const e=Pa(a.routes,a),t=a.parseQuery||Ha,n=a.stringifyQuery||$t,s=a.history,i=Te(),c=Te(),h=Te(),u=fn(xe);let o=xe;Pe&&a.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const v=Ze.bind(null,k=>""+k),_=Ze.bind(null,oa),y=Ze.bind(null,Ue);function r(k,C){let x,I;return Qt(k)?(x=e.getRecordMatcher(k),I=C):I=k,e.addRoute(I,x)}function p(k){const C=e.getRecordMatcher(k);C&&e.removeRoute(C)}function d(){return e.getRoutes().map(k=>k.record)}function m(k){return!!e.getRecordMatcher(k)}function l(k,C){if(C=K({},C||u.value),typeof k=="string"){const O=et(t,k,C.path),U=e.resolve({path:O.path},C),re=s.createHref(O.fullPath);return K(O,U,{params:y(U.params),hash:Ue(O.hash),redirectedFrom:void 0,href:re})}let x;if(k.path!=null)x=K({},k,{path:et(t,k.path,C.path).path});else{const O=K({},k.params);for(const U in O)O[U]==null&&delete O[U];x=K({},k,{params:_(O)}),C.params=_(C.params)}const I=e.resolve(x,C),G=k.hash||"";I.params=v(y(I.params));const W=la(n,K({},k,{hash:na(G),path:I.path})),V=s.createHref(W);return K({fullPath:W,hash:G,query:n===$t?za(k.query):k.query||{}},I,{redirectedFrom:void 0,href:V})}function g(k){return typeof k=="string"?et(t,k,u.value.path):K({},k)}function f(k,C){if(o!==k)return Ie(8,{from:C,to:k})}function w(k){return A(k)}function $(k){return w(K(g(k),{replace:!0}))}function b(k){const C=k.matched[k.matched.length-1];if(C&&C.redirect){const{redirect:x}=C;let I=typeof x=="function"?x(k):x;return typeof I=="string"&&(I=I.includes("?")||I.includes("#")?I=g(I):{path:I},I.params={}),K({query:k.query,hash:k.hash,params:I.path!=null?{}:k.params},I)}}function A(k,C){const x=o=l(k),I=u.value,G=k.state,W=k.force,V=k.replace===!0,O=b(x);if(O)return A(K(g(O),{state:typeof O=="object"?K({},G,O.state):G,force:W,replace:V}),C||x);const U=x;U.redirectedFrom=C;let re;return!W&&ca(n,I,x)&&(re=Ie(16,{to:U,from:I}),z(I,I,!0,!1)),(re?Promise.resolve(re):H(U,I)).catch(ue=>be(ue)?be(ue,2)?ue:E(ue):Ce(ue,U,I)).then(ue=>{if(ue){if(be(ue,2))return A(K({replace:V},g(ue.to),{state:typeof ue.to=="object"?K({},G,ue.to.state):G,force:W}),C||U)}else ue=te(U,I,!0,V,G);return Z(U,I,ue),ue})}function S(k,C){const x=f(k,C);return x?Promise.reject(x):Promise.resolve()}function T(k){const C=Q.values().next().value;return C&&typeof C.runWithContext=="function"?C.runWithContext(k):k()}function H(k,C){let x;const[I,G,W]=Ka(k,C);x=tt(I.reverse(),"beforeRouteLeave",k,C);for(const O of I)O.leaveGuards.forEach(U=>{x.push(De(U,k,C))});const V=S.bind(null,k,C);return x.push(V),J(x).then(()=>{x=[];for(const O of i.list())x.push(De(O,k,C));return x.push(V),J(x)}).then(()=>{x=tt(G,"beforeRouteUpdate",k,C);for(const O of G)O.updateGuards.forEach(U=>{x.push(De(U,k,C))});return x.push(V),J(x)}).then(()=>{x=[];for(const O of W)if(O.beforeEnter)if(ve(O.beforeEnter))for(const U of O.beforeEnter)x.push(De(U,k,C));else x.push(De(O.beforeEnter,k,C));return x.push(V),J(x)}).then(()=>(k.matched.forEach(O=>O.enterCallbacks={}),x=tt(W,"beforeRouteEnter",k,C,T),x.push(V),J(x))).then(()=>{x=[];for(const O of c.list())x.push(De(O,k,C));return x.push(V),J(x)}).catch(O=>be(O,8)?O:Promise.reject(O))}function Z(k,C,x){h.list().forEach(I=>T(()=>I(k,C,x)))}function te(k,C,x,I,G){const W=f(k,C);if(W)return W;const V=C===xe,O=Pe?history.state:{};x&&(I||V?s.replace(k.fullPath,K({scroll:V&&O&&O.scroll},G)):s.push(k.fullPath,G)),u.value=k,z(k,C,x,V),E()}let le;function _e(){le||(le=s.listen((k,C,x)=>{if(!ie.listening)return;const I=l(k),G=b(I);if(G){A(K(G,{replace:!0,force:!0}),I).catch(Be);return}o=I;const W=u.value;Pe&&va(gt(W.fullPath,x.delta),Ge()),H(I,W).catch(V=>be(V,12)?V:be(V,2)?(A(K(g(V.to),{force:!0}),I).then(O=>{be(O,20)&&!x.delta&&x.type===We.pop&&s.go(-1,!1)}).catch(Be),Promise.reject()):(x.delta&&s.go(-x.delta,!1),Ce(V,I,W))).then(V=>{V=V||te(I,W,!1),V&&(x.delta&&!be(V,8)?s.go(-x.delta,!1):x.type===We.pop&&be(V,20)&&s.go(-1,!1)),Z(I,W,V)}).catch(Be)}))}let we=Te(),Fe=Te(),me;function Ce(k,C,x){E(k);const I=Fe.list();return I.length?I.forEach(G=>G(k,C,x)):console.error(k),Promise.reject(k)}function R(){return me&&u.value!==xe?Promise.resolve():new Promise((k,C)=>{we.add([k,C])})}function E(k){return me||(me=!k,_e(),we.list().forEach(([C,x])=>k?x(k):C()),we.reset()),k}function z(k,C,x,I){const{scrollBehavior:G}=a;if(!Pe||!G)return Promise.resolve();const W=!x&&ya(gt(k.fullPath,0))||(I||!x)&&history.state&&history.state.scroll||null;return pn().then(()=>G(k,C,W)).then(V=>V&&ma(V)).catch(V=>Ce(V,k,C))}const B=k=>s.go(k);let M;const Q=new Set,ie={currentRoute:u,listening:!0,addRoute:r,removeRoute:p,clearRoutes:e.clearRoutes,hasRoute:m,getRoutes:d,resolve:l,options:a,push:w,replace:$,go:B,back:()=>B(-1),forward:()=>B(1),beforeEach:i.add,beforeResolve:c.add,afterEach:h.add,onError:Fe.add,isReady:R,install(k){const C=this;k.component("RouterLink",Ua),k.component("RouterView",qa),k.config.globalProperties.$router=C,Object.defineProperty(k.config.globalProperties,"$route",{enumerable:!0,get:()=>Y(u)}),Pe&&!M&&u.value===xe&&(M=!0,w(s.location).catch(G=>{}));const x={};for(const G in xe)Object.defineProperty(x,G,{get:()=>u.value[G],enumerable:!0});k.provide(Ke,C),k.provide(ct,hn(x)),k.provide(it,u);const I=k.unmount;Q.add(k),k.unmount=function(){Q.delete(k),Q.size<1&&(o=xe,le&&le(),le=null,u.value=xe,M=!1,me=!1),I()}}};function J(k){return k.reduce((C,x)=>C.then(()=>T(x)),Promise.resolve())}return ie}function Ka(a,e){const t=[],n=[],s=[],i=Math.max(e.matched.length,a.matched.length);for(let c=0;c<i;c++){const h=e.matched[c];h&&(a.matched.find(o=>Me(o,h))?n.push(h):t.push(h));const u=a.matched[c];u&&(e.matched.find(o=>Me(o,u))||s.push(u))}return[t,n,s]}function Ya(){return Le(Ke)}function Xa(a){return Le(ct)}const nn=[{path:"/",name:"Directory",component:()=>Ee(()=>import("./FileView_N-H4xLkUSB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]),import.meta.url),meta:{icon:"sysIcon_folderopen",deny_user:!1,deny_guest:!1}},{path:"/favourite",name:"Favourite",component:()=>Ee(()=>import("./Favourite-CpGSoyb6.js"),__vite__mapDeps([10,2,3,5,4,6,7,8,11]),import.meta.url),meta:{icon:"sysIcon_star-o",deny_user:!1,deny_guest:!0}},{path:"/recycle",name:"Recycle",component:()=>Ee(()=>import("./FileView_R-CDi8d82d.js"),__vite__mapDeps([12,1,2,3,4,5,6,7,8,9]),import.meta.url),meta:{icon:"sysIcon_delete",deny_user:!1,deny_guest:!0}},{path:"/tag",name:"Tag",component:()=>Ee(()=>import("./TagView-Br2YFzA4.js"),__vite__mapDeps([13,2,3,5,6,7,14]),import.meta.url),meta:{icon:"sysIcon_tagso",deny_user:!1,deny_guest:!0}},{path:"/shares",name:"Share",component:()=>Ee(()=>import("./ShareView-OlBoNzxG.js"),__vite__mapDeps([15,2,3,16]),import.meta.url),meta:{icon:"sysIcon_export",deny_user:!1,deny_guest:!0}},{path:"/group",name:"User",component:()=>Ee(()=>import("./UserView-CJQI27_N.js"),__vite__mapDeps([17,2,3,5,6,7,18]),import.meta.url),meta:{icon:"sysIcon_team",deny_user:!0,deny_guest:!0}},{path:"/log",name:"ProcessLog",component:()=>Ee(()=>import("./LogView-DwLa1FPl.js"),__vite__mapDeps([19,2,3,20]),import.meta.url),meta:{icon:"sysIcon_filetext",deny_user:!0,deny_guest:!0}},{path:"/setting",name:"Setting",component:()=>Ee(()=>import("./SettingView-BQRAIId0.js"),__vite__mapDeps([21,2,3,5,22]),import.meta.url),meta:{icon:"sysIcon_setting",deny_user:!0,deny_guest:!0}}],Qa=Ga({history:ka("./"),routes:nn}),Ja=["onClick"],Za={class:"content"},es=pe({__name:"NaviContent",props:{depth:{},records:{}},setup(a){const e=a;e.depth&&e.depth;const t=e.records,n=Ya(),s=Xa();async function i(h){console.info("go",h);const u=await n.push(h.path);console.info(u)}const c=je();return(h,u)=>(D(!0),L(q,null,oe(Y(t),(o,v)=>{var _,y,r,p,d,m;return D(),L(q,{key:v},[(_=o.meta)!=null&&_.hide?(D(),L(q,{key:0},[],64)):(y=o.meta)!=null&&y.deny_guest&&((r=Y(c))==null?void 0:r.group.title)=="guest"?(D(),L(q,{key:1},[],64)):(p=o.meta)!=null&&p.deny_user&&!((d=Y(c))!=null&&d.group.admin)?(D(),L(q,{key:2},[],64)):(D(),L("p",{key:3,onClick:l=>i(o),class:de({title:!0,active:o.path===Y(s).path})},[P("span",{class:de(["icon","sysIcon",(m=o.meta)==null?void 0:m.icon])},null,2),P("span",Za,ae(o.name),1)],10,Ja))],64)}),128))}}),ts=pe({__name:"Navi",setup(a){return(e,t)=>(D(),L("div",{class:de(["fr_navi",{folded:!1}])},[Oe(es,{records:Y(nn),depth:1},null,8,["records"])]))}});let rt=null;function an(a){rt=a}function ns(a,e){rt&&rt(a,e)}const as=Object.freeze(Object.defineProperty({__proto__:null,register:an,trigger:ns},Symbol.toStringTag,{value:"Module"}));var sn={};Object.defineProperty(sn,"__esModule",{value:!0});function ss(a){a===void 0&&(a={});var e=/^0/,t=/\s+/g,n=/^\s+|\s+$/g,s=/[^\x00-\x80]/,i=/^0x[0-9a-f]+$/i,c=/(0x[\da-fA-F]+|(^[\+\-]?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?(?=\D|\s|$))|\d+)/g,h=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,u=String.prototype.toLocaleLowerCase||String.prototype.toLowerCase,o=a.desc?-1:1,v=-o,_=a.insensitive?function(p){return u.call(""+p).replace(n,"")}:function(p){return(""+p).replace(n,"")};function y(p){return p.replace(c,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0")}function r(p,d){return(!p.match(e)||d===1)&&parseFloat(p)||p.replace(t," ").replace(n,"")||0}return function(p,d){var m=_(p),l=_(d);if(!m&&!l)return 0;if(!m&&l)return v;if(m&&!l)return o;var g=y(m),f=y(l),w=m.match(i),$=l.match(i),b=w&&$?parseInt(w[0],16):g.length!==1&&Date.parse(m),A=w&&$?parseInt($[0],16):b&&l.match(h)&&Date.parse(l)||null;if(A){if(b===A)return 0;if(b<A)return v;if(b>A)return o}for(var S=g.length,T=f.length,H=0,Z=Math.max(S,T);H<Z;H+=1){var te=r(g[H]||"",S),le=r(f[H]||"",T);if(isNaN(te)!==isNaN(le))return isNaN(te)?o:v;if(s.test(te+le)&&te.localeCompare){var _e=te.localeCompare(le);if(_e>0)return o;if(_e<0)return v;if(H===Z-1)return 0}if(te<le)return v;if(te>le)return o;if(""+te<""+le)return v;if(""+te>""+le)return o}return 0}}var os=sn.default=ss;let N;class To{constructor(e){se(this,"nodeList",j([]));se(this,"getList");se(this,"route");se(this,"router");se(this,"contentDOM");se(this,"emitGo");se(this,"modal");se(this,"context");se(this,"mode",j(""));se(this,"modeKey","");se(this,"sortVal",j(""));se(this,"selecting",!1);se(this,"selectingMovEvtCount",0);se(this,"selectingOffset",[[0,0],[0,0]]);se(this,"preSelectedNodeIndexSet",new Set);se(this,"selectingKeyDef","");se(this,"showSelectionOp",j(!1));se(this,"lastSelectIndex",-1);se(this,"reloadOffset_timer",0);se(this,"reloadOffset_count",0);se(this,"startScroll",!1);this.contentDOM=e.contentDOM,this.getList=e.getList,this.route=e.route,this.router=e.router,this.emitGo=e.emitGo,this.modal=yn,this.context=as,this.mode.value=fe("file_view_mode")??"detail",this.modeKey=gn("file_view_mode",t=>this.mode.value=t),this.sortVal=j(fe("file_view_sort")??"name_asc"),this.contextMenuEvt=this.contextMenuEvt.bind(this),this.mouseDownEvt=this.mouseDownEvt.bind(this),this.mouseMoveEvt=this.mouseMoveEvt.bind(this),this.mouseUpEvt=this.mouseUpEvt.bind(this),this.keymap=this.keymap.bind(this),this.reloadOffset=this.reloadOffset.bind(this),this.scrollEvt=this.scrollEvt.bind(this),addEventListener("contextmenu",this.contextMenuEvt),addEventListener("pointerdown",this.mouseDownEvt),addEventListener("pointermove",this.mouseMoveEvt),addEventListener("pointerup",this.mouseUpEvt),addEventListener("keydown",this.keymap),addEventListener("resize",this.reloadOffset),this.contentDOM.addEventListener("scroll",this.scrollEvt),N=this}destructor(){console.info("destructor loaded"),wn("file_view_mode",this.modeKey),removeEventListener("contextmenu",this.contextMenuEvt),removeEventListener("pointerdown",this.mouseDownEvt),removeEventListener("pointermove",this.mouseMoveEvt),removeEventListener("pointerup",this.mouseUpEvt),removeEventListener("keydown",this.keymap),removeEventListener("resize",this.reloadOffset),this.contentDOM&&this.contentDOM.removeEventListener("scroll",this.scrollEvt),N=null}setList(e){this.nodeList.value=e,setTimeout(()=>{this.reloadOffset(void 0)},ne.timeouts.offsetDebounce)}deleteFromList(e){const t=[],n=new Set;e.forEach(s=>n.add(s)),this.nodeList.value.forEach(s=>{n.has(s.id??0)||t.push(s)}),this.getList(t)}inDetailView(e){let t=!1,n=e.target;for(;n;){if(n.contentEditable==="true"){t=!1;break}if(n.classList.contains("rater")){t=!1;break}if(n.classList.contains("list_fav")){t=!0;break}if(n.classList.contains("view_fav")){t=!1;break}if(n.classList.contains("content_meta")){t=!1;break}if(n.classList.contains("fr_content")){t=!0;break}if(!n.parentElement)break;n=n.parentElement}return t}inTaggingDOM(e){let t=!1,n=e.target;for(;n;){if(n.classList.contains("content_detail"))return!1;if(n.classList.contains("tag_list")){t=!0;break}if(!n.parentElement)break;n=n.parentElement}return t}mouseDownEvt(e){var c,h,u,o;if(!this.inDetailView(e)||e.button===1)return;if(this.selectingOffset[0]=[e.x+(((c=this.contentDOM)==null?void 0:c.scrollLeft)??0),e.y+(((h=this.contentDOM)==null?void 0:h.scrollTop)??0)],this.selectingOffset[1]=[e.x+(((u=this.contentDOM)==null?void 0:u.scrollLeft)??0),e.y+(((o=this.contentDOM)==null?void 0:o.scrollTop)??0)],this.preSelectedNodeIndexSet.clear(),e.preventDefault(),e.button!==0)return this.rightMouseDownEvt(e);this.nodeList.value.forEach((v,_)=>{v._selected&&this.preSelectedNodeIndexSet.add(_)}),this.selecting=!0,this.selectingMovEvtCount=0;const t=this.getSelection(this.selectingOffset),n=[];e.ctrlKey&&n.push("ctrl"),e.shiftKey&&n.push("shift"),this.selectingKeyDef=n.join("_");let s=-1;const i=Array.from(t);switch(i.length&&(s=i.pop()??-1),this.selectingKeyDef){case"shift":this.preSelectedNodeIndexSet.clear();case"ctrl_shift":if(s==-1||this.lastSelectIndex==-1)break;const v=Math.min(s,this.lastSelectIndex),_=Math.max(s,this.lastSelectIndex);for(let y=v;y<=_;y++)t.has(y)||this.preSelectedNodeIndexSet.add(y);break;default:this.preSelectedNodeIndexSet.clear();break;case"ctrl":break}this.nodeList.value.forEach((v,_)=>{let y=0;this.preSelectedNodeIndexSet.has(_)&&(y+=1),t.has(_)&&(y+=1),v._selected=y===1}),this.lastSelectIndex=s,this.showSelectionOp.value=this.preSelectedNodeIndexSet.size+t.size>0}rightMouseDownEvt(e){const t=this.getSelection(this.selectingOffset);let n=!1;const s=new Set;this.nodeList.value.forEach((i,c)=>{i._selected&&(s.add(c),t.has(c)&&(n=!0))}),n?this.preSelectedNodeIndexSet=s:this.preSelectedNodeIndexSet=t,this.nodeList.value.forEach((i,c)=>{i._selected=this.preSelectedNodeIndexSet.has(c)})}mouseMoveEvt(e){var s,i;if(!this.selecting||(this.selectingMovEvtCount+=1,this.selectingMovEvtCount<10))return;e.preventDefault(),this.selectingOffset[1]=[e.x+(((s=this.contentDOM)==null?void 0:s.scrollLeft)??0),e.y+(((i=this.contentDOM)==null?void 0:i.scrollTop)??0)];const t=this.getSelection(this.selectingOffset);this.nodeList.value.forEach((c,h)=>{let u=0;this.preSelectedNodeIndexSet.has(h)&&(u+=1),t.has(h)&&(u+=1),c._selected=u===1});const n=this.getSelection([this.selectingOffset[1],this.selectingOffset[1]]);n.size&&(this.lastSelectIndex=Array.from(n).pop()??-1),this.showSelectionOp.value=this.preSelectedNodeIndexSet.size+t.size>0}mouseUpEvt(e){this.selecting&&(e.preventDefault(),setTimeout(()=>{this.selecting=!1,this.selectingMovEvtCount=0,this.selectingOffset=[[0,0],[0,0]],this.preSelectedNodeIndexSet.clear(),this.selectingKeyDef=""},ne.timeouts.selectEvt))}async contextMenuEvt(e){if(!this.inDetailView(e))return;let t=this.route.name==="Recycle",n=this.getSelected();if(!n.nodeLs||!n.nodeLs.length)return;let s=n.nodeLs.length!==1;const i=n.nodeLs,c=n.idSet;let h=fe("file_view_mode")??"detail";this.route.name!=="Directory"&&(h="detail");let u=h==="detail";this.route.name==="Recycle"&&(u=!1),e.preventDefault(),e.stopPropagation(),this.context.trigger([{title:"Open",auth:"guest",method:async o=>{console.info("Open",o),s?await F.op_bath_browser(c,i):this.emitGo("node",i[0].id)}},{title:"Open New Tab",auth:"guest",method:async o=>{var y;console.info("Open",o,this.route,this.router);let v=null;s||i.length&&i[0].type==="directory"&&(v=i[0]),he.copyObject(this.route.query);const _=new URL(location.href);v&&_.searchParams.set("id_dir",`${v.id??0}`),(y=window.open(_,"_blank"))==null||y.focus()}},{title:"Download",auth:s||i[0].type=="directory"?"none":"guest",method:o=>{var p,d;console.info("Download",o);const v=i[0];let _=(d=(p=v.file_index)==null?void 0:p.raw)==null?void 0:d.path,y=(v==null?void 0:v.title)??"";if(!_)return;let r=document.createElement("a");r.style.display="none",r.href=_+"?filename="+y,r.target="_blank",r.setAttribute("download",y),r.click()}},{title:"Download Selected",auth:s||i[0].type=="directory"?"guest":"none",method:async o=>{if(console.info("DownloadSelected",o),console.info(this,i),!N||!N.modal)return;const v=Mt("",i),_=new bn(v,async p=>{const d=await X("file/get",Object.assign({mode:"directory",cascade_dir:"0",id_dir:p.id.toString(),with:"file"}));return d?Mt(p.path,d.list):[]}),y=j("downloading 0/0 (0%)"),r=N.modal.set({title:_.title,alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:y});await _.prepare(),await _.download((p,d,m,l,g)=>{const f=p+d,w=Math.round(1e4*f/m)/100+"%";r.content.text.value=`downloading ${f}/${m} (${w})`}),await _.build(),await _.complete(),N.modal.close(r.nid)}},{title:"Rename",auth:u?"user":"none",method:async o=>{console.info("Rename",o),s?await F.op_bath_rename(c,i):await F.op_rename(i[0])}},{title:"Move",auth:u?"user":"none",method:async o=>{console.info("Move",o),s?await F.op_bath_move(c,i):await F.op_move(i[0])}},{title:"Delete",auth:t?"none":"user",method:async o=>{console.info("Delete",o),s?await F.op_bath_delete(c,i):await F.op_delete(i[0])}},{title:"Recover",auth:t?"user":"none",method:async o=>{console.info("Recover",o),s?await F.op_bath_delete(c,i,!0):await F.op_delete(i[0],!0)}},{title:"Delete Forever",auth:t?"user":"none",method:async o=>{console.info("Delete Forever",o),s?await F.op_bath_delete_forever(c,i):await F.op_delete_forever(i[0])}},{title:"Favourite",auth:u?"user":"none",method:async o=>{console.info("Favourite",o),s?await F.op_bath_favourite(c,i):await F.op_toggle_favourite(i[0])}},{title:"Share",auth:"user",method:async o=>{console.info("Share",o),await F.op_share(c)}},{title:"Extra",auth:"guest",method:o=>{console.info("Extra",o)},child:[{title:"Tagging",auth:u?"user":"none",method:async o=>{console.info("Tagging",o),i.forEach(v=>{F.op_tag(v)})}},{title:"Set Cover",auth:s?"none":"user",method:async o=>{console.info("Set Cover",o),await F.op_set_cover(i[0])}},{title:"Import EHT",auth:"admin",method:async o=>{console.info("Import EHT",o),await F.op_imp_tag_eh(Array.from(c))}},{title:"Cascade Tag",auth:"user",method:async o=>{console.info("Cascade Tag",o),await F.op_cascade_tag(Array.from(c))}}]},{title:"Admin",auth:"admin",method:o=>{console.info("Extra",o)},child:[{title:"ReBuild",auth:"admin",method:async o=>{console.info("ReBuild",o),await F.op_rebuild(Array.from(c))}},{title:"ReHash",auth:s?"none":"admin",method:async o=>{console.info("ReHash",o),await F.op_rehash(Array.from(c))}},{title:"RM RAW",auth:"admin",method:async o=>{console.info("RMRAW",o),await F.op_rm_raw(Array.from(c))}}]}],e)}getSelection(e){let t=e[0][0]>e[1][0]?e[1][0]:e[0][0],n=e[0][1]>e[1][1]?e[1][1]:e[0][1],s=e[0][0]<e[1][0]?e[1][0]:e[0][0],i=e[0][1]<e[1][1]?e[1][1]:e[0][1];const c=new Set;return this.nodeList.value.forEach((h,u)=>{if(!h._offsets)return;let o=h==null?void 0:h._offsets[0],v=h==null?void 0:h._offsets[1],_=h==null?void 0:h._offsets[2],y=h==null?void 0:h._offsets[3],r=o>=t&&o<=s||_>=t&&_<=s||o<=s&&_>=t,p=v>=n&&v<=i||y>=n&&y<=i||v<=i&&y>=n;!r||!p||c.add(u)}),c}clearSelect(e){e.target.classList.contains("content_detail")&&(this.nodeList.value.forEach(t=>{t._selected=!1}),this.showSelectionOp.value=!1)}async bathOp(e){let{idSet:t,nodeLs:n}=this.getSelected();if(t.size)switch(e){case"rename":await F.op_bath_rename(t,n);break;case"move":await F.op_bath_move(t,n);break;case"delete":await F.op_bath_delete(t,n);break;case"delete_forever":await F.op_bath_delete_forever(t,n);break;case"browser":await F.op_bath_browser(t,n);break;case"favourite":await F.op_bath_favourite(t,n);break}}getSelected(){const e=[],t=new Set;return this.nodeList.value.forEach(n=>{n._selected&&(e.push(n),t.add((n==null?void 0:n.id)??0))}),{nodeLs:e,idSet:t}}arrowSelection(e){if(!this.nodeList.value.length)return;let t=this.lastSelectIndex;if(t===-1){const o=this.getSelected();o.idSet.size?t=Array.from(o.idSet).pop()??0:t=0}fe("file_view_mode"),this.route.name;const n=this.nodeList.value[t];if(!n)return;n._offsets||(n._offsets=[]);const s=n._offsets[2]-n._offsets[0],i=this.contentDOM.offsetWidth,c=Math.floor(i/s);let h=t;switch(e.key){case"ArrowRight":h+=1;break;case"ArrowLeft":h-=1;break;case"ArrowUp":h-=1*c;break;case"ArrowDown":h+=1*c;break}let u=!1;(e.ctrlKey||e.shiftKey)&&(u=!0),h<0&&(h=0),h>this.nodeList.value.length-1&&(h=this.nodeList.value.length-1),this.lastSelectIndex=h,this.nodeList.value.forEach((o,v)=>{if(h===v)return o._selected=!0;o._selected&&!u&&(o._selected=!1)})}setMode(e){ke("file_view_mode",e),this.setList(this.nodeList.value)}setSort(e){console.info("setSort",e),ke("file_view_sort",e);const t=this.nodeList.value;this.nodeList.value=[],setTimeout(()=>{this.nodeList.value=this.sortList(t,this.sortVal.value),this.setList(this.nodeList.value)},ne.timeouts.sort)}sortList(e,t){return e=on(e,t),e}async keymap(e){let t;const n=e.target;switch(e.key){case"F2":if(He(n)||ze(n)||this.mode.value!="detail")return;t=this.getSelected(),t.nodeLs.length!==1?await F.op_bath_rename(t.idSet,t.nodeLs):await F.op_rename(t.nodeLs[0]);break;case"Delete":if(He(n)||ze(n))return;t=this.getSelected(),this.route.name==="Recycle"?await F.op_bath_delete_forever(t.idSet,t.nodeLs):await F.op_bath_delete(t.idSet,t.nodeLs);break;case"NumpadEnter":case"Enter":if(He(n)||ze(n)||(t=this.getSelected(),!t.idSet.size))return;if(console.info(t.idSet.size),e.altKey&&t.idSet.size==1)return this.emitGo("node",Array.from(t.idSet)[0]);await F.op_bath_browser(t.idSet,t.nodeLs);break;case"ArrowRight":case"ArrowLeft":case"ArrowUp":case"ArrowDown":return He(n)||ze(n)?void 0:this.arrowSelection(e)}}reloadOffset(e){if(this.reloadOffset_count>100)return;let t=!0;if(this.nodeList.value.forEach(n=>{n._dom||(t=!1)}),clearTimeout(this.reloadOffset_timer),!t){this.reloadOffset_timer=setTimeout(()=>{this.reloadOffset_count+=1,this.reloadOffset(e)},ne.timeouts.offsetDebounce);return}this.nodeList.value.forEach(n=>{if(!n._dom)return;const s=n._dom;let i=0,c=0,h=0,u=0;i=he.nodeOffsetX(s),c=he.nodeOffsetY(s),h=i+s.offsetWidth,u=c+s.offsetHeight,n._offsets=[i,c,h,u]}),this.scrollEvt(e)}go(e){const t=Object.assign({id_dir:"",id_tag:""},e);this.router.push({path:"/",query:t})}scrollEvt(e){he.debounce(()=>{this.saveScroll(),this.reloadLazyLoad()},ne.timeouts.scrollEvt,"debounce_scroll_view")}saveScroll(){const e=this.route.query??{},t=[this.route.path,e.mode?e.mode:"",e.pid?e.pid:"",e.id?e.id:"",e.id?e.id:"",e.tag_id?e.tag_id:""].join(":"),n=[this.contentDOM.scrollTop,this.contentDOM.scrollLeft];!n[0]&&!n[1]||he.debounce(()=>{kn("scroll_log",t,n)},ne.timeouts.scrollSave,"debounce_scroll_save")}async reloadScroll(){const e=this.route.query??{},t=[this.route.path,e.mode?e.mode:"",e.pid?e.pid:"",e.id?e.id:"",e.id?e.id:"",e.tag_id?e.tag_id:""].join(":"),n=await En("scroll_log",t);n&&(this.contentDOM.scrollTop=n[0]??0,this.contentDOM.scrollLeft=n[1]??0)}reloadLazyLoad(){if(!this.contentDOM)return;const e=this.contentDOM,t=he.nodeOffsetY(e),n=e.scrollTop+t,s=n+e.clientHeight+t;this.nodeList.value.forEach(i=>{let c=!0;if(!i._offsets||!i._offsets.length)return;let h=i._offsets;h[1]>s&&(c=!1),h[3]<n&&(c=!1),i._in_screen=c})}}class F{static async op_download(e){var n,s;let t=(s=(n=e.file_index)==null?void 0:n.raw)==null?void 0:s.path;t&&window.open(`${t}?filename=${e.title}`)}static async op_rename(e){if(e._renaming){const t=new FormData;t.set("id",`${e.id}`),t.set("title",e.title??""),t.set("description",e.description??""),await X("file/mod",t),N&&N.emitGo("reload")}e._renaming=!e._renaming,setTimeout(()=>{let t=document.body.querySelector('[contenteditable="true"]');t&&t.focus()},50)}static async op_bath_rename(e,t){N&&N.modal.set({title:"bath rename",alpha:!1,key:"",single:!1,w:400,h:275,minW:400,minH:275,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"renameUtil",data:{node_list:t,callback:()=>{N&&N.getList()}}}]})}static async op_move(e){N&&N.modal.set({title:`locator | move ${e.title} to:`,alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async t=>{const n=new FormData;n.set("id_node",`${e.id}`),n.set("id_target",`${t.id}`),await X("file/mov",n),N&&N.emitGo("reload")}}}]})}static async op_bath_move(e,t){N&&N.modal.set({title:`locator | move ${e.size} files to:`,alpha:!1,key:"",single:!1,w:400,h:60,minW:400,minH:60,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,component:[{componentName:"locator",data:{query:{type:"directory"},call:async n=>{const s={id_list:Array.from(e).join(","),id_parent:`${n.id}`},i=await X("file/bath_move",s);N&&N.getList()}}}]})}static async op_delete(e,t=!1){const n=new FormData;n.set("id",`${e.id}`);const s=await X("file/delete",n);return console.info(N),N&&e.id&&N.deleteFromList([e.id]),s}static async op_bath_delete(e,t,n=!1,s){N&&N.modal.set({title:`confirm to ${n?"recover":"delete"} ${e.size} files`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:"conform to "+(n?"recover":"delete"),callback:{confirm:async i=>{const c=Array.from(e),h={id_list:c.join(",")},u=await X("file/bath_delete",h);N&&N.deleteFromList(c),s&&s()}}})}static async op_delete_forever(e){const t=new FormData;t.set("id",`${e.id}`);const n=await X("file/delete_forever",t);return N&&e.id&&N.deleteFromList([e.id]),n}static async op_bath_delete_forever(e,t){N&&N.modal.set({title:`confirm to delete ${e.size} files forever`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:"conform to delete forever",callback:{confirm:async n=>{const s=Array.from(e),i={id_list:s.join(",")},c=await X("file/bath_delete_forever",i);N&&N.deleteFromList(s)}}})}static async op_toggle_favourite(e){const t=await X("favourite_group/get",{}),n={};t&&t.forEach(s=>{s.auto||(n[s.id??0]=s.title??"")}),N&&N.modal.set({title:"select fav group:",alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"checkbox",label:"attach to",key:"target_group",value:e.list_fav,options:n}],callback:{submit:async function(s){const c=s.content.form[0].value.join(",");await X("favourite/attach",{id_node:e.id,list_group:c}),location.reload()}}})}static async op_bath_favourite(e,t){const n=await X("favourite_group/get",{}),s={};n&&n.forEach(i=>{i.auto||(s[i.id??0]=i.title??"")}),N&&N.modal.set({title:"select fav group:",alpha:!1,key:"",single:!1,w:400,h:150,minW:400,minH:150,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"checkbox",label:"attach to:",key:"target_group",value:[],options:s}],callback:{submit:async function(i){const c=i.content.form[0].value.join(",");await X("favourite/bath_attach",{node_id_list:Array.from(e),list_group:c})}}})}static async op_bath_browser(e,t){let n=Array.from(e),s={};s.with="crumb,file",n.length==1?(s.mode="directory",s.id_dir=`${t[0].type==="directory"?t[0].id:t[0].id_parent}`):(s.mode="id_iterate",s.keyword=n.join(",")),s.cascade_dir="0",is(s,n[0])}static async op_tag(e){if(e._tagging){const t=new Set;if(e.tag)for(let s=0;s<e.tag.length;s++)for(let i=0;i<e.tag[s].sub.length;i++){const c=e.tag[s].sub[i].id;c&&t.add(c)}const n=new FormData;n.set("id_node",`${e.id}`),n.set("tag_list",Array.from(t).join(",")),await X("tag/attach",n)}e._tagging=!e._tagging}static async op_set_cover(e){const t=new FormData;return t.set("id",`${e.id}`),await X("file/cover",t)}static async op_rebuild(e){const t=new FormData;return t.set("id_list",e.join(",")),await X("file/rebuild",t)}static async op_rehash(e){const t=new FormData;return t.set("id_list",e.join(",")),await X("file/rehash",t)}static async op_cascade_tag(e){const t=new FormData;return t.set("id_list",e.join(",")),await X("file/cascade_tag",t)}static async op_rm_raw(e){const t=new FormData;return t.set("id_list",e.join(",")),await X("file/rm_raw",t)}static async op_imp_tag_eh(e){const t=new FormData;return t.set("id_list",e.join(",")),await X("setting/import_eht_tag",t)}static async op_rate(e,t){if(!N)return;let n=N.getSelected();t&&!n.idSet.size&&(n.idSet.add((t==null?void 0:t.id)??0),n.nodeLs.push(t)),n.nodeLs.forEach(i=>{i.rate=e});const s=new FormData;s.set("node_id_list",Array.from(n.idSet).join(",")),s.set("rate",`${e}`),await X("rate/attach",s)}static async op_share(e){const t={title:"share file",alpha:!1,key:"",single:!1,w:400,h:120,minW:400,minH:120,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,text:'<a href="./share.html?id=#id#" target="_blank" style="text-decoration: underline">url generated<br> id: #id#</a>',callback:{submit:async n=>{}}};N==null||N.modal.set({title:"share file",alpha:!1,key:"",single:!1,w:400,h:160,minW:400,minH:160,allow_resize:!0,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{type:"radio",label:"duration",key:"status",value:"1",options:{1:"long",2:"1 day",3:"7 day",4:"30 day",5:"manual"},on_change:(n,s,i)=>{const c=new Date;switch(i.value){case"1":s.content.form[1].disabled=!0;break;case"2":s.content.form[1].disabled=!0,c.setDate(c.getDate()+1),s.content.form[1].value=c.toISOString().substring(0,16);break;case"3":s.content.form[1].disabled=!0,c.setDate(c.getDate()+7),s.content.form[1].value=c.toISOString().substring(0,16);break;case"4":s.content.form[1].disabled=!0,c.setDate(c.getDate()+30),s.content.form[1].value=c.toISOString().substring(0,16);break;case"5":s.content.form[1].disabled=!1,c.setDate(c.getDate()+30),s.content.form[1].value=c.toISOString().substring(0,16);break}}},{type:"datetime",label:"expire",key:"time_to",value:new Date().toISOString().substring(0,16),disabled:!0}],callback:{submit:async n=>{const s=new FormData;s.set("node_id_list",Array.from(e).join(",")),n.content.form[0].value=="1"?s.set("status","2"):(s.set("status","1"),s.set("time_to",n.content.form[1].value));const i=await X("share/set",s);i&&(t.text&&(t.text=t.text.replace(/#id#/ig,`${i.id}`)),N==null||N.modal.set(t))}}})}}function Mt(a,e){const t=[];return e.forEach(n=>{var i;const s={id:n.id,id_parent:n.id_parent,path:"",url:"",size:0,type:n.type??""};if(s.path=[a??"",n.title??""].join("/"),n.type!=="directory"){const c=(i=n.file_index)==null?void 0:i.raw;if(!c)return;c.path&&(s.url=c.path+"?filename="+n.title),s.size=c.size??0}t.push(s)}),t}function is(a,e){if(!N)return;let t=fe("browser_layout_w"),n=fe("browser_layout_h");const s=window.innerWidth,i=window.innerHeight;s<t&&(t=0),i<n&&(n=0),N.modal.set({title:"file browser",alpha:!1,key:"",single:!1,w:t||400,h:n||400,minW:400>window.innerWidth?window.innerWidth*.9:400,minH:400>window.innerHeight?window.innerHeight*.9:400,allow_resize:!0,allow_move:!0,allow_fullscreen:!0,auto_focus:!1,component:[{componentName:"fileBrowser",data:{query:he.copyObject(a),curId:e}}]})}function on(a,e){let t=["id","asc"];switch(e){default:case"id_asc":t=["id","asc"];break;case"id_desc":t=["id","desc"];break;case"name_asc":t=["title","asc"];break;case"name_desc":t=["title","desc"];break;case"crt_asc":t=["time_create","asc"];break;case"crt_desc":t=["time_create","desc"];break;case"upd_asc":t=["time_update","asc"];break;case"upd_desc":t=["time_update","desc"];break;case"rate_asc":t=["rate","asc"];break;case"rate_desc":t=["rate","desc"];break}for(let i=0;i<a.length;i++){const c=a[i];c._sort_index||(c._sort_index=c.node_path+"/"+c.title)}const n=t[1]==="desc",s=n?-1:1;return a.sort((i,c)=>{let h="",u="";switch(t[0]){default:h=i[t[0]],u=c[t[0]];break;case"title":return h=s*(i.type==="directory"?0:1)+(i._sort_index??""),u=s*(c.type==="directory"?0:1)+(c._sort_index??""),os({desc:n,insensitive:!0})(h,u)}return(h>u?1:-1)*s}),a}var Ye={},ge=ge||function(a,e){var t={},n=t.lib={},s=function(){},i=n.Base={extend:function(r){s.prototype=this;var p=new s;return r&&p.mixIn(r),p.hasOwnProperty("init")||(p.init=function(){p.$super.init.apply(this,arguments)}),p.init.prototype=p,p.$super=this,p},create:function(){var r=this.extend();return r.init.apply(r,arguments),r},init:function(){},mixIn:function(r){for(var p in r)r.hasOwnProperty(p)&&(this[p]=r[p]);r.hasOwnProperty("toString")&&(this.toString=r.toString)},clone:function(){return this.init.prototype.extend(this)}},c=n.WordArray=i.extend({init:function(r,p){r=this.words=r||[],this.sigBytes=p!=e?p:4*r.length},toString:function(r){return(r||u).stringify(this)},concat:function(r){var p=this.words,d=r.words,m=this.sigBytes;if(r=r.sigBytes,this.clamp(),m%4)for(var l=0;l<r;l++)p[m+l>>>2]|=(d[l>>>2]>>>24-8*(l%4)&255)<<24-8*((m+l)%4);else if(65535<d.length)for(l=0;l<r;l+=4)p[m+l>>>2]=d[l>>>2];else p.push.apply(p,d);return this.sigBytes+=r,this},clamp:function(){var r=this.words,p=this.sigBytes;r[p>>>2]&=4294967295<<32-8*(p%4),r.length=a.ceil(p/4)},clone:function(){var r=i.clone.call(this);return r.words=this.words.slice(0),r},random:function(r){for(var p=[],d=0;d<r;d+=4)p.push(4294967296*a.random()|0);return new c.init(p,r)}}),h=t.enc={},u=h.Hex={stringify:function(r){var p=r.words;r=r.sigBytes;for(var d=[],m=0;m<r;m++){var l=p[m>>>2]>>>24-8*(m%4)&255;d.push((l>>>4).toString(16)),d.push((l&15).toString(16))}return d.join("")},parse:function(r){for(var p=r.length,d=[],m=0;m<p;m+=2)d[m>>>3]|=parseInt(r.substr(m,2),16)<<24-4*(m%8);return new c.init(d,p/2)}},o=h.Latin1={stringify:function(r){var p=r.words;r=r.sigBytes;for(var d=[],m=0;m<r;m++)d.push(String.fromCharCode(p[m>>>2]>>>24-8*(m%4)&255));return d.join("")},parse:function(r){for(var p=r.length,d=[],m=0;m<p;m++)d[m>>>2]|=(r.charCodeAt(m)&255)<<24-8*(m%4);return new c.init(d,p)}},v=h.Utf8={stringify:function(r){try{return decodeURIComponent(escape(o.stringify(r)))}catch{throw Error("Malformed UTF-8 data")}},parse:function(r){return o.parse(unescape(encodeURIComponent(r)))}},_=n.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(r){typeof r=="string"&&(r=v.parse(r)),this._data.concat(r),this._nDataBytes+=r.sigBytes},_process:function(r){var p=this._data,d=p.words,m=p.sigBytes,l=this.blockSize,g=m/(4*l),g=r?a.ceil(g):a.max((g|0)-this._minBufferSize,0);if(r=g*l,m=a.min(4*r,m),r){for(var f=0;f<r;f+=l)this._doProcessBlock(d,f);f=d.splice(0,r),p.sigBytes-=m}return new c.init(f,m)},clone:function(){var r=i.clone.call(this);return r._data=this._data.clone(),r},_minBufferSize:0});n.Hasher=_.extend({cfg:i.extend(),init:function(r){this.cfg=this.cfg.extend(r),this.reset()},reset:function(){_.reset.call(this),this._doReset()},update:function(r){return this._append(r),this._process(),this},finalize:function(r){return r&&this._append(r),this._doFinalize()},blockSize:16,_createHelper:function(r){return function(p,d){return new r.init(d).finalize(p)}},_createHmacHelper:function(r){return function(p,d){return new y.HMAC.init(r,d).finalize(p)}}});var y=t.algo={};return t}(Math);(function(a){for(var e=ge,r=e.lib,t=r.WordArray,n=r.Hasher,r=e.algo,s=[],i=[],c=function(d){return 4294967296*(d-(d|0))|0},h=2,u=0;64>u;){var o;e:{o=h;for(var v=a.sqrt(o),_=2;_<=v;_++)if(!(o%_)){o=!1;break e}o=!0}o&&(8>u&&(s[u]=c(a.pow(h,.5))),i[u]=c(a.pow(h,1/3)),u++),h++}var y=[],r=r.SHA256=n.extend({_doReset:function(){this._hash=new t.init(s.slice(0))},_doProcessBlock:function(p,d){for(var m=this._hash.words,l=m[0],g=m[1],f=m[2],w=m[3],$=m[4],b=m[5],A=m[6],S=m[7],T=0;64>T;T++){if(16>T)y[T]=p[d+T]|0;else{var H=y[T-15],Z=y[T-2];y[T]=((H<<25|H>>>7)^(H<<14|H>>>18)^H>>>3)+y[T-7]+((Z<<15|Z>>>17)^(Z<<13|Z>>>19)^Z>>>10)+y[T-16]}H=S+(($<<26|$>>>6)^($<<21|$>>>11)^($<<7|$>>>25))+($&b^~$&A)+i[T]+y[T],Z=((l<<30|l>>>2)^(l<<19|l>>>13)^(l<<10|l>>>22))+(l&g^l&f^g&f),S=A,A=b,b=$,$=w+H|0,w=f,f=g,g=l,l=H+Z|0}m[0]=m[0]+l|0,m[1]=m[1]+g|0,m[2]=m[2]+f|0,m[3]=m[3]+w|0,m[4]=m[4]+$|0,m[5]=m[5]+b|0,m[6]=m[6]+A|0,m[7]=m[7]+S|0},_doFinalize:function(){var p=this._data,d=p.words,m=8*this._nDataBytes,l=8*p.sigBytes;return d[l>>>5]|=128<<24-l%32,d[(l+64>>>9<<4)+14]=a.floor(m/4294967296),d[(l+64>>>9<<4)+15]=m,p.sigBytes=4*d.length,this._process(),this._hash},clone:function(){var p=n.clone.call(this);return p._hash=this._hash.clone(),p}});e.SHA256=n._createHelper(r),e.HmacSHA256=n._createHmacHelper(r)})(Math);(function(){var a=ge,e=a.enc.Utf8;a.algo.HMAC=a.lib.Base.extend({init:function(t,n){t=this._hasher=new t.init,typeof n=="string"&&(n=e.parse(n));var s=t.blockSize,i=4*s;n.sigBytes>i&&(n=t.finalize(n)),n.clamp();for(var c=this._oKey=n.clone(),h=this._iKey=n.clone(),u=c.words,o=h.words,v=0;v<s;v++)u[v]^=1549556828,o[v]^=909522486;c.sigBytes=h.sigBytes=i,this.reset()},reset:function(){var t=this._hasher;t.reset(),t.update(this._iKey)},update:function(t){return this._hasher.update(t),this},finalize:function(t){var n=this._hasher;return t=n.finalize(t),n.reset(),n.finalize(this._oKey.clone().concat(t))}})})();(function(){var a=ge,e=a.lib.WordArray;a.enc.Base64={stringify:function(t){var n=t.words,s=t.sigBytes,i=this._map;t.clamp(),t=[];for(var c=0;c<s;c+=3)for(var h=(n[c>>>2]>>>24-8*(c%4)&255)<<16|(n[c+1>>>2]>>>24-8*((c+1)%4)&255)<<8|n[c+2>>>2]>>>24-8*((c+2)%4)&255,u=0;4>u&&c+.75*u<s;u++)t.push(i.charAt(h>>>6*(3-u)&63));if(n=i.charAt(64))for(;t.length%4;)t.push(n);return t.join("")},parse:function(t){var n=t.length,s=this._map,i=s.charAt(64);i&&(i=t.indexOf(i),i!=-1&&(n=i));for(var i=[],c=0,h=0;h<n;h++)if(h%4){var u=s.indexOf(t.charAt(h-1))<<2*(h%4),o=s.indexOf(t.charAt(h))>>>6-2*(h%4);i[c>>>2]|=(u|o)<<24-8*(c%4),c++}return e.create(i,c)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();(function(a){for(var e=ge,r=e.lib,t=r.WordArray,n=r.Hasher,r=e.algo,s=[],i=[],c=function(d){return 4294967296*(d-(d|0))|0},h=2,u=0;64>u;){var o;e:{o=h;for(var v=a.sqrt(o),_=2;_<=v;_++)if(!(o%_)){o=!1;break e}o=!0}o&&(8>u&&(s[u]=c(a.pow(h,.5))),i[u]=c(a.pow(h,1/3)),u++),h++}var y=[],r=r.SHA256=n.extend({_doReset:function(){this._hash=new t.init(s.slice(0))},_doProcessBlock:function(p,d){for(var m=this._hash.words,l=m[0],g=m[1],f=m[2],w=m[3],$=m[4],b=m[5],A=m[6],S=m[7],T=0;64>T;T++){if(16>T)y[T]=p[d+T]|0;else{var H=y[T-15],Z=y[T-2];y[T]=((H<<25|H>>>7)^(H<<14|H>>>18)^H>>>3)+y[T-7]+((Z<<15|Z>>>17)^(Z<<13|Z>>>19)^Z>>>10)+y[T-16]}H=S+(($<<26|$>>>6)^($<<21|$>>>11)^($<<7|$>>>25))+($&b^~$&A)+i[T]+y[T],Z=((l<<30|l>>>2)^(l<<19|l>>>13)^(l<<10|l>>>22))+(l&g^l&f^g&f),S=A,A=b,b=$,$=w+H|0,w=f,f=g,g=l,l=H+Z|0}m[0]=m[0]+l|0,m[1]=m[1]+g|0,m[2]=m[2]+f|0,m[3]=m[3]+w|0,m[4]=m[4]+$|0,m[5]=m[5]+b|0,m[6]=m[6]+A|0,m[7]=m[7]+S|0},_doFinalize:function(){var p=this._data,d=p.words,m=8*this._nDataBytes,l=8*p.sigBytes;return d[l>>>5]|=128<<24-l%32,d[(l+64>>>9<<4)+14]=a.floor(m/4294967296),d[(l+64>>>9<<4)+15]=m,p.sigBytes=4*d.length,this._process(),this._hash},clone:function(){var p=n.clone.call(this);return p._hash=this._hash.clone(),p}});e.SHA256=n._createHelper(r),e.HmacSHA256=n._createHmacHelper(r)})(Math);Ye.enc={Base64:ge.enc.Base64,Utf8:ge.enc.Utf8,Latin1:ge.enc.Latin1};Ye.SHA256=ge.SHA256;Ye.HmacSHA256=ge.HmacSHA256;const ut=Ye,rs={alg:"HS256",typ:"JWT"};function rn(a){return ut.enc.Base64.stringify(a).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function ls(a,e,t={}){const n=Object.assign(rs,t);if(n.alg!=="HS256"&&n.typ!=="JWT")throw new Error("jwt-encode only support the HS256 algorithm and the JWT type of hash");const s=It(n),i=It(a);let c=`${s}.${i}`;return c=ut.HmacSHA256(c,e),c=rn(c),`${s}.${i}.${c}`}function It(a){const e=ut.enc.Utf8.parse(JSON.stringify(a));return rn(e)}var cs=ls;const us=xn(cs),ds={class:"modal_browser office"},fs={class:"base"},hs={class:"l"},ps={class:"r"},_s={class:"content"},ms=["id"],nt=100,vs=pe({__name:"office",props:{extId:{},curIndex:{},isActive:{type:Boolean},file:{},dom:{}},setup(a){const e=a;""+e.extId,j(null);const t=je();$e(()=>{console.warn("mounted");const h=new URL(location.href);i(`${h.origin}/onlyoffice_server/web-apps/apps/api/documents/api.js`),setTimeout(()=>n(),nt)});function n(){if(!s)return setTimeout(()=>n(),nt);const h="modal_office_"+e.extId;if(!document.getElementById(h))return setTimeout(()=>n(),nt);const o=ne.onlyOffice.jwtSecret,v=e.file,_=v.title.lastIndexOf("."),y=v.title.substring(_+1),r=c(y);if(!r)return;const p=new URL(location.href),d={document:{fileType:y,key:v.id.toString(16)+"_"+Math.floor(new Date().valueOf()).toString(),title:v.title,url:`${p.origin}${v.raw}?tosho_token=${t==null?void 0:t.token}`},documentType:r,editorConfig:{callbackUrl:`${p.origin}/api/onlyoffice/callback?id=${v.id}&tosho_token=${t==null?void 0:t.token}`},token:""};d.token=us(d,o),console.info(d),DocsAPI.DocEditor(h,d)}Ht(()=>e.file,async h=>{console.info("onMod props.curNode")}),Re(()=>{});let s=!1;function i(h){var u=document.createElement("script");u.type="text/javascript",u.src=h,u.onload=o=>{console.info(o),s=!0},document.body.appendChild(u)}function c(h){let u=!1;switch(h){default:break;case"doc":case"docm":case"docx":case"dot":case"dotm":case"dotx":case"epub":case"fb2":case"fodt":case"htm":case"html":case"mht":case"mhtml":case"odt":case"ott":case"rtf":case"stw":case"sxw":case"txt":case"wps":case"wpt":u="word";break;case"csv":case"et":case"ett":case"fods":case"ods":case"ots":case"sxc":case"xls":case"xlsb":case"xlsm":case"xlsx":case"xlt":case"xltm":case"xltx":u="cell";break;case"dps":case"dpt":case"fodp":case"odp":case"otp":case"pot":case"potm":case"potx":case"pps":case"ppsm":case"ppsx":case"ppt":case"pptm":case"pptx":case"sxi":u="slide";break}return u}return(h,u)=>(D(),L("div",ds,[P("div",fs,[P("div",hs,[Qe(h.$slots,"info")]),P("div",ps,[Qe(h.$slots,"btnContainer")])]),Qe(h.$slots,"navigator"),P("div",_s,[P("div",{id:"modal_office_"+h.extId},null,8,ms)])]))}}),ys={key:0},gs={class:"preLine"},ws={class:"btnContainer"},bs=["value"],ks=["value","innerHTML"],Es=["value"],xs=["value"],Ss=pe({__name:"browser",props:{data:{},modalData:{}},setup(a){const e=a,t=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1,n={audio:Sn,video:Dn,image:Ln,pdf:$n,text:Rn,office:pt,base:pt};ne.onlyOffice.enabled&&(n.office=vs),console.info("regComponentLs",n);let s=!1;function i(){if(s&&!e.modalData.layout.fullscreen){let R=fe("browser_layout_w"),E=fe("browser_layout_h");e.modalData.layout.w=R,e.modalData.layout.h=E,e.modalData.layout.x=(window.innerWidth-R)/2,e.modalData.layout.y=(window.innerHeight-E)/2}else e.modalData.layout.fullscreen||(ke("browser_layout_w",e.modalData.layout.w),ke("browser_layout_h",e.modalData.layout.h));s=e.modalData.layout.fullscreen,l.value={w:e.modalData.layout.w,h:e.modalData.layout.h}}const c=j(fe("browser_play_mode")??"loop");function h(){let R=ne.playMode.indexOf(c.value);R+=1,R>ne.playMode.length-1&&(R=0),c.value=ne.playMode[R],ke("browser_play_mode",c.value)}const u=j(fe("browser_show_detail")??!1);function o(){u.value=!u.value,ke("browser_show_detail",u.value)}$e(()=>{document.addEventListener("keydown",H),document.addEventListener(`modal_resizing_${e.modalData.nid}`,i),l.value={w:e.modalData.layout.w,h:e.modalData.layout.h},setTimeout(()=>{document.activeElement&&document.activeElement.blur()},100)}),Re(()=>{document.removeEventListener("keydown",H),document.removeEventListener(`modal_resizing_${e.modalData.nid}`,i)});const v=j([]),_=j([]),y=j([]);let r=0;const p=j(0),d=j(null),m=j({id:0,title:"",cover:"",preview:"",normal:"",raw:"",sameName:[]}),l=j({w:0,h:0});async function g(R){const E=await X("file/get",{node_type:"directory",id_dir:`${R}`,with:"none"});return E||{path:[],list:[]}}w();function f(){let R=[];return r=0,_.value.forEach(E=>{if(!A(E))return;const z=E.rate?E.rate+2:2;R.push(Object.assign(E,{_weight_stack:r})),r+=z}),R=_e(R,te.value),R}async function w(R={}){var ie;R&&(e.data.query=Object.assign(e.data.query,R));let E=await X("file/get",e.data.query);if(!E||!E.list.length)return!1;let z=[];if(E.list.forEach(J=>{J.is_file&&z.push(J)}),E.list=z,!E.list.length){if(parseInt(((ie=e.data.query)==null?void 0:ie.cascade_dir)??""))return!1;const J=he.copyObject(e.data.query);if(J.cascade_dir="1",E=await X("file/get",J),!E||!E.list.length)return!1;z=[],E.list.forEach(k=>{k.is_file&&z.push(k)}),E.list=z}if(!E.list.length)return!1;let B=0,M=null;for(let J=0;J<E.list.length;J++)if(E.list[J].id===e.data.curId){B=J,M=E.list[J];break}console.info(B,M),v.value=E.path,_.value=E.list;let Q=f();return Q.length?(y.value=_e(Q,te.value),M||(M=y.value[0]),p.value=Z(y.value,M),console.info(p.value),S(),!0):!1}function $(R,E,z=0){let B=y.value.length;if(B<1)return;let M=0;if(c.value==="shuffle"){let Q=Math.random()*r;E=0;for(let ie=0;ie<B&&(E=ie,!(y.value[ie]._weight_stack>Q));ie++);M=E}else M=R+E;for(;M<0;)M+=B;for(;M>B-1;)M-=B;z||(z=0),z+=1,!(z>B)&&(p.value=M,S())}function b(R){let E=R-p.value;$(p.value,E)}function A(R){const E=parseInt(me.value)??0;if((R.rate??0)<E)return!1;switch(we.value){case"any":case"file":return ne.ignoreFileType.indexOf(R.type??"directory")===-1;default:return we.value==R.type}}function S(){var B,M,Q,ie;if(!y.value.length)return;const R=y.value[p.value];if(d.value=R,!R.file_index.preview&&["audio","video"].indexOf(R.type)!==-1){let J=!1;_.value.forEach(k=>{if(k.id_parent!==R.id_parent||J)return;let C=!1;if(ne.coverKeyword.forEach(x=>{ne.imgKeyword.forEach(I=>{R.title.toLowerCase().indexOf(x)!==-1&&R.title.toLowerCase().indexOf(I)!==-1&&(C=!0)})}),C){J=!0;let x;x||(x=R.file_index.preview),x||(x=R.file_index.normal),x||(x=R.file_index.raw),R.file_index.preview=x}})}const E={id:R.id,title:R.title,cover:((B=R.file_index.cover)==null?void 0:B.path)??"",preview:((M=R.file_index.preview)==null?void 0:M.path)??"",normal:((Q=R.file_index.normal)==null?void 0:Q.path)??"",raw:((ie=R.file_index.raw)==null?void 0:ie.path)??"",sameName:[]};let z=E.title.lastIndexOf(".");if(z!==-1){let J=E.title.substring(0,z)??"";J&&_.value.forEach(k=>{var x,I,G,W,V,O,U,re;if(k.id==E.id||((x=k.title)==null?void 0:x.indexOf(J))!==0)return;let C=(I=k.title)==null?void 0:I.substring(J.length);E.sameName.push({title:C,type:k.type??"",raw:((W=(G=k.file_index)==null?void 0:G.raw)==null?void 0:W.path)??"",normal:((O=(V=k.file_index)==null?void 0:V.normal)==null?void 0:O.path)??"",preview:((re=(U=k.file_index)==null?void 0:U.preview)==null?void 0:re.path)??""})})}m.value=E,T()}function T(){d.value&&(e.modalData.base.title=p.value+1+"/"+y.value.length+" "+(d.value.title??""))}async function H(R){if(!d.value||He(R.target)||!e.modalData.layout.active)return;let E,z,B,M,Q,ie;switch(R.key){case"ArrowLeft":if(R.preventDefault(),R.stopPropagation(),["audio","video"].indexOf(d.value.type??"")!==-1)return;$(p.value,-1);break;case"ArrowRight":if(R.preventDefault(),R.stopPropagation(),["audio","video"].indexOf(d.value.type??"")!==-1)return;$(p.value,1);break;case"a":case"PageUp":R.preventDefault(),R.stopPropagation(),$(p.value,-1);break;case"d":case"PageDown":R.preventDefault(),R.stopPropagation(),$(p.value,1);break;case"w":case"[":switch(e.data.query.mode){default:const k=v.value.length?v.value[v.value.length-1]:{id:0,id_parent:0,type:"directory",title:"root",description:"",status:1,building:0};if(E=await g(k.id_parent),z=_e(E.list,te.value),B=z.length,B<2)return;M=0,z.forEach((O,U)=>{O.id==e.data.query.id_dir&&(M=U)}),ie=z.length;do{for(M-=1;M<0;)M+=B;for(;M>B-1;)M-=B;if(Q=z[M],e.data.query.id_dir=`${Q.id}`,await w())break}while(--ie>0);break;case"id_iterate":if(!e.data.query.keyword)break;const C=e.data.query.keyword.split(","),x=[];C.forEach(O=>x.push(parseInt(O)));let I=null;if(d.value.crumb_node)for(let O=0;O<d.value.crumb_node.length;O++){const U=d.value.crumb_node[O];if(x.indexOf(U.id)!==-1){I=U.id;break}}if(!I)break;const G=x.indexOf(I);B=x.length;let W=G-1;for(;W<0;)W+=B;for(;W>B-1;)W-=B;const V=x[W];for(let O=0;O<y.value.length;O++){const U=y.value[O];for(let re=0;re<U.crumb_node.length;re++)if(U.crumb_node[re].id===V)return $(O,0)}}break;case"s":case"]":switch(e.data.query.mode){default:const k=v.value.length?v.value[v.value.length-1]:{id:0,id_parent:0,type:"directory",title:"root",description:"",status:1,building:0};if(E=await g(k.id_parent),z=_e(E.list,te.value),B=z.length,B<2)return;M=0,z.forEach((O,U)=>{O.id==e.data.query.id_dir&&(M=U)}),ie=z.length;do{for(M+=1;M<0;)M+=B;for(;M>B-1;)M-=B;if(Q=z[M],e.data.query.id_dir=`${Q.id}`,await w())break}while(--ie>0);break;case"id_iterate":if(!e.data.query.keyword)break;const C=e.data.query.keyword.split(","),x=[];C.forEach(O=>x.push(parseInt(O)));let I=null;for(let O=0;O<d.value.crumb_node.length;O++){const U=d.value.crumb_node[O];if(x.indexOf(U.id)!==-1){I=U.id;break}}if(!I)break;const G=x.indexOf(I);B=x.length;let W=G+1;for(;W<0;)W+=B;for(;W>B-1;)W-=B;const V=x[W];for(let O=0;O<y.value.length;O++){const U=y.value[O];for(let re=0;re<U.crumb_node.length;re++)if(U.crumb_node[re].id===V)return $(O,0)}break}break;case"NumpadEnter":case"Enter":break;case"Delete":R.preventDefault(),R.stopPropagation();const J=new Set;d.value&&d.value.id&&J.add(d.value.id),await F.op_bath_delete(J,[],!1,()=>{$(p.value,1)});break}}function Z(R,E){let z=0;return R.forEach((B,M)=>{B.id===E.id&&(z=M)}),z}const te=j(fe("browser_list_sort")??"name_asc");function le(R){var z;if(!d.value)return;console.info("setSort",te.value,R),(z=R.target)==null||z.blur();const E=y.value;y.value=[],_e(E,te.value),y.value=E,p.value=Z(E,d.value),T()}function _e(R,E){return R=on(R,E),p.value=Z(R,d.value??{}),ke("browser_list_sort",te.value),R}const we=j(fe("browser_list_filter")??"any");function Fe(R){ke("browser_list_filter",R);let E=y.value[p.value],z=f();y.value=_e(z,te.value),p.value=Z(y.value,E),console.info(p.value),S()}const me=j("0");function Ce(R){let E=y.value[p.value],z=f();y.value=_e(z,te.value),p.value=Z(y.value,E),console.info(p.value),S()}return(R,E)=>d.value?(D(),zt(Nt(n[d.value.type]?n[d.value.type]:n.base),{key:0,extId:e.modalData.nid,isActive:e.modalData.layout.active,curIndex:p.value,file:m.value,dom:l.value,onNav:b},{info:Je(()=>{var z,B;return[P("div",{class:de({info:!0,detail:u.value})},[u.value?(D(),L(q,{key:0},[P("p",null,ae(d.value.title)+" ("+ae(Y(he).kmgt(((B=(z=d.value.file_index)==null?void 0:z.raw)==null?void 0:B.size)??0,2))+") ",1),d.value.crumb_node?(D(),L("p",ys,[E[11]||(E[11]=ht("Dir : ")),(D(!0),L(q,null,oe(d.value.crumb_node,M=>(D(),L(q,null,[ht("/"+ae(M.title),1)],64))),256))])):ee("",!0),P("p",gs,ae(d.value.description),1)],64)):ee("",!0)],2)]}),btnContainer:Je(()=>{var z,B;return[P("div",ws,[u.value?(D(),L(q,{key:0},[t?ce((D(),L("select",{key:0,"onUpdate:modelValue":E[0]||(E[0]=M=>me.value=M),onChange:E[1]||(E[1]=M=>Ce(me.value))},[(D(!0),L(q,null,oe(Y(ne).rateMobile,(M,Q)=>(D(),L("option",{value:Q,key:"BROWSER_RATE_"+R.modalData.nid+"_"+Q},ae(M),9,bs))),128))],544)),[[Ne,me.value]]):ce((D(),L("select",{key:1,class:"sysIcon","onUpdate:modelValue":E[2]||(E[2]=M=>me.value=M),onChange:E[3]||(E[3]=M=>Ce(me.value))},[(D(!0),L(q,null,oe(Y(ne).rate,(M,Q)=>(D(),L("option",{class:"sysIcon_A sysIcon",value:Q,innerHTML:M,key:"BROWSER_RATE_"+R.modalData.nid+"_"+Q},null,8,ks))),128))],544)),[[Ne,me.value]]),ce(P("select",{"onUpdate:modelValue":E[4]||(E[4]=M=>we.value=M),onChange:E[5]||(E[5]=M=>Fe(we.value))},[(D(!0),L(q,null,oe(Y(ne).fileType,(M,Q)=>(D(),L("option",{value:M,key:"BROWSER_TYPE_"+R.modalData.nid+"_"+Q},ae(M),9,Es))),128))],544),[[Ne,we.value]]),E[12]||(E[12]=P("br",null,null,-1))],64)):ee("",!0),ce(P("select",{"onUpdate:modelValue":E[6]||(E[6]=M=>te.value=M),onChange:E[7]||(E[7]=M=>le(M))},[(D(!0),L(q,null,oe(Y(ne).sort,(M,Q)=>(D(),L("option",{value:Q,key:"BROWSER_SORT_"+R.modalData.nid+"_"+Q},ae(M),9,xs))),128))],544),[[Ne,te.value]]),P("button",{class:de(["sysIcon",`sysIcon_player_${c.value}`]),onClick:h},null,2),P("button",{class:de(["sysIcon","sysIcon_info-cirlce-o"]),onClick:o}),(B=(z=d.value.file_index)==null?void 0:z.raw)!=null&&B.path?(D(),L("button",{key:1,class:de(["sysIcon","sysIcon_download"]),onClick:E[8]||(E[8]=M=>Y(F).op_download(d.value))})):ee("",!0)])]}),navigator:Je(()=>[P("div",{class:de({pagination:1,isMobile:t})},[P("div",{class:"left",onClick:E[9]||(E[9]=z=>$(p.value,-1))},E[13]||(E[13]=[P("span",{class:"sysIcon sysIcon_arrowleft"},null,-1)])),P("div",{class:"right",onClick:E[10]||(E[10]=z=>$(p.value,1))},E[14]||(E[14]=[P("span",{class:"sysIcon sysIcon_arrowright"},null,-1)]))],2)]),_:1},40,["extId","isActive","curIndex","file","dom"])):ee("",!0)}}),Ds={class:"modal_locator"},Ls={class:"locator_list"},$s=["onClick"],Rs={class:"type"},Cs={class:"tree"},Os={class:"title"},Ps=pe({__name:"locator",props:{data:{},modalData:{}},setup(a){const e=j(null);let t={mode:"directory",id_dir:"",keyword:"",id_tag:"",cascade_dir:"1",node_type:"directory",with:"crumb",limit:"20"};const n=a,s=j([]);$e(()=>{var o;(o=e.value)==null||o.focus()}),Re(()=>{});async function i(){const o=await X("file/get",t);!o||!o.list||(t.keyword&&"root".indexOf(t.keyword)!==-1&&o.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),s.value=o.list,s.value.length&&(s.value[0]._sel=!0,n.modalData.layout.h<220&&(n.modalData.layout.h=220)))}async function c(o){console.info(o),!await u(o)&&he.debounce(()=>{var y;let _=(y=e.value)==null?void 0:y.value;if(!_||!_.length){s.value=[];return}console.info(_),console.info(n.modalData),t.keyword=_,i()},200,"locator")}async function h(o){if(console.info(o),!await n.data.call(o))return Bt(n.modalData.nid)}async function u(o){let v,_,y=!1;switch(o.code){case"ArrowDown":if(y=!0,o.stopPropagation(),o.preventDefault(),!s.value.length)break;for(v=-1,s.value.forEach((p,d)=>{p._sel&&(v=d)}),_=v+1;_<0;)_+=s.value.length;for(;_>=s.value.length;)_-=s.value.length;s.value.forEach((p,d)=>{p._sel=d==_});break;case"ArrowUp":if(y=!0,o.stopPropagation(),o.preventDefault(),!s.value.length)break;for(v=0,s.value.forEach((p,d)=>{p._sel&&(v=d)}),_=v-1;_<0;)_+=s.value.length;for(;_>=s.value.length;)_-=s.value.length;s.value.forEach((p,d)=>{p._sel=d==_});break;case"NumpadEnter":case"Enter":if(y=!0,o.stopPropagation(),o.preventDefault(),!s.value.length||(v=-1,s.value.forEach((p,d)=>{p._sel&&(v=d)}),v==-1))break;const r=s.value[v];h(r);break}return y}return(o,v)=>(D(),L("div",Ds,[P("input",{type:"text",class:"locator_input",placeholder:"type title/desc here ...",ref_key:"locatorInput",ref:e,onKeydown:c},null,544),P("div",Ls,[(D(!0),L(q,null,oe(s.value,_=>(D(),L("div",{onClick:y=>h(_),class:de({active:_._sel})},[P("p",Rs,ae(_.type),1),P("p",Cs,[P("span",Os,ae(_.title),1),_.crumb_node?(D(!0),L(q,{key:0},oe(_.crumb_node,y=>(D(),L("span",null,ae(y.title),1))),256)):ee("",!0)])],10,$s))),256))])]))}}),As={class:"upload_list"},Ms={class:"title"},Is={class:"meta"},Ts={key:0},Hs={key:1},zs=["onClick"],Ns={class:"upload_menu"},Bs={key:1},Vs=pe({__name:"uploader",props:{data:{},modalData:{}},setup(a){const e=a,t=j([]),n=new Map;$e(()=>{}),Re(()=>{});function s(d){console.info("onSelectFile",d);const m=document.createElement("input");m.type="file",m.setAttribute("multiple",!0),m.onchange=l=>{var g;if((g=m.files)!=null&&g.length)for(let f=0;f<m.files.length;f++){const w=m.files[f];t.value.push({name:"/"+w.name,size:w.size,file:w,isDir:!1,status:"waiting",start:0,loaded:0})}},m.click()}function i(d){var m,l,g;if(console.debug("onDrop",d.type,(m=d.dataTransfer)==null?void 0:m.files,d),d.preventDefault(),d.stopPropagation(),!(!d.dataTransfer||!d.dataTransfer.files.length)){for(let f=0;f<((l=d.dataTransfer)==null?void 0:l.files.length);f++){const w=(g=d.dataTransfer)==null?void 0:g.items[f],$=w.webkitGetAsEntry();if($.isFile){const b=w.getAsFile();t.value.push({name:$.fullPath,size:b.size,file:b,isDir:!1,status:"waiting",start:0,loaded:0})}else c($).then(b=>{b.forEach(A=>t.value.push(A))})}console.info(t.value)}}async function c(d){const m=[];m.push({name:d.fullPath,size:0,file:null,isDir:!0,status:"waiting",start:0,loaded:0});const l=d.createReader(),g=await u(l);for(let f=0;f<g.length;f++){const w=g[f];if(w.isFile){const $=await h(w);m.push({name:w.fullPath,size:$.size,file:$,isDir:!1,status:"waiting",start:0,loaded:0})}w.isDirectory&&(await c(w)).forEach(b=>m.push(b))}return m}function h(d){return new Promise(m=>{d.file(l=>m(l))})}function u(d){return new Promise(m=>{d.readEntries(l=>{m(l)})})}function o(d){d.stopPropagation(),d.preventDefault()}let v=j(!1);async function _(){if(t.value.length){v.value=!0;for(let d=0;d<t.value.length;d++)t.value[d].status==="waiting"&&await y(t.value[d]);v.value=!1,e.data.emitGo("reload")}}async function y(d){let m=null,[l,g,f]=r(d.name);if(d.isDir){const w=new FormData;w.set("pid",l),w.set("title",f),d.status="uploading",m=await X("file/mkdir",w),n.set(g+f+"/",m.id)}else{const w=new FormData;w.set("pid",l),w.set("file",d.file),d.status="uploading",m=await X("file/upd",w,{upload:$=>{d.loaded=$.loaded}})}return d.status="complete",m}function r(d){const m=d.replace(/[\\/]+$/i).split(/[\\/]/i),l=m.pop();if(!m.length)return[e.data.pid,"/",l];let g="";for(let w=0;w<m.length;w++)g+=m[w]+"/";return g=="/"?[e.data.pid,g,l]:[n.get(g),g,l]}function p(d){t.value.splice(d,1)}return(d,m)=>(D(),L("div",{class:"modal_uploader",onDrop:i,onDragover:o},[P("div",As,[(D(!0),L(q,null,oe(t.value,(l,g)=>(D(),L("div",{key:`file_upload_${g}`},[P("div",Ms,ae(l.name),1),P("div",Is,[l.status==="uploading"?(D(),L("span",Ts,ae(Math.round(100*l.loaded/l.size))+" % ",1)):(D(),L("span",Hs,ae(l.status),1)),P("span",null,ae(Y(he).kmgt(l.size)),1),l.status==="waiting"?(D(),L("span",{key:2,onClick:f=>p(g),class:"pointer"},"X",8,zs)):ee("",!0)])]))),128)),P("div",{onClick:s},"drag / drop files here...")]),P("div",Ns,[Y(v)?(D(),L("button",Bs,"uploading")):(D(),L("button",{key:0,onClick:_},"upload"))])],32))}}),Us={class:"modal_rename_util"},Ws={class:"mode_selector"},js=["id","name"],Fs=["for"],qs=["id","name"],Gs=["for"],Ks=pe({__name:"renameUtil",props:{data:{},modalData:{}},setup(a){j(null);const e=a;let t=j("pattern"),n=j("{index}_{filename}"),s=j("");$e(()=>{const h=[];e.data.node_list.forEach(u=>{h.push((u==null?void 0:u.title)??"")}),s.value=h.join(`\r
`),console.info(s)}),Re(()=>{});function i(h){let u=h.length.toString().length+1,o=0,v="",_=n.value.match(/\{index:(\d+)}/);_&&(o=parseInt(_[1]),v=_[0]);const y=new Map;h.forEach((p,d)=>{const m=p.crumb_node?p.crumb_node[p.crumb_node.length-1]:null,l=m?m.title:"";let g=new Map;g.set("{filename}",p.title??""),g.set("{index}",he.prefix(d+1,u,"0")),g.set("{directory}",l??""),g.set(`{index:${v}}`,he.prefix(d+1,o,"0"));let f=n.value;g.forEach((w,$)=>{f=f.replace($,w)}),y.set(p.id??0,f)});const r=[];return y.forEach((p,d)=>{r.push({id:d,title:p})}),r}async function c(){let h=[];switch(t.value){default:case"pattern":h=i(e.data.node_list);break;case"bath":const v=s.value.split(/[\r\n]+/);h=[],e.data.node_list.forEach((_,y)=>{v[y]&&v[y].trim().length&&h.push({id:_.id??0,title:v[y].trim()})});break}const u={list:JSON.stringify(h)},o=await X("file/bath_rename",u);return console.info(o),e.data.callback(h),Bt(e.modalData.nid)}return(h,u)=>(D(),L("div",Us,[P("div",Ws,[ce(P("input",{id:`P_${e.modalData.nid}_MODE_PATTERN`,name:`P_${e.modalData.nid}_MODE`,value:"pattern",type:"radio","onUpdate:modelValue":u[0]||(u[0]=o=>qe(t)?t.value=o:t=o)},null,8,js),[[at,Y(t)]]),P("label",{for:`P_${e.modalData.nid}_MODE_PATTERN`},"pattern",8,Fs),ce(P("input",{id:`P_${e.modalData.nid}_MODE_BATH`,name:`P_${e.modalData.nid}_MODE`,value:"bath",type:"radio","onUpdate:modelValue":u[1]||(u[1]=o=>qe(t)?t.value=o:t=o)},null,8,qs),[[at,Y(t)]]),P("label",{for:`P_${e.modalData.nid}_MODE_BATH`},"bath",8,Gs)]),Y(t)=="pattern"?(D(),L(q,{key:0},[u[5]||(u[5]=Vt("<p>rename pattern:</p><table><tbody><tr><td>code</td><td>description</td></tr><tr><td>{filename}</td><td>file name</td></tr><tr><td>{index}</td><td>index by sort, prefix by max len+1</td></tr><tr><td>{index:n}</td><td>index by sort, prefix len by [n]</td></tr><tr><td>{directory}</td><td>parent directory name</td></tr></tbody></table>",2)),P("label",null,[u[4]||(u[4]=P("span",null,"pattern",-1)),ce(P("input",{type:"text","onUpdate:modelValue":u[2]||(u[2]=o=>qe(n)?n.value=o:n=o)},null,512),[[Ae,Y(n)]])])],64)):ee("",!0),Y(t)=="bath"?(D(),L(q,{key:1},[u[6]||(u[6]=P("p",null,"rename bath:",-1)),ce(P("textarea",{"onUpdate:modelValue":u[3]||(u[3]=o=>qe(s)?s.value=o:s=o)},null,512),[[Ae,Y(s)]])],64)):ee("",!0),P("label",{class:"confirm"},[P("button",{onClick:c},"submit")])]))}}),Ys={class:"fr_popup"},Xs=["data-ref-id","onClick"],Qs=["onPointerdown","onDblclick"],Js={class:"modal_title"},Zs={class:"modal_menu"},eo=["onClick"],to=["onClick"],no=["onClick"],ao={class:"modal_content"},so=["innerHTML"],oo={key:1,class:"modal_content_form"},io={key:0},ro=["onUpdate:modelValue","onChange","disabled"],lo=["onClick","disabled"],co={key:0},uo=["onUpdate:modelValue","onChange","disabled"],fo=["onUpdate:modelValue","onChange","disabled"],ho=["onUpdate:modelValue","onChange","disabled"],po=["id","name","value","onUpdate:modelValue","onChange","disabled"],_o=["for"],mo=["id","name","value","onUpdate:modelValue","onChange","disabled"],vo=["for"],yo=["onUpdate:modelValue","multiple","onChange","disabled"],go=["value"],wo={key:2,class:"modal_content_callback"},bo=["onClick"],ko=["onPointerdown"],Se=20,Eo=pe({__name:"Popup",setup(a){const e={fileBrowser:Ss,uploader:Vs,locator:Ps,renameUtil:Ks},t=new Date().valueOf(),n=j(new Map);function s(l){const g=Math.floor((new Date().valueOf()-t)/100),f=window.innerWidth,w=window.innerHeight,$=(g+Math.random()).toString(32),b={nid:$,base:{title:l.title??"",alpha:l.alpha??!1,key:l.key??"",single:l.single??!1},layout:{w:0,h:0,x:0,y:0,minW:0,minH:0,allow_resize:!1,allow_move:!1,allow_escape:!1,allow_fullscreen:!1,auto_focus:!1,active:!1,index:0,fullscreen:!1},content:{text:j(""),form:[],component:[]},callback:[],closed:!1,event:{resize:new Event("modal_resizing_"+$)}};console.info(g,b.nid);const A={};if(A.w=l.w??400,A.h=l.h??160,A.x=(f-A.w)/2,A.y=(w-A.h)/2,A.minW=l.minW??400,A.minH=l.minH??160,A.allow_resize=l.allow_resize??!0,A.allow_move=l.allow_move??!0,A.allow_escape=l.allow_escape??!0,A.allow_fullscreen=l.allow_fullscreen??!1,A.auto_focus=l.auto_focus??!0,A.active=!1,A.index=g,A.fullscreen=l.fullscreen??!1,Object.assign(b.layout,A),l.text&&(typeof l.text=="string"?b.content.text.value=l.text:b.content.text=l.text),l.form&&(Array.isArray(l.form)?b.content.form.push(...l.form):b.content.form.push(l.form),b.content.form.forEach(S=>{if(S.value=S.value??null,S.options=S.options??null,S.default=S.default??null,S.multiple=!!S.multiple,S.disabled=!!S.disabled,S.options&&Array.isArray(S.options)){let T={};S.options.forEach(H=>{T[H]=H}),S.options=T}S.on_change||(S.on_change=()=>{})})),l.component&&(Array.isArray(l.component)?l.component.forEach(S=>{let T;typeof S=="string"?T={key:"",componentName:S,data:{}}:T=Object.assign({key:"",componentName:null,data:{}},S),b.content.component.push(T)}):typeof l.component=="string"?b.content.component.push({key:"",componentName:l.component,data:{}}):b.content.component.push(Object.assign({key:"",componentName:null,data:{}},l.component))),l.callback){if(Array.isArray(l.callback))l.callback.forEach((S,T)=>{let H;typeof S=="function"?H={key:"",name:"",func:S}:H=Object.assign({key:"",name:"",func:null},S),b.callback.push(H)});else if(typeof l.callback=="function")b.callback.push({key:"",name:"",func:l.callback});else if(l.callback.func)b.callback.push(Object.assign({key:"",name:"",func:null},l.callback));else for(const S in l.callback){if(!Object.prototype.hasOwnProperty.call(l.callback,S))continue;const T=l.callback[S];b.callback.push(Object.assign({key:S,name:S,func:T}))}b.callback.forEach((S,T)=>{if(S.name&&!S.key)S.key=S.name;else if(!S.name&&S.key)S.name=S.key;else if(!S.name&&!S.key){let H="button";b.callback.length>1&&(H+=" "+T),S.name=H,S.key=H}})}return console.debug(b),b}window.addEventListener("resize",l=>{n.value.forEach(g=>{if(g.layout.fullscreen){const f={x:Se,y:Se,w:window.innerWidth-Se*2,h:window.innerHeight-Se*2};Object.assign(g.layout,f),document.dispatchEvent(g.event.resize)}})}),_t("set",l=>{let g=null,f=null;return l.single&&n.value.forEach((w,$,b)=>{w.base.key==l.key&&(g=$,f=w)}),g?setTimeout(()=>{g&&i(g)}):(f=s(l),n.value.set(f.nid,f),setTimeout(()=>{f&&i(f.nid)})),f}),_t("close",l=>u(l)),document.body.addEventListener("click",l=>{let g=l.target;ze(g)||i("")});function i(l){const g=Math.floor((new Date().valueOf()-t)/100);n.value.forEach(f=>{if(f.nid===l){f.layout.index=g;let w=!f.layout.active;f.layout.active=!0,f.layout.auto_focus&&w&&setTimeout(()=>{const $=document.querySelector(`.modal_dom[data-ref-id="${f.nid}"] input,.modal_dom[data-ref-id="${f.nid}"] button,.modal_dom[data-ref-id="${f.nid}"] textarea`);$&&$.focus()},100)}else f.layout.active=!1})}function c(l){const g=n.value.get(l);if(!g)return;const f={x:Se,y:Se,w:window.innerWidth-Se*2,h:window.innerHeight-Se*2,fullscreen:!0};Object.assign(g.layout,f),document.dispatchEvent(g.event.resize)}function h(l){const g=n.value.get(l);if(!g)return;const f={x:0,y:0,w:g.layout.minW,h:g.layout.minH,fullscreen:!1};f.x=(window.innerWidth-f.w)/2,f.y=(window.innerHeight-f.h)/2,Object.assign(g.layout,f),document.dispatchEvent(g.event.resize)}function u(l){const g=n.value.get(l);if(!g||!g.layout.allow_escape)return;n.value.delete(l);let f=-1,w="";return n.value.forEach($=>{f=$.layout.index,w=$.nid}),f!=-1&&i(w),g}let o={x:0,y:0,d:"",modalX:0,modalY:0,modalW:0,modalH:0,modal:null},v=0;function _(l,g){g.preventDefault(),g.stopPropagation(),g.pointerId&&(v=g.pointerId,g.target.hasPointerCapture(g.pointerId)),o.x=g.clientX,o.y=g.clientY,o.d=g.target.className,n.value.forEach(f=>{f.nid===l&&(o.modal=f)}),o.modal&&(o.modal.layout.fullscreen||(o.modalX=o.modal.layout.x,o.modalY=o.modal.layout.y,o.modalW=o.modal.layout.w,o.modalH=o.modal.layout.h,document.addEventListener("pointerup",r),document.addEventListener("pointermove",y)))}function y(l){if(l.preventDefault(),!o.modal||!l.pointerId||v!=l.pointerId)return;const g={x:l.clientX-o.x,y:l.clientY-o.y},f={x:o.modal.layout.x,y:o.modal.layout.y,w:o.modal.layout.w,h:o.modal.layout.h};switch(o.d){case"c_l":f.x=o.modalX+g.x,f.w=o.modalW-g.x;break;case"c_r":f.x=o.modalX,f.w=o.modalW+g.x;break;case"c_t":f.y=o.modalY+g.y,f.h=o.modalH-g.y;break;case"c_b":f.y=o.modalY,f.h=o.modalH+g.y;break;case"c_lt":f.x=o.modalX+g.x,f.w=o.modalW-g.x,f.y=o.modalY+g.y,f.h=o.modalH-g.y;break;case"c_lb":f.x=o.modalX+g.x,f.w=o.modalW-g.x,f.y=o.modalY,f.h=o.modalH+g.y;break;case"c_rt":f.x=o.modalX,f.w=o.modalW+g.x,f.y=o.modalY+g.y,f.h=o.modalH-g.y;break;case"c_rb":f.x=o.modalX,f.w=o.modalW+g.x,f.y=o.modalY,f.h=o.modalH+g.y;break;case"modal_header":case"modal_title":f.x=o.modalX+g.x,f.y=o.modalY+g.y;break}const w={l:0,r:window.innerWidth,t:0,b:window.innerHeight};f.w<100&&(f.w=100),f.h<80&&(f.h=80),f.y<0&&(f.y=0),f.y>w.b-f.h/2&&(f.y=w.b-f.h/2),f.x<0-f.w/2&&(f.x=0-f.w/2),f.x>w.r-f.w/2&&(f.x=w.r-f.w/2),o.modal.layout.minW&&f.w<o.modal.layout.minW&&(f.w=o.modal.layout.minW),o.modal.layout.minH&&f.h<o.modal.layout.minH&&(f.h=o.modal.layout.minH),Object.assign(o.modal.layout,f),document.dispatchEvent(o.modal.event.resize)}function r(l){l.preventDefault(),l.stopPropagation(),!(!l.pointerId||v!=l.pointerId)&&(document.removeEventListener("pointerup",r),document.removeEventListener("pointermove",y),v=0,o.modal=null)}function p(l,g){const f=n.value.get(l);f&&f.callback.forEach(async w=>{w.key!==g||await w.func(f)||u(l)})}$e(()=>{console.info("Popup mounted"),document.addEventListener("keydown",d)}),Re(()=>{console.info("unmounted"),document.removeEventListener("keydown",d)});function d(l){switch(l.key){case"Escape":n.value.forEach((f,w)=>{if(f.layout.active){if(!f.layout.allow_escape)return;setTimeout(()=>u(f.nid))}});break;case"NumpadEnter":case"Enter":if(l.target.tagName==="BODY"||l.target.tagName==="BUTTON"||l.isComposing)return;let g=l.target;for(;g.parentElement;){if(g=g.parentElement,!g.classList.contains("modal_dom"))continue;const w=g.getAttribute("data-ref-id");if(!w)break;const $=n.value.get(w);if(!$)break;for(let b=0;b<$.callback.length;b++){const A=$.callback[b].key;return p(w,A)}}break}}function m(l){console.info("processModalFile",l);const g=document.createElement("input");g.type="file",g.onchange=f=>{const w=f.target.files;!w||w.length===0||(l.value=w[0],console.info("processModalFile mod",l,l.value))},g.click()}return(l,g)=>(D(),L("div",Ys,[(D(!0),L(q,null,oe(n.value,([f,w])=>{var $;return D(),L("div",{key:`_modal_${f}`,class:de({modal_dom:!0,active:w.layout.active,resizing:(($=Y(o).modal)==null?void 0:$.nid)==w.nid,modal_alpha:w.base.alpha}),"data-ref-id":w.nid,style:Ut({zIndex:w.layout.index,width:w.layout.w+"px",height:w.layout.h+"px",left:w.layout.x+"px",top:w.layout.y+"px"}),onClick:Cn(b=>i(w.nid),["stop"])},[P("div",{class:"modal_header",onPointerdown:b=>_(w.nid,b),onDblclick:b=>w.layout.fullscreen?h(w.nid):c(w.nid)},[P("div",Js,ae(w.base.title),1),P("div",Zs,[w.layout.allow_move&&w.layout.allow_fullscreen?(D(),L(q,{key:0},[w.layout.fullscreen?(D(),L("span",{key:1,class:"buttonStyle sysIcon sysIcon_windowize",onClick:b=>h(w.nid)},null,8,to)):(D(),L("span",{key:0,class:"buttonStyle sysIcon sysIcon_maximize",onClick:b=>c(w.nid)},null,8,eo))],64)):ee("",!0),P("span",{class:"buttonStyle sysIcon sysIcon_close",onClick:b=>u(w.nid)},null,8,no)])],40,Qs),P("div",ao,[w.content.text&&w.content.text.length?(D(),L("div",{key:0,class:"modal_content_text",innerHTML:w.content.text},null,8,so)):ee("",!0),w.content.form&&w.content.form.length?(D(),L("div",oo,[(D(!0),L(q,null,oe(w.content.form,(b,A)=>(D(),L("label",{key:`_modal_${f}_form_${A}`},[b.label?(D(),L("span",io,ae(b.label),1)):ee("",!0),g[0]||(g[0]=P("span",null,null,-1)),P("span",null,[b.type==="text"?ce((D(),L("input",{key:0,type:"text","onUpdate:modelValue":S=>b.value=S,onChange:S=>b.on_change(S,w,b),disabled:b.disabled},null,40,ro)),[[Ae,b.value]]):ee("",!0),b.type==="file"?(D(),L(q,{key:1},[P("button",{onClick:S=>m(b),disabled:b.disabled},"select file",8,lo),b.value?(D(),L("span",co,ae(b.value.name),1)):ee("",!0)],64)):ee("",!0),b.type==="textarea"?ce((D(),L("textarea",{key:2,"onUpdate:modelValue":S=>b.value=S,onChange:S=>b.on_change(S,w,b),disabled:b.disabled},null,40,uo)),[[Ae,b.value]]):ee("",!0),b.type==="date"?ce((D(),L("input",{key:3,type:"date","onUpdate:modelValue":S=>b.value=S,onChange:S=>b.on_change(S,w,b),disabled:b.disabled},null,40,fo)),[[Ae,b.value]]):ee("",!0),b.type==="datetime"?ce((D(),L("input",{key:4,type:"datetime-local","onUpdate:modelValue":S=>b.value=S,onChange:S=>b.on_change(S,w,b),disabled:b.disabled},null,40,ho)),[[Ae,b.value]]):ee("",!0),b.type==="checkbox"?(D(!0),L(q,{key:5},oe(b.options,(S,T)=>(D(),L(q,{key:`P_${f}_C_${A}_CB_${T}`},[ce(P("input",{id:`P_${f}_C_${A}_CB_${T}`,name:`P_${f}_C_${A}_CB`,type:"checkbox",value:T,"onUpdate:modelValue":H=>b.value=H,onChange:H=>b.on_change(H,w,b),disabled:b.disabled},null,40,po),[[On,b.value]]),P("label",{for:`P_${f}_C_${A}_CB_${T}`},ae(S),9,_o)],64))),128)):ee("",!0),b.type==="radio"?(D(!0),L(q,{key:6},oe(b.options,(S,T)=>(D(),L(q,{key:`P_${f}_C_${A}_RD_${T}`},[ce(P("input",{id:`P_${f}_C_${A}_RD_${T}`,name:`P_${f}_C_${A}_RD`,type:"radio",value:T,"onUpdate:modelValue":H=>b.value=H,onChange:H=>b.on_change(H,w,b),disabled:b.disabled},null,40,mo),[[at,b.value]]),P("label",{for:`P_${f}_C_${A}_RD_${T}`},ae(S),9,vo)],64))),128)):ee("",!0),b.type==="select"?ce((D(),L("select",{key:7,"onUpdate:modelValue":S=>b.value=S,multiple:b.multiple,onChange:S=>b.on_change(S,w,b),disabled:b.disabled},[(D(!0),L(q,null,oe(b.options,(S,T)=>(D(),L("option",{key:`P_${f}_C_${A}_SL_${T}`,value:T},ae(S),9,go))),128))],40,yo)),[[Ne,b.value]]):ee("",!0)])]))),128))])):ee("",!0),(D(!0),L(q,null,oe(w.content.component,(b,A)=>(D(),zt(Nt(e[b.componentName]),{key:`CMP_${f}_${A}`,data:b.data,modalData:w},null,8,["data","modalData"]))),128)),w.callback&&w.callback.length?(D(),L("div",wo,[(D(!0),L(q,null,oe(w.callback,(b,A)=>(D(),L("button",{key:`BTN_${f}_${A}`,onClick:S=>p(w.nid,b.key)},ae(b.name),9,bo))),128))])):ee("",!0)]),w.layout.allow_resize?(D(),L("div",{key:0,class:"modal_border",onPointerdown:b=>_(w.nid,b)},g[1]||(g[1]=[Vt('<div class="c_l"></div><div class="c_r"></div><div class="c_t"></div><div class="c_b"></div><div class="c_lt"></div><div class="c_lb"></div><div class="c_rt"></div><div class="c_rb"></div>',8)]),40,ko)):ee("",!0)],14,Xs)}),128))]))}}),xo={class:"fr_context"},So=["onClick"],Do=["innerHTML"],Lo={key:0,class:"context_menu_sub"},$o=["onClick"],Ro=["innerHTML"],Co=pe({__name:"Context",setup(a){const e=je(),t=e?e!=null&&e.group.admin?2:1:0,n=j([]),s=j(null),i=j(!0),c=j({x:-1e3,y:0,w:0,h:0,sx:0,sy:0,direction:"lb"});an(h);function h(p,d){i.value=!1;const m=[];p.forEach(l=>{if(u(l)){if(l.child){let g=[];if(l.child.forEach(f=>{u(f)&&g.push(f)}),!g.length)return;l.child=g}m.push(l)}}),n.value=m,console.info(m),setTimeout(()=>o(d),20)}function u(p){switch(p.auth){case"none":return!1;default:case"guest":return!0;case"user":if(t<1)break;return!0;case"admin":if(t<2)break;return!0}}function o(p){if(!s.value)return;const d=s.value;let m=r();const l={x:p.clientX,y:p.clientY,w:d==null?void 0:d.offsetWidth,h:d==null?void 0:d.offsetHeight,sx:m.scrollTop,sy:m.scrollLeft,direction:"rb"};let g=["r","b"];switch(l.w+l.x>window.innerWidth&&(g[0]="l"),l.h+l.y>window.innerHeight&&(g[1]="t"),l.direction=g.join(""),l.direction){case"rb":break;case"rt":l.y-=l.h;break;case"lb":l.x-=l.w;break;case"lt":l.x-=l.w,l.y-=l.h;break}c.value=l,r().addEventListener("scroll",y),setTimeout(()=>i.value=!0,10)}function v(){r().removeEventListener("scroll",y),i.value=!1,_=null,setTimeout(()=>{n.value=[],c.value={x:-1e3,y:0,w:0,h:0,sx:0,sy:0,direction:"lb"}},10)}$e(()=>{});let _=null;function y(p){const d=r();if(!d)return;let m=c.value,l=d.scrollLeft,g=d.scrollTop,f=l-m.sx,w=g-m.sy;c.value=Object.assign(m,{x:m.x-f,y:m.y-w,sx:l,sy:g})}function r(){return _||(_=document.querySelector(".fr_content"),_)}return addEventListener("contextmenu",p=>{console.info("triggerMenu"),h([],p)}),addEventListener("click",p=>{v()}),(p,d)=>(D(),L("div",xo,[P("div",{class:de(["context_menu",i.value?"show":"",c.value.direction]),style:Ut({left:c.value.x+"px",top:c.value.y+"px"}),ref_key:"contextDOM",ref:s},[(D(!0),L(q,null,oe(n.value,(m,l)=>{var g;return D(),L("div",{key:`COM_${l}`,class:de(["context_item",(g=m.child)!=null&&g.length?"has_sub":""]),onClick:m.method},[P("span",{innerHTML:m.title},null,8,Do),m.child&&m.child.length?(D(),L("div",Lo,[(D(!0),L(q,null,oe(m.child,(f,w)=>(D(),L("div",{key:`COM_${l}_${w}`,class:de({context_item:!0}),onClick:f.method},[P("span",{innerHTML:f.title},null,8,Ro)],8,$o))),128))])):ee("",!0)],10,So)}),128))],6)]))}}),Oo={class:"fr_body"},Po=pe({__name:"main",setup(a){const e=je();e&&(document.cookie=`tosho_token=${e.token}; max-age=31536000`,n());const t=new Event("fe_config_loaded");async function n(){const s=await X("setting/get_front_conf");s&&(s.onlyoffice_enabled==="true"&&(ne.onlyOffice.enabled=!0,ne.onlyOffice.jwtSecret=s.onlyoffice_jwt_secret??""),ne.navList=[{name:"Nas",meta:{cur:!0},path:"/"}],s.link_nav&&s.link_nav.forEach(i=>{ne.navList.push({name:i[0],meta:{cur:!1},path:i[1]})}),document.dispatchEvent(t))}return(s,i)=>{const c=Pn("router-view");return D(),L(q,null,[Oe(Wn,{class:"fr_header"}),Oe(Eo),Oe(Co),P("div",Oo,[Oe(ts,{class:"fr_navi"}),Oe(c)])],64)}}});An();const dt=Mn(Po);dt.use(In());dt.use(Qa);dt.mount("#app");export{Un as _,Io as a,Xa as b,F as c,To as o,is as p,Ya as u};

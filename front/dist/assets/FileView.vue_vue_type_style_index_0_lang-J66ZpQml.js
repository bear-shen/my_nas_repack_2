import{r as C,B as q,q as $,d as A,a as G,s as z,t as X,g as J,u as W,b as Y,e as Z,f as Q,D as ee,o as l,h as i,i as a,k as n,F as _,j as k,x as O,m as p,w as g,v as te,l as V,C as w,A as oe,n as F,c as ne,G as H,p as se}from"./index-ja85KVwm.js";import{F as ae}from"./FileItem-DuONDfzA.js";const S=C([]),j=C("copy"),le=q("counter",()=>({nodeList:S,mode:j,doPaste:re}));async function re(T){if(console.info(S.value),!S.value.length)return;const h=new Set;S.value.forEach(I=>{h.add(I.id)});const f=Array.from(h),v=new FormData;switch(v.set("id_node",`${f.join(",")}`),v.set("id_target",`${T}`),j.value){case"copy":await $("file/copy",v);break;case"cut":await $("file/mov",v);break}S.value=[]}const ie={class:"content_meta"},ue={key:0,class:"crumb"},ce=["onClick","title"],de={class:"search"},fe=a("span",null,"Title : ",-1),ye=a("span",null,"Type : ",-1),_e=a("span",null,"Rate : ",-1),pe=["value","innerHTML"],ve=["value","innerHTML"],me=a("span",null,"Cascade : ",-1),ke=a("label",{class:"buttonStyle",for:"FV_S_CB"},null,-1),be={class:"display"},ge=a("a",{class:"sysIcon sysIcon_fengefu"},null,-1),he=a("a",{class:"buttonStyle sysIcon sysIcon_fengefu"},null,-1),we={key:2},Se=a("span",null,"Sort : ",-1),Ce=["value"],Le=a("a",{class:"sysIcon sysIcon_fengefu"},null,-1),Oe=["onClick"],Ve={key:1,class:"pastebin"},Me=A({__name:"FileView",setup(T){const h=G(),f=le(),v=C(null),I=z(),m=X(),K=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1;let u={mode:"directory",id_dir:"0",id_tag:""},c={keyword:"",node_type:"",rate:"",cascade_dir:"1"};function N(o){if(o){for(let e in u)if(Object.prototype.hasOwnProperty.call(u,e))switch(e){default:u[e]=o[e]??"";break;case"mode":u[e]=o[e]??"directory";break;case"id_dir":u[e]=o[e]??"0";break}for(let e in c)if(Object.prototype.hasOwnProperty.call(c,e))switch(e){default:c[e]=o[e]??"";break;case"cascade_dir":c[e]=o[e]??"1";break}}}J(async o=>{console.warn("onBeforeRouteUpdate",o,JSON.stringify(o.query)),o.query&&N(o.query),await b()});let d=C([]),y=C([]),s;async function b(o){if(console.info("getList",m.name),y.value=[],o)y.value=o;else{switch(d.value=[],m.name){default:break;case"Recycle":u.status="deleted";break;case"Favourite":break}let e={};switch(u.mode){case"directory":e=Object.assign(e,u);break;case"search":e=Object.assign(e,u,c);break}const t=await $("file/get",e);if(!t)return;d.value=t.path,y.value=s.sortList(t.list,s.sortVal.value)}return s&&s.setList(y.value),{crumb:d.value,node:y.value}}function B(){let o=0,e="root";if(d.value.length){let t=d.value[d.value.length-1];t&&(o=t.id??0,e=t.title??"root")}h.set({title:`mkdir | ${e}`,alpha:!1,key:"",single:!1,w:400,h:100,minW:400,minH:100,allow_resize:!1,allow_move:!0,allow_fullscreen:!1,auto_focus:!0,form:[{label:"title",type:"text"}],callback:{submit:async t=>{const L=t.content.form[0].value;if(!L)return!0;const P=await $("file/mkdir",{title:L,pid:`${o}`});b()}}})}function M(){let o=0,e="root";if(d.value.length){let t=d.value[d.value.length-1];t&&(o=t.id??0,e=t.title??"root")}h.set({title:`upload | ${e}`,alpha:!1,key:`FileView_addFile_${o}`,single:!0,w:400,h:200,minW:400,minH:200,allow_resize:!0,allow_move:!0,allow_fullscreen:!0,auto_focus:!0,component:[{componentName:"uploader",data:{pid:o,emitGo:D}}]})}W();function R(){const o=H.copyObject(c);u.id_tag&&(o.id_tag=u.id_tag),u.id_dir&&(o.id_dir=u.id_dir);let e=!1;c.rate&&(e=!0),c.keyword.trim()&&(e=!0),c.node_type&&c.node_type!="any"&&(e=!0),e?o.mode="search":o.mode="directory",s.go(o)}function D(o,e){switch(console.info("emitGo",o,e),o){case"reload":b();break;case"tag":s.go({mode:"directory",id_tag:`${e}`});break;case"node":let t;for(let r=0;r<y.value.length;r++)if(y.value[r].id===e){t=y.value[r];break}if(!t)break;switch(t.type){case"directory":s.go({mode:"directory",id_dir:`${t.id}`});break;default:se(H.copyObject(u),t.id??0);break}break}}Y(async()=>{console.info("onMounted"),m.query&&N(m.query),s=new Z({route:m,router:I,getList:b,contentDOM:v.value,emitGo:D}),await b()&&(s.reloadScroll(),document.addEventListener("keydown",E))}),Q(()=>{s.destructor(),document.removeEventListener("keydown",E)});function E(o){const e=[];switch(o.ctrlKey&&e.push("ctrl"),o.shiftKey&&e.push("shift"),e.push(o.code),e.join("_")){default:return;case"ctrl_KeyU":if(!(d.value.length||u.id_dir))return;s&&s.showSelectionOp&&(o.preventDefault(),M());break;case"ctrl_KeyM":if(!(d.value.length||u.id_dir))return;s&&s.showSelectionOp&&(o.preventDefault(),B());break;case"ctrl_KeyC":case"ctrl_KeyV":case"ctrl_KeyX":if(ee(o.target))return;x(e);break;case"Enter":case"NumpadEnter":if(!o.target||o.target.id!=="searchBarInput")return;R();break}}function U(o){(d.value.length||u.id_dir)&&(o.stopPropagation(),o.preventDefault(),M())}async function x(o){console.info(o,d.value,u.id_dir);let e;switch(o.join("_")){case"ctrl_KeyC":if(e=s.getSelected(),!e.nodeLs.length)return;f.nodeList=e.nodeLs,f.mode="copy";break;case"ctrl_KeyX":if(e=s.getSelected(),!e.nodeLs.length)return;f.nodeList=e.nodeLs,f.mode="cut";break;case"ctrl_KeyV":if(!f.nodeList.length||!u.id_dir)return;await f.doPaste(u.id_dir),await b();break}}return(o,e)=>(l(),i("div",{class:"fr_content view_file",onDragover:U},[a("div",ie,[n(d).length?(l(),i("div",ue,[(l(!0),i(_,null,k(n(d),(t,r)=>(l(),i("a",{dir:"ltr",class:"item",key:r,onClick:L=>n(s).go({id_dir:`${t==null?void 0:t.id}`,mode:"directory"}),title:t.title},O(t.title),9,ce))),128))])):p("",!0),a("div",de,[a("label",null,[fe,g(a("input",{id:"searchBarInput",type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>n(c).keyword=t)},null,512),[[te,n(c).keyword]])]),a("label",null,[ye,g(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>n(c).node_type=t)},[(l(!0),i(_,null,k(n(w).fileType,(t,r)=>(l(),i("option",{key:`FV_SCH_NODE_TYPE_${r}`},O(t),1))),128))],512),[[V,n(c).node_type]])]),a("label",null,[_e,K?g((l(),i("select",{key:0,class:"sysIcon","onUpdate:modelValue":e[2]||(e[2]=t=>n(c).rate=t)},[(l(!0),i(_,null,k(n(w).rateMobile,(t,r)=>(l(),i("option",{value:r,innerHTML:t,key:`FV_SCH_CON_RATE_${r}`},null,8,pe))),128))],512)),[[V,n(c).rate]]):g((l(),i("select",{key:1,class:"sysIcon","onUpdate:modelValue":e[3]||(e[3]=t=>n(c).rate=t)},[(l(!0),i(_,null,k(n(w).rate,(t,r)=>(l(),i("option",{value:r,innerHTML:t,key:`FV_SCH_CON_RATE_${r}`},null,8,ve))),128))],512)),[[V,n(c).rate]])]),a("label",null,[me,g(a("input",{type:"checkbox","onUpdate:modelValue":e[4]||(e[4]=t=>n(c).cascade_dir=t),id:"FV_S_CB","true-value":1,"false-value":""},null,512),[[oe,n(c).cascade_dir]]),ke]),a("label",null,[a("button",{class:"buttonStyle sysIcon sysIcon_search",onClick:R})])]),a("div",be,[n(s)&&n(s).showSelectionOp?(l(),i(_,{key:0},[a("a",{class:"buttonStyle",onClick:e[5]||(e[5]=t=>n(s).bathOp("browser"))},"OP"),a("a",{class:"buttonStyle",onClick:e[6]||(e[6]=t=>n(s).bathOp("favourite"))},"FAV"),a("a",{class:"buttonStyle",onClick:e[7]||(e[7]=t=>n(s).bathOp("rename"))},"RN"),a("a",{class:"buttonStyle",onClick:e[8]||(e[8]=t=>n(s).bathOp("move"))},"MV"),n(m).name!=="Recycle"?(l(),i("a",{key:0,class:"buttonStyle",onClick:e[9]||(e[9]=t=>n(s).bathOp("delete"))},"DEL")):p("",!0),n(m).name==="Recycle"?(l(),i("a",{key:1,class:"buttonStyle",onClick:e[10]||(e[10]=t=>n(s).bathOp("delete_forever"))},"rDEL")):p("",!0),ge],64)):p("",!0),n(d).length||n(u).id_dir=="0"?(l(),i(_,{key:1},[a("a",{class:"buttonStyle sysIcon sysIcon_addfolder",onClick:B}),a("a",{class:"buttonStyle sysIcon sysIcon_addfile",onClick:M}),he],64)):p("",!0),n(s)&&n(s).sortVal?(l(),i("label",we,[Se,g(a("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>n(s).sortVal.value=t),onChange:e[12]||(e[12]=t=>n(s).setSort(o.sortVal))},[(l(!0),i(_,null,k(n(w).sort,(t,r)=>(l(),i("option",{value:r,key:`FV_SCH_CON_SORT_${r}`},O(t),9,Ce))),128))],544),[[V,n(s).sortVal.value]])])):p("",!0),Le,n(s)?(l(!0),i(_,{key:3},k(n(w).listType,(t,r)=>(l(),i("a",{class:F(["buttonStyle","sysIcon",`sysIcon_listType_${t}`,{active:n(s).mode.value===t}]),onClick:L=>n(s).setMode(t),key:`FAV_SCH_BTN_${r}`},null,10,Oe))),128)):p("",!0)]),n(f)&&n(f).nodeList.length?(l(),i("div",Ve,[a("span",{class:F(["sysIcon",`sysIcon_${n(f).mode}`])},O(n(f).nodeList.length),3)])):p("",!0)]),a("div",{class:F(["content_detail",`mode_${n(s)?n(s).mode.value:""}`]),ref_key:"contentDOM",ref:v},[(l(!0),i(_,null,k(n(y),(t,r)=>(l(),ne(ae,{key:r,node:t,index:r,selected:!1,onGo:D},null,8,["node","index"]))),128))],2)],32))}});export{Me as _};

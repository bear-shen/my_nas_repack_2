import{d as Z,u as W,a as ee,r as $,b as te,e as oe,f as se,g as le,q as h,m as ne,p as ae,h as u,i as o,n as k,F as _,j as f,w as m,v as ie,k as a,l as S,s as A,t as ue,x as de,o as i,y as b,z as R,A as w,C as V,B as q,c as re,G as ce}from"./index-D6pvmuxL.js";import{_ as N}from"./ContentEditable.vue_vue_type_script_setup_true_lang-F6SV6TeL.js";import{R as _e,F as ye}from"./FileItem-DytLDN29.js";import{H as B}from"./Hinter-Di0Hug11.js";const ve={class:"fr_content view_fav"},fe={class:"list_fav_group"},pe=["onClick"],ke={class:"title"},me=["onClick"],Ce=["onClick"],be={class:"operator"},he=["onClick"],Ve=["onClick"],$e=o("td",null,"nodeType",-1),Se=["onUpdate:modelValue"],we=["value"],Ie=o("td",null,"withTag",-1),ge={class:"favTagLs"},Oe=["onClick"],Ge=o("td",null,"or",-1),Ae=["onUpdate:modelValue","id"],Ue=["for"],Te=o("td",null,"root",-1),De=o("td",null,"cascade",-1),Fe=["onUpdate:modelValue","id"],Me=["for"],Ee=o("td",null,"rate",-1),Le=["onClick"],Re={class:"title"},qe=["onClick"],Ne=["onClick"],Be={class:"operator"},je=["onClick"],He=["onClick"],Qe={class:"content_meta"},ze={class:"search"},Pe=o("span",null,"Title : ",-1),xe=o("span",null,"Type : ",-1),Ye=o("span",null,"Rate : ",-1),Je=["value"],Ke=["value","innerHTML"],Xe={key:0,class:"display"},Ze=o("a",{class:"sysIcon sysIcon_fengefu"},null,-1),We={key:2},et=o("span",null,"Sort : ",-1),tt=["value"],ot=o("a",{class:"sysIcon sysIcon_fengefu"},null,-1),st=["onClick"],rt=Z({__name:"Favourite",setup(lt){W(),ee();const T=$(null),U=ue(),v=de();let y={id:"",keyword:""};const c=$([]),j=$(null),C=$(-1),H=window.navigator.userAgent.toLowerCase().indexOf("mobile")!==-1;te(async()=>{y.id=v.query.id??"",r.keyword=v.query.keyword??"",r.node_type=v.query.node_type??"",r.rate=v.query.rate??"",await Q(),d=new oe({route:v,router:U,getList:O,contentDOM:T.value,emitGo:E}),y.id&&(F(),await O(),await d.reloadScroll())}),se(()=>{d.destructor()}),le(async s=>{console.info(s),y.id=s.query.id??"",r.keyword=s.query.keyword??"",r.node_type=s.query.node_type??"",r.rate=s.query.rate??"",y.id&&(F(),await O())});async function Q(){const s=await h("favourite_group/get",y);s&&(s.forEach(t=>{t.edit=!1,t.ext_key=t.id}),c.value=s||[])}async function I(s){const t=c.value[s];await h("favourite_group/del",t)}async function g(s){console.info(c.value[s]);const t=ce.copyObject(c.value[s]);if(t.edit){c.value[s].edit=!1,t.meta=JSON.stringify(t.meta);const e=await h("favourite_group/mod",t);if(!e)return;c.value[s].id=parseInt(e.id??"")}else c.value[s].edit=!0}function D(s){c.value.unshift({title:"",status:1,auto:s,meta:{node_type:"any",tag_id:"",rate:"",pid:"",cascade_dir:"1",tag_or:"1"},edit:!0,ext_key:new Date().valueOf()})}function F(){if(!y.id)return;let s=parseInt(y.id);c.value.forEach((t,e)=>{s===t.id&&(C.value=e,j.value=t)})}async function M(s){const t=c.value[s];U.push({path:v.path,query:{id:t.id}})}let r={keyword:"",node_type:"any",rate:""};const p=$([]);let d;function z(){const s=Object.assign({},y,r);U.push({path:v.path,query:s})}async function O(s){if(p.value=[],s)p.value=s;else{const t=await h("file/get",Object.assign({},{mode:"favourite",fav_id:y.id,with:"file,tag"},r||{}));if(!t)return;p.value=ne(t.list,"name_asc")}d.setList(p.value)}function E(s,t){switch(s){case"reload":O();break;case"tag":d.go({tag_id:`${t}`,mode:"tag"});break;case"node":let e;for(let l=0;l<p.value.length;l++)if(p.value[l].id===t){e=p.value[l];break}if(!e)break;switch(e.type){case"directory":d.go({pid:`${e.id}`,mode:"directory"});break;default:ae({mode:"favourite",fav_id:y.id,with:"file,crumb"},e.id??0);break}break}}async function P(s){console.info("node_hint");const e=await h("file/get",{mode:"search",node_type:"directory",keyword:s,with:"crumb",limit:"20"});return e?("root".indexOf(s)!==-1&&e.list.unshift({id:0,title:"root",status:1,type:"directory",crumb_node:[]}),e.list):!1}function x(s,t){console.info("node_add",s,t);const e=c.value[t];e.meta=Object.assign(e.meta??{},{pid:s.id}),c.value[t].node=s}function Y(s){var e;if(console.info("node_parse"),!s)return"";const t=[];return(e=s.crumb_node)==null||e.forEach(l=>{l.title&&t.push(l.title)}),s.title&&t.push(s.title),`/ ${t.join(" / ")}`}async function J(s){const t=new FormData;return t.set("keyword",s),t.set("size","20"),await h("tag/get",t)}function K(s,t){const e=c.value[t];e.tag||(e.tag=[]),e.tag.push(s);const l=[];e.tag.forEach(n=>l.push(n.id??0)),e.meta=Object.assign(e.meta??{},{tag_id:l.join(",")})}function L(s){return s?`${s.group.title} : ${s.title}`:""}function X(s,t){const e=c.value[s];e.tag||(e.tag=[]),e.tag.splice(t,1);const l=[];e.tag.forEach(n=>l.push(n.id??0)),e.meta=Object.assign(e.meta??{},{tag_id:l.join(",")})}return(s,t)=>(i(),u("div",ve,[o("div",fe,[o("div",{class:k({fav_group:!0,fav_group_add:!0,active:C.value===-1})},[o("span",{class:"buttonStyle sysIcon sysIcon_plus-square-o",onClick:t[0]||(t[0]=e=>D(0))}),o("span",{class:"buttonStyle sysIcon sysIcon_A",onClick:t[1]||(t[1]=e=>D(1))})],2),(i(!0),u(_,null,f(c.value,(e,l)=>(i(),u("div",{key:`favView_group_${e.ext_key?e.ext_key:e.id}`,class:k({active:C.value===l,fav_group:!0,edit:e.edit})},[e.auto?(i(),u(_,{key:0},[e.edit?(i(),u("div",{key:1,class:k({active:C.value==l,auto:!0})},[w(N,{class:"title",modelValue:e.title,"onUpdate:modelValue":n=>e.title=n,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),o("div",be,[o("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:n=>g(l)},null,8,he),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>I(l)},null,8,Ve)]),o("table",null,[o("tr",null,[$e,o("td",null,[m(o("select",{"onUpdate:modelValue":n=>e.meta.node_type=n},[(i(!0),u(_,null,f(a(V).fileType,(n,G)=>(i(),u("option",{value:n,key:`FAV_G_${e.ext_key}_NODE_TYPE_${G}`},b(n),9,we))),128))],8,Se),[[S,e.meta.node_type]])])]),o("tr",null,[Ie,o("td",ge,[o("div",null,[(i(!0),u(_,null,f(e.tag,(n,G)=>(i(),u("p",{key:`FAV_G_${e.ext_key}_TAG_BTN_${G}`},[o("span",null,b(L(n)),1),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:nt=>X(l,G)},null,8,Oe)]))),128))]),w(B,{"get-list":J,submit:K,"parse-text":L,meta:l},null,8,["meta"])])]),o("tr",null,[Ge,o("td",null,[m(o("input",{type:"checkbox","onUpdate:modelValue":n=>e.meta.tag_or=n,id:`FAV_G_CB_S_${e.ext_key?e.ext_key:e.id}_TAG_OR`,"true-value":"1","false-value":""},null,8,Ae),[[q,e.meta.tag_or]]),o("label",{class:"buttonStyle",for:`FAV_G_CB_S_${e.ext_key?e.ext_key:e.id}_TAG_OR`},null,8,Ue)])]),o("tr",null,[Te,o("td",null,[w(B,{"get-list":P,submit:x,"parse-text":Y,modelValue:e.node,"onUpdate:modelValue":n=>e.node=n,meta:l},null,8,["modelValue","onUpdate:modelValue","meta"])])]),o("tr",null,[De,o("td",null,[m(o("input",{type:"checkbox","onUpdate:modelValue":n=>e.meta.cascade_dir=n,id:`FAV_G_CB_S_${e.ext_key?e.ext_key:e.id}_CASCADE`,"true-value":"1","false-value":""},null,8,Fe),[[q,e.meta.cascade_dir]]),o("label",{class:"buttonStyle",for:`FAV_G_CB_S_${e.ext_key?e.ext_key:e.id}_CASCADE`},null,8,Me)])]),o("tr",null,[Ee,o("td",null,[w(_e,{node:null,modelValue:e.meta.rate,"onUpdate:modelValue":n=>e.meta.rate=n},null,8,["modelValue","onUpdate:modelValue"])])])])],2)):(i(),u("div",{key:0,class:k({active:C.value==l,auto:!0}),onClick:n=>M(l)},[o("div",ke,b(e.title),1),o("div",{class:"operator",onClick:t[2]||(t[2]=R(()=>{},["stop"]))},[o("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:n=>g(l)},null,8,me),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>I(l)},null,8,Ce)])],10,pe))],64)):(i(),u(_,{key:1},[e.edit?(i(),u("div",{key:1,class:k({active:C.value==l})},[w(N,{class:"title",modelValue:e.title,"onUpdate:modelValue":n=>e.title=n,"auto-focus":!0},null,8,["modelValue","onUpdate:modelValue"]),o("div",Be,[o("span",{class:"buttonStyle sysIcon sysIcon_save",onClick:n=>g(l)},null,8,je),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>I(l)},null,8,He)])],2)):(i(),u("div",{key:0,class:k({active:C.value==l}),onClick:n=>M(l)},[o("div",Re,b(e.title),1),o("div",{class:"operator",onClick:t[3]||(t[3]=R(()=>{},["stop"]))},[o("span",{class:"buttonStyle sysIcon sysIcon_edit",onClick:n=>g(l)},null,8,qe),o("span",{class:"buttonStyle sysIcon sysIcon_delete",onClick:n=>I(l)},null,8,Ne)])],10,Le))],64))],2))),128))]),o("div",{class:"fav_content",ref_key:"contentDOM",ref:T},[o("div",Qe,[o("div",ze,[o("label",null,[Pe,m(o("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=e=>a(r).keyword=e)},null,512),[[ie,a(r).keyword]])]),o("label",null,[xe,m(o("select",{"onUpdate:modelValue":t[5]||(t[5]=e=>a(r).node_type=e)},[(i(!0),u(_,null,f(a(V).fileType,(e,l)=>(i(),u("option",{key:`FAV_SCH_CON_TYPE_${l}`},b(e),1))),128))],512),[[S,a(r).node_type]])]),o("label",null,[Ye,H?m((i(),u("select",{key:0,"onUpdate:modelValue":t[6]||(t[6]=e=>a(r).rate=e)},[(i(!0),u(_,null,f(a(V).rateMobile,(e,l)=>(i(),u("option",{value:l,key:`FAV_SCH_CON_RATE_${l}`},b(e),9,Je))),128))],512)),[[S,a(r).rate]]):m((i(),u("select",{key:1,class:"sysIcon","onUpdate:modelValue":t[7]||(t[7]=e=>a(r).rate=e)},[(i(!0),u(_,null,f(a(V).rate,(e,l)=>(i(),u("option",{value:l,innerHTML:e,key:`FAV_SCH_CON_RATE_${l}`},null,8,Ke))),128))],512)),[[S,a(r).rate]])]),o("label",null,[o("button",{class:"buttonStyle sysIcon sysIcon_search",onClick:z})])]),a(d)&&a(d).showSelectionOp?(i(),u("div",Xe,[o("a",{class:"buttonStyle",onClick:t[8]||(t[8]=e=>a(d).bathOp("browser"))},"OP"),o("a",{class:"buttonStyle",onClick:t[9]||(t[9]=e=>a(d).bathOp("rename"))},"RN"),o("a",{class:"buttonStyle",onClick:t[10]||(t[10]=e=>a(d).bathOp("move"))},"MV"),a(v).name!=="Recycle"?(i(),u("a",{key:0,class:"buttonStyle",onClick:t[11]||(t[11]=e=>a(d).bathOp("delete"))},"DEL")):A("",!0),a(v).name==="Recycle"?(i(),u("a",{key:1,class:"buttonStyle",onClick:t[12]||(t[12]=e=>a(d).bathOp("delete_forever"))},"rDEL")):A("",!0),Ze,a(d)&&a(d).sortVal?(i(),u("label",We,[et,m(o("select",{"onUpdate:modelValue":t[13]||(t[13]=e=>a(d).sortVal.value=e),onChange:t[14]||(t[14]=e=>a(d).setSort(s.sortVal))},[(i(!0),u(_,null,f(a(V).sort,(e,l)=>(i(),u("option",{value:l,key:`FV_SCH_CON_SORT_${l}`},b(e),9,tt))),128))],544),[[S,a(d).sortVal.value]])])):A("",!0),ot,(i(!0),u(_,null,f(a(V).listType,(e,l)=>(i(),u("a",{class:k(["buttonStyle","sysIcon",`sysIcon_listType_${e}`,{active:a(d).mode.value===e}]),onClick:n=>a(d).setMode(e),key:`FAV_SCH_CON_ICON_${l}`},null,10,st))),128))])):A("",!0)]),o("div",{class:k(["list_fav",`mode_${a(d)?a(d).mode.value:""}`])},[(i(!0),u(_,null,f(p.value,(e,l)=>(i(),re(ye,{key:l,node:e,index:l,selected:!1,onGo:E},null,8,["node","index"]))),128))],2)],512)]))}});export{rt as default};

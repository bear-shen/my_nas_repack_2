import{u as $,b as x,q as v,c as L,d as j}from"./index-BBv66A2b.js";import{a as C,r as g,o as M,G as k,j as S,c as a,e as n,M as i,F as c,f as b,b as l,t as o,A as m}from"./basic-BYt0z23_.js";const V=["href"],q={class:"multi"},B=["onClick"],N=C({__name:"ShareView",setup(E){$();const r=g(null);L();const D=j();let y={status:""};const _=g([]);M(async()=>{Object.assign(y,k.copyObject(D.query)),d(),r.value&&r.value.addEventListener("scroll",p)}),x(async s=>{console.info(s),d()}),S(()=>{var s;r.value&&((s=r.value)==null||s.removeEventListener("scroll",p))});async function p(s){if(console.info(s),!r.value)return;let e=r.value,t=(e==null?void 0:e.scrollTop)+(e==null?void 0:e.clientHeight)+(e==null?void 0:e.clientHeight);(e==null?void 0:e.scrollHeight)<t&&k.debounce(async()=>{await d()},500,"logViewDebounce")}let f=1,h=!1;async function d(s=!1){if(h)return;h=!0,s&&(f=1);const e=await v("share/list",Object.assign({page:f},y));if(f+=1,h=!1,!e)return;if(!e.length){f--;return}const t=s?[]:_.value;for(let u=0;u<e.length;u++)t.push(Object.assign(e[u],{ext_key:`${new Date().valueOf()}_${Math.random()}`}));_.value=t}async function O(s){await v("share/del",{id:s}),await d(!0)}return(s,e)=>(l(),a("div",{class:"fr_content view_share",ref_key:"contentDOM",ref:r},[n("table",null,[n("tbody",null,[e[1]||(e[1]=n("tr",null,[n("th",null,"id"),n("th",null,"user"),n("th",null,"path"),n("th",null,[i("time_create"),n("br"),i("time_to")]),n("th",null,"operate")],-1)),(l(!0),a(c,null,b(_.value,t=>(l(),a("tr",{key:`share_view_${t.ext_key}`},[n("td",null,[n("a",{href:`./share.html?id=${t.id}`,target:"_blank"},o(t.id),9,V)]),n("td",null,o(t.user.name),1),n("td",null,[n("div",q,[(l(!0),a(c,null,b(t.node,u=>(l(),a("p",{key:`share_view_${t.ext_key}_${u.id}`},o(u.node_path)+"/"+o(u.title),1))),128))])]),n("td",null,[i(o(t.time_create)+" ",1),e[0]||(e[0]=n("br",null,null,-1)),t.status===0?(l(),a(c,{key:1},[i("Stopped")],64)):t.status===1?(l(),a(c,{key:2},[i(o(t.time_to),1)],64)):t.status===2?(l(),a(c,{key:3},[i("Long")],64)):m("",!0)]),n("td",null,[t.status!==0?(l(),a("button",{key:0,class:"sysIcon sysIcon_delete",onClick:u=>O(t.id)},"Delete ",8,B)):m("",!0)])]))),128))])])],512))}});export{N as default};
